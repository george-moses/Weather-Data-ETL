"use strict";exports.id=885,exports.ids=[885],exports.modules={46398:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeProgram=t.nullCallback=void 0;const s=n(88711),o=r(n(30795)),l=n(59273);t.nullCallback=()=>{},t.analyzeProgram=function(e,n,a,i,r,p){let c=!1;i=null!=i?i:t.nullCallback;try{(0,s.throwIfCancellationRequested)(p);const t=new l.Duration;c=e.analyze(n,p);const r=e.getFilesToAnalyzeCount(),o=e.getDiagnostics(a),d=o.length,u=t.getDurationInSeconds();(d>0||!c)&&i({diagnostics:o,filesInProgram:e.getFileCount(),filesRequiringAnalysis:r,checkingOnlyOpenFiles:e.isCheckingOnlyOpenFiles(),fatalErrorOccurred:!1,configParseErrorOccurred:!1,elapsedTime:u})}catch(e){if(s.OperationCanceledException.is(e))return!1;const t=o.getErrorString(e);r.error("Error performing analysis: "+t),i({diagnostics:[],filesInProgram:0,filesRequiringAnalysis:0,checkingOnlyOpenFiles:!0,fatalErrorOccurred:!0,configParseErrorOccurred:!1,elapsedTime:0,error:o.getSerializableError(e)})}return c}},21403:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAnnotationEvaluationPostponed=void 0;const a=n(86513);t.isAnnotationEvaluationPostponed=function(e){return!!e.isStubFile||(!!e.futureImports.has("annotations")||e.executionEnvironment.pythonVersion>=a.PythonVersion.V3_13)}},21:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCodeUnreachable=t.setTypeParameterSymbol=t.getTypeParameterSymbol=t.setDunderAllInfo=t.getDunderAllInfo=t.setCodeFlowComplexity=t.getCodeFlowComplexity=t.setCodeFlowExpressions=t.getCodeFlowExpressions=t.setFileInfo=t.getFileInfo=t.setAfterFlowNode=t.getAfterFlowNode=t.setFlowNode=t.getFlowNode=t.setDeclaration=t.getDeclaration=t.setScope=t.getScope=t.setImportInfo=t.getImportInfo=t.cleanNodeAnalysisInfo=void 0;const a=n(80563);function i(e){return e.flowNode}t.cleanNodeAnalysisInfo=function(e){const t=e;delete t.scope,delete t.declaration,delete t.flowNode,delete t.afterFlowNode,delete t.fileInfo,delete t.codeFlowExpressions,delete t.codeFlowComplexity,delete t.dunderAllInfo,delete t.typeParameterSymbol},t.getImportInfo=function(e){return e.importInfo},t.setImportInfo=function(e,t){e.importInfo=t},t.getScope=function(e){return e.scope},t.setScope=function(e,t){e.scope=t},t.getDeclaration=function(e){return e.declaration},t.setDeclaration=function(e,t){e.declaration=t},t.getFlowNode=i,t.setFlowNode=function(e,t){e.flowNode=t},t.getAfterFlowNode=function(e){return e.afterFlowNode},t.setAfterFlowNode=function(e,t){e.afterFlowNode=t},t.getFileInfo=function(e){for(;36!==e.nodeType;)e=e.parent;return e.fileInfo},t.setFileInfo=function(e,t){e.fileInfo=t},t.getCodeFlowExpressions=function(e){return e.codeFlowExpressions},t.setCodeFlowExpressions=function(e,t){e.codeFlowExpressions=t},t.getCodeFlowComplexity=function(e){var t;return null!==(t=e.codeFlowComplexity)&&void 0!==t?t:0},t.setCodeFlowComplexity=function(e,t){e.codeFlowComplexity=t},t.getDunderAllInfo=function(e){return e.dunderAllInfo},t.setDunderAllInfo=function(e,t){e.dunderAllInfo=t},t.getTypeParameterSymbol=function(e){return e.typeParameterSymbol},t.setTypeParameterSymbol=function(e,t){e.typeParameterSymbol=t},t.isCodeUnreachable=function(e){let t=e;for(;t;){const e=i(t);if(e)return!!(e.flags&a.FlowFlags.Unreachable);t=t.parent}return!1}},24618:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundAnalysisProgram=t.InvalidatedReason=void 0;const a=n(46398),i=n(12394);!function(e){e[e.Reanalyzed=0]="Reanalyzed",e[e.SourceWatcherChanged=1]="SourceWatcherChanged",e[e.LibraryWatcherChanged=2]="LibraryWatcherChanged",e[e.LibraryWatcherContentOnlyChanged=3]="LibraryWatcherContentOnlyChanged"}(t.InvalidatedReason||(t.InvalidatedReason={}));t.BackgroundAnalysisProgram=class{constructor(e,t,n,a,r,s,o,l,p){this.serviceId=e,this._console=t,this._configOptions=n,this._importResolver=a,this._backgroundAnalysis=r,this._maxAnalysisTime=s,this._disableChecker=o,this._disposed=!1,this._program=new i.Program(this.importResolver,this.configOptions,this._console,void 0,p,this._disableChecker,l,e)}get configOptions(){return this._configOptions}get importResolver(){return this._importResolver}get program(){return this._program}get host(){return this._importResolver.host}get backgroundAnalysis(){return this._backgroundAnalysis}hasSourceFile(e){return!!this._program.getSourceFile(e)}setConfigOptions(e){var t;this._configOptions=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setConfigOptions(e),this._program.setConfigOptions(e)}setImportResolver(e){var t;this._importResolver=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setImportResolver(e),this._program.setImportResolver(e),this.configOptions.getExecutionEnvironments().forEach((e=>this._ensurePartialStubPackages(e)))}setTrackedFiles(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.setTrackedFiles(e);const n=this._program.setTrackedFiles(e);this._reportDiagnosticsForRemovedFiles(n)}setAllowedThirdPartyImports(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.setAllowedThirdPartyImports(e),this._program.setAllowedThirdPartyImports(e)}setFileOpened(e,t,n,a){var i;null===(i=this._backgroundAnalysis)||void 0===i||i.setFileOpened(e,t,n,a),this._program.setFileOpened(e,t,n,a)}getChainedFilePath(e){return this._program.getChainedFilePath(e)}updateChainedFilePath(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.updateChainedFilePath(e,t),this._program.updateChainedFilePath(e,t)}updateOpenFileContents(e,t,n,a){var i;null===(i=this._backgroundAnalysis)||void 0===i||i.setFileOpened(e,t,n,a),this._program.setFileOpened(e,t,n,a),this.markFilesDirty([e],!0)}setFileClosed(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.setFileClosed(e,t);const a=this._program.setFileClosed(e,t);this._reportDiagnosticsForRemovedFiles(a)}addInterimFile(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.addInterimFile(e),this._program.addInterimFile(e)}markAllFilesDirty(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.markAllFilesDirty(e),this._program.markAllFilesDirty(e)}markFilesDirty(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.markFilesDirty(e,t),this._program.markFilesDirty(e,t)}setCompletionCallback(e){var t;this._onAnalysisCompletion=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setCompletionCallback(e)}startAnalysis(e){return this._backgroundAnalysis?(this._backgroundAnalysis.startAnalysis(this,e),!1):(0,a.analyzeProgram)(this._program,this._maxAnalysisTime,this._configOptions,this._onAnalysisCompletion,this._console,e)}analyzeFile(e,t){return this._program.analyzeFile(e,t)}libraryUpdated(){}async getDiagnosticsForRange(e,t,n){return this._backgroundAnalysis?this._backgroundAnalysis.getDiagnosticsForRange(e,t,n):this._program.getDiagnosticsForRange(e,t)}async writeTypeStub(e,t,n,i){return this._backgroundAnalysis?this._backgroundAnalysis.writeTypeStub(e,t,n,i):((0,a.analyzeProgram)(this._program,void 0,this._configOptions,this._onAnalysisCompletion,this._console,i),this._program.writeTypeStub(e,t,n,i))}invalidateAndForceReanalysis(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.invalidateAndForceReanalysis(e),this._importResolver.invalidateCache(),this._program.markAllFilesDirty(!0)}restart(){var e;null===(e=this._backgroundAnalysis)||void 0===e||e.restart()}dispose(){var e;this._disposed||(this._disposed=!0,this._program.dispose(),null===(e=this._backgroundAnalysis)||void 0===e||e.shutdown())}enterEditMode(){this._preEditAnalysis=this._backgroundAnalysis,this._backgroundAnalysis=void 0,this._program.enterEditMode()}exitEditMode(){return this._backgroundAnalysis=this._preEditAnalysis,this._preEditAnalysis=void 0,this._program.exitEditMode()}_ensurePartialStubPackages(e){var t;return null===(t=this._backgroundAnalysis)||void 0===t||t.ensurePartialStubPackages(e.root),this._importResolver.ensurePartialStubPackages(e)}_reportDiagnosticsForRemovedFiles(e){0!==e.length&&!this._backgroundAnalysis&&this._onAnalysisCompletion&&this._onAnalysisCompletion({diagnostics:e,filesInProgram:this._program.getFileCount(),filesRequiringAnalysis:this._program.getFilesToAnalyzeCount(),checkingOnlyOpenFiles:this._program.isCheckingOnlyOpenFiles(),fatalErrorOccurred:!1,configParseErrorOccurred:!1,elapsedTime:0})}}},43324:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DummyScopeGenerator=t.ReturnFinder=t.YieldFinder=t.Binder=void 0;const s=n(5284),o=n(30795),l=n(28513),p=n(81844),c=n(96541),d=n(6698),u=n(99661),m=r(n(21)),y=n(80563),g=n(44660),h=n(91128),f=r(n(66455)),T=n(59438),v=n(89126),b=r(n(93890)),_=n(16682),I=n(48466);class C extends T.ParseTreeWalker{constructor(e,t=!1){super(),this._moduleSymbolOnly=t,this._deferredBindingTasks=[],this._activeTypeParams=new Map,this._currentExceptTargets=[],this._finallyTargets=[],this._typingImportAliases=[],this._sysImportAliases=[],this._dataclassesImportAliases=[],this._typingSymbolAliases=new Map,this._dataclassesSymbolAliases=new Map,this._dunderAllStringNodes=[],this._usesUnsupportedDunderAllForm=!1,this._isInExceptSuite=!1,this._isInAnnotatedAnnotation=!1,this._potentialHiddenSymbols=new Map,this._potentialPrivateSymbols=new Map,this._codeFlowComplexity=0,this._fileInfo=e}bindModule(e){var t;const n=void 0===this._fileInfo.builtinsScope;this._createNewScope(n?4:3,this._fileInfo.builtinsScope,(()=>{m.setScope(e,this._currentScope),m.setFlowNode(e,this._currentFlowNode),this._addImplicitSymbolToCurrentScope("__name__",e,"str"),this._addImplicitSymbolToCurrentScope("__qualname__",e,"str"),this._addImplicitSymbolToCurrentScope("__loader__",e,"Any"),this._addImplicitSymbolToCurrentScope("__package__",e,"str"),this._addImplicitSymbolToCurrentScope("__spec__",e,"Any"),this._addImplicitSymbolToCurrentScope("__path__",e,"Iterable[str]"),this._addImplicitSymbolToCurrentScope("__file__",e,"str"),this._addImplicitSymbolToCurrentScope("__cached__",e,"str"),this._addImplicitSymbolToCurrentScope("__dict__",e,"Dict[str, Any]"),this._addImplicitSymbolToCurrentScope("__annotations__",e,"Dict[str, Any]"),this._addImplicitSymbolToCurrentScope("__builtins__",e,"Any");const t=f.getDocString(e.statements);this._addImplicitSymbolToCurrentScope("__doc__",e,t?"str":"str | None"),this._currentFlowNode=this._createStartFlowNode(),this._walkStatementsAndReportUnreachable(e.statements),m.setAfterFlowNode(e,this._currentFlowNode),m.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions),m.setCodeFlowComplexity(e,this._codeFlowComplexity)})),this._bindDeferred(),this._potentialHiddenSymbols.forEach(((e,t)=>{var n;(null===(n=this._dunderAllNames)||void 0===n?void 0:n.some((e=>e===t)))||(this._fileInfo.isStubFile?e.setIsExternallyHidden():e.setPrivatePyTypedImport())})),this._potentialPrivateSymbols.forEach(((e,t)=>{var n;(null===(n=this._dunderAllNames)||void 0===n?void 0:n.some((e=>e===t)))||e.setIsPrivateMember()})),this._dunderAllNames?m.setDunderAllInfo(e,{names:this._dunderAllNames,stringNodes:this._dunderAllStringNodes,usesUnsupportedDunderAllForm:this._usesUnsupportedDunderAllForm}):m.setDunderAllInfo(e,void 0);const a=m.getScope(e);if(a&&this._dunderAllNames)for(const e of this._dunderAllNames)null===(t=a.symbolTable.get(e))||void 0===t||t.setIsInDunderAll()}visitModule(e){return(0,o.fail)("We should never get here"),!1}visitSuite(e){return this._walkStatementsAndReportUnreachable(e.statements),!1}visitModuleName(e){const t=m.getImportInfo(e);if((0,o.assert)(void 0!==t),t.isNativeLib)return!0;if(!t.isImportFound)return this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingImports,l.DiagnosticRule.reportMissingImports,u.Localizer.Diagnostic.importResolveFailure().format({importName:t.importName}),e),!0;if(!t.isStubFile&&1===t.importType&&!t.pyTypedInfo){const n=this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingTypeStubs,l.DiagnosticRule.reportMissingTypeStubs,u.Localizer.Diagnostic.stubFileMissing().format({importName:t.importName}),e);if(n){const e={action:"pyright.createtypestub",moduleName:t.importName};n.addAction(e)}}return!0}visitClass(e){this.walkMultiple(e.decorators);const t={type:6,node:e,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},n=this._bindNameToScope(this._currentScope,e.name);return n&&n.addDeclaration(t),m.setDeclaration(e,t),e.typeParameters&&this.walk(e.typeParameters),this.walkMultiple(e.arguments),this._createNewScope(2,this._getNonClassParentScope(),(()=>{m.setScope(e,this._currentScope),this._addImplicitSymbolToCurrentScope("__doc__",e,"str | None"),this._addImplicitSymbolToCurrentScope("__module__",e,"str"),this._dunderSlotsEntries=void 0,this._moduleSymbolOnly||this.walk(e.suite),this._dunderSlotsEntries&&this._addSlotsToCurrentScope(this._dunderSlotsEntries),this._dunderSlotsEntries=void 0})),this._createAssignmentTargetFlowNodes(e.name,!1,!1),e.typeParameters&&this._removeActiveTypeParameters(e.typeParameters),!1}visitFunction(e){this._createVariableAnnotationFlowNode(),m.setFlowNode(e,this._currentFlowNode);const t=this._bindNameToScope(this._currentScope,e.name),n=f.getEnclosingClass(e,!0),a={type:5,node:e,isMethod:!!n,isGenerator:!1,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};return t&&t.addDeclaration(a),m.setDeclaration(e,a),e.parameters.forEach((e=>{e.defaultValue&&this.walk(e.defaultValue)})),e.typeParameters&&this.walk(e.typeParameters),this.walkMultiple(e.decorators),e.parameters.forEach((e=>{e.typeAnnotation&&this.walk(e.typeAnnotation),e.typeAnnotationComment&&this.walk(e.typeAnnotationComment)})),e.returnTypeAnnotation&&this.walk(e.returnTypeAnnotation),e.functionAnnotationComment&&this.walk(e.functionAnnotationComment),this._createNewScope(1,this._getNonClassParentScope(),(()=>{m.setScope(e,this._currentScope);f.getEnclosingClass(e)&&this._addImplicitSymbolToCurrentScope("__class__",e,"class"),this._deferBinding((()=>{this._currentFlowNode=this._createStartFlowNode(),this._codeFlowComplexity=0,e.parameters.forEach((t=>{var n,a;if(t.name){const i=this._bindNameToScope(this._currentScope,t.name);let r=f.getDocString(null!==(a=null===(n=null==e?void 0:e.suite)||void 0===n?void 0:n.statements)&&void 0!==a?a:[]);if(void 0!==r&&(r=(0,h.extractParameterDocumentation)(r,t.name.value)),i){const e={type:2,node:t,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(t,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:r};i.addDeclaration(e),m.setDeclaration(t.name,e)}this._createFlowAssignment(t.name)}})),this._targetFunctionDeclaration=a,this._currentReturnTarget=this._createBranchLabel(),this.walk(e.suite),m.setAfterFlowNode(e.suite,this._currentFlowNode),this._addAntecedent(this._currentReturnTarget,this._currentFlowNode);const t=this._finishFlowLabel(this._currentReturnTarget);m.setAfterFlowNode(e,t),m.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions),m.setCodeFlowComplexity(e,this._codeFlowComplexity)}))})),this._createAssignmentTargetFlowNodes(e.name,!1,!1),e.typeParameters&&this._removeActiveTypeParameters(e.typeParameters),!1}visitLambda(e){return this._createVariableAnnotationFlowNode(),m.setFlowNode(e,this._currentFlowNode),e.parameters.forEach((e=>{e.defaultValue&&this.walk(e.defaultValue)})),this._createNewScope(1,this._getNonClassParentScope(),(()=>{m.setScope(e,this._currentScope),this._deferBinding((()=>{this._currentFlowNode=this._createStartFlowNode(),e.parameters.forEach((e=>{if(e.name){const t=this._bindNameToScope(this._currentScope,e.name);if(t){const n={type:2,node:e,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};t.addDeclaration(n),m.setDeclaration(e.name,n)}this._createFlowAssignment(e.name),this.walk(e.name),m.setFlowNode(e,this._currentFlowNode)}})),this.walk(e.expression),m.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions)}))})),!1}visitCall(e){var t,n;if(this._disableTrueFalseTargets((()=>{this.walk(e.leftExpression),e.arguments.forEach((e=>{this._currentFlowNode&&m.setFlowNode(e,this._currentFlowNode),this.walk(e)}))})),f.isNodeContainedWithinNodeType(e,13)||this._isInAnnotatedAnnotation||this._createCallFlowNode(e),3===this._currentScope.type&&35===e.leftExpression.nodeType&&38===e.leftExpression.leftExpression.nodeType&&"__all__"===e.leftExpression.leftExpression.value){let a=!0;if("extend"===e.leftExpression.memberName.value&&1===e.arguments.length){const t=e.arguments[0].valueExpression;if(31===t.nodeType)t.entries.forEach((e=>{var t,n;48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(e.strings[0].value),null===(n=this._dunderAllStringNodes)||void 0===n||n.push(e.strings[0]),a=!1)}));else if(35===t.nodeType&&38===t.leftExpression.nodeType&&"__all__"===t.memberName.value){const e=this._getDunderAllNamesFromImport(t.leftExpression.value);e&&e.length>0&&(e.forEach((e=>{var t;null===(t=this._dunderAllNames)||void 0===t||t.push(e)})),a=!1)}}else if("remove"===e.leftExpression.memberName.value&&1===e.arguments.length){const t=e.arguments[0].valueExpression;48===t.nodeType&&1===t.strings.length&&49===t.strings[0].nodeType&&this._dunderAllNames&&(this._dunderAllNames=this._dunderAllNames.filter((e=>e!==t.strings[0].value)),this._dunderAllStringNodes=this._dunderAllStringNodes.filter((e=>e.value!==t.strings[0].value)),a=!1)}else if("append"===e.leftExpression.memberName.value&&1===e.arguments.length){const i=e.arguments[0].valueExpression;48===i.nodeType&&1===i.strings.length&&49===i.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(i.strings[0].value),null===(n=this._dunderAllStringNodes)||void 0===n||n.push(i.strings[0]),a=!1)}a&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,u.Localizer.Diagnostic.unsupportedDunderAllOperation(),e))}return!1}visitTypeParameterList(e){return e.parameters.forEach((e=>{e.boundExpression&&this.walk(e.boundExpression)})),e.parameters.forEach((t=>{const n=t.name,a=new _.Symbol(0),i={type:3,node:t,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};a.addDeclaration(i),m.setDeclaration(n,i),m.setTypeParameterSymbol(n,a),this._activeTypeParams.has(n.value)?this._addError(u.Localizer.Diagnostic.typeParameterExistingTypeParameter().format({name:n.value}),n):this._activeTypeParams.set(n.value,a)})),e.parameters.forEach((e=>{e.defaultExpression&&this.walk(e.defaultExpression)})),!1}visitTypeAlias(e){this._bindNameToScope(this._currentScope,e.name),this.walk(e.name),e.typeParameters&&this.walk(e.typeParameters);const t={type:4,node:e,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},n=this._bindNameToScope(this._currentScope,e.name);return n&&n.addDeclaration(t),m.setDeclaration(e,t),this._createAssignmentTargetFlowNodes(e.name,!0,!1),this.walk(e.expression),e.typeParameters&&this._removeActiveTypeParameters(e.typeParameters),!1}visitAssignment(e){if(this._handleTypingStubAssignmentOrAnnotation(e))return!1;if(this._bindPossibleTupleNamedTarget(e.leftExpression),e.typeAnnotationComment&&(this.walk(e.typeAnnotationComment),this._addTypeDeclarationForVariable(e.leftExpression,e.typeAnnotationComment)),e.chainedTypeAnnotationComment&&this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,u.Localizer.Diagnostic.annotationNotSupported(),e.chainedTypeAnnotationComment),24===e.leftExpression.nodeType){const t=e.leftExpression;if(1===t.items.length&&!t.trailingComma&&48===t.items[0].valueExpression.nodeType&&(0,y.isCodeFlowSupportedForReference)(t.baseExpression)){const e=(0,y.createKeyForReference)(t.baseExpression);this._currentScopeCodeFlowExpressions.add(e)}}this.walk(e.rightExpression);let t=!0;if((f.getEnclosingFunction(e)||9===e.rightExpression.nodeType&&this._fileInfo.isTypingStubFile||f.isWithinLoop(e))&&(t=!1),this._addInferredTypeAssignmentForVariable(e.leftExpression,e.rightExpression,t),this._createAssignmentTargetFlowNodes(e.leftExpression,!0,!1),3===this._currentScope.type&&(38===e.leftExpression.nodeType&&"__all__"===e.leftExpression.value||54===e.leftExpression.nodeType&&38===e.leftExpression.valueExpression.nodeType&&"__all__"===e.leftExpression.valueExpression.value)){const t=e.rightExpression;this._dunderAllNames=[];let n=!1;31===t.nodeType?t.entries.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?(this._dunderAllNames.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0])):n=!0})):52===t.nodeType?t.expressions.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?(this._dunderAllNames.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0])):n=!0})):n=!0,n&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,u.Localizer.Diagnostic.unsupportedDunderAllOperation(),e))}if(2===this._currentScope.type&&(38===e.leftExpression.nodeType&&"__slots__"===e.leftExpression.value||54===e.leftExpression.nodeType&&38===e.leftExpression.valueExpression.nodeType&&"__slots__"===e.leftExpression.valueExpression.value)){const t=e.rightExpression;this._dunderSlotsEntries=[];let n=!0;48===t.nodeType?this._dunderSlotsEntries.push(t):31===t.nodeType?t.entries.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?this._dunderSlotsEntries.push(e):n=!1})):52===t.nodeType?t.expressions.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?this._dunderSlotsEntries.push(e):n=!1})):n=!1,n||(this._dunderSlotsEntries=void 0)}return!1}visitAssignmentExpression(e){this._disableTrueFalseTargets((()=>{this.walk(e.rightExpression)}));const t=f.getEvaluationNodeForAssignmentExpression(e);if(t){const n=m.getScope(t);let a=this._currentScope;for(;a&&a!==n;){if(a.lookUpSymbol(e.name.value)){this._addError(u.Localizer.Diagnostic.assignmentExprComprehension().format({name:e.name.value}),e.name);break}a=a.parent}this._bindNameToScope(n,e.name),this._addInferredTypeAssignmentForVariable(e.name,e.rightExpression),this._createAssignmentTargetFlowNodes(e.name,!0,!1)}else this._addError(u.Localizer.Diagnostic.assignmentExprContext(),e),this.walk(e.name);return!1}visitAugmentedAssignment(e){if(this.walk(e.leftExpression),this.walk(e.rightExpression),this._bindPossibleTupleNamedTarget(e.destExpression),this._createAssignmentTargetFlowNodes(e.destExpression,!1,!1),1===e.operator&&3===this._currentScope.type&&38===e.leftExpression.nodeType&&"__all__"===e.leftExpression.value){const t=e.rightExpression;let n=!0;if(31===t.nodeType)t.entries.forEach((e=>{var t;48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0]))})),n=!1;else if(35===t.nodeType&&38===t.leftExpression.nodeType&&"__all__"===t.memberName.value){const e=this._getDunderAllNamesFromImport(t.leftExpression.value);e&&(e.forEach((e=>{var t;null===(t=this._dunderAllNames)||void 0===t||t.push(e)})),n=!1)}n&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,u.Localizer.Diagnostic.unsupportedDunderAllOperation(),e))}return!1}visitDel(e){return e.expressions.forEach((e=>{this._bindPossibleTupleNamedTarget(e),this.walk(e),this._createAssignmentTargetFlowNodes(e,!1,!0)})),!1}visitTypeAnnotation(e){var t;if(this._handleTypingStubAssignmentOrAnnotation(e))return!1;const n=3===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&void 0!==f.getEnclosingClass(e,!0);n||this.walk(e.typeAnnotation),this._createVariableAnnotationFlowNode(),this._bindPossibleTupleNamedTarget(e.valueExpression),this._addTypeDeclarationForVariable(e.valueExpression,e.typeAnnotation),n&&this.walk(e.typeAnnotation);const a=[];return this._isNarrowingExpression(e.valueExpression,a)&&a.forEach((e=>{const t=(0,y.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)})),this.walk(e.valueExpression),!1}visitFor(e){this._bindPossibleTupleNamedTarget(e.targetExpression),this._addInferredTypeAssignmentForVariable(e.targetExpression,e),this.walk(e.iterableExpression);const t=this._createLoopLabel(),n=this._createBranchLabel(),a=this._createBranchLabel();this._addAntecedent(t,this._currentFlowNode),this._currentFlowNode=t,this._addAntecedent(n,this._currentFlowNode);const i=this._trackCodeFlowExpressions((()=>{this._createAssignmentTargetFlowNodes(e.targetExpression,!0,!1)}));if(this._bindLoopStatement(t,a,(()=>{this.walk(e.forSuite),this._addAntecedent(t,this._currentFlowNode),i.forEach((e=>{var t;null===(t=this._currentScopeCodeFlowExpressions)||void 0===t||t.add(e)}))})),this._currentFlowNode=this._finishFlowLabel(n),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),e.asyncToken&&!this._fileInfo.ipythonMode){const t=f.getEnclosingFunction(e);t&&t.isAsync||this._addError(u.Localizer.Diagnostic.asyncNotInAsyncFunction(),e.asyncToken)}return!1}visitContinue(e){return this._currentContinueTarget&&this._addAntecedent(this._currentContinueTarget,this._currentFlowNode),this._currentFlowNode=C._unreachableFlowNode,!1}visitBreak(e){return this._currentBreakTarget&&this._addAntecedent(this._currentBreakTarget,this._currentFlowNode),this._currentFlowNode=C._unreachableFlowNode,!1}visitReturn(e){return this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.returnStatements||(this._targetFunctionDeclaration.returnStatements=[]),this._targetFunctionDeclaration.returnStatements.push(e)),e.returnExpression&&this.walk(e.returnExpression),m.setFlowNode(e,this._currentFlowNode),this._currentReturnTarget&&this._addAntecedent(this._currentReturnTarget,this._currentFlowNode),this._finallyTargets.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),this._currentFlowNode=C._unreachableFlowNode,!1}visitYield(e){return this._isInListComprehension(e,!0)&&this._addError(u.Localizer.Diagnostic.yieldWithinListCompr(),e),this._bindYield(e),!1}visitYieldFrom(e){return this._isInListComprehension(e,!0)&&this._addError(u.Localizer.Diagnostic.yieldWithinListCompr(),e),this._bindYield(e),!1}visitMemberAccess(e){return this.walk(e.leftExpression),m.setFlowNode(e,this._currentFlowNode),!1}visitName(e){m.setFlowNode(e,this._currentFlowNode);const t=this._activeTypeParams.get(e.value);return t&&m.setTypeParameterSymbol(e,t),!1}visitIndex(e){m.setFlowNode(e,this._currentFlowNode),this.walk(e.baseExpression);const t=this._isInAnnotatedAnnotation;return this._isTypingAnnotation(e.baseExpression,"Annotated")&&(this._isInAnnotatedAnnotation=!0),e.items.forEach((e=>{this.walk(e)})),this._isInAnnotatedAnnotation=t,!1}visitIf(e){const t=this._currentFlowNode,n=this._createBranchLabel(),a=this._createBranchLabel(),i=this._createBranchLabel(t);return i.affectedExpressions=this._trackCodeFlowExpressions((()=>{const t=b.evaluateStaticBoolLikeExpression(e.testExpression,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases);this._bindConditional(e.testExpression,n,a),this._currentFlowNode=!1===t?C._unreachableFlowNode:this._finishFlowLabel(n),this.walk(e.ifSuite),this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=!0===t?C._unreachableFlowNode:this._finishFlowLabel(a),e.elseSuite?this.walk(e.elseSuite):this._bindNeverCondition(e.testExpression,i,!1),this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(i)})),!1}visitWhile(e){const t=this._createBranchLabel(),n=this._createBranchLabel(),a=this._createBranchLabel(),i=b.evaluateStaticBoolLikeExpression(e.testExpression,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases),r=this._createLoopLabel();return this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=r,this._bindConditional(e.testExpression,t,n),this._currentFlowNode=!1===i?C._unreachableFlowNode:this._finishFlowLabel(t),this._bindLoopStatement(r,a,(()=>{this.walk(e.whileSuite)})),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=!0===i?C._unreachableFlowNode:this._finishFlowLabel(n),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),!1}visitAssert(e){const t=this._createBranchLabel(),n=this._createBranchLabel();return this._bindConditional(e.testExpression,t,n),e.exceptionExpression&&(this._currentFlowNode=this._finishFlowLabel(n),this.walk(e.exceptionExpression)),this._currentFlowNode=this._finishFlowLabel(t),!1}visitExcept(e){if(e.typeExpression&&this.walk(e.typeExpression),e.name){this.walk(e.name);const t=this._bindNameToScope(this._currentScope,e.name);if(this._createAssignmentTargetFlowNodes(e.name,!0,!1),t){const n={type:1,node:e.name,isConstant:(0,I.isConstantName)(e.name.value),inferredTypeSource:e,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};t.addDeclaration(n)}}const t=this._isInExceptSuite;return this._isInExceptSuite=!0,this.walk(e.exceptSuite),this._isInExceptSuite=t,e.name&&this._createFlowAssignment(e.name,!0),!1}visitRaise(e){return this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.raiseStatements||(this._targetFunctionDeclaration.raiseStatements=[]),this._targetFunctionDeclaration.raiseStatements.push(e)),e.typeExpression&&this.walk(e.typeExpression),e.valueExpression&&this.walk(e.valueExpression),e.tracebackExpression&&this.walk(e.tracebackExpression),this._finallyTargets.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),this._currentFlowNode=C._unreachableFlowNode,!1}visitTry(e){const t=this._currentFlowNode,n=e.exceptClauses.map((()=>this._createBranchLabel())),a=this._createBranchLabel(t);let i=!1;const r=this._createBranchLabel(t),s={flags:y.FlowFlags.PreFinallyGate,id:this._getUniqueFlowNodeId(),antecedent:r,isGateClosed:!1};if(a.affectedExpressions=this._trackCodeFlowExpressions((()=>{e.finallySuite&&this._addAntecedent(a,s);e.exceptClauses.some((e=>!e.typeExpression))||n.push(r),n.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),e.finallySuite&&this._finallyTargets.push(r),this._useExceptTargets(n,(()=>{this.walk(e.trySuite)})),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._isCodeUnreachable()||(i=!0),e.exceptClauses.forEach(((e,t)=>{this._currentFlowNode=this._finishFlowLabel(n[t]),this.walk(e),this._addAntecedent(a,this._currentFlowNode),this._isCodeUnreachable()||(i=!0)})),e.finallySuite&&this._finallyTargets.pop(),this._currentFlowNode=this._finishFlowLabel(a)})),e.finallySuite){this.walk(e.finallySuite);const t={flags:y.FlowFlags.PostFinally,id:this._getUniqueFlowNodeId(),finallyNode:e.finallySuite,antecedent:this._currentFlowNode,preFinallyGate:s};this._currentFlowNode=i?t:C._unreachableFlowNode}return!1}visitAwait(e){var t;const n=f.getEnclosingFunction(e);if(void 0===n||!n.isAsync){if(this._fileInfo.ipythonMode&&void 0===n)return!0;32!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&this._addError(u.Localizer.Diagnostic.awaitNotInAsync(),e)}return!0}visitGlobal(e){const t=this._currentScope.getGlobalScope().scope;return e.nameList.forEach((e=>{const n=e.value;0===this._currentScope.getBindingType(n)&&this._addError(u.Localizer.Diagnostic.nonLocalRedefinition().format({name:n}),e);const a=this._currentScope.lookUpSymbolRecursive(n);a&&a.scope===this._currentScope&&this._addError(u.Localizer.Diagnostic.globalReassignment().format({name:n}),e),this._bindNameToScope(t,e),this._currentScope!==t&&this._currentScope.setBindingType(n,1)})),!0}visitNonlocal(e){const t=this._currentScope.getGlobalScope().scope;return this._currentScope===t?this._addError(u.Localizer.Diagnostic.nonLocalInModule(),e):e.nameList.forEach((e=>{const n=e.value;1===this._currentScope.getBindingType(n)&&this._addError(u.Localizer.Diagnostic.globalRedefinition().format({name:n}),e);const a=this._currentScope.lookUpSymbolRecursive(n);a&&a.scope===this._currentScope?this._addError(u.Localizer.Diagnostic.nonLocalReassignment().format({name:n}),e):a&&a.scope!==t||this._addError(u.Localizer.Diagnostic.nonLocalNoBinding().format({name:n}),e),a&&this._currentScope.setBindingType(n,0)})),!0}visitImportAs(e){var t,n,a,i,r,s;if(e.module.nameParts.length>0){const l=e.module.nameParts[0].value;let p,c;e.alias?(p=e.alias.value,c=e.alias):(p=l,c=e.module.nameParts[0]);const d=this._bindNameToScope(this._currentScope,c);!d||3!==this._currentScope.type&&4!==this._currentScope.type||e.alias&&1===e.module.nameParts.length&&e.module.nameParts[0].value===e.alias.value||(this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage)&&this._potentialHiddenSymbols.set(p,d);const u=m.getImportInfo(e.module);(0,o.assert)(void 0!==u),d&&this._createAliasDeclarationForMultipartImportName(e,e.alias,u,d),this._createFlowAssignment(e.alias?e.alias:e.module.nameParts[0]),1===e.module.nameParts.length&&("typing"===l||"typing_extensions"===l?this._typingImportAliases.push(null!==(n=null===(t=e.alias)||void 0===t?void 0:t.value)&&void 0!==n?n:l):"sys"===l?this._sysImportAliases.push(null!==(i=null===(a=e.alias)||void 0===a?void 0:a.value)&&void 0!==i?i:l):"dataclasses"===l&&this._dataclassesImportAliases.push(null!==(s=null===(r=e.alias)||void 0===r?void 0:r.value)&&void 0!==s?s:l))}return!0}visitImportFrom(e){var t;const n=["Final","ClassVar","Annotated"],a=["InitVar"],i=m.getImportInfo(e.module);m.setFlowNode(e,this._currentFlowNode);let r="";i&&i.isImportFound&&!i.isNativeLib&&(r=i.resolvedPaths[i.resolvedPaths.length-1]);const s=(0,p.stripFileExtension)((0,p.getFileName)(this._fileInfo.filePath)),o="__init__"===s&&1===e.module.leadingDots&&1===e.module.nameParts.length;let l=!1,g=!1;if(1===e.module.nameParts.length){const t=e.module.nameParts[0].value;"typing"!==t&&"typing_extensions"!==t||(l=!0),"dataclasses"===t&&(g=!0)}if(e.isWildcardImport){if((f.getEnclosingClass(e)||f.getEnclosingFunction(e))&&this._addError(u.Localizer.Diagnostic.wildcardInFunction(),e),i){const s=[];null===(t=this._currentScopeCodeFlowExpressions)||void 0===t||t.add(y.wildcardImportReferenceKey);const p=this._fileInfo.importLookup(r);if(p){const t=this._getWildcardImportNames(p);if(o){t.some((t=>t===e.module.nameParts[0].value))||this._addImplicitFromImport(e,i)}t.forEach((t=>{const n=this._bindNameValueToScope(this._currentScope,t);if(n){if(p.symbolTable.get(t)){const a={type:8,node:e,path:r,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,symbolName:t,moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};n.addDeclaration(a),s.push(t)}else if(i&&i.filteredImplicitImports){const a=i.filteredImplicitImports.get(t);if(a){const i={type:8,node:e,path:a.path,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},o={type:8,node:e,path:r,loadSymbolsFromPath:!0,usesLocalName:!1,symbolName:t,submoduleFallback:i,range:(0,d.getEmptyRange)(),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};n.addDeclaration(o),s.push(t)}}}}))}this._createFlowWildcardImport(e,s),l&&n.forEach((e=>{this._typingSymbolAliases.set(e,e)})),g&&a.forEach((e=>{this._dataclassesSymbolAliases.set(e,e)}))}}else o&&this._addImplicitFromImport(e,i),e.imports.forEach((t=>{const o=t.name.value,p=t.alias||t.name;m.setFlowNode(t,this._currentFlowNode);const u=this._bindNameToScope(this._currentScope,p);if(u){let m,y;e.module.nameParts.length>0&&(3!==this._currentScope.type&&4!==this._currentScope.type||t.alias&&t.alias.value===t.name.value||(this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage)&&this._potentialHiddenSymbols.set(p.value,u)),i&&i.filteredImplicitImports&&(m=i.filteredImplicitImports.get(o));let h=!0;m&&(y={type:8,node:t,path:m.path,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},"__init__"===s&&(1===e.module.leadingDots&&0===e.module.nameParts.length||r===this._fileInfo.filePath)&&(h=!1));const f={type:8,node:t,path:r,loadSymbolsFromPath:h,usesLocalName:!!t.alias,symbolName:o,submoduleFallback:y,range:(0,c.convertTextRangeToRange)(p,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,isNativeLib:null==i?void 0:i.isNativeLib};u.addDeclaration(f),this._createFlowAssignment(t.alias||t.name),l&&n.some((e=>e===t.name.value))&&this._typingSymbolAliases.set(p.value,t.name.value),g&&a.some((e=>e===t.name.value))&&this._dataclassesSymbolAliases.set(p.value,t.name.value)}}));return!0}visitWith(e){e.withItems.forEach((e=>{this.walk(e.expression),e.target&&(this._bindPossibleTupleNamedTarget(e.target),this._addInferredTypeAssignmentForVariable(e.target,e),this._createAssignmentTargetFlowNodes(e.target,!0,!1))}));const t=this._createContextManagerLabel(e.withItems.map((e=>e.expression)),!!e.isAsync,!1);this._addAntecedent(t,this._currentFlowNode);const n=this._createContextManagerLabel(e.withItems.map((e=>e.expression)),!!e.isAsync,!0);this._currentExceptTargets.forEach((e=>{this._addAntecedent(e,n)}));const a=this._currentFlowNode,i=this._createBranchLabel(a);return this._addAntecedent(i,t),i.affectedExpressions=this._trackCodeFlowExpressions((()=>{if(this._useExceptTargets([t,n],(()=>{this.walk(e.suite)})),this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=i,this._isCodeUnreachable()||this._addExceptTargets(this._currentFlowNode),e.asyncToken&&!this._fileInfo.ipythonMode){const t=f.getEnclosingFunction(e);t&&t.isAsync||this._addError(u.Localizer.Diagnostic.asyncNotInAsyncFunction(),e.asyncToken)}})),!1}visitTernary(e){const t=this._currentFlowNode,n=this._createBranchLabel(),a=this._createBranchLabel(),i=this._createBranchLabel(t);return i.affectedExpressions=this._trackCodeFlowExpressions((()=>{this._bindConditional(e.testExpression,n,a),this._currentFlowNode=this._finishFlowLabel(n),this.walk(e.ifExpression),this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),this.walk(e.elseExpression),this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(i)})),!1}visitUnaryOperation(e){return 38===e.operator&&this._currentFalseTarget&&this._currentTrueTarget?this._bindConditional(e.expression,this._currentFalseTarget,this._currentTrueTarget):this._disableTrueFalseTargets((()=>{this.walk(e.expression)})),!1}visitBinaryOperation(e){if(36===e.operator||37===e.operator){let t,n=this._currentTrueTarget,a=this._currentFalseTarget;n&&a||(t=this._createBranchLabel(),n=a=t);const i=this._createBranchLabel();36===e.operator?this._bindConditional(e.leftExpression,i,a):this._bindConditional(e.leftExpression,n,i),this._currentFlowNode=this._finishFlowLabel(i),this._bindConditional(e.rightExpression,n,a),t&&(this._currentFlowNode=this._finishFlowLabel(t))}else this._disableTrueFalseTargets((()=>{this.walk(e.leftExpression),this.walk(e.rightExpression)}));return!1}visitListComprehension(e){const t=f.getEnclosingFunction(e);return e.forIfNodes.length>0&&33===e.forIfNodes[0].nodeType&&this.walk(e.forIfNodes[0].iterableExpression),this._createNewScope(0,this._getNonClassParentScope(),(()=>{var n;m.setScope(e,this._currentScope);const a=this._createBranchLabel();for(let a=0;a<e.forIfNodes.length;a++){const i=e.forIfNodes[a],r=new Map;33===i.nodeType&&(this._bindPossibleTupleNamedTarget(i.targetExpression,r),this._addInferredTypeAssignmentForVariable(i.targetExpression,i),i.asyncToken&&!this._fileInfo.ipythonMode&&(t&&t.isAsync||31===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&this._addError(u.Localizer.Diagnostic.asyncNotInAsyncFunction(),i.asyncToken)))}for(let t=0;t<e.forIfNodes.length;t++){const n=e.forIfNodes[t];if(33===n.nodeType)0!==t&&this.walk(n.iterableExpression),this._createAssignmentTargetFlowNodes(n.targetExpression,!0,!1);else{const e=this._createBranchLabel();this._bindConditional(n.testExpression,e,a),this._currentFlowNode=this._finishFlowLabel(e)}}this.walk(e.expression),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a)})),!1}visitMatch(e){this.walk(e.subjectExpression);const t=[],n=this._isNarrowingExpression(e.subjectExpression,t);n&&t.forEach((e=>{const t=(0,y.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)}));const a=this._createBranchLabel();let i=!1;return e.cases.forEach((t=>{const n=this._createBranchLabel(),r=this._createBranchLabel(),s=this._createBranchLabel();this._addAntecedent(r,this._currentFlowNode),t.isIrrefutable?t.guardExpression||(i=!0):this._addAntecedent(n,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(r),this.walk(t.pattern),this._createFlowNarrowForPattern(e.subjectExpression,t),t.guardExpression?this._bindConditional(t.guardExpression,s,n):this._addAntecedent(s,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(s),this.walk(t.suite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(n)})),n&&this._createFlowNarrowForPattern(e.subjectExpression,e),i||this._createFlowExhaustedMatch(e),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),!1}visitPatternAs(e){const t=this._createBranchLabel();if(e.orPatterns.forEach((e=>{this.walk(e),this._addAntecedent(t,this._currentFlowNode)})),this._currentFlowNode=this._finishFlowLabel(t),e.target){this.walk(e.target);const t=this._bindNameToScope(this._currentScope,e.target);if(this._createAssignmentTargetFlowNodes(e.target,!1,!1),t){const n={type:1,node:e.target,isConstant:(0,I.isConstantName)(e.target.value),inferredTypeSource:e,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.target,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};t.addDeclaration(n)}}return!1}visitPatternCapture(e){return e.isWildcard||this._addPatternCaptureTarget(e.target),!0}visitPatternMappingExpandEntry(e){return"_"!==e.target.value&&this._addPatternCaptureTarget(e.target),!0}_removeActiveTypeParameters(e){e.parameters.forEach((e=>{const t=this._activeTypeParams.get(e.name.value);if(t){const n=t.getDeclarations();(0,o.assert)(n&&1===n.length&&3===n[0].type),n[0].node===e&&this._activeTypeParams.delete(e.name.value)}}))}_getNonClassParentScope(){let e=this._currentScope;for(;2===e.type;)e=e.parent;return e}_addSlotsToCurrentScope(e){(0,o.assert)(2===this._currentScope.type);let t=!1;for(const n of e){const e=n.strings[0].value;if("__dict__"===e){t=!0;continue}let a=this._currentScope.lookUpSymbol(e);if(!a){a=this._currentScope.addSymbol(e,5);const t="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(e)&&t&&a.setIsPrivateMember()}const i={type:1,node:n,isConstant:(0,I.isConstantName)(e),isDefinedBySlots:!0,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(n,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};a.addDeclaration(i)}t||this._currentScope.setSlotsNames(e.map((e=>e.strings[0].value)))}_isInListComprehension(e,t=!1){let n,a,i=e;for(;i;){if(32===i.nodeType){if(t&&i.forIfNodes.length>0){const e=i.forIfNodes[0];if(n===e&&33===e.nodeType&&a===e.iterableExpression)return!1}return!0}a=n,n=i,i=i.parent}return!1}_addPatternCaptureTarget(e){const t=this._bindNameToScope(this._currentScope,e);if(this._createAssignmentTargetFlowNodes(e,!1,!1),t){const n={type:1,node:e,isConstant:(0,I.isConstantName)(e.value),inferredTypeSource:e.parent,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};t.addDeclaration(n)}}_useExceptTargets(e,t){const n=this._currentExceptTargets;this._currentExceptTargets=e,t(),this._currentExceptTargets=n}_getDunderAllNamesFromImport(e){var t,n;const a=this._currentScope.lookUpSymbol(e);if(!a)return;const i=a.getDeclarations().find((e=>8===e.type)),r=(null==i?void 0:i.path)&&i.loadSymbolsFromPath?i.path:(null===(t=null==i?void 0:i.submoduleFallback)||void 0===t?void 0:t.path)&&i.submoduleFallback.loadSymbolsFromPath?i.submoduleFallback.path:void 0;if(!r)return;let s=this._fileInfo.importLookup(r);return(null==s?void 0:s.dunderAllNames)?s.dunderAllNames:(null===(n=null==i?void 0:i.submoduleFallback)||void 0===n?void 0:n.path)?(s=this._fileInfo.importLookup(i.submoduleFallback.path),null==s?void 0:s.dunderAllNames):void 0}_addImplicitFromImport(e,t){const n=e.module.nameParts[0].value,a=this._bindNameValueToScope(this._currentScope,n);a&&this._createAliasDeclarationForMultipartImportName(e,void 0,t,a),this._createFlowAssignment(e.module.nameParts[0])}_createAliasDeclarationForMultipartImportName(e,t,n,a){var i;const r=e.module.nameParts[0].value;m.setFlowNode(e,this._currentFlowNode);const s=a.getDeclarations().find((e=>8===e.type&&e.firstNamePart===r));let o,l;l=n&&n.isImportFound&&!n.isNativeLib&&n.resolvedPaths.length>0?n.resolvedPaths[n.resolvedPaths.length-1]:g.UnresolvedModuleMarker;const p=n&&n.isImportFound&&!n.isNativeLib&&n.resolvedPaths.length>0;o=s||(p?{type:8,node:e,path:l,loadSymbolsFromPath:!1,range:(0,d.getEmptyRange)(),usesLocalName:!!t,moduleName:r,firstNamePart:r,isInExceptSuite:this._isInExceptSuite}:{type:8,node:e,path:l,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!!t,moduleName:null!==(i=null==n?void 0:n.importName)&&void 0!==i?i:"",firstNamePart:r,isUnresolved:!0,isInExceptSuite:this._isInExceptSuite});const c=m.getImportInfo(e.module.nameParts[0]);if(c&&c.resolvedPaths.length&&(o.path=c.resolvedPaths[0],o.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(c,o)),t||1===e.module.nameParts.length)o.path=l,o.loadSymbolsFromPath=!0,o.isUnresolved=!1,n&&this._addImplicitImportsToLoaderActions(n,o);else{let t=o;for(let a=1;a<e.module.nameParts.length;a++){const i=e.module.nameParts[a].value;let r=t.implicitImports?t.implicitImports.get(i):void 0;if(!r){r={path:n&&a<n.resolvedPaths.length?n.resolvedPaths[a]:g.UnresolvedModuleMarker,loadSymbolsFromPath:!1,implicitImports:new Map,isUnresolved:!p},t.implicitImports||(t.implicitImports=new Map),t.implicitImports.set(i,r)}if(a===e.module.nameParts.length-1)n&&a<n.resolvedPaths.length&&(r.path=n.resolvedPaths[a],r.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(n,r));else{const t=m.getImportInfo(e.module.nameParts[a]);t&&t.resolvedPaths.length&&(r.path=t.resolvedPaths[a],r.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(t,r))}t=r}}s||a.addDeclaration(o)}_getWildcardImportNames(e){const t=[];if(e.dunderAllNames){if(!e.usesUnsupportedDunderAllForm)return e.dunderAllNames;(0,s.appendArray)(t,e.dunderAllNames)}return e.symbolTable.forEach(((e,n)=>{e.isExternallyHidden()||(0,I.isPrivateOrProtectedName)(n)||t.push(n)})),t}_walkStatementsAndReportUnreachable(e){let t=!1;for(const n of e)if(m.setFlowNode(n,this._currentFlowNode),t||(t=this._isCodeUnreachable()),t){if(this._targetFunctionDeclaration&&!this._targetFunctionDeclaration.isGenerator){(new k).checkContainsYield(n)&&(this._targetFunctionDeclaration.isGenerator=!0)}if(!this._moduleSymbolOnly){new w(this._currentScope).walk(n)}}else this.walk(n);return!1}_createStartFlowNode(){return{flags:y.FlowFlags.Start,id:this._getUniqueFlowNodeId()}}_createBranchLabel(e){return{flags:y.FlowFlags.BranchLabel,id:this._getUniqueFlowNodeId(),antecedents:[],preBranchAntecedent:e,affectedExpressions:void 0}}_createFlowNarrowForPattern(e,t){const n={flags:y.FlowFlags.NarrowForPattern,id:this._getUniqueFlowNodeId(),subjectExpression:e,statement:t,antecedent:this._currentFlowNode};this._currentFlowNode=n}_createContextManagerLabel(e,t,n){return{flags:y.FlowFlags.PostContextManager|y.FlowFlags.BranchLabel,id:this._getUniqueFlowNodeId(),antecedents:[],expressions:e,affectedExpressions:void 0,isAsync:t,blockIfSwallowsExceptions:n}}_createLoopLabel(){return{flags:y.FlowFlags.LoopLabel,id:this._getUniqueFlowNodeId(),antecedents:[],affectedExpressions:void 0}}_finishFlowLabel(e){return 0===e.antecedents.length?C._unreachableFlowNode:1===e.antecedents.length&&e.flags===y.FlowFlags.BranchLabel?e.antecedents[0]:(this._codeFlowComplexity+=e.antecedents.length-1,e)}_bindNeverCondition(e,t,n){const a=[];if(55===e.nodeType&&38===e.operator)this._bindNeverCondition(e.expression,t,!n);else if(7!==e.nodeType||36!==e.operator&&37!==e.operator){if(this._isNarrowingExpression(e,a,!0)){a.filter((e=>38===e.nodeType)).length>0&&(this._currentFlowNode=this._createFlowConditional(n?y.FlowFlags.TrueNeverCondition:y.FlowFlags.FalseNeverCondition,this._currentFlowNode,e))}this._addAntecedent(t,this._currentFlowNode)}else{let a=36===e.operator;if(n&&(a=!a),a){const a=this._currentFlowNode;this._bindNeverCondition(e.leftExpression,t,n),this._currentFlowNode=a,this._bindNeverCondition(e.rightExpression,t,n)}else{const a=this._currentFlowNode,i=this._createBranchLabel();if(this._bindNeverCondition(e.leftExpression,i,n),a!==this._currentFlowNode){this._currentFlowNode=this._finishFlowLabel(i);const r=this._currentFlowNode;this._bindNeverCondition(e.rightExpression,t,n),r===this._currentFlowNode&&(this._currentFlowNode=a)}}}}_bindConditional(e,t,n){this._setTrueFalseTargets(t,n,(()=>{this.walk(e)})),this._isLogicalExpression(e)||(this._addAntecedent(t,this._createFlowConditional(y.FlowFlags.TrueCondition,this._currentFlowNode,e)),this._addAntecedent(n,this._createFlowConditional(y.FlowFlags.FalseCondition,this._currentFlowNode,e)))}_disableTrueFalseTargets(e){this._setTrueFalseTargets(void 0,void 0,e)}_setTrueFalseTargets(e,t,n){const a=this._currentTrueTarget,i=this._currentFalseTarget;this._currentTrueTarget=e,this._currentFalseTarget=t,n(),this._currentTrueTarget=a,this._currentFalseTarget=i}_createFlowConditional(e,t,n){if(t.flags&y.FlowFlags.Unreachable)return t;const a=b.evaluateStaticBoolLikeExpression(n,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases);if(!0===a&&e&y.FlowFlags.FalseCondition||!1===a&&e&y.FlowFlags.TrueCondition)return C._unreachableFlowNode;const i=[];if(!this._isNarrowingExpression(n,i,0!=(e&(y.FlowFlags.TrueNeverCondition|y.FlowFlags.FalseNeverCondition))))return t;i.forEach((e=>{const t=(0,y.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)}));const r=i.filter((e=>38===e.nodeType)),s={flags:e,id:this._getUniqueFlowNodeId(),reference:r.length>0?r[0]:void 0,expression:n,antecedent:t};return this._addExceptTargets(s),s}_isLogicalExpression(e){switch(e.nodeType){case 55:return 38===e.operator;case 7:return 36===e.operator||37===e.operator}return!1}_isNarrowingExpression(e,t,n=!1,a=!1){switch(e.nodeType){case 38:case 35:case 24:if(n){if(38!==e.nodeType)return!1;if(!a)return!1}return!!(0,y.isCodeFlowSupportedForReference)(e)&&(t.push(e),n||(35===e.nodeType&&(0,y.isCodeFlowSupportedForReference)(e.leftExpression)&&t.push(e.leftExpression),24!==e.nodeType||1!==e.items.length||e.trailingComma||0!==e.items[0].argumentCategory||(0,y.isCodeFlowSupportedForReference)(e.baseExpression)&&t.push(e.baseExpression)),!0);case 4:return t.push(e.name),this._isNarrowingExpression(e.rightExpression,t,n,!0),!0;case 7:{const a=39===e.operator||40===e.operator,i=12===e.operator||28===e.operator;if(a||i){if(11===e.rightExpression.nodeType&&26===e.rightExpression.constType)return this._isNarrowingExpression(e.leftExpression,t,n,!0);if(a&&9===e.leftExpression.nodeType&&38===e.leftExpression.leftExpression.nodeType&&"type"===e.leftExpression.leftExpression.value&&1===e.leftExpression.arguments.length&&0===e.leftExpression.arguments[0].argumentCategory)return this._isNarrowingExpression(e.leftExpression.arguments[0].valueExpression,t,n,!0);return this._isNarrowingExpression(e.leftExpression,t,n,!0)}return!(41!==e.operator&&42!==e.operator||48!==e.leftExpression.nodeType||!this._isNarrowingExpression(e.rightExpression,t,n,!0))||(41===e.operator||42===e.operator)&&this._isNarrowingExpression(e.leftExpression,t,n,!0)}case 55:return 38===e.operator&&this._isNarrowingExpression(e.expression,t,n,!1);case 5:return this._isNarrowingExpression(e.rightExpression,t,n,!0);case 9:if(38===e.leftExpression.nodeType&&("isinstance"===e.leftExpression.value||"issubclass"===e.leftExpression.value)&&2===e.arguments.length)return this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0);if(38===e.leftExpression.nodeType&&"callable"===e.leftExpression.value&&1===e.arguments.length)return this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0);if(e.arguments.length>=1)return!n&&this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0)}return!1}_createAssignmentTargetFlowNodes(e,t,n){switch(e.nodeType){case 38:case 35:case 24:this._createFlowAssignment(e,n),t&&this.walk(e);break;case 52:e.expressions.forEach((e=>{this._createAssignmentTargetFlowNodes(e,t,n)}));break;case 54:this._createAssignmentTargetFlowNodes(e.valueExpression,!1,n),t&&this.walk(e);break;case 56:this._createAssignmentTargetFlowNodes(e.expression,!1,n),t&&this.walk(e);break;case 31:e.entries.forEach((e=>{this._createAssignmentTargetFlowNodes(e,t,n)}));break;default:t&&this.walk(e)}}_createCallFlowNode(e){if(!this._isCodeUnreachable()){const t={flags:y.FlowFlags.Call,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode};this._currentFlowNode=t}this._isCodeUnreachable()||this._addExceptTargets(this._currentFlowNode)}_createVariableAnnotationFlowNode(){if(!this._isCodeUnreachable()){const e={flags:y.FlowFlags.VariableAnnotation,id:this._getUniqueFlowNodeId(),antecedent:this._currentFlowNode};this._currentFlowNode=e}}_createFlowAssignment(e,t=!1){let n=_.indeterminateSymbolId;if(38===e.nodeType){const t=this._currentScope.lookUpSymbolRecursive(e.value);(0,o.assert)(void 0!==t),n=t.symbol.id}const a=this._currentFlowNode;if(!this._isCodeUnreachable()&&(0,y.isCodeFlowSupportedForReference)(e)){const a={flags:y.FlowFlags.Assignment,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode,targetSymbolId:n},i=(0,y.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(i),t&&(a.flags|=y.FlowFlags.Unbind),35===e.nodeType&&this._addExceptTargets(a),this._currentFlowNode=a}t&&void 0!==m.getFlowNode(e)||m.setFlowNode(e,t?a:this._currentFlowNode)}_createFlowWildcardImport(e,t){if(!this._isCodeUnreachable()){const n={flags:y.FlowFlags.WildcardImport,id:this._getUniqueFlowNodeId(),node:e,names:t,antecedent:this._currentFlowNode};this._addExceptTargets(n),this._currentFlowNode=n}m.setFlowNode(e,this._currentFlowNode)}_createFlowExhaustedMatch(e){if(!this._isCodeUnreachable()){const t={flags:y.FlowFlags.ExhaustedMatch,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode};this._currentFlowNode=t}m.setAfterFlowNode(e,this._currentFlowNode)}_isCodeUnreachable(){return!!(this._currentFlowNode.flags&y.FlowFlags.Unreachable)}_addExceptTargets(e){this._currentExceptTargets&&this._currentExceptTargets.forEach((t=>{this._addAntecedent(t,e)}))}_trackCodeFlowExpressions(e){const t=this._currentScopeCodeFlowExpressions;this._currentScopeCodeFlowExpressions=new Set,e();const n=this._currentScopeCodeFlowExpressions;return t&&this._currentScopeCodeFlowExpressions.forEach((e=>{t.add(e)})),this._currentScopeCodeFlowExpressions=t,n}_bindLoopStatement(e,t,n){const a=this._currentContinueTarget,i=this._currentBreakTarget;this._currentContinueTarget=e,this._currentBreakTarget=t,e.affectedExpressions=this._trackCodeFlowExpressions(n),this._currentContinueTarget=a,this._currentBreakTarget=i}_addAntecedent(e,t){this._currentFlowNode.flags&y.FlowFlags.Unreachable||e.antecedents.some((e=>e.id===t.id))||e.antecedents.push(t)}_bindNameToScope(e,t,n){return this._bindNameValueToScope(e,t.value,n)}_bindNameValueToScope(e,t,n){const a=this._currentScope.getBindingType(t);if(void 0===a){let a=e.lookUpSymbol(t);return a||(a=e.addSymbol(t,5),3!==this._currentScope.type&&4!==this._currentScope.type||(0,I.isPrivateOrProtectedName)(t)&&((0,I.isPrivateName)(t)?a.setIsExternallyHidden():this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage?4===this._currentScope.type?a.setIsExternallyHidden():this._potentialPrivateSymbols.set(t,a):a.setIsPrivateMember()),n&&n.set(t,a)),a}{const e=(0===a?this._currentScope.parent:this._currentScope.getGlobalScope().scope).lookUpSymbolRecursive(t);if(e)return e.symbol}}_bindPossibleTupleNamedTarget(e,t){switch(e.nodeType){case 38:this._bindNameToScope(this._currentScope,e,t);break;case 52:e.expressions.forEach((e=>{this._bindPossibleTupleNamedTarget(e,t)}));break;case 31:e.entries.forEach((e=>{this._bindPossibleTupleNamedTarget(e,t)}));break;case 54:this._bindPossibleTupleNamedTarget(e.valueExpression,t);break;case 56:this._bindPossibleTupleNamedTarget(e.expression,t)}}_addImplicitSymbolToCurrentScope(e,t,n){const a=this._addSymbolToCurrentScope(e,!1);a&&(a.addDeclaration({type:0,node:t,intrinsicType:n,path:this._fileInfo.filePath,range:(0,d.getEmptyRange)(),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite}),a.setIsIgnoredForProtocolMatch())}_addSymbolToCurrentScope(e,t){let n=this._currentScope.lookUpSymbol(e);if(!n){let a=0;t&&(a|=1),2===this._currentScope.type&&(a|=4),this._fileInfo.isStubFile&&(0,I.isPrivateOrProtectedName)(e)&&(a|=2),n=this._currentScope.addSymbol(e,a)}return n}_createNewScope(e,t,n){const a=this._currentScope,i=new v.Scope(e,t);this._currentScope=i;const r=4===e||3===e||1===e,s=this._currentScopeCodeFlowExpressions;return r&&(this._currentScopeCodeFlowExpressions=new Set),n(),this._currentScopeCodeFlowExpressions=s,this._currentScope=a,i}_addInferredTypeAssignmentForVariable(e,t,n=!1){switch(e.nodeType){case 38:{const a=e,i=this._currentScope.lookUpSymbolRecursive(a.value);if(i&&i.symbol){const r={type:1,node:e,isConstant:(0,I.isConstantName)(e.value),inferredTypeSource:t,isInferenceAllowedInPyTyped:this._isInferenceAllowedInPyTyped(a.value),typeAliasName:n?e:void 0,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(a,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};i.symbol.addDeclaration(r)}break}case 35:{const n=this._getMemberAccessInfo(e);if(n){const a=e.memberName;let i=n.classScope.lookUpSymbol(a.value);if(!i){i=n.classScope.addSymbol(a.value,1);const e="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(a.value)&&e&&i.setIsPrivateMember()}n.isInstanceMember?i.isClassMember()&&i.getDeclarations().some((e=>5===e.type&&e.isMethod))||i.setIsInstanceMember():i.setIsClassMember();const r={type:1,node:e.memberName,isConstant:(0,I.isConstantName)(a.value),inferredTypeSource:t,isDefinedByMemberAccess:!0,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(e.memberName,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};i.addDeclaration(r)}break}case 52:e.expressions.forEach((e=>{this._addInferredTypeAssignmentForVariable(e,t)}));break;case 54:this._addInferredTypeAssignmentForVariable(e.valueExpression,t);break;case 56:this._addInferredTypeAssignmentForVariable(e.expression,t);break;case 31:e.entries.forEach((e=>{this._addInferredTypeAssignmentForVariable(e,t)}))}}_isInferenceAllowedInPyTyped(e){return["__match_args__","__slots__","__all__"].some((t=>t===e))}_addTypeDeclarationForVariable(e,t){var n,a,i;let r=!1;switch(e.nodeType){case 38:{const s=e,o=this._currentScope.lookUpSymbolRecursive(s.value);if(o&&o.symbol){const r=this._isAnnotationFinal(t);let l=t;r.isFinal&&(r.finalTypeNode||(l=void 0));let p=this._isAnnotationClassVar(t);if(p.isClassVar&&(p.classVarTypeNode||(l=void 0)),r.isFinal){const t=f.getEnclosingClassOrFunction(e);t&&10===t.nodeType&&(3!==(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&3!==(null===(i=null===(a=e.parent)||void 0===a?void 0:a.parent)||void 0===i?void 0:i.nodeType)||(p={isClassVar:!0,classVarTypeNode:void 0}))}const d={type:1,node:e,isConstant:(0,I.isConstantName)(s.value),isFinal:r.isFinal,typeAliasName:e,path:this._fileInfo.filePath,typeAnnotationNode:l,range:(0,c.convertTextRangeToRange)(s,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};if(o.symbol.addDeclaration(d),p.isClassVar?o.symbol.setIsClassVar():o.symbol.setIsInstanceMember(),24===t.nodeType)if(this._isDataclassesAnnotation(t.baseExpression,"InitVar"))o.symbol.setIsInitVar();else if(this._isTypingAnnotation(t.baseExpression,"Annotated")&&t.items.length>0){const e=t.items[0].valueExpression;24===e.nodeType&&this._isDataclassesAnnotation(e.baseExpression,"InitVar")&&o.symbol.setIsInitVar()}}r=!0;break}case 35:{const n=this._getMemberAccessInfo(e);if(n){const a=e.memberName;let i=n.classScope.lookUpSymbol(a.value);if(!i){i=n.classScope.addSymbol(a.value,1);const e="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(a.value)&&e&&i.setIsPrivateMember()}n.isInstanceMember?i.setIsInstanceMember():i.setIsClassMember();const s=this._isAnnotationFinal(t),o={type:1,node:e.memberName,isConstant:(0,I.isConstantName)(a.value),isDefinedByMemberAccess:!0,isFinal:s.isFinal,path:this._fileInfo.filePath,typeAnnotationNode:s.isFinal&&!s.finalTypeNode?void 0:t,range:(0,c.convertTextRangeToRange)(e.memberName,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};i.addDeclaration(o),r=!0}break}}r||this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,u.Localizer.Diagnostic.annotationNotSupported(),t)}_isTypingAnnotation(e,t){return this._isKnownAnnotation(e,t,this._typingImportAliases,this._typingSymbolAliases)}_isDataclassesAnnotation(e,t){return this._isKnownAnnotation(e,t,this._dataclassesImportAliases,this._dataclassesSymbolAliases)}_isKnownAnnotation(e,t,n,a){let i=e;if(48===i.nodeType&&i.typeAnnotation&&(i=i.typeAnnotation),38===i.nodeType){if(a.get(i.value)===t)return!0}else if(35===i.nodeType&&38===i.leftExpression.nodeType&&i.memberName.value===t){const e=i.leftExpression.value;return n.some((t=>t===e))}return!1}_getVariableDocString(e){const t=f.getVariableDocStringNode(e);if(!t)return;const n=t.strings;return 1===n.length?n[0].value:n.map((e=>e.value)).join("")}_isAnnotationFinal(e){let t,n=!1;if(e)if(this._isTypingAnnotation(e,"Final"))n=!0;else if(24===e.nodeType&&1===e.items.length){!this._isAnnotationFinal(e.baseExpression).isFinal||0!==e.items[0].argumentCategory||e.items[0].name||e.trailingComma||(n=!0,t=e.items[0].valueExpression)}return{isFinal:n,finalTypeNode:t}}_isAnnotationClassVar(e){let t,n=!1;for(;e;){if(48===e.nodeType&&e.typeAnnotation&&(e=e.typeAnnotation),!(24===e.nodeType&&e.items.length>0&&this._isTypingAnnotation(e.baseExpression,"Annotated"))){if(this._isTypingAnnotation(e,"ClassVar")){n=!0;break}if(24===e.nodeType&&1===e.items.length){!this._isAnnotationClassVar(e.baseExpression).isClassVar||0!==e.items[0].argumentCategory||e.items[0].name||e.trailingComma||(n=!0,t=e.items[0].valueExpression);break}break}e=e.items[0].valueExpression}return{isClassVar:n,classVarTypeNode:t}}_getMemberAccessInfo(e){if(38!==e.leftExpression.nodeType)return;const t=e.leftExpression.value,n=f.getEnclosingFunction(e);if(!n)return;const a=f.getEnclosingClass(n,!0);if(!a)return;let i=!1;if(n.parameters.length<1||!n.parameters[0].name)return;const r=a.name.value,s=n.parameters[0].name.value;if(t===r)i=!1;else{if(t!==s)return;if("__new__"===n.name.value)i=!1;else{i=!0;for(const e of n.decorators)if(38===e.expression.nodeType){const t=e.expression.value;if("staticmethod"===t)return;if("classmethod"===t){i=!1;break}}}}const l=m.getScope(a);return(0,o.assert)(void 0!==l),{classNode:a,methodNode:n,classScope:l,isInstanceMember:i}}_addImplicitImportsToLoaderActions(e,t){e.filteredImplicitImports.forEach((e=>{const n=t.implicitImports?t.implicitImports.get(e.name):void 0;n?(n.path=e.path,n.loadSymbolsFromPath=!0):(t.implicitImports||(t.implicitImports=new Map),t.implicitImports.set(e.name,{path:e.path,loadSymbolsFromPath:!0,implicitImports:new Map}))}))}_handleTypingStubAssignmentOrAnnotation(e){if(!this._fileInfo.isTypingStubFile)return!1;let t;if(54===e.nodeType)t=e;else{if(54!==e.leftExpression.nodeType)return!1;t=e.leftExpression}if(38!==t.valueExpression.nodeType)return!1;const n=t.valueExpression,a=new Set(["Tuple","Generic","Protocol","Callable","Type","ClassVar","Final","Literal","TypedDict","Union","Optional","Annotated","TypeAlias","OrderedDict","Concatenate","TypeGuard","Unpack","Self","NoReturn","Never","LiteralString"]),i=n.value;if(!a.has(i))return!1;const r=this._bindNameToScope(this._currentScope,t.valueExpression);return r&&r.addDeclaration({type:7,node:t,path:this._fileInfo.filePath,range:(0,c.convertTextRangeToRange)(t,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite}),!0}_deferBinding(e){this._moduleSymbolOnly||this._deferredBindingTasks.push({scope:this._currentScope,codeFlowExpressions:this._currentScopeCodeFlowExpressions,activeTypeParams:new Map(this._activeTypeParams),callback:e})}_bindDeferred(){for(;this._deferredBindingTasks.length>0;){const e=this._deferredBindingTasks.shift();this._currentScope=e.scope,this._currentScopeCodeFlowExpressions=e.codeFlowExpressions,this._activeTypeParams=e.activeTypeParams,e.callback()}}_bindYield(e){const t=f.getEnclosingFunction(e);t?t.isAsync&&61===e.nodeType&&this._addError(u.Localizer.Diagnostic.yieldFromOutsideAsync(),e):f.getEnclosingLambda(e)||this._addError(u.Localizer.Diagnostic.yieldOutsideFunction(),e),this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.yieldStatements||(this._targetFunctionDeclaration.yieldStatements=[]),this._targetFunctionDeclaration.yieldStatements.push(e),this._targetFunctionDeclaration.isGenerator=!0),e.expression&&this.walk(e.expression),m.setFlowNode(e,this._currentFlowNode)}_getUniqueFlowNodeId(){return this._codeFlowComplexity+=.05,(0,y.getUniqueFlowNodeId)()}_addDiagnostic(e,t,n,a){let i;switch(e){case"error":i=this._addError(n,a);break;case"warning":i=this._addWarning(n,a);break;case"information":i=this._addInformation(n,a);break;case"none":break;default:return(0,o.assertNever)(e,`${e} is not expected`)}return i&&i.setRule(t),i}_addError(e,t){return this._fileInfo.diagnosticSink.addDiagnosticWithTextRange("error",e,t)}_addWarning(e,t){return this._fileInfo.diagnosticSink.addDiagnosticWithTextRange("warning",e,t)}_addInformation(e,t){return this._fileInfo.diagnosticSink.addDiagnosticWithTextRange("information",e,t)}}t.Binder=C,C._unreachableFlowNode={flags:y.FlowFlags.Unreachable,id:(0,y.getUniqueFlowNodeId)()};class k extends T.ParseTreeWalker{constructor(){super(...arguments),this._containsYield=!1}checkContainsYield(e){return this.walk(e),this._containsYield}visitYield(e){return this._containsYield=!0,!1}visitYieldFrom(e){return this._containsYield=!0,!1}}t.YieldFinder=k;class S extends T.ParseTreeWalker{constructor(){super(...arguments),this._containsReturn=!1}checkContainsReturn(e){return this.walk(e),this._containsReturn}visitReturn(e){return this._containsReturn=!0,!1}}t.ReturnFinder=S;class w extends T.ParseTreeWalker{constructor(e){super(),this._currentScope=e}visitClass(e){const t=this._createNewScope(2,(()=>{this.walk(e.suite)}));return m.getScope(e)||m.setScope(e,t),!1}visitFunction(e){const t=this._createNewScope(1,(()=>{this.walk(e.suite)}));return m.getScope(e)||m.setScope(e,t),!1}_createNewScope(e,t){const n=this._currentScope,a=new v.Scope(e,this._currentScope);return this._currentScope=a,t(),this._currentScope=n,a}}t.DummyScopeGenerator=w},5084:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CacheManager=void 0;const a=n(30795),i=n(52957);t.CacheManager=class{constructor(){this._pausedCount=0,this._cacheOwners=[]}registerCacheOwner(e){this._cacheOwners.push(e)}unregisterCacheOwner(e){const t=this._cacheOwners.findIndex((t=>t===e));t<0?(0,a.fail)("Specified cache provider not found"):this._cacheOwners.splice(t,1)}pauseTracking(){const e=this;return e._pausedCount++,{dispose(){e._pausedCount--}}}getCacheUsage(){if(this._pausedCount>0)return-1;let e=0;return this._cacheOwners.forEach((t=>{e+=t.getCacheUsage()})),e}emptyCache(e){if(e){const t=(0,i.getHeapStatistics)();e.info(`Emptying type cache to avoid heap overflow. Used ${this._convertToMB(t.used_heap_size)} out of ${this._convertToMB(t.heap_size_limit)}.`)}this._cacheOwners.forEach((e=>{e.emptyCache()}))}getUsedHeapRatio(e){const t=(0,i.getHeapStatistics)();return e&&e.info(`Heap stats: total_heap_size=${this._convertToMB(t.total_heap_size)}, used_heap_size=${this._convertToMB(t.used_heap_size)}, total_physical_size=${this._convertToMB(t.total_physical_size)}, total_available_size=${this._convertToMB(t.total_available_size)}, heap_size_limit=${this._convertToMB(t.heap_size_limit)}`),t.used_heap_size/t.heap_size_limit}_convertToMB(e){return`${Math.round(e/1048576)}MB`}}},46892:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Checker=void 0;const s=n(29335),o=n(5284),l=n(30795),p=n(83501),c=n(28513),d=n(81844),u=n(86513),m=n(6698),y=n(55843),g=n(99661),h=n(29597),f=n(1240),T=r(n(21)),v=n(44660),b=n(24161),_=n(87710),I=n(32966),C=r(n(66455)),k=n(59438),S=n(78140),w=n(59083),A=n(60177),x=n(17741),P=n(9584),D=n(93890),N=r(n(48466)),F=n(60721),E=n(11528),z=n(36906),M=n(33029),O=n(43024),V=n(51458);new Map([["Tuple",{version:u.PythonVersion.V3_9,fullName:"builtins.tuple",replacementText:"tuple"}],["List",{version:u.PythonVersion.V3_9,fullName:"builtins.list",replacementText:"list"}],["Dict",{version:u.PythonVersion.V3_9,fullName:"builtins.dict",replacementText:"dict"}],["Set",{version:u.PythonVersion.V3_9,fullName:"builtins.set",replacementText:"set"}],["FrozenSet",{version:u.PythonVersion.V3_9,fullName:"builtins.frozenset",replacementText:"frozenset"}],["Type",{version:u.PythonVersion.V3_9,fullName:"builtins.type",replacementText:"type"}],["Deque",{version:u.PythonVersion.V3_9,fullName:"collections.deque",replacementText:"collections.deque"}],["DefaultDict",{version:u.PythonVersion.V3_9,fullName:"collections.defaultdict",replacementText:"collections.defaultdict"}],["OrderedDict",{version:u.PythonVersion.V3_9,fullName:"collections.OrderedDict",replacementText:"collections.OrderedDict"}],["Counter",{version:u.PythonVersion.V3_9,fullName:"collections.Counter",replacementText:"collections.Counter"}],["ChainMap",{version:u.PythonVersion.V3_9,fullName:"collections.ChainMap",replacementText:"collections.ChainMap"}]]),new Map([["Optional",{version:u.PythonVersion.V3_10,fullName:"typing.Optional",replacementText:"| None"}],["Union",{version:u.PythonVersion.V3_10,fullName:"typing.Union",replacementText:"|"}]]);class R extends k.ParseTreeWalker{constructor(e,t,n,a,i){super(),this._importResolver=e,this._evaluator=t,this._parseResults=n,this._sourceMapper=a,this._dependentFiles=i,this._isUnboundCheckSuppressed=!1,this._scopedNodes=[],this._typeParameterLists=[],this._moduleNode=n.parseTree,this._fileInfo=T.getFileInfo(this._moduleNode)}check(){this._scopedNodes.push(this._moduleNode),this._conditionallyReportShadowedModule();const e=T.getCodeFlowComplexity(this._moduleNode);e>E.maxCodeComplexity&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.codeTooComplexToAnalyze(),{start:0,length:0}),this._walkStatementsAndReportUnreachable(this._moduleNode.statements);const t=T.getDunderAllInfo(this._moduleNode);t&&(this._evaluator.markNamesAccessed(this._moduleNode,t.names),this._reportUnusedDunderAllSymbols(t.stringNodes)),this._validateSymbolTables(),this._reportDuplicateImports(),this._checkRegions()}walk(e){T.isCodeUnreachable(e)?this._evaluator.suppressDiagnostics(e,(()=>{super.walk(e)})):super.walk(e)}visitSuite(e){return this._walkStatementsAndReportUnreachable(e.statements),!1}visitStatementList(e){return e.statements.forEach((e=>{(0,h.isExpressionNode)(e)&&(this._evaluator.getType(e),this._reportUnusedExpression(e))})),!0}visitClass(e){const t=this._evaluator.getTypeOfClass(e);return e.typeParameters&&this.walk(e.typeParameters),this.walk(e.suite),this.walkMultiple(e.decorators),this.walkMultiple(e.arguments),t&&(V.ClassType.isProtocolClass(t.classType)&&(e.arguments.forEach((e=>{if(!e.name){const n=this._evaluator.getType(e.valueExpression);n&&(0,V.isInstantiableClass)(n)&&!V.ClassType.isBuiltIn(n,"Protocol")&&!V.ClassType.isBuiltIn(n,"Generic")&&(V.ClassType.isProtocolClass(n)||this._evaluator.addError(g.Localizer.Diagnostic.protocolBaseClass().format({classType:this._evaluator.printType(t.classType),baseType:this._evaluator.printType(n)}),e.valueExpression))}})),this._validateProtocolTypeParamVariance(e,t.classType)),this._fileInfo.isStubFile||(this._validateBaseClassOverrides(t.classType),this._validateSlotsClassVarConflict(t.classType)),this._validateMultipleInheritanceCompatibility(t.classType,e.name),this._validateConstructorConsistency(t.classType),this._validateFinalMemberOverrides(t.classType),this._validateInstanceVariableInitialization(e,t.classType),this._validateFinalClassNotAbstract(t.classType,e),this._validateDataClassPostInit(t.classType,e),this._validateProtocolCompatibility(t.classType,e),this._reportDuplicateEnumMembers(t.classType),V.ClassType.isTypedDictClass(t.classType)&&this._validateTypedDictClassSuite(e.suite),V.ClassType.isEnumClass(t.classType)&&this._validateEnumClassOverride(e,t.classType),this._evaluator.validateInitSubclassArgs(e,t.classType)),this._scopedNodes.push(e),!1}visitFunction(e){var t;e.typeParameters&&this.walk(e.typeParameters),this._fileInfo.diagnosticRuleSet.analyzeUnannotatedFunctions||this._fileInfo.isStubFile||C.isUnannotatedFunction(e)&&this._evaluator.addInformation(g.Localizer.Diagnostic.unannotatedFunctionSkipped().format({name:e.name.value}),e.name);const n=this._evaluator.getTypeOfFunction(e),a=C.getEnclosingClass(e,!0);if(n){let i=!1;e.parameters.forEach(((e,t)=>{if(e.name)if(1===e.category){const t=e.typeAnnotation||e.typeAnnotationComment;if(t&&35===t.nodeType&&"args"===t.memberName.value){const e=this._evaluator.getType(t.leftExpression);e&&(0,V.isTypeVar)(e)&&e.details.isParamSpec&&(i=!0)}}else 2===e.category&&(i=!1);if(e.name&&0===e.category&&i&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.namedParamAfterParamSpecArgs().format({name:e.name.value}),e.name),e.name&&"_"!==e.name.value){const t=n.functionType.details.parameters.find((t=>{var n;return t.name===(null===(n=e.name)||void 0===n?void 0:n.value)}));if(t){const n=t.type;if("none"!==this._fileInfo.diagnosticRuleSet.reportUnknownParameterType)if((0,V.isUnknown)(n)||(0,V.isTypeVar)(n)&&n.details.isSynthesized&&!n.details.isSynthesizedSelf)this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownParameterType,c.DiagnosticRule.reportUnknownParameterType,g.Localizer.Diagnostic.paramTypeUnknown().format({paramName:e.name.value}),e.name);else if((0,M.isPartlyUnknown)(n)){const t=new p.DiagnosticAddendum;t.addMessage(g.Localizer.DiagnosticAddendum.paramType().format({paramType:this._evaluator.printType(n,{expandTypeAlias:!0})})),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownParameterType,c.DiagnosticRule.reportUnknownParameterType,g.Localizer.Diagnostic.paramTypePartiallyUnknown().format({paramName:e.name.value})+t.getString(),e.name)}let a=!1;(t.typeAnnotation||(0,V.isTypeVar)(n)&&n.details.isSynthesizedSelf)&&(a=!0),a||"none"===this._fileInfo.diagnosticRuleSet.reportMissingParameterType||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingParameterType,c.DiagnosticRule.reportMissingParameterType,g.Localizer.Diagnostic.paramAnnotationMissing().format({name:e.name.value}),e.name)}}}));const r=n.functionType.details.parameters.filter((e=>!!(e.typeAnnotation&&(0,V.isTypeVar)(e.type)&&(0,V.isParamSpec)(e.type)&&0!==e.category&&e.name&&e.type.paramSpecAccess)));if(1===r.length&&r[0].typeAnnotation&&this._evaluator.addError(g.Localizer.Diagnostic.paramSpecArgsKwargsUsage(),r[0].typeAnnotation),this._fileInfo.isStubFile){e.returnTypeAnnotation||(null===(t=e.functionAnnotationComment)||void 0===t?void 0:t.returnTypeAnnotation)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownParameterType,c.DiagnosticRule.reportUnknownParameterType,g.Localizer.Diagnostic.returnTypeUnknown(),e.name)}a&&this._validateMethod(e,n.functionType,a)}e.parameters.forEach(((e,t)=>{if(e.defaultValue&&this.walk(e.defaultValue),e.typeAnnotation&&this.walk(e.typeAnnotation),e.typeAnnotationComment&&this.walk(e.typeAnnotationComment),n){const a=e.typeAnnotation||e.typeAnnotationComment;if(a&&t<n.functionType.details.parameters.length){const e=n.functionType.details.parameters[t].type,i=["__init__","__new__"];!(0,V.isTypeVar)(e)||3!==e.details.declaredVariance||e.details.isSynthesized||i.some((e=>e===n.functionType.details.name))||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.paramTypeCovariant(),a)}}})),e.returnTypeAnnotation&&this.walk(e.returnTypeAnnotation),e.functionAnnotationComment&&(this.walk(e.functionAnnotationComment),"none"!==this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage&&this._fileInfo.executionEnvironment.pythonVersion>=u.PythonVersion.V3_5&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage,c.DiagnosticRule.reportTypeCommentUsage,g.Localizer.Diagnostic.typeCommentDeprecated(),e.functionAnnotationComment)),this.walkMultiple(e.decorators),e.parameters.forEach((e=>{e.name&&this.walk(e.name)}));const i=T.getCodeFlowComplexity(e),r=i>E.maxCodeComplexity;if(r?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.codeTooComplexToAnalyze(),e.name):this.walk(e.suite),n&&(r||this._validateFunctionReturn(e,n.functionType),this._validateDunderSignatures(e,n.functionType,void 0!==a),this._validateTypeGuardFunction(e,n.functionType,void 0!==a),this._validateFunctionTypeVarUsage(e,n)),this._fileInfo.isStubFile&&"__getattr__"===e.name.value){const t=(0,A.getScopeForNode)(e);3===(null==t?void 0:t.type)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompleteStub,c.DiagnosticRule.reportIncompleteStub,g.Localizer.Diagnostic.stubUsesGetAttr(),e.name)}if(this._scopedNodes.push(e),n&&(0,V.isOverloadedFunction)(n.decoratedType)&&V.OverloadedFunctionType.getImplementation(n.decoratedType)!==n.functionType){const t=V.OverloadedFunctionType.getOverloads(n.decoratedType);if(t.length>1){const n=100;t.length<n&&this._validateOverloadConsistency(e,t[t.length-1],t.slice(0,t.length-1))}}return!1}visitLambda(e){this._evaluator.getType(e),this.walkMultiple([...e.parameters,e.expression]),e.parameters.forEach((e=>{if(e.name){const t=this._evaluator.getType(e.name);t&&((0,V.isUnknown)(t)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownLambdaType,c.DiagnosticRule.reportUnknownLambdaType,g.Localizer.Diagnostic.paramTypeUnknown().format({paramName:e.name.value}),e.name):(0,M.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownLambdaType,c.DiagnosticRule.reportUnknownLambdaType,g.Localizer.Diagnostic.paramTypePartiallyUnknown().format({paramName:e.name.value}),e.name))}}));const t=this._evaluator.getType(e.expression);return t&&((0,V.isUnknown)(t)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownLambdaType,c.DiagnosticRule.reportUnknownLambdaType,g.Localizer.Diagnostic.lambdaReturnTypeUnknown(),e.expression):(0,M.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownLambdaType,c.DiagnosticRule.reportUnknownLambdaType,g.Localizer.Diagnostic.lambdaReturnTypePartiallyUnknown().format({returnType:this._evaluator.printType(t,{expandTypeAlias:!0})}),e.expression)),this._scopedNodes.push(e),!1}visitCall(e){var t;if(this._validateIsInstanceCall(e),this._validateIllegalDefaultParamInitializer(e),this._validateStandardCollectionInstantiation(e),("none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCallResult||"none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCoroutine)&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)){const t=38===e.leftExpression.nodeType&&"reveal_type"===e.leftExpression.value,n=this._evaluator.getType(e);!t&&n&&this._isTypeValidForUnusedValueTest(n)&&(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnusedCallResult,c.DiagnosticRule.reportUnusedCallResult,g.Localizer.Diagnostic.unusedCallResult().format({type:this._evaluator.printType(n)}),e),(0,V.isClassInstance)(n)&&V.ClassType.isBuiltIn(n,"Coroutine")&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnusedCoroutine,c.DiagnosticRule.reportUnusedCoroutine,g.Localizer.Diagnostic.unusedCoroutine(),e))}return!0}visitAwait(e){var t;if("none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCallResult&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&9===e.expression.nodeType){const t=this._evaluator.getType(e);t&&this._isTypeValidForUnusedValueTest(t)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnusedCallResult,c.DiagnosticRule.reportUnusedCallResult,g.Localizer.Diagnostic.unusedCallResult().format({type:this._evaluator.printType(t)}),e)}return!0}visitFor(e){return this._evaluator.evaluateTypesForStatement(e),e.typeComment&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.annotationNotSupported(),e.typeComment),!0}visitList(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitSet(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitDictionary(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitListComprehension(e){return this._scopedNodes.push(e),!0}visitListComprehensionIf(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitIf(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitWhile(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitWith(e){return e.withItems.forEach((e=>{this._evaluator.evaluateTypesForStatement(e)})),e.typeComment&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.annotationNotSupported(),e.typeComment),!0}visitReturn(e){var t,n;let a;const i=C.getEnclosingFunction(e),r=i?this._evaluator.getFunctionDeclaredReturnType(i):void 0;if(a=e.returnExpression?null!==(t=this._evaluator.getTypeResult(e.returnExpression))&&void 0!==t?t:{type:V.UnknownType.create()}:{type:V.NoneType.createInstance()},(null==i?void 0:i.isAsync)&&e.returnExpression){const t=T.getDeclaration(i);5===(null==t?void 0:t.type)&&t.isGenerator&&this._evaluator.addError(g.Localizer.Diagnostic.returnInAsyncGenerator(),e.returnExpression)}if(this._evaluator.isNodeReachable(e,void 0)&&i){if(r)if((0,V.isNever)(r))this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.noReturnContainsReturn(),e);else{let t=new p.DiagnosticAddendum,i=!1;if(this._evaluator.assignType(r,a.type,t,new O.TypeVarContext,void 0,64))i=!0;else{const n=(0,M.getTypeVarArgumentsRecursive)(r);if(n&&n.some((e=>e.details.constraints.length>0))){const s=new O.TypeVarContext;for(const t of n)if(t.details.constraints.length>0){const n=this._evaluator.narrowConstrainedTypeVar(e,t);n&&(s.setTypeVarType(t,n),s.addSolveForScope((0,M.getTypeVarScopeId)(t)))}if(!s.isEmpty()){const e=(0,M.applySolvedTypeVars)(r,s);this._evaluator.assignType(e,a.type,t,void 0,void 0,64)&&(i=!0)}}}i||(a.expectedTypeDiagAddendum&&(t=a.expectedTypeDiagAddendum),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.returnTypeMismatch().format({exprType:this._evaluator.printType(a.type),returnType:this._evaluator.printType(r)})+t.getString(),e.returnExpression?e.returnExpression:e,null===(n=a.expectedTypeDiagAddendum)||void 0===n?void 0:n.getEffectiveTextRange()))}(0,V.isUnknown)(a.type)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownVariableType,c.DiagnosticRule.reportUnknownVariableType,g.Localizer.Diagnostic.returnTypeUnknown(),e.returnExpression):(0,M.isPartlyUnknown)(a.type)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownVariableType,c.DiagnosticRule.reportUnknownVariableType,g.Localizer.Diagnostic.returnTypePartiallyUnknown().format({returnType:this._evaluator.printType(a.type,{expandTypeAlias:!0})}),e.returnExpression)}return!0}visitYield(e){const t=e.expression?this._evaluator.getType(e.expression):V.NoneType.createInstance();return this._validateYieldType(e,t||V.UnknownType.create()),!0}visitYieldFrom(e){var t,n,a,i;const r=this._evaluator.getType(e.expression)||V.UnknownType.create();let s;if((0,V.isClassInstance)(r)&&V.ClassType.isBuiltIn(r,"Coroutine"))s=V.UnknownType.create();else{s=null!==(n=null===(t=this._evaluator.getTypeOfIterable({type:r},!1,e))||void 0===t?void 0:t.type)&&void 0!==n?n:V.UnknownType.create();const o=(0,M.getGeneratorTypeArgs)(s);s=o?o.length>=1?o[0]:V.UnknownType.create():null!==(i=null===(a=this._evaluator.getTypeOfIterator({type:r},!1,e))||void 0===a?void 0:a.type)&&void 0!==i?i:V.UnknownType.create()}return this._validateYieldType(e,s),!0}visitRaise(e){if(this._evaluator.verifyRaiseExceptionType(e),e.valueExpression){const t=this._evaluator.getBuiltInType(e,"BaseException"),n=this._evaluator.getType(e.valueExpression);if(n&&t&&(0,V.isInstantiableClass)(t)){const a=new p.DiagnosticAddendum;(0,M.doForEachSubtype)(n,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,V.isAnyOrUnknown)(e)||(0,V.isNoneInstance)(e)||(0,V.isClass)(e)&&(0,M.derivesFromClassRecursive)(e,t,!1)||a.addMessage(g.Localizer.Diagnostic.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)}))})),a.isEmpty()||this._evaluator.addError(g.Localizer.Diagnostic.expectedExceptionObj()+a.getString(),e.valueExpression)}}return!0}visitExcept(e){if(e.typeExpression){this._evaluator.evaluateTypesForStatement(e);const t=this._evaluator.getType(e.typeExpression);t&&this._validateExceptionType(t,e.typeExpression)}return!0}visitAssert(e){e.exceptionExpression&&this._evaluator.getType(e.exceptionExpression),this._validateConditionalIsBool(e.testExpression);const t=this._evaluator.getType(e.testExpression);return t&&(0,V.isClassInstance)(t)&&(0,M.isTupleClass)(t)&&t.tupleTypeArguments&&t.tupleTypeArguments.length>0&&((0,M.isUnboundedTupleClass)(t)||this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportAssertAlwaysTrue,c.DiagnosticRule.reportAssertAlwaysTrue,g.Localizer.Diagnostic.assertAlwaysTrue(),e.testExpression)),!0}visitAssignment(e){if(this._evaluator.evaluateTypesForStatement(e),e.typeAnnotationComment&&(this._evaluator.getType(e.typeAnnotationComment),"none"!==this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage&&this._fileInfo.executionEnvironment.pythonVersion>=u.PythonVersion.V3_6&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage,c.DiagnosticRule.reportTypeCommentUsage,g.Localizer.Diagnostic.typeCommentDeprecated(),e.typeAnnotationComment)),54===e.leftExpression.nodeType){const t=this._evaluator.getTypeOfAnnotation(e.leftExpression.typeAnnotation);if((0,V.isClassInstance)(t)&&V.ClassType.isBuiltIn(t,"TypeAlias")){const t=(0,A.getScopeForNode)(e);t&&2!==t.type&&3!==t.type&&4!==t.type&&this._evaluator.addError(g.Localizer.Diagnostic.typeAliasNotInModuleOrClass(),e.leftExpression.typeAnnotation)}}return!0}visitAssignmentExpression(e){return this._evaluator.getType(e),!0}visitAugmentedAssignment(e){return this._evaluator.evaluateTypesForStatement(e),!0}visitIndex(e){this._evaluator.getType(e);const t=this._evaluator.getType(e.baseExpression);return t&&(0,M.doForEachSubtype)(t,(t=>{if((0,V.isClassInstance)(t)&&t.tupleTypeArguments&&!(0,M.isUnboundedTupleClass)(t)){const n=t.tupleTypeArguments.length;if(1===e.items.length&&!e.trailingComma&&0===e.items[0].argumentCategory&&!e.items[0].name){const a=this._evaluator.getType(e.items[0].valueExpression);a&&(0,V.isClassInstance)(a)&&V.ClassType.isBuiltIn(a,"int")&&(0,M.isLiteralType)(a)&&"number"==typeof a.literalValue&&(a.literalValue>=0&&a.literalValue>=n||a.literalValue<0&&a.literalValue+n<0)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.tupleIndexOutOfRange().format({index:a.literalValue,type:this._evaluator.printType(t)}),e)}}})),!0}visitBinaryOperation(e){return 36!==e.operator&&37!==e.operator||(this._validateConditionalIsBool(e.leftExpression),this._validateConditionalIsBool(e.rightExpression)),12===e.operator||28===e.operator?C.isWithinAssertExpression(e)||this._validateComparisonTypes(e):39===e.operator||40===e.operator?C.isWithinAssertExpression(e)||this._validateComparisonTypesForIsOperator(e):41!==e.operator&&42!==e.operator||C.isWithinAssertExpression(e)||this._validateContainmentTypes(e),this._evaluator.getType(e),!0}visitSlice(e){return this._evaluator.getType(e),!0}visitUnpack(e){return this._evaluator.getType(e),!0}visitTuple(e){return this._evaluator.getType(e),!0}visitUnaryOperation(e){return 38===e.operator&&this._validateConditionalIsBool(e.expression),this._evaluator.getType(e),!0}visitTernary(e){return this._evaluator.getType(e),this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitStringList(e){const t=[];if(this._fileInfo.executionEnvironment.pythonVersion<u.PythonVersion.V3_12){let n=e;for(;n;)27===n.nodeType&&t.push(n),n=n.parent}for(const n of e.strings){if((49===n.nodeType?[n.token]:n.middleTokens).forEach((e=>{const n=(0,f.getUnescapedString)(e);let a=e.start;if(5===e.type&&(a+=e.prefixLength+e.quoteMarkLength),n.unescapeErrors.forEach((e=>{0===e.errorType&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportInvalidStringEscapeSequence,c.DiagnosticRule.reportInvalidStringEscapeSequence,g.Localizer.Diagnostic.stringUnsupportedEscape(),{start:a+e.offset,length:e.length})})),t.length>0){e.escapedValue.indexOf("\\")>=0&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,"error","",g.Localizer.Diagnostic.formatStringEscape(),{start:a,length:1})}})),t.length>0){const e=7;t.some((t=>(t.token.flags&e)==(n.token.flags&e)))&&this._evaluator.addError(g.Localizer.Diagnostic.formatStringNestedQuote(),n)}}return e.typeAnnotation&&this._evaluator.getType(e),e.strings.length>1&&!e.isParenthesized&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportImplicitStringConcatenation,c.DiagnosticRule.reportImplicitStringConcatenation,g.Localizer.Diagnostic.implicitStringConcat(),e),!0}visitFormatString(e){return e.fieldExpressions.forEach((e=>{this._evaluator.getType(e)})),e.formatExpressions.forEach((e=>{this._evaluator.getType(e)})),!0}visitGlobal(e){return this._suppressUnboundCheck((()=>{e.nameList.forEach((e=>{this._evaluator.getType(e),this.walk(e)}))})),!1}visitNonlocal(e){return this._suppressUnboundCheck((()=>{e.nameList.forEach((e=>{this._evaluator.getType(e),this.walk(e)}))})),!1}visitName(e){this._conditionallyReportPrivateUsage(e),this._isUnboundCheckSuppressed||this._reportUnboundName(e);const t=this._evaluator.getType(e);return this._reportDeprecatedUse(e,t),!0}visitDel(e){return e.expressions.forEach((e=>{this._evaluator.verifyDeleteExpression(e),this.walk(e)})),!1}visitMemberAccess(e){const t=this._evaluator.getType(e);return this._reportDeprecatedUse(e.memberName,t),this._conditionallyReportPrivateUsage(e.memberName),this.walk(e.leftExpression),!1}visitImportAs(e){return this._conditionallyReportShadowedImport(e),this._evaluator.evaluateTypesForStatement(e),!0}visitImportFrom(e){if(0===e.module.leadingDots&&1===e.module.nameParts.length&&"__future__"===e.module.nameParts[0].value&&(C.isValidLocationForFutureImport(e)||this._evaluator.addError(g.Localizer.Diagnostic.futureImportLocationNotAllowed(),e)),this._conditionallyReportShadowedImport(e),e.isWildcardImport){const t=T.getImportInfo(e.module);t&&t.isImportFound&&2!==t.importType&&!this._fileInfo.isStubFile&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportWildcardImportFromLibrary,c.DiagnosticRule.reportWildcardImportFromLibrary,g.Localizer.Diagnostic.wildcardLibraryImport(),e.wildcardToken||e)}else e.imports.forEach((e=>{this._evaluator.evaluateTypesForStatement(e)}));return!0}visitImportFromAs(e){var t;if(this._fileInfo.isStubFile)return!1;const n=this._evaluator.getDeclarationsForNameNode(e.name);if(!n)return!1;for(const t of n){if(!(0,v.isAliasDeclaration)(t)||!t.submoduleFallback||t.node!==e)continue;const n=this._evaluator.resolveAliasDeclaration(t,!0);if(!(null==n?void 0:n.path)||!(0,P.isStubFile)(n.path))continue;const a=this._getImportResult(e,n.path);if(a){this._addMissingModuleSourceDiagnosticIfNeeded(a,e.name);break}}const a=this._evaluator.getType(null!==(t=e.alias)&&void 0!==t?t:e.name);return this._reportDeprecatedUse(e.name,a),!1}visitModuleName(e){if(this._fileInfo.isStubFile)return!1;const t=T.getImportInfo(e);return(0,l.assert)(void 0!==t),this._addMissingModuleSourceDiagnosticIfNeeded(t,e),!1}visitTypeParameterList(e){return this._typeParameterLists.push(e),!0}visitTypeParameter(e){return!1}visitTypeAnnotation(e){return this._evaluator.getType(e.typeAnnotation),!0}visitMatch(e){return this._evaluator.getType(e.subjectExpression),this._validateExhaustiveMatch(e),!0}visitCase(e){return e.guardExpression&&this._validateConditionalIsBool(e.guardExpression),this._evaluator.evaluateTypesForStatement(e.pattern),!0}visitPatternClass(e){return(0,S.validateClassPattern)(this._evaluator,e),!0}visitTry(e){return this._reportUnusedExceptStatements(e),!0}visitError(e){return e.child&&this._evaluator.getType(e.child),!1}_getImportResult(e,t){const n=this._importResolver.getConfigOptions().findExecEnvironment(t),a=0===e.parent.module.leadingDots?this._importResolver.getModuleNameForImport(t,n).moduleName:(0,_.getRelativeModuleName)(this._importResolver.fileSystem,this._fileInfo.filePath,t);if(a)return this._importResolver.resolveImport(this._fileInfo.filePath,n,(0,b.createImportedModuleDescriptor)(a))}_addMissingModuleSourceDiagnosticIfNeeded(e,t){!e.isNativeLib&&e.isStubFile&&0!==e.importType&&e.nonStubImportResult&&!e.nonStubImportResult.isImportFound&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingModuleSource,c.DiagnosticRule.reportMissingModuleSource,g.Localizer.Diagnostic.importSourceResolveFailure().format({importName:e.importName}),t)}_validateConditionalIsBool(e){const t=this._evaluator.getType(e);if(!t)return;let n=!0;const a=new p.DiagnosticAddendum;this._evaluator.mapSubtypesExpandTypeVars(t,void 0,(t=>{if((0,V.isAnyOrUnknown)(t))return;if((0,V.isClassInstance)(t)&&V.ClassType.isBuiltIn(t,"bool"))return;const i=this._evaluator.getTypeOfMagicMethodReturn(t,[],"__bool__",e,void 0);i&&!(0,V.isAnyOrUnknown)(i)&&((0,V.isClassInstance)(i)&&V.ClassType.isBuiltIn(i,"bool")||(n=!1,a.addMessage(g.Localizer.DiagnosticAddendum.conditionalRequiresBool().format({operandType:this._evaluator.printType(t),boolReturnType:this._evaluator.printType(i)}))))})),n||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.conditionalOperandInvalid().format({type:this._evaluator.printType(t)})+a.getString(),e)}_reportUnnecessaryConditionExpression(e){if(7===e.nodeType)return void(36!==e.operator&&37!==e.operator||(this._reportUnnecessaryConditionExpression(e.leftExpression),this._reportUnnecessaryConditionExpression(e.rightExpression)));if(55===e.nodeType)return void(38===e.operator&&this._reportUnnecessaryConditionExpression(e.expression));const t=this._evaluator.getTypeOfExpression(e);let n=!0;(0,M.doForEachSubtype)(t.type,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,V.isFunction)(e)||(0,V.isOverloadedFunction)(e)||(n=!1)})),n&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryComparison,c.DiagnosticRule.reportUnnecessaryComparison,g.Localizer.Diagnostic.functionInConditionalExpression(),e)}_reportUnusedExpression(e){var t,n;if("none"===this._fileInfo.diagnosticRuleSet.reportUnusedExpression)return;let a=!1;[55,7,40,11,38,52].some((t=>t===e.nodeType))?a=!0:31!==e.nodeType&&45!==e.nodeType&&15!==e.nodeType||e.entries.some((e=>32===e.nodeType))||(a=!0),a&&this._fileInfo.ipythonMode===x.IPythonMode.CellDocs&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.statements[e.parent.statements.length-1]===e&&36===(null===(n=e.parent.parent)||void 0===n?void 0:n.nodeType)&&e.parent.parent.statements[e.parent.parent.statements.length-1]===e.parent&&(a=!1),a&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnusedExpression,c.DiagnosticRule.reportUnusedExpression,g.Localizer.Diagnostic.unusedExpression(),e)}_validateExhaustiveMatch(e){if("none"===this._fileInfo.diagnosticRuleSet.reportMatchNotExhaustive)return;const t=this._evaluator.evaluateTypeForSubnode(e,(()=>{this._evaluator.evaluateTypesForMatchStatement(e)}));if(t&&!(0,V.isNever)(t.type)){const n=new p.DiagnosticAddendum;n.addMessage(g.Localizer.DiagnosticAddendum.matchIsNotExhaustiveType().format({type:this._evaluator.printType(t.type)})),n.addMessage(g.Localizer.DiagnosticAddendum.matchIsNotExhaustiveHint()),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMatchNotExhaustive,c.DiagnosticRule.reportMatchNotExhaustive,g.Localizer.Diagnostic.matchIsNotExhaustive()+n.getString(),e.subjectExpression)}}_suppressUnboundCheck(e){const t=this._isUnboundCheckSuppressed;this._isUnboundCheckSuppressed=!0;try{e()}finally{this._isUnboundCheckSuppressed=t}}_validateIllegalDefaultParamInitializer(e){"none"!==this._fileInfo.diagnosticRuleSet.reportCallInDefaultInitializer&&C.isWithinDefaultParamInitializer(e)&&!this._fileInfo.isStubFile&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportCallInDefaultInitializer,c.DiagnosticRule.reportCallInDefaultInitializer,g.Localizer.Diagnostic.defaultValueContainsCall(),e)}_validateStandardCollectionInstantiation(e){const t=this._evaluator.getType(e.leftExpression);if(t&&(0,V.isInstantiableClass)(t)&&V.ClassType.isBuiltIn(t)&&!t.includeSubclasses&&t.aliasName){["List","Set","Dict","Tuple"].some((e=>e===t.aliasName))&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.collectionAliasInstantiation().format({type:t.aliasName,alias:t.details.name}),e.leftExpression)}}_validateContainmentTypes(e){const t=this._evaluator.getType(e.leftExpression),n=this._evaluator.getType(e.rightExpression);if(!t||!n)return;if((0,V.isNever)(t)||(0,V.isNever)(n))return;const a=(0,z.getElementTypeForContainerNarrowing)(n);if(!a)return;const i=(0,z.narrowTypeForContainerElementType)(this._evaluator,t,this._evaluator.makeTopLevelTypeVarsConcrete(a));if((0,V.isNever)(i)){const n=()=>41===e.operator?g.Localizer.Diagnostic.containmentAlwaysFalse():g.Localizer.Diagnostic.containmentAlwaysTrue();this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryContains,c.DiagnosticRule.reportUnnecessaryContains,n().format({leftType:this._evaluator.printType(t,{expandTypeAlias:!0}),rightType:this._evaluator.printType(a,{expandTypeAlias:!0})}),e)}}_validateComparisonTypesForIsOperator(e){const t=this._evaluator.getType(e.rightExpression);if(!t||!(0,V.isNoneInstance)(t))return;const n=this._evaluator.getType(e.leftExpression);if(!n)return;let a=!1;(0,M.doForEachSubtype)(n,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),this._evaluator.assignType(e,V.NoneType.createInstance())&&(a=!0)}));a||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryComparison,c.DiagnosticRule.reportUnnecessaryComparison,(39===e.operator?g.Localizer.Diagnostic.comparisonAlwaysFalse():g.Localizer.Diagnostic.comparisonAlwaysTrue()).format({leftType:this._evaluator.printType(n,{expandTypeAlias:!0}),rightType:this._evaluator.printType(t)}),e)}_validateComparisonTypes(e){let t=e.rightExpression;7===t.nodeType&&!t.parenthesized&&C.operatorSupportsChaining(t.operator)&&(t=t.leftExpression);const n=this._evaluator.getType(e.leftExpression),a=this._evaluator.getType(t);if(!n||!a)return;if((0,V.isNever)(n)||(0,V.isNever)(a))return;const i=()=>12===e.operator?g.Localizer.Diagnostic.comparisonAlwaysFalse():g.Localizer.Diagnostic.comparisonAlwaysTrue();if((0,M.isLiteralTypeOrUnion)(a)&&(0,M.isLiteralTypeOrUnion)(n)){if(void 0===(0,D.evaluateStaticBoolExpression)(e,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants)){let t=!1;(0,M.doForEachSubtype)(n,(e=>{this._evaluator.assignType(a,e)&&(t=!0)})),t||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryComparison,c.DiagnosticRule.reportUnnecessaryComparison,i().format({leftType:this._evaluator.printType(n,{expandTypeAlias:!0}),rightType:this._evaluator.printType(a,{expandTypeAlias:!0})}),e)}}else{let t=!1;if((0,M.doForEachSubtype)(n,(e=>{t||(e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,M.doForEachSubtype)(a,(n=>{t||(n=this._evaluator.makeTopLevelTypeVarsConcrete(n),this._isTypeComparable(e,n)&&(t=!0))})))})),!t){const t=this._evaluator.printType(n,{expandTypeAlias:!0}),r=this._evaluator.printType(a,{expandTypeAlias:!0});this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryComparison,c.DiagnosticRule.reportUnnecessaryComparison,i().format({leftType:t,rightType:r}),e)}}}_isTypeComparable(e,t){if((0,V.isAnyOrUnknown)(e)||(0,V.isAnyOrUnknown)(t))return!0;if((0,V.isNever)(e)||(0,V.isNever)(t))return!1;if((0,V.isModule)(e)||(0,V.isModule)(t))return(0,V.isTypeSame)(e,t);if((0,V.isNoneInstance)(e)||(0,V.isNoneInstance)(t))return(0,V.isTypeSame)(e,t);if(((0,V.isFunction)(e)||(0,V.isOverloadedFunction)(e))!==((0,V.isFunction)(t)||(0,V.isOverloadedFunction)(t)))return!1;if((0,V.isInstantiableClass)(e)||(0,V.isClassInstance)(e)&&V.ClassType.isBuiltIn(e,"type")){if((0,V.isInstantiableClass)(t)||(0,V.isClassInstance)(t)&&V.ClassType.isBuiltIn(t,"type")){const n=V.ClassType.cloneForSpecialization(e,void 0,!1),a=V.ClassType.cloneForSpecialization(t,void 0,!1);if(this._evaluator.assignType(n,a)||this._evaluator.assignType(a,n))return!0}const n=e.details.effectiveMetaclass;return!!(n&&(0,V.isClass)(n)&&(0,M.lookUpClassMember)(n,"__eq__",4))}if((0,V.isClassInstance)(e)){if((0,V.isClassInstance)(t)){const n=V.ClassType.cloneForSpecialization(e,void 0,!1),a=V.ClassType.cloneForSpecialization(t,void 0,!1);if(this._evaluator.assignType(n,a)||this._evaluator.assignType(a,n))return!0;if(V.ClassType.isBuiltIn(e)&&V.ClassType.isBuiltIn(t))return!1}const n=(0,M.lookUpClassMember)(V.ClassType.cloneAsInstantiable(e),"__eq__",4);return!!n&&(!V.ClassType.isDataClass(e)||!n.symbol.getSynthesizedType())}return!0}_isTypeValidForUnusedValueTest(e){return!(0,V.isNoneInstance)(e)&&!(0,V.isNever)(e)&&!(0,V.isAnyOrUnknown)(e)}_validateFunctionTypeVarUsage(e,t){if("none"===this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse)return;const n=t.functionType,a=new Map,i=new Map;let r,s,o=!0;if(V.FunctionType.isInstanceMethod(n)&&"__init__"===e.name.value){const t=C.getEnclosingClassOrFunction(e);if(t&&10===t.nodeType){const e=this._evaluator.getTypeOfClass(t);e&&(0,V.isClass)(e.classType)&&(s=e.classType)}}const l=new C.NameNodeWalker(((t,n,l)=>{var p,c,d,u,m,y;const g=this._evaluator.getType(t);if(g&&(0,V.isTypeVar)(g)&&!g.details.isSynthesizedSelf){if(g.scopeId===C.getScopeIdForNode(e)){let e=g.details.constraints.length>0||!!g.details.defaultType||o&&void 0!==g.details.boundType&&void 0!==n||(0,V.isParamSpec)(g);if(!e&&l&&void 0!==n){const t=this._evaluator.getType(l);(null==t?void 0:t.typeAliasInfo)&&t.typeAliasInfo.typeParameters&&n<t.typeAliasInfo.typeParameters.length&&(e=!0)}const i=a.get(g.details.name),s=18===(null===(p=null==r?void 0:r.defaultValue)||void 0===p?void 0:p.nodeType);i?(i.nodes.push(t),void 0!==r?(i.paramTypeUsageCount+=1,s&&(i.paramTypeWithEllipsisUsageCount+=1,i.paramWithEllipsis||(i.paramWithEllipsis=null===(d=null==r?void 0:r.name)||void 0===d?void 0:d.value))):i.returnTypeUsageCount+=1):a.set(g.details.name,{nodes:[t],paramTypeUsageCount:void 0!==r?1:0,paramTypeWithEllipsisUsageCount:s?1:0,returnTypeUsageCount:void 0===r?1:0,paramWithEllipsis:s?null===(c=null==r?void 0:r.name)||void 0===c?void 0:c.value:void 0,isExempt:e})}if(s&&g.scopeId===s.details.typeVarScopeId){const e=i.get(g.details.name),n=18===(null===(u=null==r?void 0:r.defaultValue)||void 0===u?void 0:u.nodeType),a=!!g.details.defaultType;e?(e.nodes.push(t),void 0!==r&&(e.paramTypeUsageCount+=1,n&&(e.paramTypeWithEllipsisUsageCount+=1,e.paramWithEllipsis||(e.paramWithEllipsis=null===(y=null==r?void 0:r.name)||void 0===y?void 0:y.value)))):i.set(g.details.name,{nodes:[t],paramTypeUsageCount:void 0!==r?1:0,paramTypeWithEllipsisUsageCount:n?1:0,returnTypeUsageCount:0,paramWithEllipsis:n?null===(m=null==r?void 0:r.name)||void 0===m?void 0:m.value:void 0,isExempt:a})}}}));e.parameters.forEach((e=>{const t=e.typeAnnotation||e.typeAnnotationComment;t&&(r=e,l.walk(t))})),r=void 0,e.returnTypeAnnotation&&(o=!1,l.walk(e.returnTypeAnnotation)),a.forEach((e=>{var a;1!==e.nodes.length||e.isExempt||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse,c.DiagnosticRule.reportInvalidTypeVarUse,g.Localizer.Diagnostic.typeVarUsedOnlyOnce().format({name:e.nodes[0].value}),e.nodes[0]);let i=e.returnTypeUsageCount>0;if(1===e.returnTypeUsageCount&&n.details.declaredReturnType){const t=n.details.declaredReturnType;(0,V.isUnion)(t)&&t.subtypes.some((t=>(0,V.isTypeVar)(t)&&t.details.name===e.nodes[0].value))&&(i=!1)}const r=(0,V.isOverloadedFunction)(t.decoratedType)&&!V.FunctionType.isOverloaded(t.functionType);if(i&&e.paramTypeWithEllipsisUsageCount>0&&e.paramTypeUsageCount===e.paramTypeWithEllipsisUsageCount&&!r){const t=new p.DiagnosticAddendum;t.addMessage(g.Localizer.DiagnosticAddendum.typeVarUnsolvableRemedy()),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse,c.DiagnosticRule.reportInvalidTypeVarUse,g.Localizer.Diagnostic.typeVarPossiblyUnsolvable().format({name:e.nodes[0].value,param:null!==(a=e.paramWithEllipsis)&&void 0!==a?a:""})+t.getString(),e.nodes[0])}})),i.forEach((e=>{var t;if(e.paramTypeWithEllipsisUsageCount>0&&e.paramTypeUsageCount===e.paramTypeWithEllipsisUsageCount&&!e.isExempt){const n=new p.DiagnosticAddendum;n.addMessage(g.Localizer.DiagnosticAddendum.typeVarUnsolvableRemedy()),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse,c.DiagnosticRule.reportInvalidTypeVarUse,g.Localizer.Diagnostic.typeVarPossiblyUnsolvable().format({name:e.nodes[0].value,param:null!==(t=e.paramWithEllipsis)&&void 0!==t?t:""})+n.getString(),e.nodes[0])}}))}_validateOverloadConsistency(e,t,n){for(let a=0;a<n.length;a++){const i=n[a];if(this._isOverlappingOverload(t,i)){this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportOverlappingOverload,c.DiagnosticRule.reportOverlappingOverload,g.Localizer.Diagnostic.overlappingOverload().format({name:e.name.value,obscured:n.length+1,obscuredBy:a+1}),e.name);break}}for(let a=0;a<n.length;a++){const i=n[a];if(this._isOverlappingOverload(i,t)){const r=V.FunctionType.getSpecializedReturnType(i),s=V.FunctionType.getSpecializedReturnType(t);if(r&&s&&!this._evaluator.assignType(s,r,void 0,new O.TypeVarContext,void 0,520)){const t=this._findNodeForOverload(e,i);this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportOverlappingOverload,c.DiagnosticRule.reportOverlappingOverload,g.Localizer.Diagnostic.overloadReturnTypeMismatch().format({name:e.name.value,newIndex:n.length+1,prevIndex:a+1}),(t||e).name);break}}}}_findNodeForOverload(e,t){const n=this._evaluator.getDeclarationsForNameNode(e.name);if(n)for(const e of n)if(5===e.type){const n=this._evaluator.getTypeOfFunction(e.node);if((null==n?void 0:n.functionType)===t)return e.node}}_isOverlappingOverload(e,t){return(!V.FunctionType.isInstanceMethod(e)||"__get__"!==e.details.name)&&this._evaluator.assignType(e,t,void 0,new O.TypeVarContext((0,M.getTypeVarScopeId)(e)),void 0,48)}_isLegalOverloadImplementation(e,t,n){var a;const i=new O.TypeVarContext((0,M.getTypeVarScopeId)(t)),r=new O.TypeVarContext((0,M.getTypeVarScopeId)(e));let s=this._evaluator.assignType(e,t,n,r,i,290);const o=null!==(a=e.details.declaredReturnType)&&void 0!==a?a:this._evaluator.getFunctionInferredReturnType(e),l=(0,M.applySolvedTypeVars)(t.details.declaredReturnType||this._evaluator.getFunctionInferredReturnType(t),i),c=new p.DiagnosticAddendum;return(0,V.isNever)(o)||this._evaluator.assignType(l,o,c.createAddendum(),i,r,8)||(c.addMessage(g.Localizer.DiagnosticAddendum.functionReturnTypeMismatch().format({sourceType:this._evaluator.printType(o),destType:this._evaluator.printType(l)})),null==n||n.addAddendum(c),s=!1),s}_walkStatementsAndReportUnreachable(e){let t,n=!1;for(const a of e){if(!n&&!this._evaluator.isNodeReachable(a,t)){const t=a.start,i=e[e.length-1],r=m.TextRange.getEnd(i);this._evaluator.addUnreachableCode(a,{start:t,length:r-t}),n=!0}!n&&this._fileInfo.isStubFile&&this._validateStubStatement(a),this.walk(a),t=a}}_validateStubStatement(e){switch(e.nodeType){case 19:case 28:case 10:case 0:break;case 57:case 26:case 53:case 58:this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidStubStatement,c.DiagnosticRule.reportInvalidStubStatement,g.Localizer.Diagnostic.invalidStubStatement(),e);break;case 47:for(const t of e.statements){let e=!0;switch(t.nodeType){case 2:case 4:case 6:case 7:case 11:case 14:case 15:case 24:case 26:case 27:case 29:case 30:case 31:case 35:case 38:case 39:case 40:case 43:case 44:case 45:case 46:case 51:case 52:case 53:case 55:case 56:case 57:case 58:case 59:case 60:case 61:e=!1;break;case 5:e=1===t.operator&&38===t.leftExpression.nodeType&&"__all__"===t.leftExpression.value;break;case 9:e=35===t.leftExpression.nodeType&&38===t.leftExpression.leftExpression.nodeType&&"__all__"===t.leftExpression.leftExpression.value}e||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidStubStatement,c.DiagnosticRule.reportInvalidStubStatement,g.Localizer.Diagnostic.invalidStubStatement(),t)}}}_validateExceptionType(e,t){var n,a;const i=this._evaluator.getBuiltInType(t,"BaseException"),r=e=>!i||!(0,V.isInstantiableClass)(i)||(0,M.derivesFromClassRecursive)(e,i,!1),s=new p.DiagnosticAddendum;let o;if((0,V.isAnyOrUnknown)(e))o=e;else if((0,V.isInstantiableClass)(e))r(e)||s.addMessage(g.Localizer.Diagnostic.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)})),o=V.ClassType.cloneAsInstance(e);else if((0,V.isClassInstance)(e)){const i=null!==(a=null===(n=this._evaluator.getTypeOfIterator({type:e},!1,t))||void 0===n?void 0:n.type)&&void 0!==a?a:V.UnknownType.create();o=(0,M.mapSubtypes)(i,(t=>(0,V.isAnyOrUnknown)(t)?t:(0,V.isInstantiableClass)(t)?(r(t)||s.addMessage(g.Localizer.Diagnostic.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)})),V.ClassType.cloneAsInstance(t)):(s.addMessage(g.Localizer.Diagnostic.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)})),V.UnknownType.create())))}return s.isEmpty()||this._evaluator.addError(g.Localizer.Diagnostic.exceptionTypeNotClass().format({type:this._evaluator.printType(e)}),t),o||V.UnknownType.create()}_reportUnusedDunderAllSymbols(e){if("none"===this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll)return;const t=T.getScope(this._moduleNode);t&&e.forEach((e=>{t.symbolTable.has(e.value)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,c.DiagnosticRule.reportUnsupportedDunderAll,g.Localizer.Diagnostic.dunderAllSymbolNotPresent().format({name:e.value}),e)}))}_validateSymbolTables(){var e;const t=null===(e=this._dependentFiles)||void 0===e?void 0:e.map((e=>T.getFileInfo(e.parseTree)));for(const e of this._scopedNodes){const n=T.getScope(e);n&&n.symbolTable.forEach(((e,a)=>{this._conditionallyReportUnusedSymbol(a,e,n.type,t),this._reportIncompatibleDeclarations(a,e),this._reportMultipleFinalDeclarations(a,e,n.type),this._reportMultipleTypeAliasDeclarations(a,e),this._reportInvalidOverload(a,e)}))}const n=this._fileInfo.accessedSymbolSet;for(const e of this._typeParameterLists)for(const t of e.parameters){const e=T.getTypeParameterSymbol(t.name);if((0,l.assert)(e),!n.has(e.id)){e.getDeclarations().forEach((e=>{this._conditionallyReportUnusedDeclaration(e,!1)}))}}}_reportInvalidOverload(e,t){const n=t.getTypedDeclarations();if(n.length>=1){const a=n[0];if(5===a.type){const n=this._evaluator.getEffectiveTypeOfSymbol(t),i=(0,V.isOverloadedFunction)(n)?V.OverloadedFunctionType.getOverloads(n):(0,V.isFunction)(n)&&V.FunctionType.isOverloaded(n)?[n]:[];if(1===i.length&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.singleOverload().format({name:e}),a.node.name),i.forEach((t=>{if(t.details.declaration&&!C.isFunctionSuiteEmpty(t.details.declaration.node)){const n=new p.DiagnosticAddendum;n.addMessage(g.Localizer.DiagnosticAddendum.overloadWithImplementation()),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.overloadWithImplementation().format({name:e})+n.getString(),t.details.declaration.node.name)}})),!this._fileInfo.isStubFile&&i.length>0){let t;if((0,V.isOverloadedFunction)(n)&&V.OverloadedFunctionType.getImplementation(n)?t=V.OverloadedFunctionType.getImplementation(n):(0,V.isFunction)(n)&&!V.FunctionType.isOverloaded(n)&&(t=n),t)(0,V.isOverloadedFunction)(n)&&V.OverloadedFunctionType.getOverloads(n).forEach(((n,i)=>{var r,s,o,l;const d=new p.DiagnosticAddendum;if(!this._isLegalOverloadImplementation(n,t,d)&&t.details.declaration){const p=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.overloadImplementationMismatch().format({name:e,index:i+1})+d.getString(),t.details.declaration.node.name);p&&n.details.declaration&&p.addRelatedInfo(g.Localizer.DiagnosticAddendum.overloadSignature(),null!==(s=null===(r=n.details.declaration)||void 0===r?void 0:r.path)&&void 0!==s?s:a.path,null!==(l=null===(o=n.details.declaration)||void 0===o?void 0:o.range)&&void 0!==l?l:a.range)}}));else{let e=!1;const t=C.getEnclosingClassOrFunction(a.node);if(t&&10===t.nodeType){const n=this._evaluator.getTypeOfClass(t);n&&V.ClassType.isProtocolClass(n.classType)&&(e=!0)}e||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.overloadWithoutImplementation().format({name:a.node.name.value}),a.node.name)}}}}}_reportMultipleFinalDeclarations(e,t,n){if(!this._evaluator.isFinalVariable(t))return;const a=t.getDeclarations();let i=!1,r=!1;if(a.forEach((t=>{this._evaluator.isFinalVariableDeclaration(t)&&(i&&this._evaluator.addError(g.Localizer.Diagnostic.finalRedeclaration().format({name:e}),t.node),i=!0),1===t.type&&t.inferredTypeSource&&(r&&2!==n&&this._evaluator.addError(g.Localizer.Diagnostic.finalReassigned().format({name:e}),t.node),r=!0)})),!r&&!this._fileInfo.isStubFile){const n=a.find((e=>1===e.type&&e.isFinal));if(n){let a=!1;if(t.isClassMember()&&!t.isClassVar()){const e=C.getEnclosingClass(n.node,!0);if(e){const t=this._evaluator.getTypeOfClass(e);t&&(0,V.isClass)(t.decoratedType)&&V.ClassType.isDataClass(t.decoratedType)&&(a=!0)}}a||this._evaluator.addError(g.Localizer.Diagnostic.finalUnassigned().format({name:e}),n.node)}}}_reportMultipleTypeAliasDeclarations(e,t){const n=t.getDeclarations(),a=n.find((e=>this._evaluator.isExplicitTypeAliasDeclaration(e)));a&&n.length>1&&n.forEach((t=>{t!==a&&this._evaluator.addError(g.Localizer.Diagnostic.typeAliasRedeclared().format({name:e}),t.node)}))}_reportIncompatibleDeclarations(e,t){var n,a,i,r;const s=(0,F.getLastTypedDeclaredForSymbol)(t);if(!s)return;if("_"===e)return;let o,l=t.getDeclarations().filter((e=>e!==s));if(5===s.type){const e=this._evaluator.getTypeOfFunction(s.node);l=l.filter((t=>{if(5!==t.type)return!0;const n=this._evaluator.getTypeOfFunction(t.node);if(!n)return!0;const a=e?this._evaluator.makeTopLevelTypeVarsConcrete(e.decoratedType):void 0;return a&&(0,V.isClassInstance)(a)&&V.ClassType.isPropertyClass(a)&&(0,V.isClassInstance)(n.decoratedType)&&V.ClassType.isPropertyClass(n.decoratedType)?n.decoratedType.details.typeSourceId!==a.details.typeSourceId:!V.FunctionType.isOverloaded(n.functionType)}))}if(0===l.length)return;o=5===s.type?s.isMethod?g.Localizer.DiagnosticAddendum.seeMethodDeclaration():g.Localizer.DiagnosticAddendum.seeFunctionDeclaration():6===s.type?g.Localizer.DiagnosticAddendum.seeClassDeclaration():2===s.type?g.Localizer.DiagnosticAddendum.seeParameterDeclaration():1===s.type?g.Localizer.DiagnosticAddendum.seeVariableDeclaration():4===s.type?g.Localizer.DiagnosticAddendum.seeTypeAliasDeclaration():g.Localizer.DiagnosticAddendum.seeDeclaration();const p=e=>{if(e){let t;5===s.type||6===s.type?t=s.node.name:1===s.type?38===s.node.nodeType&&(t=s.node):2!==s.type&&3!==s.type||s.node.name&&(t=s.node.name),t&&e.addRelatedInfo(o,s.path,s.range)}};for(const t of l)if(6===t.type){let n=!1;if(3===s.type&&(n=!0),!n){p(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.obscuredClassDeclaration().format({name:e}),t.node.name))}}else if(5===t.type){const i=null===(n=this._evaluator.getTypeForDeclaration(s))||void 0===n?void 0:n.type;let r=!1;i&&(0,V.isFunction)(i)&&this._evaluator.getFunctionInferredReturnType(i);const o=null===(a=this._evaluator.getTypeForDeclaration(t))||void 0===a?void 0:a.type,l=C.getEnclosingSuite(s.node)===C.getEnclosingSuite(t.node);if(o&&(0,V.isFunction)(o)&&this._evaluator.getFunctionInferredReturnType(o),!l&&i&&o&&(0,V.isTypeSame)(i,o)&&(r=!0),3===s.type&&(r=!0),!r){p(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,t.isMethod?g.Localizer.Diagnostic.obscuredMethodDeclaration().format({name:e}):g.Localizer.Diagnostic.obscuredFunctionDeclaration().format({name:e}),t.node.name))}}else if(2===t.type){if(t.node.name){let n=!1;if(3===s.type&&(n=!0),!n){const n=g.Localizer.Diagnostic.obscuredParameterDeclaration();p(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,n.format({name:e}),t.node.name))}}}else if(1===t.type){const n=null===(i=this._evaluator.getTypeForDeclaration(s))||void 0===i?void 0:i.type;if(t.typeAnnotationNode&&38===t.node.nodeType){let a=!1;const i=null===(r=this._evaluator.getTypeForDeclaration(t))||void 0===r?void 0:r.type;if(n&&i&&(0,V.isTypeSame)(n,i)&&(a=!0),3===s.type&&(a=!0),!a){p(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.obscuredVariableDeclaration().format({name:e}),t.node))}}}else if(4===t.type){p(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.obscuredTypeAliasDeclaration().format({name:e}),t.node.name))}}_conditionallyReportUnusedSymbol(e,t,n,a){const i=this._fileInfo.accessedSymbolSet;if(t.isIgnoredForProtocolMatch()||i.has(t.id))return;if(a&&a.some((e=>e.accessedSymbolSet.has(t.id))))return;if("_"===e)return;if(N.isDunderName(e))return;t.getDeclarations().forEach((t=>{this._conditionallyReportUnusedDeclaration(t,this._isSymbolPrivate(e,n))}))}_conditionallyReportUnusedDeclaration(e,t){var n;let a,i,r,s;switch(e.type){case 8:if(a=this._fileInfo.diagnosticRuleSet.reportUnusedImport,s=c.DiagnosticRule.reportUnusedImport,21===e.node.nodeType)if(e.node.alias)e.node.alias.value!==e.moduleName&&(i=e.node.alias);else{const t=e.node.module.nameParts;if(t.length>0){const e=t.map((e=>e.value)).join(".");let n={start:t[0].start,length:t[0].length};return n=m.TextRange.extend(n,t[t.length-1]),this._fileInfo.diagnosticSink.addUnusedCodeWithTextRange(g.Localizer.Diagnostic.unaccessedSymbol().format({name:e}),n,{action:"pyright.unusedImport"}),void this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportUnusedImport,c.DiagnosticRule.reportUnusedImport,g.Localizer.Diagnostic.unaccessedImport().format({name:e}),n)}}else if(23===e.node.nodeType){const t=e.node.parent,a=(null===(n=e.node.alias)||void 0===n?void 0:n.value)===e.node.name.value,r=1===t.module.nameParts.length&&"__future__"===t.module.nameParts[0].value;a||r||(i=e.node.alias||e.node.name)}i&&(r=g.Localizer.Diagnostic.unaccessedImport().format({name:i.value}));break;case 4:case 1:case 2:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedVariable,38===e.node.nodeType?(i=e.node,i.value.startsWith("_")&&(a="none")):41===e.node.nodeType&&(i=e.node.name,a="none"),i&&(s=c.DiagnosticRule.reportUnusedVariable,r=g.Localizer.Diagnostic.unaccessedVariable().format({name:i.value}));break;case 6:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedClass,i=e.node.name,s=c.DiagnosticRule.reportUnusedClass,r=g.Localizer.Diagnostic.unaccessedClass().format({name:i.value});break;case 5:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedFunction,i=e.node.name,s=c.DiagnosticRule.reportUnusedFunction,r=g.Localizer.Diagnostic.unaccessedFunction().format({name:i.value});break;case 3:a="none",i=e.node.name;break;case 0:case 7:return;default:(0,l.assertNever)(e)}const o=s===c.DiagnosticRule.reportUnusedImport?{action:"pyright.unusedImport"}:void 0;i&&(this._fileInfo.diagnosticSink.addUnusedCodeWithTextRange(g.Localizer.Diagnostic.unaccessedSymbol().format({name:i.value}),i,o),void 0!==s&&r&&this._evaluator.addDiagnostic(a,s,r,i))}_validateIsInstanceCall(e){if(38!==e.leftExpression.nodeType||"isinstance"!==e.leftExpression.value&&"issubclass"!==e.leftExpression.value||2!==e.arguments.length)return;const t=e.leftExpression.value,n="isinstance"===t;let a=this._evaluator.getType(e.arguments[0].valueExpression);if(!a)return;a=(0,M.mapSubtypes)(a,(e=>(0,M.transformPossibleRecursiveTypeAlias)(e)));const i=this._evaluator.getType(e.arguments[1].valueExpression);if(!i)return;let r=!0;if((0,M.doForEachSubtype)(i,(e=>{(0,V.isClassInstance)(e)&&V.ClassType.isTupleClass(e)&&e.tupleTypeArguments?e.tupleTypeArguments.some((e=>!this._isTypeSupportedTypeForIsInstance(e.type,n)))&&(r=!1):this._isTypeSupportedTypeForIsInstance(e,n)||(r=!1)})),!r){const t=new p.DiagnosticAddendum;t.addMessage(g.Localizer.DiagnosticAddendum.typeVarNotAllowed()),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,n?g.Localizer.Diagnostic.isInstanceInvalidType().format({type:this._evaluator.printType(i)})+t.getString():g.Localizer.Diagnostic.isSubclassInvalidType().format({type:this._evaluator.printType(i)})+t.getString(),e.arguments[1])}let s=e;for(;s;){if(2===s.nodeType)return;s=s.parent}const o=["FunctionType","LambdaType","BuiltinFunctionType","BuiltinMethodType","type","Type"],l=[];let d=!1;if((0,M.doForEachSubtype)(i,(e=>{(0,V.isClass)(e)?V.TypeBase.isInstantiable(e)?void 0===e.literalValue&&(l.push(e),V.ClassType.isBuiltIn(e)&&o.some((t=>t===e.details.name))&&(r=!1),e.includeSubclasses&&(d=!0)):((0,M.isTupleClass)(e)?e.tupleTypeArguments&&e.tupleTypeArguments.forEach((e=>{(0,V.isInstantiableClass)(e.type)?(l.push(e.type),e.type.includeSubclasses&&(d=!0)):r=!1})):e.includeSubclasses&&(d=!0),V.ClassType.isBuiltIn(e)&&o.some((t=>t===e.details.name))&&(r=!1)):r=!1})),!r)return;if(l.some((e=>V.ClassType.isProtocolClass(e)&&!V.ClassType.isRuntimeCheckable(e)))&&this._evaluator.addError(g.Localizer.Diagnostic.protocolUsedInCall().format({name:t}),e.arguments[1].valueExpression),(0,M.derivesFromAnyOrUnknown)(a))return;const u=e=>(0,V.combineTypes)(e),m=e=>{const t=[];for(const a of l){const i=(0,z.isIsinstanceFilterSuperclass)(this._evaluator,e,a,a,n),r=(0,z.isIsinstanceFilterSubclass)(this._evaluator,e,a,a,n);r&&r&&!V.ClassType.isSameGenericClass(e,a)?t.push(V.UnknownType.create()):i?t.push(e):r&&t.push(a)}return n?t.map((e=>(0,V.isInstantiableClass)(e)?V.ClassType.cloneAsInstance(e):e)):t};let y;if(n&&(0,V.isClassInstance)(a)){y=u(m(V.ClassType.cloneAsInstantiable(a)))}else if(!n&&(0,V.isInstantiableClass)(a)){y=u(m(a))}else{if(!(0,V.isUnion)(a))return;{let e=[],t=!1;if((0,M.doForEachSubtype)(a,(a=>{(0,V.isAnyOrUnknown)(a)&&(t=!0),n&&(0,V.isClassInstance)(a)?e=e.concat(m(V.ClassType.cloneAsInstantiable(a))):!n&&(0,V.isInstantiableClass)(a)&&(e=e.concat(m(a)))})),y=u(e),t)return}}const h=()=>{const e=l.map((e=>V.ClassType.cloneAsInstance(e)));return(0,V.combineTypes)(e)};!d&&(0,V.isTypeSame)(y,a,{ignorePseudoGeneric:!0})&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnnecessaryIsInstance,c.DiagnosticRule.reportUnnecessaryIsInstance,n?g.Localizer.Diagnostic.unnecessaryIsInstanceAlways().format({testType:this._evaluator.printType(a),classType:this._evaluator.printType(h())}):g.Localizer.Diagnostic.unnecessaryIsSubclassAlways().format({testType:this._evaluator.printType(a),classType:this._evaluator.printType(h())}),e)}_isTypeSupportedTypeForIsInstance(e,t){let n=!0;return(0,M.doForEachSubtype)(e,(e=>{switch(e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(e=(0,M.transformPossibleRecursiveTypeAlias)(e)).category){case 2:case 1:case 0:break;case 7:e.isTypeArgumentExplicit&&!e.includeSubclasses&&(n=!1);break;case 3:n=!!t&&V.TypeBase.isInstantiable(e);break;case 5:n=V.TypeBase.isInstantiable(e);break;case 9:n=this._isTypeSupportedTypeForIsInstance(e,t);break;default:n=!1}})),n}_isSymbolPrivate(e,t){if(1===t||0===t)return!0;if(N.isPrivateName(e))return!0;if(N.isProtectedName(e)){return!(2===t)}return!1}_reportDeprecatedUse(e,t){if(!t)return;let n,a;function i(t,i){const r=C.getCallForName(e);if(r){const s=t.getTypeResult(r);s&&s.overloadsUsedForCall&&s.overloadsUsedForCall.length>0&&s.overloadsUsedForCall.forEach((t=>{void 0!==t.details.deprecatedMessage&&(e.value===t.details.name?(a=t.details.deprecatedMessage,n=g.Localizer.Diagnostic.deprecatedFunction().format({name:t.details.name})):(0,V.isInstantiableClass)(i)&&"__init__"===t.details.name&&(a=t.details.deprecatedMessage,n=g.Localizer.Diagnostic.deprecatedConstructor().format({name:i.details.name})))}))}}if((0,M.doForEachSubtype)(t,(t=>{(0,V.isClass)(t)?t.includeSubclasses||void 0===t.details.deprecatedMessage||e.value!==t.details.name?i(this._evaluator,t):(a=t.details.deprecatedMessage,n=g.Localizer.Diagnostic.deprecatedClass().format({name:t.details.name})):(0,V.isFunction)(t)?void 0!==t.details.deprecatedMessage&&e.value===t.details.name&&(a=t.details.deprecatedMessage,n=g.Localizer.Diagnostic.deprecatedFunction().format({name:t.details.name||"<anonymous>"})):(0,V.isOverloadedFunction)(t)&&i(this._evaluator,t)})),n){const t=new p.DiagnosticAddendum;a&&t.addMessage(a),"none"===this._fileInfo.diagnosticRuleSet.reportDeprecated?this._evaluator.addDeprecated(n+t.getString(),e):this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportDeprecated,c.DiagnosticRule.reportDeprecated,n+t.getString(),e)}}_reportUnboundName(e){if("none"!==this._fileInfo.diagnosticRuleSet.reportUnboundVariable&&!T.isCodeUnreachable(e)){const t=this._evaluator.getType(e);t&&((0,V.isUnbound)(t)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnboundVariable,c.DiagnosticRule.reportUnboundVariable,g.Localizer.Diagnostic.symbolIsUnbound().format({name:e.value}),e):(0,V.isPossiblyUnbound)(t)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnboundVariable,c.DiagnosticRule.reportUnboundVariable,g.Localizer.Diagnostic.symbolIsPossiblyUnbound().format({name:e.value}),e))}}_conditionallyReportShadowedModule(){if("none"===this._fileInfo.diagnosticRuleSet.reportShadowedImports)return;const e=this._fileInfo.moduleName,t={nameParts:e.split("."),leadingDots:0,importedSymbols:new Set};if(this._importResolver.getTypeshedStdLibPath(this._fileInfo.executionEnvironment)&&this._importResolver.isStdlibModule(t,this._fileInfo.executionEnvironment)&&this._sourceMapper.isUserCode(this._fileInfo.filePath)){const t=this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportShadowedImports,c.DiagnosticRule.reportShadowedImports,g.Localizer.Diagnostic.stdlibModuleOverridden().format({name:e,path:this._fileInfo.filePath}),this._moduleNode);if(t){const e={action:"renameShadowedFile",oldFile:this._fileInfo.filePath,newFile:this._sourceMapper.getNextFileName(this._fileInfo.filePath)};t.addAction(e)}}}_conditionallyReportShadowedImport(e){var t,n;if("none"===this._fileInfo.diagnosticRuleSet.reportShadowedImports)return;const a=23===e.nodeType?22===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)?null===(n=e.parent)||void 0===n?void 0:n.module:void 0:e.module;if(null==a?void 0:a.leadingDots)return;const i=21===e.nodeType?e.module.nameParts:23===e.nodeType?[e.name]:e.module.nameParts,r=i.map((e=>e.value)),o={nameParts:r,leadingDots:0,importedSymbols:new Set},l=this._importResolver.getTypeshedStdLibPath(this._fileInfo.executionEnvironment);if(l&&this._importResolver.isStdlibModule(o,this._fileInfo.executionEnvironment)){const t=y.DefinitionProvider.getDefinitionsForNode(this._sourceMapper,this._evaluator,i[i.length-1],i[i.length-1].start,s.CancellationToken.None);(t?t.map((e=>e.path)):[]).forEach((t=>{if(!t.startsWith(l)&&!(0,P.isStubFile)(t)&&this._sourceMapper.isUserCode(t)){const n=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportShadowedImports,c.DiagnosticRule.reportShadowedImports,g.Localizer.Diagnostic.stdlibModuleOverridden().format({name:r.join("."),path:t}),e);if(n){const e={action:"renameShadowedFile",oldFile:t,newFile:this._sourceMapper.getNextFileName(t)};n.addAction(e)}}}))}}_conditionallyReportPrivateUsage(e){var t;if("none"===this._fileInfo.diagnosticRuleSet.reportPrivateUsage)return;if(this._fileInfo.isStubFile)return;if(1===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.name===e)return;const n=e.value,a=N.isPrivateName(n),i=N.isProtectedName(n);if(!a&&!i)return;const r=this._evaluator.getDeclarationsForNameNode(e);let s,o=r&&r.length>0?r[r.length-1]:void 0;if(!o||o.node===e)return;if(8===o.type){if(o.usesLocalName)return;const e=this._evaluator.resolveAliasDeclarationWithInfo(o,!0);if(!e)return;if(o=e.declaration,!e.isPrivate)return}if(!o||o.node===e)return;o.node&&(s=C.getEnclosingClass(o.node)),o.node&&o.node.parent&&o.node.parent===s&&(s=C.getEnclosingClass(s));let l=!1;if(s&&i){const t=this._evaluator.getTypeOfClass(s);if(t&&(0,V.isInstantiableClass)(t.decoratedType)){if(V.ClassType.isDefinedInStub(t.decoratedType))return;l=!0;const n=C.getEnclosingClass(e);if(n){const e=this._evaluator.getTypeOfClass(n);if(e&&(0,V.isInstantiableClass)(e.decoratedType)&&(0,M.derivesFromClassRecursive)(e.decoratedType,t.decoratedType,!0))return}}}s&&!C.isNodeContainedWithin(e,s)&&(l?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportPrivateUsage,c.DiagnosticRule.reportPrivateUsage,g.Localizer.Diagnostic.protectedUsedOutsideOfClass().format({name:n}),e):this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportPrivateUsage,c.DiagnosticRule.reportPrivateUsage,g.Localizer.Diagnostic.privateUsedOutsideOfClass().format({name:n}),e))}_validateEnumClassOverride(e,t){t.details.baseClasses.forEach(((t,n)=>{if((0,V.isClass)(t)&&V.ClassType.isEnumClass(t)){let a=!1;t.details.fields.forEach((e=>{const n=this._evaluator.getEffectiveTypeOfSymbol(e);(0,V.isClassInstance)(n)&&V.ClassType.isSameGenericClass(n,t)&&(a=!0)})),a&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.enumClassOverride().format({name:t.details.name}),e.arguments[n])}}))}_validateTypedDictClassSuite(e){const t=e=>{this._evaluator.addError(g.Localizer.Diagnostic.typedDictBadVar(),e)};e.statements.forEach((e=>{if(!T.isCodeUnreachable(e))if(47===e.nodeType)for(const n of e.statements)54!==n.nodeType&&18!==n.nodeType&&48!==n.nodeType&&42!==n.nodeType&&t(n);else t(e)}))}_validateTypeGuardFunction(e,t,n){const a=t.details.declaredReturnType;if(!a)return;if(!(0,V.isClassInstance)(a)||!a.typeArguments||a.typeArguments.length<1)return;if(!V.ClassType.isBuiltIn(a,"TypeGuard"))return;let i=t.details.parameters.length;n&&(V.FunctionType.isInstanceMethod(t)||V.FunctionType.isConstructorMethod(t)||V.FunctionType.isClassMethod(t))&&i--,i<1&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.typeGuardParamCount(),e.name)}_validateDunderSignatures(e,t,n){var a;const i=t.details.name;if(n&&"__init__"===i){const n=e.returnTypeAnnotation||(null===(a=e.functionAnnotationComment)||void 0===a?void 0:a.returnTypeAnnotation),i=t.details.declaredReturnType;if(n&&i)(0,V.isNoneInstance)(i)||(0,V.isNever)(i)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.initMustReturnNone(),n);else{const n=this._evaluator.getFunctionInferredReturnType(t);(0,V.isNever)(n)||(0,V.isNoneInstance)(n)||(0,V.isAnyOrUnknown)(n)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.initMustReturnNone(),e.name)}}}_validateFunctionReturn(e,t){var n;if(this._fileInfo.isStubFile)return;const a=e.returnTypeAnnotation||(null===(n=e.functionAnnotationComment)||void 0===n?void 0:n.returnTypeAnnotation);if(a){const n=!this._evaluator.isAfterNodeReachable(e),i=this._evaluator.isAfterNodeReachable(e.suite);let r=t.details.declaredReturnType;if(r&&(this._reportUnknownReturnResult(e,r),(0,V.isTypeVar)(r)&&4===r.details.declaredVariance&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.returnTypeContravariant(),a)),V.FunctionType.isGenerator(t)&&(r=(0,M.getDeclaredGeneratorReturnType)(t)),r&&!n&&i)if((0,V.isNever)(r))C.isSuiteEmpty(e.suite)||V.FunctionType.isOverloaded(t)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.noReturnReturnsNone(),a);else if(!V.FunctionType.isAbstractMethod(t)){const n=new p.DiagnosticAddendum;this._evaluator.assignType(r,V.NoneType.createInstance(),n)||C.isSuiteEmpty(e.suite)||V.FunctionType.isOverloaded(t)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.returnMissing().format({returnType:this._evaluator.printType(r)})+n.getString(),a)}}else{const n=this._evaluator.getFunctionInferredReturnType(t);this._reportUnknownReturnResult(e,n)}}_reportUnknownReturnResult(e,t){(0,V.isUnknown)(t)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownParameterType,c.DiagnosticRule.reportUnknownParameterType,g.Localizer.Diagnostic.returnTypeUnknown(),e.name):(0,M.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnknownParameterType,c.DiagnosticRule.reportUnknownParameterType,g.Localizer.Diagnostic.returnTypePartiallyUnknown().format({returnType:this._evaluator.printType(t,{expandTypeAlias:!0})}),e.name)}_validateFinalMemberOverrides(e){e.details.fields.forEach(((t,n)=>{const a=(0,M.lookUpClassMember)(e,n,1);if(a&&(0,V.isInstantiableClass)(a.classType)&&this._evaluator.isFinalVariable(a.symbol)&&!N.isPrivateName(n)){const e=t.getDeclarations()[0];this._evaluator.addError(g.Localizer.Diagnostic.finalRedeclarationBySubclass().format({name:n,className:a.classType.details.name}),e.node)}}))}_reportDuplicateEnumMembers(e){V.ClassType.isEnumClass(e)&&!V.ClassType.isBuiltIn(e)&&e.details.fields.forEach(((t,n)=>{if(t.getTypedDeclarations().length>0)return;const a=t.getDeclarations();if(a.length>=2&&1===a[0].type){const i=this._evaluator.getEffectiveTypeOfSymbol(t);(0,V.isClassInstance)(i)&&V.ClassType.isSameGenericClass(i,e)&&void 0!==i.literalValue&&this._evaluator.addError(g.Localizer.Diagnostic.duplicateEnumMember().format({name:n}),a[1].node)}}))}_validateProtocolCompatibility(e,t){if(V.ClassType.isProtocolClass(e))return;const n=new p.DiagnosticAddendum,a=t=>e.details.mro.some((e=>(0,V.isClass)(e)&&!V.ClassType.isProtocolClass(e)&&e.details.fields.has(t)));e.details.baseClasses.forEach((e=>{if(!(0,V.isClass)(e)||!V.ClassType.isProtocolClass(e))return;(0,M.getProtocolSymbols)(e).forEach(((e,t)=>{const i=e.symbol.getDeclarations();0!==i.length&&(0,V.isClass)(e.classType)&&(1===i[0].type?i.some((e=>1===e.type&&!!e.inferredTypeSource))||a(t)||n.addMessage(g.Localizer.DiagnosticAddendum.missingProtocolMember().format({name:t,classType:e.classType.details.name})):5===i[0].type&&i.every((e=>5!==e.type||C.isSuiteEmpty(e.node.suite)))&&".pyi"!==(0,d.getFileExtension)(i[0].path).toLowerCase()&&(a(t)||n.addMessage(g.Localizer.DiagnosticAddendum.missingProtocolMember().format({name:t,classType:e.classType.details.name}))))}))})),n.isEmpty()||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.missingProtocolMembers()+n.getString(),t.name)}_validateDataClassPostInit(e,t){if(!V.ClassType.isDataClass(e))return;const n=(0,M.lookUpClassMember)(e,"__post_init__",18);if(!n)return;if(V.ClassType.derivesFromAnyOrUnknown(e))return;const a=new Map;V.ClassType.getReverseMro(e).forEach((e=>{(0,V.isClass)(e)&&V.ClassType.isDataClass(e)&&e.details.fields.forEach(((e,t)=>{e.isInitVar()&&a.set(t,e)}))}));const i=this._evaluator.getTypeOfMember(n);if(!(0,V.isFunction)(i)||!V.FunctionType.isInstanceMethod(i)||!i.details.declaration)return;const r=(0,I.getParameterListDetails)(i);if(void 0!==r.argsIndex||void 0!==r.kwargsIndex||void 0!==r.firstKeywordOnlyIndex)return;const s=r.params.filter((e=>!e.param.hasDefault)),o=a.size+1;(o<s.length||o>r.params.length)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.dataClassPostInitParamCount().format({expected:a.size}),i.details.declaration.node.name);let l=1;a.forEach(((e,t)=>{var n;if(l>=r.params.length)return;const a=r.params[l].param;if(a.hasDeclaredType&&a.typeAnnotation){const s=null===(n=this._evaluator.getDeclaredTypeOfSymbol(e))||void 0===n?void 0:n.type,o=V.FunctionType.getEffectiveParameterType(i,r.params[l].index),d=new p.DiagnosticAddendum;if(s&&!this._evaluator.assignType(o,s,d)){const n=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.dataClassPostInitType().format({fieldName:t})+d.getString(),a.typeAnnotation);if(n){const t=e.getTypedDeclarations();t.length>0&&n.addRelatedInfo(g.Localizer.DiagnosticAddendum.dataClassFieldLocation(),t[0].path,t[0].range)}}}l++}))}_validateFinalClassNotAbstract(e,t){if(!V.ClassType.isFinal(e))return;if(!V.ClassType.supportsAbstractMethods(e))return;const n=this._evaluator.getAbstractMethods(e);if(0===n.length)return;const a=new p.DiagnosticAddendum;n.forEach(((e,t)=>{if(2===t)a.addMessage(g.Localizer.DiagnosticAddendum.memberIsAbstractMore().format({count:n.length-2}));else if(t<2&&(0,V.isInstantiableClass)(e.classType)){const t=e.classType.details.name;a.addMessage(g.Localizer.DiagnosticAddendum.memberIsAbstract().format({type:t,name:e.symbolName}))}})),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.finalClassIsAbstract().format({type:e.details.name})+a.getString(),t.name)}_validateInstanceVariableInitialization(e,t){if(this._fileInfo.isStubFile)return;if("none"===this._fileInfo.diagnosticRuleSet.reportUninitializedInstanceVariable)return;if(V.ClassType.isProtocolClass(t)||V.ClassType.supportsAbstractMethods(t)&&!V.ClassType.isFinal(t))return;const n=new Map;V.ClassType.isFinal(t)&&(0,M.getProtocolSymbolsRecursive)(t,n,1024),t.details.fields.forEach(((e,a)=>{if(n.delete(a),!e.isInstanceMember())return;const i=e.getDeclarations();if(i.find((e=>{var n,a,i;const r=C.getEnclosingClassOrFunction(e.node);if(!r)return!0;if(10===r.nodeType){if(3===(null===(n=e.node.parent)||void 0===n?void 0:n.nodeType))return!0;if(54===(null===(a=e.node.parent)||void 0===a?void 0:a.nodeType)&&3===(null===(i=e.node.parent.parent)||void 0===i?void 0:i.nodeType))return!0;if(V.ClassType.isDataClass(t))return!0;if(V.ClassType.isTypedDictClass(t))return!0}return"__init__"===r.name.value})))return;(0,M.lookUpClassMember)(t,a,1)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUninitializedInstanceVariable,c.DiagnosticRule.reportUninitializedInstanceVariable,g.Localizer.Diagnostic.uninitializedInstanceVariable().format({name:a}),i[0].node)}));const a=new p.DiagnosticAddendum;n.forEach(((e,t)=>{const n=e.symbol.getDeclarations();0!==n.length&&(0,V.isClass)(e.classType)&&1===n[0].type&&(n.some((e=>1===e.type&&!!e.inferredTypeSource))||a.addMessage(g.Localizer.DiagnosticAddendum.uninitializedAbstractVariable().format({name:t,classType:e.classType.details.name})))})),a.isEmpty()||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUninitializedInstanceVariable,c.DiagnosticRule.reportUninitializedInstanceVariable,g.Localizer.Diagnostic.uninitializedAbstractVariables().format({classType:t.details.name})+a.getString(),e.name)}_validateProtocolTypeParamVariance(e,t){if(0===t.details.typeParameters.length)return;const n=this._evaluator.getBuiltInType(e,"object");if(!(0,V.isInstantiableClass)(n))return;const a=t.details.typeParameters.map((e=>V.TypeVarType.cloneAsInvariant(e))),i=V.ClassType.cloneWithNewTypeParameters(t,a),r=V.ClassType.cloneAsInstance(n),s=V.ClassType.createInstantiable("__varianceDummy","","","",0,0,void 0,void 0);a.forEach(((n,o)=>{if(n.details.isVariadic||n.details.isParamSpec)return;if(0===n.details.declaredVariance)return;const l=a.map(((e,t)=>e.details.isVariadic?e:t===o?r:s)),p=a.map(((e,t)=>t===o||e.details.isVariadic?e:s)),d=V.ClassType.cloneForSpecialization(i,l,!0),u=V.ClassType.cloneForSpecialization(i,p,!0);let m;if(this._evaluator.assignClassToSelf(d,u))m=3;else{m=this._evaluator.assignClassToSelf(u,d)?4:2}if(m!==t.details.typeParameters[o].details.declaredVariance){let a;a=3===m?g.Localizer.Diagnostic.protocolVarianceCovariant().format({variable:n.details.name,class:t.details.name}):4===m?g.Localizer.Diagnostic.protocolVarianceContravariant().format({variable:n.details.name,class:t.details.name}):g.Localizer.Diagnostic.protocolVarianceInvariant().format({variable:n.details.name,class:t.details.name}),this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse,c.DiagnosticRule.reportInvalidTypeVarUse,a,e.name)}}))}_validateSlotsClassVarConflict(e){e.details.localSlotsNames&&(V.ClassType.isDataClass(e)||e.details.fields.forEach(((e,t)=>{const n=e.getDeclarations();n.some((e=>1===e.type&&e.isDefinedBySlots))&&n.forEach((e=>{1!==e.type||e.isDefinedBySlots||e.isDefinedByMemberAccess||38===e.node.nodeType&&C.isWriteAccess(e.node)&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.slotsClassVarConflict().format({name:t}),e.node)}))})))}_validateConstructorConsistency(e){const t=(0,M.lookUpClassMember)(e,"__init__",12),n=(0,M.lookUpClassMember)(e,"__new__",12);if(!(t&&n&&(0,V.isClass)(t.classType)&&(0,V.isClass)(n.classType)))return;if(!V.ClassType.isSameGenericClass(n.classType,e)&&!V.ClassType.isSameGenericClass(t.classType,e))return;const a=n.classType.details.effectiveMetaclass;if(a&&(0,V.isClass)(a)&&!V.ClassType.isBuiltIn(a,"type")){if((0,M.lookUpClassMember)(a,"__call__",40))return}let i=this._evaluator.getTypeOfMember(n);if(!(0,V.isFunction)(i)&&!(0,V.isOverloadedFunction)(i))return;if(i=this._evaluator.bindFunctionToClassOrObject(e,i,void 0,void 0,void 0,!0),!i)return;if((0,V.isOverloadedFunction)(i)&&(i=V.OverloadedFunctionType.getImplementation(i),!i))return;let r=this._evaluator.getTypeOfMember(t);if(((0,V.isFunction)(r)||(0,V.isOverloadedFunction)(r))&&(r=this._evaluator.bindFunctionToClassOrObject(V.ClassType.cloneAsInstance(e),r),r&&(!(0,V.isOverloadedFunction)(r)||(r=V.OverloadedFunctionType.getImplementation(r),r))&&(0,V.isFunction)(r)&&(0,V.isFunction)(i)&&!(V.FunctionType.hasDefaultParameters(r)||V.FunctionType.hasDefaultParameters(i)||(r=V.FunctionType.cloneWithNewFlags(r,98304|r.details.flags),i=V.FunctionType.cloneWithNewFlags(i,98304|r.details.flags),this._evaluator.assignType(i,r,void 0,void 0,void 0,32)&&this._evaluator.assignType(r,i,void 0,void 0,void 0,32))))){const a=V.ClassType.isSameGenericClass(t.classType,e),s=(0,F.getLastTypedDeclaredForSymbol)(t.symbol),o=(0,F.getLastTypedDeclaredForSymbol)(n.symbol);if(s&&o){const e=a?s:o,l=28===e.node.nodeType?e.node.name:e.node,d=new p.DiagnosticAddendum,u=this._evaluator.printType(r),m=this._evaluator.printType(i);d.addMessage(g.Localizer.DiagnosticAddendum.initMethodSignature().format({type:u})),d.addMessage(g.Localizer.DiagnosticAddendum.newMethodSignature().format({type:m}));const y=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInconsistentConstructor,c.DiagnosticRule.reportInconsistentConstructor,g.Localizer.Diagnostic.constructorParametersMismatch().format({classType:this._evaluator.printType(V.ClassType.cloneAsInstance(a?t.classType:n.classType))})+d.getString(),l);if(y){const e=a?o:s;y.addRelatedInfo((a?g.Localizer.DiagnosticAddendum.newMethodLocation():g.Localizer.DiagnosticAddendum.initMethodLocation()).format({type:this._evaluator.printType(V.ClassType.cloneAsInstance(a?n.classType:t.classType))}),e.path,e.range)}}}}_validateMultipleInheritanceCompatibility(e,t){if("none"===this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride&&"none"===this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride)return;const n=[];if(e.details.baseClasses.forEach((e=>{!(0,V.isClass)(e)||V.ClassType.isBuiltIn(e,"Generic")||V.ClassType.isBuiltIn(e,"Protocol")||n.push(e)})),n.length<2)return;const a=n.map((t=>{const n=e.details.mro.find((e=>(0,V.isClass)(e)&&V.ClassType.isSameGenericClass(e,t)));return n&&(0,V.isClass)(n)?(0,M.getClassFieldsRecursive)(n):new Map})),i=(0,M.getClassFieldsRecursive)(e,!0);for(let n=1;n<a.length;n++){const r=a[n];for(const[n,a]of r){if(N.isDunderName(n)||N.isPrivateName(n))continue;const r=a.classType;if(!(0,V.isClass)(r))continue;const s=i.get(n);if(s){const i=s.classType;if(!(0,V.isClass)(i)||V.ClassType.isSameGenericClass(i,r)||V.ClassType.isSameGenericClass(i,e))continue;this._validateMultipleInheritanceOverride(a,s,e,n,t)}}}}_validateMultipleInheritanceOverride(e,t,n,a,i){if(!(0,V.isClass)(e.classType)||!(0,V.isClass)(t.classType))return;if("_"===a)return;let r=this._evaluator.getEffectiveTypeOfSymbol(e.symbol);r=(0,M.partiallySpecializeType)(r,e.classType);const s=t.symbol;let o=this._evaluator.getEffectiveTypeOfSymbol(s);o=(0,M.partiallySpecializeType)(o,t.classType);const l=n.details.fields.get(a),d=l?this._evaluator.getEffectiveTypeOfSymbol(l):void 0;let u;const m=(0,F.getLastTypedDeclaredForSymbol)(t.symbol),y=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);if((0,V.isFunction)(r)||(0,V.isOverloadedFunction)(r)){const e=new p.DiagnosticAddendum;let t;if((0,V.isFunction)(o))t=o;else if((0,V.isOverloadedFunction)(o)&&(t=V.OverloadedFunctionType.getImplementation(o),!t))return;if(t&&!this._evaluator.validateOverrideMethod(r,t,void 0,e,!0)){const r=t.details.declaration;r&&5===r.type&&(u=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.baseClassMethodTypeIncompatible().format({classType:n.details.name,name:a})+e.getString(),i))}}else if((0,M.isProperty)(r)){if(!(0,M.isProperty)(o)&&!(0,V.isAnyOrUnknown)(o)){s.getDeclarations().length>0&&(u=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride,c.DiagnosticRule.reportIncompatibleVariableOverride,g.Localizer.Diagnostic.baseClassVariableTypeIncompatible().format({classType:n.details.name,name:a}),i))}}else"none"!==this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride&&((0,V.isAnyOrUnknown)(r)||(0,V.isAnyOrUnknown)(o)||this._evaluator.assignType(r,null!=d?d:o)||(u=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride,c.DiagnosticRule.reportIncompatibleVariableOverride,g.Localizer.Diagnostic.baseClassVariableTypeIncompatible().format({classType:n.details.name,name:a}),i)));u&&m&&y&&(u.addRelatedInfo(g.Localizer.DiagnosticAddendum.baseClassOverriddenType().format({baseClass:this._evaluator.printType((0,M.convertToInstance)(e.classType)),type:this._evaluator.printType(r)}),y.path,y.range),u.addRelatedInfo(g.Localizer.DiagnosticAddendum.baseClassOverridesType().format({baseClass:this._evaluator.printType((0,M.convertToInstance)(t.classType)),type:this._evaluator.printType(o)}),m.path,m.range))}_validateBaseClassOverrides(e){e.details.fields.forEach(((t,n)=>{if(N.isPrivateName(n))return;if(!t.hasTypedDeclarations()&&!this._evaluator.isFinalVariable(t))return;const a=this._evaluator.getEffectiveTypeOfSymbol(t);if((0,V.isAnyOrUnknown)(a))return;let i;for(const r of e.details.baseClasses){if(!(0,V.isClass)(r))continue;const s=e.details.mro.find((e=>(0,V.isClass)(e)&&V.ClassType.isSameGenericClass(e,r)));if(!s)continue;(0,l.assert)((0,V.isClass)(s));const o=(0,M.lookUpClassMember)(s,n,0);o&&(i=null!=i?i:o,this._validateBaseClassOverride(o,t,a,e,n))}i?this._validateOverrideDecoratorPresent(t,a,i):this._validateOverrideDecoratorNotPresent(t,a)}))}_validateOverrideDecoratorPresent(e,t,n){var a;if("none"===this._fileInfo.diagnosticRuleSet.reportImplicitOverride)return;let i;if((0,V.isFunction)(t))i=t;else if((0,V.isOverloadedFunction)(t))i=V.OverloadedFunctionType.getImplementation(t);else if((0,V.isClassInstance)(t)&&V.ClassType.isPropertyClass(t)){const e=t.details.fields.get("fget");if(e){const t=null===(a=this._evaluator.getDeclaredTypeOfSymbol(e))||void 0===a?void 0:a.type;t&&(0,V.isFunction)(t)&&(i=t)}}if(!(null==i?void 0:i.details.declaration)||V.FunctionType.isOverridden(i))return;if("__init__"===i.details.name||"__new__"===i.details.name)return;if(!e.getDeclarations().some((e=>e===i.details.declaration)))return;const r=i.details.declaration.node;this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportImplicitOverride,c.DiagnosticRule.reportImplicitOverride,g.Localizer.Diagnostic.overrideDecoratorMissing().format({name:r.name.value,className:this._evaluator.printType((0,M.convertToInstance)(n.classType))}),r.name)}_validateOverrideDecoratorNotPresent(e,t){var n;let a;if((0,V.isFunction)(t))a=t;else if((0,V.isOverloadedFunction)(t))a=V.OverloadedFunctionType.getImplementation(t);else if((0,V.isClassInstance)(t)&&V.ClassType.isPropertyClass(t)){const e=t.details.fields.get("fget");if(e){const t=null===(n=this._evaluator.getDeclaredTypeOfSymbol(e))||void 0===n?void 0:n.type;t&&(0,V.isFunction)(t)&&(a=t)}}if(!(null==a?void 0:a.details.declaration)||!V.FunctionType.isOverridden(a))return;if(!e.getDeclarations().some((e=>e===a.details.declaration)))return;const i=a.details.declaration.node;this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.overriddenMethodNotFound().format({name:i.name.value}),i.name)}_validateBaseClassOverride(e,t,n,a,i){if(!(0,V.isInstantiableClass)(e.classType))return;if(e.symbol.isIgnoredForOverrideChecks())return;if(!e.symbol.hasTypedDeclarations())return;if("_"===i)return;const r=(0,M.partiallySpecializeType)(this._evaluator.getEffectiveTypeOfSymbol(e.symbol),e.classType);if((0,V.isFunction)(r)||(0,V.isOverloadedFunction)(r)){const s=new p.DiagnosticAddendum;if((0,V.isFunction)(n)||(0,V.isOverloadedFunction)(n)){const o=["__init__","__new__","__init_subclass__"],l=!N.isDunderName(i);if(!o.some((e=>e===i))&&!N.isPrivateName(i)&&!this._evaluator.validateOverrideMethod(r,n,a,s,l)){const a=(0,V.isFunction)(n)&&n.details.declaration?n.details.declaration:(0,F.getLastTypedDeclaredForSymbol)(t);if(a){const t=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.incompatibleMethodOverride().format({name:i,className:e.classType.details.name})+s.getString(),5===a.type?a.node.name:a.node),n=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);t&&n&&t.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenMethod(),n.path,n.range)}}if((0,V.isFunction)(r)&&!N.isPrivateName(i)&&V.FunctionType.isFinal(r)){const n=(0,F.getLastTypedDeclaredForSymbol)(t);if(n&&5===n.type){const t=this._evaluator.addError(g.Localizer.Diagnostic.finalMethodOverride().format({name:i,className:e.classType.details.name}),n.node.name),a=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);t&&a&&t.addRelatedInfo(g.Localizer.DiagnosticAddendum.finalMethod(),a.path,a.range)}}}else if(!(0,V.isAnyOrUnknown)(n)&&!V.ClassType.isBuiltIn(e.classType,"_TypedDict")){const a=t.getDeclarations();if(a.length>0){const t=a[a.length-1],r=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.methodOverridden().format({name:i,className:e.classType.details.name,type:this._evaluator.printType(n)}),t.node),s=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);r&&s&&r.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenMethod(),s.path,s.range)}}}else if((0,M.isProperty)(r))if((0,M.isProperty)(n)){const s=r.details.fields,o=n.details.fields,l=e.classType;["fget","fset","fdel"].forEach((e=>{const n=new p.DiagnosticAddendum,r=s.get(e),d=o.get(e);if(r){const s=(0,M.partiallySpecializeType)(this._evaluator.getEffectiveTypeOfSymbol(r),l);if((0,V.isFunction)(s))if(d){const t=(0,M.partiallySpecializeType)(this._evaluator.getEffectiveTypeOfSymbol(d),a);if((0,V.isFunction)(t)&&!this._evaluator.validateOverrideMethod(s,t,a,n.createAddendum())){n.addMessage(g.Localizer.DiagnosticAddendum.propertyMethodIncompatible().format({name:e}));const a=t.details.declaration;if(a&&5===a.type){const e=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.propertyOverridden().format({name:i,className:l.details.name})+n.getString(),a.node.name),t=s.details.declaration;e&&t&&e.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenMethod(),t.path,t.range)}}}else{n.addMessage(g.Localizer.DiagnosticAddendum.propertyMethodMissing().format({name:e}));const a=t.getDeclarations();if(a.length>0){const e=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.propertyOverridden().format({name:i,className:l.details.name})+n.getString(),a[a.length-1].node),t=s.details.declaration;e&&t&&e.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenMethod(),t.path,t.range)}}}}))}else{const n=t.getDeclarations();n.length>0&&this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride,c.DiagnosticRule.reportIncompatibleMethodOverride,g.Localizer.Diagnostic.propertyOverridden().format({name:i,className:e.classType.details.name}),n[n.length-1].node)}else if("none"!==this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride){const a=t.getDeclarations();if(a.length>0){const s=a[a.length-1],o=new p.DiagnosticAddendum;if(!this._evaluator.assignType(r,n,o)){const t=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride,c.DiagnosticRule.reportIncompatibleVariableOverride,g.Localizer.Diagnostic.symbolOverridden().format({name:i,className:e.classType.details.name})+o.getString(),s.node),n=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);t&&n&&t.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenSymbol(),n.path,n.range)}const l=this._evaluator.isFinalVariable(e.symbol),d=a.find((e=>this._evaluator.isFinalVariableDeclaration(e)));if(!l&&d){const t=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride,c.DiagnosticRule.reportIncompatibleVariableOverride,g.Localizer.Diagnostic.variableFinalOverride().format({name:i,className:e.classType.details.name}),s.node);t&&t.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenSymbol(),d.path,d.range)}const u=e.symbol.isClassVar();let m=t.isClassVar();if(u&&!m&&(t.hasTypedDeclarations()||(m=!0),t.getTypedDeclarations().every((e=>6===e.type))&&(m=!0)),u!==m){const n=t.isClassVar()?g.Localizer.Diagnostic.classVarOverridesInstanceVar():g.Localizer.Diagnostic.instanceVarOverridesClassVar(),a=this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride,c.DiagnosticRule.reportIncompatibleVariableOverride,n.format({name:i,className:e.classType.details.name}),s.node),r=(0,F.getLastTypedDeclaredForSymbol)(e.symbol);a&&r&&a.addRelatedInfo(g.Localizer.DiagnosticAddendum.overriddenSymbol(),r.path,r.range)}}}}_validateMethod(e,t,n){var a,i,r,s;const o=this._evaluator.getTypeOfClass(n),l=null==o?void 0:o.classType;if(e.name&&l){["__init__","__init_subclass__","__enter__","__exit__"].some((t=>t===e.name.value))&&(V.FunctionType.isAbstractMethod(t)||V.FunctionType.isOverloaded(t)||this._fileInfo.isStubFile||this._validateSuperCallForMethod(e,t,l))}if("__new__"===(null===(a=e.name)||void 0===a?void 0:a.value))0!==e.parameters.length&&e.parameters[0].name&&["cls","_cls","__cls","__mcls","mcls","mcs"].some((t=>e.parameters[0].name.value===t))||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.newClsParam(),e.parameters.length>0?e.parameters[0]:e.name),l&&this._validateClsSelfParameterType(t,l,!0);else if("__init_subclass__"===(null===(i=e.name)||void 0===i?void 0:i.value))0!==e.parameters.length&&e.parameters[0].name&&"cls"===e.parameters[0].name.value||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.initSubclassClsParam(),e.parameters.length>0?e.parameters[0]:e.name),l&&this._validateClsSelfParameterType(t,l,!0);else if("__class_getitem__"===(null===(r=e.name)||void 0===r?void 0:r.value))0!==e.parameters.length&&e.parameters[0].name&&"cls"===e.parameters[0].name.value||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.classGetItemClsParam(),e.parameters.length>0?e.parameters[0]:e.name),l&&this._validateClsSelfParameterType(t,l,!0);else if("_generate_next_value_"===(null===(s=e.name)||void 0===s?void 0:s.value));else if(V.FunctionType.isStaticMethod(t)){if(e.parameters.length>0&&e.parameters[0].name){const t=e.parameters[0].name.value;"self"!==t&&"cls"!==t||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.staticClsSelfParam(),e.parameters[0].name)}}else if(V.FunctionType.isClassMethod(t)){let n="";e.parameters.length>0&&e.parameters[0].name&&(n=e.parameters[0].name.value),"cls"!==n&&(this._fileInfo.isStubFile&&(n.startsWith("_")||"metacls"===n)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.classMethodClsParam(),e.parameters.length>0?e.parameters[0]:e.name)),l&&this._validateClsSelfParameterType(t,l,!0)}else{const a=e.decorators.length>0;if(V.FunctionType.isOverloaded(t)||!a){let t="",a=!0;if(e.parameters.length>0&&(e.parameters[0].name&&(t=e.parameters[0].name.value),0!==e.parameters[0].category&&(a=!1)),a&&"self"!==t){let a=!1;if(["cls","mcls","mcs"].some((e=>e===t))){const e=this._evaluator.getTypeOfClass(n),t=this._evaluator.getBuiltInType(n,"type");t&&(0,V.isInstantiableClass)(t)&&e&&(0,V.isInstantiableClass)(e.classType)&&(0,M.derivesFromClassRecursive)(e.classType,t,!0)&&(a=!0)}const i=N.isPrivateOrProtectedName(t);a||i||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportSelfClsParameterName,c.DiagnosticRule.reportSelfClsParameterName,g.Localizer.Diagnostic.instanceMethodSelfParam(),e.parameters.length>0?e.parameters[0]:e.name)}}l&&this._validateClsSelfParameterType(t,l,!1)}}_validateSuperCallForMethod(e,t,n){if("none"===this._fileInfo.diagnosticRuleSet.reportMissingSuperCall)return;let a=9;V.ClassType.isFinal(n)&&(a|=4);if(!(0,M.lookUpClassMember)(n,t.details.name,a))return;let i=!1;const r=new C.CallNodeWalker((e=>{if(35===e.leftExpression.nodeType&&e.leftExpression.memberName.value===t.details.name){const t=e.leftExpression.leftExpression;if(9===t.nodeType&&38===t.leftExpression.nodeType&&"super"===t.leftExpression.value)i=!0;else{const e=this._evaluator.getType(t);e&&(0,V.isInstantiableClass)(e)&&(i=!0)}}}));r.walk(e.suite),i||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingSuperCall,c.DiagnosticRule.reportMissingSuperCall,g.Localizer.Diagnostic.missingSuperCall().format({methodName:t.details.name}),e.name)}_validateClsSelfParameterType(e,t,n){if(e.details.parameters.length<1)return;const a=e.details.parameters[0];if(!a.typeAnnotation||!a.name)return;if(V.ClassType.isProtocolClass(t))return;const i=this._evaluator.makeTopLevelTypeVarsConcrete(a.type),r=n?t:(0,M.convertToInstance)(t);if((0,V.isInstantiableClass)(i)&&V.ClassType.isProtocolClass(i))return;if((0,V.isClassInstance)(i)&&V.ClassType.isProtocolClass(i))return;if(1===a.category&&(0,V.isParamSpec)(a.type)&&"args"===a.type.paramSpecAccess)return;if(V.FunctionType.isOverloaded(e))return;if((0,V.isClassInstance)(i)&&V.ClassType.isBuiltIn(i,"LiteralString")&&V.ClassType.isBuiltIn(t,"str"))return;const s=new O.TypeVarContext((0,M.getTypeVarScopeId)(e));this._evaluator.assignType(i,r,void 0,s)||(0,V.isNever)(i)||this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.clsSelfParamTypeMismatch().format({name:a.name,classType:this._evaluator.printType(r)}),a.typeAnnotation)}_validateYieldType(e,t){var n;const a=C.getEnclosingFunction(e);if(!a||!a.returnTypeAnnotation)return;const i=this._evaluator.getTypeOfFunction(a);if(!i)return;const r=V.FunctionType.getSpecializedReturnType(i.functionType);if(!r)return;let s;if(s=!a.isAsync&&(0,V.isClassInstance)(r)&&V.ClassType.isBuiltIn(r,"AwaitableGenerator")?this._evaluator.getTypingType(e,"AwaitableGenerator"):this._evaluator.getTypingType(e,a.isAsync?"AsyncGenerator":"Generator"),!s||!(0,V.isInstantiableClass)(s))return;if(!this._evaluator.isNodeReachable(e,void 0))return;if((0,V.isNever)(r))return void this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.noReturnContainsYield(),e);const o=V.ClassType.cloneAsInstance(V.ClassType.cloneForSpecialization(s,[t],!0)),l=new p.DiagnosticAddendum;if(!this._evaluator.assignType(r,o,l)){const i=a.isAsync?g.Localizer.Diagnostic.generatorAsyncReturnType():g.Localizer.Diagnostic.generatorSyncReturnType();this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,i.format({yieldType:this._evaluator.printType(t)})+l.getString(),null!==(n=e.expression)&&void 0!==n?n:e)}}_reportUnusedExceptStatements(e){let t=!1;const n=[];e.exceptClauses.forEach((e=>{var a,i;if(t||e.isExceptGroup||!e.typeExpression)return;const r=this._evaluator.getType(e.typeExpression);if(!r||(0,V.isAnyOrUnknown)(r))return void(t=!0);const s=[];if((0,V.isInstantiableClass)(r))r.includeSubclasses&&(t=!0),s.push(r);else if((0,V.isClassInstance)(r)){const e=null!==(i=null===(a=this._evaluator.getTypeOfIterator({type:r},!1,void 0))||void 0===a?void 0:a.type)&&void 0!==i?i:V.UnknownType.create();(0,M.doForEachSubtype)(e,(e=>{(0,V.isAnyOrUnknown)(e)&&(t=!0),(0,V.isInstantiableClass)(e)&&(e.includeSubclasses&&(t=!0),s.push(e))}))}else t=!0;if(n.length>0&&!t){const t=new p.DiagnosticAddendum;let a=0;s.forEach((e=>{const i=n.find((t=>(0,M.derivesFromClassRecursive)(e,t,!0)));i&&(t.addMessage(g.Localizer.DiagnosticAddendum.unreachableExcept().format({exceptionType:this._evaluator.printType((0,M.convertToInstance)(e)),parentType:this._evaluator.printType((0,M.convertToInstance)(i))})),a++)})),s.length===a&&(this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.Localizer.Diagnostic.unreachableExcept()+t.getString(),e.typeExpression),this._evaluator.addUnreachableCode(e,e.exceptSuite))}(0,o.appendArray)(n,s)}))}_reportDuplicateImports(){const e=(0,_.getTopLevelImports)(this._moduleNode),t=new Map;e.orderedImports.forEach((e=>{if(22===e.node.nodeType){const t=new Map;e.node.imports.forEach((e=>{if(!e.alias){t.get(e.name.value)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportDuplicateImport,c.DiagnosticRule.reportDuplicateImport,g.Localizer.Diagnostic.duplicateImport().format({importName:e.name.value}),e.name):t.set(e.name.value,e)}}))}else if(e.subnode&&!e.subnode.alias){t.get(e.moduleName)?this._evaluator.addDiagnostic(this._fileInfo.diagnosticRuleSet.reportDuplicateImport,c.DiagnosticRule.reportDuplicateImport,g.Localizer.Diagnostic.duplicateImport().format({importName:e.moduleName}),e.subnode):t.set(e.moduleName,e.subnode)}}))}_checkRegions(){const e=(0,w.getRegionComments)(this._parseResults),t=[];e.forEach((e=>{0===e.type?t.push(e):t.length>0?t.pop():this._addDiagnosticForRegionComment(e,g.Localizer.Diagnostic.unmatchedEndregionComment())})),t.forEach((e=>{this._addDiagnosticForRegionComment(e,g.Localizer.Diagnostic.unmatchedRegionComment())}))}_addDiagnosticForRegionComment(e,t){return this._evaluator.addDiagnosticForTextRange(this._fileInfo,"error","",t,{start:e.comment.start-1,length:e.comment.length+1})}}t.Checker=R},33866:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularDependency=void 0;t.CircularDependency=class{constructor(){this._paths=[]}appendPath(e){this._paths.push(e)}getPaths(){return this._paths}normalizeOrder(){let e=0;this._paths.forEach(((t,n)=>{t<this._paths[e]&&(e=n)})),0!==e&&(this._paths=this._paths.slice(e).concat(this._paths.slice(0,e)))}isEqual(e){if(e._paths.length!==this._paths.length)return!1;for(let t=0;t<this._paths.length;t++)if(this._paths[t]!==e._paths[t])return!1;return!0}}},54318:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCodeFlowEngine=t.isIncompleteType=void 0;const a=n(30795),i=n(96541),r=n(21),s=n(80563),o=n(27548),l=n(66455),p=n(78140),c=n(2026),d=n(36906),u=n(51458),m=n(33029);function y(e){return!!e.isIncompleteType}t.isIncompleteType=y;t.getCodeFlowEngine=function(e,t){const n=new Map,g=new Map,h=new Map;let f=1,T=0,v=0;function b(t,i,r=!1){const o=new Set;if(n.has(t.id))return!0;n.set(t.id,!0);try{return function t(n,i,l=0){if(l>64)return!0;l++;let p=n;for(;;){if(o.has(p.id))return!1;if(o.add(p.id),p.flags&s.FlowFlags.Unreachable)return!1;if(p===i)return!0;if(p.flags&(s.FlowFlags.VariableAnnotation|s.FlowFlags.Assignment|s.FlowFlags.TrueCondition|s.FlowFlags.FalseCondition|s.FlowFlags.WildcardImport|s.FlowFlags.TrueNeverCondition|s.FlowFlags.FalseNeverCondition|s.FlowFlags.NarrowForPattern|s.FlowFlags.ExhaustedMatch))p=p.antecedent;else if(p.flags&s.FlowFlags.Call){const t=p;if(!r&&I(e,t))return!1;p=t.antecedent}else{if(p.flags&(s.FlowFlags.BranchLabel|s.FlowFlags.LoopLabel)){if(p.flags&s.FlowFlags.PostContextManager){const t=p;if(!t.expressions.some((n=>k(e,n,t.isAsync))))return!1}const n=p;for(const e of n.antecedents)if(t(e,i,l))return!0;return!1}if(p.flags&s.FlowFlags.Start)return!i;if(!(p.flags&s.FlowFlags.PreFinallyGate)){if(p.flags&s.FlowFlags.PostFinally){const e=p,n=e.preFinallyGate.isGateClosed;try{return e.preFinallyGate.isGateClosed=!0,t(e.antecedent,i,l)}finally{e.preFinallyGate.isGateClosed=n}}return(0,a.fail)("Unexpected flow node flags"),!1}{const e=p;if(e.isGateClosed)return!1;p=e.antecedent}}}}(t,i)}finally{n.delete(t.id)}}function _(e,t){let n=!0;return(0,m.doForEachSubtype)(e,(e=>{(0,u.isTypeVar)(e)?(0,u.isTypeSame)(e,t)||(n=!1):e.condition&&e.condition.some((e=>e.isConstrainedTypeVar&&e.typeVarName===t.nameWithScope))||(n=!1)})),n}function I(e,t){const n=t.node;if(g.has(n.id)){const e=g.get(n.id);return e}if(T>u.maxTypeRecursionCount)return!1;if(30===n.leftExpression.nodeType)return!1;g.set(n.id,!1),T++;try{let t=0,a=0;const i=e.getTypeOfExpression(n.leftExpression,2),r=i.type;(0,m.doForEachSubtype)(r,(r=>{var s;if(a++,(0,u.isInstantiableClass)(r)){if(r.details.effectiveMetaclass&&(0,u.isClass)(r.details.effectiveMetaclass)&&!u.ClassType.isBuiltIn(r.details.effectiveMetaclass,"type")){if((0,m.lookUpClassMember)(r.details.effectiveMetaclass,"__call__",12))return}let t=(0,m.lookUpClassMember)(r,"__init__",12);if(void 0===t&&(t=(0,m.lookUpClassMember)(r,"__new__",12)),t){const n=e.getTypeOfMember(t);if(n&&((0,u.isFunction)(n)||(0,u.isOverloadedFunction)(n))){const t=e.bindFunctionToClassOrObject(void 0,n);t&&(r=t)}}}else if((0,u.isClassInstance)(r)){const t=(0,m.lookUpClassMember)(r,"__call__",8);if(t){const n=e.getTypeOfMember(t);if(n&&((0,u.isFunction)(n)||(0,u.isOverloadedFunction)(n))){const t=e.bindFunctionToClassOrObject(void 0,n);t&&(r=t)}}}const o=6===(null===(s=n.parent)||void 0===s?void 0:s.nodeType);if((0,u.isFunction)(r))C(r,o)&&t++;else if((0,u.isOverloadedFunction)(r)){let a=0,s=0;if(u.OverloadedFunctionType.getOverloads(r).forEach((e=>{a++,C(e,o)&&s++})),s>0)if(s===a)t++;else{const a=e.validateOverloadedFunctionArguments(n,n.arguments,{type:r,isIncomplete:i.isIncomplete},void 0,!1,void 0);a.returnType&&(0,u.isNever)(a.returnType)&&t++}}}));const s=a>0&&t===a;return g.set(n.id,s),s}finally{T--}}function C(e,t){const n=e.details.declaredReturnType;return!!n&&(!!(u.FunctionType.isAsync(e)&&(0,u.isClassInstance)(n)&&u.ClassType.isBuiltIn(n,"Coroutine")&&n.typeArguments&&n.typeArguments.length>=3&&(0,u.isNever)(n.typeArguments[2])&&t)||(0,u.isNever)(n))}function k(e,t,n){var a;if(h.has(t.id))return h.get(t.id);if(h.set(t.id,!1),v>u.maxTypeRecursionCount)return!1;v++;let i=!1;try{const r=e.getTypeOfExpression(t).type;if(r&&(0,u.isClassInstance)(r)){const s=n?"__aexit__":"__exit__",o=null===(a=e.getTypeOfObjectMember(t,r,s))||void 0===a?void 0:a.type;if(o&&(0,u.isFunction)(o)&&o.details.declaredReturnType){let e=o.details.declaredReturnType;n&&u.FunctionType.isAsync(o)&&(0,u.isClassInstance)(e)&&u.ClassType.isBuiltIn(e,"Coroutine")&&e.typeArguments&&e.typeArguments.length>=3&&(e=e.typeArguments[2]),i=!1,(0,u.isClassInstance)(e)&&u.ClassType.isBuiltIn(e,"bool")&&(void 0!==e.literalValue&&!0!==e.literalValue||(i=!0))}}}finally{v--}return h.set(t.id,i),i}function S(t,n){const i=(0,r.getImportInfo)(t.node.module);(0,a.assert)(void 0!==i&&i.isImportFound),(0,a.assert)(t.node.isWildcardImport);const s=e.lookUpSymbolRecursive(t.node,n,!1);(0,a.assert)(void 0!==s);const o=s.symbol.getDeclarations().find((e=>e.node===t.node));return o&&e.getInferredTypeOfDeclaration(s.symbol,o)||u.UnknownType.create()}function w(e,t,n,a=console){let s="";if(t){const e=(0,r.getFileInfo)(t),n=(0,i.convertOffsetToPosition)(t.start,e.lines);s=`${(0,l.printExpression)(t)}[${n.line+1}:${n.character+1}]`}a.log(`${n}@${e.id}: ${s||"(none)"}`),a.log((0,o.formatControlFlowGraph)(e))}return{createCodeFlowAnalyzer:function(){const n=new Map;return{getTypeFromCodeFlow:function(i,r,o,g,h){const T=void 0!==r?(0,s.createKeyForReference)(r):void 0;let v;const _=function(e){let t=n.get(e);return t||(t={cache:new Map,pendingNodes:new Set},n.set(e,t)),t}(void 0!==T&&void 0!==o?T+`.${o.toString()}`:".");function C(e,n,a){if(a){if(n){const t=_.cache.get(e.id);if(t){const e=t;e.isIncompleteType&&e.type&&!(0,u.isTypeSame)(e.type,n)&&f++}}}else f++;const i=a?{isIncompleteType:!0,type:n,incompleteSubtypes:[],generationCount:f}:n;return _.cache.set(e.id,i),t.trackEntry(_.cache,e.id),{type:n,isIncomplete:a,generationCount:f,incompleteSubtypes:a?[]:void 0}}function w(e,t,n,i,r,s){const o=_.cache.get(e.id);void 0!==o&&y(o)||(0,a.fail)("setIncompleteSubtype can be called only on a valid incomplete cache entry");const l=o.incompleteSubtypes;if(t<l.length){const e=l[t];e.isIncomplete===i&&(0,u.isTypeSame)(e.type,n)?e.isPending!==r&&(l[t]={type:n,isIncomplete:i,isPending:r,evaluationCount:s}):(l[t]={type:n,isIncomplete:i,isPending:r,evaluationCount:s},f++)}else(0,a.assert)(l.length===t),l.push({type:n,isIncomplete:i,isPending:r,evaluationCount:s}),f++;let p;if(o.incompleteSubtypes.length>0){const e=[];o.incompleteSubtypes.forEach((t=>{t.type&&e.push(t.type)})),p=e.length>0?(0,u.combineTypes)(e):void 0}return o.type=p,o.generationCount=f,A(e)}function A(e){if(!_.cache.has(e.id))return;const t=_.cache.get(e.id);return void 0===t?{type:void 0,isIncomplete:!1}:y(t)?{type:t.type,isIncomplete:!0,incompleteSubtypes:t.incompleteSubtypes,generationCount:t.generationCount}:{type:t,isIncomplete:!1}}function x(t){let n=t.node;const a=t.node.parent;return a&&(28!==a.nodeType&&10!==a.nodeType||(n=a)),e.evaluateTypeForSubnode(n,(()=>{e.evaluateTypesForStatement(t.node)}))}function P(e,t){_.pendingNodes.add(e.id);try{const n=t();return _.pendingNodes.delete(e.id),n}catch(t){throw _.pendingNodes.delete(e.id),t}}function D(t){var n,i;let y=t;for(e.checkForCancellation();;){const t=A(y);if(t){if(!t.isIncomplete)return t;if(t.generationCount===f)return{type:t.type?(0,u.cleanIncompleteUnknown)(t.type):void 0,isIncomplete:!0}}if(_.pendingNodes.has(y.id))return{type:null!==(n=null==t?void 0:t.type)&&void 0!==n?n:u.UnknownType.create(!0),isIncomplete:!0};if(y.flags&s.FlowFlags.Unreachable)return C(y,u.NeverType.createNever(),!1);if(y.flags&s.FlowFlags.VariableAnnotation){y=y.antecedent}else if(y.flags&s.FlowFlags.Call){const t=y;if(!(null==h?void 0:h.skipNoReturnCallAnalysis)&&I(e,t))return C(y,void 0,!1);y=t.antecedent}else if(y.flags&s.FlowFlags.Assignment){const t=y,n=t.node;if(r){if(o===t.targetSymbolId&&(0,l.isMatchingExpression)(r,n)){if(y.flags&s.FlowFlags.Unbind)return C(y,u.UnboundType.create(),!1);let a=P(y,(()=>x(t)));return a&&((0,m.isTypeAliasPlaceholder)(a.type)||35===r.nodeType&&e.isAsymmetricDescriptorAssignment(n))&&(a=void 0),C(y,null==a?void 0:a.type,!!(null==a?void 0:a.isIncomplete))}if(24===n.nodeType&&(0,l.isMatchingExpression)(r,n.baseExpression)&&3===(null===(i=n.parent)||void 0===i?void 0:i.nodeType)&&1===n.items.length&&!n.trailingComma&&!n.items[0].name&&0===n.items[0].argumentCategory&&48===n.items[0].valueExpression.nodeType&&1===n.items[0].valueExpression.strings.length&&49===n.items[0].valueExpression.strings[0].nodeType){const e=n.items[0].valueExpression.strings[0].value,a=P(t,(()=>{const n=D(t.antecedent);return n.type&&(n.type=(0,m.mapSubtypes)(n.type,(t=>(0,u.isClass)(t)&&u.ClassType.isTypedDictClass(t)?(0,c.narrowForKeyAssignment)(t,e):t))),n}));return C(y,null==a?void 0:a.type,!!(null==a?void 0:a.isIncomplete))}if((0,l.isPartialMatchingExpression)(r,n))return{type:g,isIncomplete:!!(null==h?void 0:h.isTypeAtStartIncomplete)}}y=t.antecedent}else{if(y.flags&s.FlowFlags.BranchLabel){const t=y;if(y.flags&s.FlowFlags.PostContextManager){const t=y;if(t.expressions.some((n=>k(e,n,t.isAsync)))===t.blockIfSwallowsExceptions)return C(y,void 0,!1)}if(r&&t.preBranchAntecedent&&t.affectedExpressions&&(v||(v=(0,s.createKeysForReferenceSubexpressions)(r)),!v.some((e=>t.affectedExpressions.has(e)))&&b(y,t.preBranchAntecedent))){y=t.preBranchAntecedent;continue}return N(y)}if(y.flags&s.FlowFlags.LoopLabel){const e=y;if(r&&(v||(v=(0,s.createKeysForReferenceSubexpressions)(r)),!v.some((t=>e.affectedExpressions.has(t))))){y=e.antecedents[0];continue}return F(e,t)}if(y.flags&(s.FlowFlags.TrueCondition|s.FlowFlags.FalseCondition)){const t=y;if(!(null==h?void 0:h.skipConditionalNarrowing)&&r){const n=P(y,(()=>{const n=(0,d.getTypeNarrowingCallback)(e,r,t.expression,!!(t.flags&(s.FlowFlags.TrueCondition|s.FlowFlags.TrueNeverCondition)));if(n){const e=D(t.antecedent);let a=e.type,i=e.isIncomplete;if(a){const e=n(a);e&&(a=e.type,e.isIncomplete&&(i=!0))}return C(y,a,i)}}));if(n)return n}y=t.antecedent}else if(y.flags&(s.FlowFlags.TrueNeverCondition|s.FlowFlags.FalseNeverCondition)){const t=y;if(!(null==h?void 0:h.skipConditionalNarrowing)&&t.reference&&(0,s.createKeyForReference)(t.reference)!==T){const n=e.lookUpSymbolRecursive(t.reference,t.reference.value,!1);if(n&&n.symbol.getTypedDeclarations().length>0){const n=P(y,(()=>{const n=(0,d.getTypeNarrowingCallback)(e,t.reference,t.expression,!!(t.flags&(s.FlowFlags.TrueCondition|s.FlowFlags.TrueNeverCondition)));if(n){const a=e.getTypeOfExpression(t.reference);let i=a.type,r=!!a.isIncomplete;const s=n(a.type);if(s&&(i=s.type,s.isIncomplete&&(r=!0)),(0,u.isNever)(i))return C(y,void 0,r)}}));if(n)return n}}y=t.antecedent}else if(y.flags&s.FlowFlags.ExhaustedMatch){const t=y,n=e.evaluateTypeForSubnode(t.node,(()=>{e.evaluateTypesForMatchStatement(t.node)}));if(n&&(0,u.isNever)(n.type))return C(y,n.type,!!n.isIncomplete);y=t.antecedent}else if(y.flags&s.FlowFlags.NarrowForPattern){const t=y;if(!r||(0,l.isMatchingExpression)(r,t.subjectExpression)){const n=e.evaluateTypeForSubnode(t.statement,(()=>{64===t.statement.nodeType?e.evaluateTypesForCaseStatement(t.statement):e.evaluateTypesForMatchStatement(t.statement)}));if(n){if(r)return C(y,n.type,!!n.isIncomplete);if((0,u.isNever)(n.type))return C(y,void 0,!!n.isIncomplete)}}else if(64===t.statement.nodeType){const n=t.statement,a=(0,p.getPatternSubtypeNarrowingCallback)(e,r,t.subjectExpression);if(a){const t=e.evaluateTypeForSubnode(n,(()=>{e.evaluateTypesForCaseStatement(n)}));if(t){const e=a(t.type);if(e)return C(y,e.type,!!t.isIncomplete||!!e.isIncomplete)}}}y=t.antecedent}else{if(y.flags&s.FlowFlags.PreFinallyGate)return E(y);if(y.flags&s.FlowFlags.PostFinally)return z(y);if(y.flags&s.FlowFlags.Start)return C(y,g,!!(null==h?void 0:h.isTypeAtStartIncomplete));if(y.flags&s.FlowFlags.WildcardImport){const e=y;if(r&&38===r.nodeType){const t=r.value;if(e.names.some((e=>e===t)))return P(y,(()=>{const n=S(e,t);return C(y,n,!1)}))}y=e.antecedent}else(0,a.fail)("Unexpected flow node flags")}}}}function N(e){const t=[];let n=!1;return P(e,(()=>{for(const a of e.antecedents){const i=D(a);if(void 0===r&&i.type&&!(0,u.isNever)(i.type))return C(e,g,!1);i.isIncomplete&&(n=!0),i.type&&t.push(i.type)}const a=t.length>0?(0,u.combineTypes)(t):void 0;return C(e,a,n)}))}function F(e,t){var n;const a=e.antecedents.length;if(void 0===t)t=C(e,r?void 0:g,!0);else if(t.incompleteSubtypes&&t.incompleteSubtypes.length===e.antecedents.length&&t.incompleteSubtypes.some((e=>e.isPending)))return{type:t.type,isIncomplete:!0};let i=0;for(;;){let s=!1,o=!1,l=void 0===r&&(null===(n=t.incompleteSubtypes)||void 0===n?void 0:n.some((e=>void 0!==e.type))),p=!1,c=!1;if(e.antecedents.forEach(((n,a)=>{var i,d;if(void 0===r&&l)return;if(c&&a>0)return;if((t=A(e)).incompleteSubtypes&&a<t.incompleteSubtypes.length&&t.incompleteSubtypes[a].isPending){if(0!==a)return s=!0,void(o=!0);c=!0}const m=void 0!==t.incompleteSubtypes&&a<t.incompleteSubtypes.length?t.incompleteSubtypes[a]:void 0;if(void 0===m||!(null==m?void 0:m.isPending)&&(null==m?void 0:m.isIncomplete)||0===a){const r=void 0===m?0:m.evaluationCount;t=w(e,a,null!==(i=null==m?void 0:m.type)&&void 0!==i?i:u.UnknownType.create(!0),!0,!0,r);try{const i=D(n);i.isIncomplete&&(s=!0,0===a&&(p=!0)),t=w(e,a,null!==(d=i.type)&&void 0!==d?d:i.isIncomplete?u.UnknownType.create(!0):u.NeverType.createNever(),i.isIncomplete,!1,r+1)}catch(t){throw w(e,a,u.UnknownType.create(!0),!0,!1,r+1),t}}void 0===r&&void 0!==(null==t?void 0:t.type)&&(l=!0)})),l)return o?{type:g,isIncomplete:!1}:C(e,g,!1);let d=t.type;if(s&&d&&(d=(0,u.cleanIncompleteUnknown)(d)),!s||i>=a){let t=s;return o||!d||(0,m.isIncompleteUnknown)(d)||p||(f++,t=!1),o||s?{type:d,isIncomplete:t}:c?{type:d,isIncomplete:!0}:C(e,d,!1)}i++}}function E(e){return e.isGateClosed?{type:void 0,isIncomplete:!1}:P(e,(()=>{const t=D(e.antecedent);return function(e){_.cache.delete(e.id)}(e),{type:t.type,isIncomplete:t.isIncomplete}}))}function z(t){const n=t.preFinallyGate.isGateClosed;try{let n;return t.preFinallyGate.isGateClosed=!0,e.useSpeculativeMode(t.finallyNode,(()=>{n=D(t.antecedent)})),n.isIncomplete?n:C(t,n.type,!1)}finally{t.preFinallyGate.isGateClosed=n}}return i?D(i):{type:g,isIncomplete:!!(null==h?void 0:h.isTypeAtStartIncomplete)}}}},isFlowNodeReachable:b,narrowConstrainedTypeVar:function(t,n){(0,a.assert)(!n.details.isParamSpec),(0,a.assert)(!n.details.isVariadic),(0,a.assert)(!n.details.boundType),(0,a.assert)(n.details.constraints.length>0);const i=new Set,r=[];for(const e of n.details.constraints){if(!(0,u.isClassInstance)(e))return;r.push(e)}const o=function t(n,o){let l=n;for(;;){if(i.has(l.id))return r;if(l.flags&(s.FlowFlags.Unreachable|s.FlowFlags.Start))return r;if(l.flags&(s.FlowFlags.VariableAnnotation|s.FlowFlags.Assignment|s.FlowFlags.WildcardImport|s.FlowFlags.TrueNeverCondition|s.FlowFlags.FalseNeverCondition|s.FlowFlags.NarrowForPattern|s.FlowFlags.ExhaustedMatch|s.FlowFlags.PostFinally|s.FlowFlags.PreFinallyGate|s.FlowFlags.Call)){l=l.antecedent}else{if(!(l.flags&(s.FlowFlags.TrueCondition|s.FlowFlags.FalseCondition))){if(l.flags&(s.FlowFlags.BranchLabel|s.FlowFlags.LoopLabel)){const e=l,n=[];i.add(l.id);for(const a of e.antecedents){const e=t(a,o);for(const t of e)n.some((e=>(0,u.isTypeSame)(e,t)))||n.push(t)}return i.delete(l.id),n}return(0,a.fail)("Unexpected flow node flags"),r}{const n=l,a=n.expression,r=0!=(l.flags&s.FlowFlags.TrueCondition);if(9===a.nodeType&&38===a.leftExpression.nodeType&&"isinstance"===a.leftExpression.value&&2===a.arguments.length){const s=a.arguments[0].valueExpression;if(_(e.getTypeOfExpression(s).type,o)){i.add(l.id);const s=t(n.antecedent,o);i.delete(l.id);const p=a.arguments[1].valueExpression,c=e.getTypeOfExpression(p,104).type;if((0,u.isInstantiableClass)(c))return s.filter((e=>u.ClassType.isSameGenericClass(e,c)?r:!r))}}l=n.antecedent}}}}(t,n);return 1===o.length?o[0]:void 0},printControlFlowGraph:w}}},80563:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wildcardImportReferenceKey=t.createKeysForReferenceSubexpressions=t.createKeyForReference=t.isCodeFlowSupportedForReference=t.getUniqueFlowNodeId=t.FlowFlags=void 0;const a=n(30795);!function(e){e[e.Unreachable=1]="Unreachable",e[e.Start=2]="Start",e[e.BranchLabel=4]="BranchLabel",e[e.LoopLabel=8]="LoopLabel",e[e.Assignment=16]="Assignment",e[e.Unbind=32]="Unbind",e[e.WildcardImport=64]="WildcardImport",e[e.TrueCondition=128]="TrueCondition",e[e.FalseCondition=512]="FalseCondition",e[e.Call=1024]="Call",e[e.PreFinallyGate=2048]="PreFinallyGate",e[e.PostFinally=4096]="PostFinally",e[e.VariableAnnotation=16384]="VariableAnnotation",e[e.PostContextManager=32768]="PostContextManager",e[e.TrueNeverCondition=65536]="TrueNeverCondition",e[e.FalseNeverCondition=131072]="FalseNeverCondition",e[e.NarrowForPattern=262144]="NarrowForPattern",e[e.ExhaustedMatch=524288]="ExhaustedMatch"}(t.FlowFlags||(t.FlowFlags={}));let i=1;function r(e){let t;if(38===e.nodeType)t=e.value;else if(35===e.nodeType){t=`${r(e.leftExpression)}.${e.memberName.value}`}else if(24===e.nodeType){const n=r(e.baseExpression);(0,a.assert)(1===e.items.length);const i=e.items[0].valueExpression;if(40===i.nodeType)t=`${n}[${i.value.toString()}]`;else if(48===i.nodeType){const e=i;(0,a.assert)(1===e.strings.length&&49===e.strings[0].nodeType),t=`${n}["${e.strings[0].value}"]`}else 55===i.nodeType&&33===i.operator&&40===i.expression.nodeType?t=`${n}[-${i.expression.value.toString()}]`:(0,a.fail)("createKeyForReference received unexpected index type")}else(0,a.fail)("createKeyForReference received unexpected expression type");return t}t.getUniqueFlowNodeId=function(){return i++},t.isCodeFlowSupportedForReference=function e(t){if(38===t.nodeType)return!0;if(35===t.nodeType)return e(t.leftExpression);if(24===t.nodeType){if(1!==t.items.length||t.trailingComma||void 0!==t.items[0].name||0!==t.items[0].argumentCategory)return!1;const n=t.items[0].valueExpression,a=40===n.nodeType&&!n.isImaginary&&n.isInteger,i=55===n.nodeType&&33===n.operator&&40===n.expression.nodeType&&!n.expression.isImaginary&&n.expression.isInteger,r=48===n.nodeType&&1===n.strings.length&&49===n.strings[0].nodeType;return!!(a||i||r)&&e(t.baseExpression)}return!1},t.createKeyForReference=r,t.createKeysForReferenceSubexpressions=function e(t){return 38===t.nodeType?[r(t)]:35===t.nodeType?[...e(t.leftExpression),r(t)]:24===t.nodeType?[...e(t.baseExpression),r(t)]:void(0,a.fail)("createKeyForReference received unexpected expression type")},t.wildcardImportReferenceKey="*"},27548:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatControlFlowGraph=void 0;const a=n(96541),i=n(21),r=n(80563);t.formatControlFlowGraph=function(e){const t=Object.create(null),n=[],s=[],o=d(e,new Set);for(const e of n)e.text=g(e.flowNode,e.circular),m(e);const l=function(e){const t=f(Array(e),0);for(const e of n)t[e.level]=Math.max(t[e.level],e.text.length);return t}(function e(t){let n=0;for(const a of p(t))n=Math.max(n,e(a));return n+1}(o));return function e(t,n){if(-1===t.lane){t.lane=n,t.endLane=n;const a=p(t);for(let i=0;i<a.length;i++){i>0&&n++;const r=a[i];e(r,n),r.endLane>t.endLane&&(n=r.endLane)}t.endLane=n}}(o,0),function(){const e=l.length,t=n.reduce(((e,t)=>Math.max(e,t.lane)),0)+1,a=f(Array(t),""),i=l.map((()=>Array(t))),r=l.map((()=>f(Array(t),0)));for(const e of n){i[e.level][e.lane]=e;const t=p(e);for(let n=0;n<t.length;n++){const a=t[n];let i=8;a.lane===e.lane&&(i|=4),n>0&&(i|=1),n<t.length-1&&(i|=2),r[e.level][a.lane]|=i}0===t.length&&(r[e.level][e.lane]|=16);const n=c(e);for(let t=0;t<n.length;t++){const a=n[t];let i=4;t>0&&(i|=1),t<n.length-1&&(i|=2),r[e.level-1][a.lane]|=i}}for(let n=0;n<e;n++)for(let e=0;e<t;e++){const t=n>0?r[n-1][e]:0,a=e>0?r[n][e-1]:0;let i=r[n][e];i||(8&t&&(i|=12),2&a&&(i|=3),r[n][e]=i)}for(let t=0;t<e;t++)for(let n=0;n<a.length;n++){const a=r[t][n],o=4&a?"─":" ",p=i[t][n];p?(s(n,p.text),t<e-1&&(s(n," "),s(n,T(o,l[t]-p.text.length)))):t<e-1&&s(n,T(o,l[t]+1)),s(n,h(a)),s(n,8&a&&t<e-1&&!i[t+1][n]?"─":" ")}return`${a.join("\n")}\n`;function s(e,t){a[e]+=t}}();function p(e){const t=[];for(const n of e.edges)n.source===e&&t.push(n.target);return t}function c(e){const t=[];for(const n of e.edges)n.target===e&&t.push(n.source);return t}function d(e,a){const i=e.id;let s=t[i];if(s&&a.has(e))return s={id:-1,flowNode:e,edges:[],text:"",lane:-1,endLane:-1,level:-1,circular:!0},n.push(s),s;if(a.add(e),!s){t[i]=s={id:i,flowNode:e,edges:[],text:"",lane:-1,endLane:-1,level:-1,circular:!1},n.push(s);const o=function(e){if(e.flags&(r.FlowFlags.LoopLabel|r.FlowFlags.BranchLabel))return e.antecedents;if(e.flags&(r.FlowFlags.Assignment|r.FlowFlags.VariableAnnotation|r.FlowFlags.WildcardImport|r.FlowFlags.TrueCondition|r.FlowFlags.FalseCondition|r.FlowFlags.TrueNeverCondition|r.FlowFlags.FalseNeverCondition|r.FlowFlags.NarrowForPattern|r.FlowFlags.ExhaustedMatch|r.FlowFlags.Call|r.FlowFlags.PreFinallyGate|r.FlowFlags.PostFinally))return[e.antecedent];return[]}(e);for(const e of o)u(s,e,a)}return a.delete(e),s}function u(e,t,n){const a=d(t,n),i={source:e,target:a};s.push(i),e.edges.push(i),a.edges.push(i)}function m(e){if(-1!==e.level)return e.level;let t=0;for(const n of c(e))t=Math.max(t,m(n)+1);return e.level=t}function y(e){const t=function(e){return e.flags&r.FlowFlags.Assignment||e.flags&r.FlowFlags.WildcardImport?e.node:e.flags&(r.FlowFlags.TrueCondition|r.FlowFlags.FalseCondition)?e.expression:e.flags&r.FlowFlags.NarrowForPattern?e.statement:e.flags&r.FlowFlags.Call?e.node:void 0}(e);if(!t)return;const n=(0,i.getFileInfo)(t),s=(0,a.convertOffsetToPosition)(t.start,n.lines);return`[${s.line+1}:${s.character+1}]`}function g(e,t){const n=`${function(e){if(e&r.FlowFlags.Start)return"Start";if(e&r.FlowFlags.BranchLabel)return"Branch";if(e&r.FlowFlags.LoopLabel)return"Loop";if(e&r.FlowFlags.Unbind)return"Unbind";if(e&r.FlowFlags.Assignment)return"Assign";if(e&r.FlowFlags.TrueCondition)return"True";if(e&r.FlowFlags.FalseCondition)return"False";if(e&r.FlowFlags.Call)return"Call";if(e&r.FlowFlags.Unreachable)return"Unreachable";if(e&r.FlowFlags.WildcardImport)return"Wildcard";if(e&r.FlowFlags.PreFinallyGate)return"PreFinal";if(e&r.FlowFlags.PostFinally)return"PostFinal";if(e&r.FlowFlags.VariableAnnotation)return"Annotate";if(e&r.FlowFlags.TrueNeverCondition)return"TrueNever";if(e&r.FlowFlags.FalseNeverCondition)return"FalseNever";if(e&r.FlowFlags.NarrowForPattern)return"Pattern";if(e&r.FlowFlags.ExhaustedMatch)return"Exhaust";throw new Error}(e.flags)}@${e.id}${y(e)||""}`;return t?`Circular(${n})`:n}function h(e){switch(e){case 3:return"│";case 12:return"─";case 5:return"╯";case 9:return"╰";case 6:return"╮";case 10:return"╭";case 7:return"┤";case 11:return"├";case 13:return"┴";case 14:return"┬";case 15:return"╫"}return" "}function f(e,t){if(e.fill)e.fill(t);else for(let n=0;n<e.length;n++)e[n]=t;return e}function T(e,t){if(e.repeat)return t>0?e.repeat(t):"";let n="";for(;n.length<t;)n+=e;return n}}},67030:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFileLevelDirectives=void 0;const a=n(59750),i=n(30795),r=n(83501),s=n(96541),o=n(99661),l="strict",p="basic";function c(e){!function(e,t,n){const i=(0,a.getBooleanDiagnosticRules)(),r=(0,a.getDiagLevelDiagnosticRules)();for(const a of i)n.find((e=>e===a))||t[a]&&(e[a]=!0);for(const a of r){if(n.find((e=>e===a)))continue;const i=t[a],r=e[a];("error"===i||"warning"===i&&"error"!==r||"information"===i&&"error"!==r&&"warning"!==r)&&(e[a]=i)}}(e,(0,a.getStrictDiagnosticRuleSet)(),(0,a.getStrictModeNotOverriddenRules)())}function d(e){!function(e,t){const n=(0,a.getBooleanDiagnosticRules)(),i=(0,a.getDiagLevelDiagnosticRules)();for(const a of n)e[a]=t[a];for(const n of i)e[n]=t[n]}(e,(0,a.getBasicDiagnosticRuleSet)())}function u(e,t,n,a,i){const s="pyright:";if(e.startsWith(s)){const s=e.substring(8);if(s.trim().startsWith("ignore"))return a;if(!n()){const e=new r.DiagnosticAddendum;e.addMessage(o.Localizer.DiagnosticAddendum.pyrightCommentIgnoreTip());const n={message:o.Localizer.Diagnostic.pyrightCommentNotOnOwnLine()+e.getString(),range:t};i.push(n)}const u=s.split(",");u.some((e=>e.trim()===l))?c(a):u.some((e=>e.trim()===p))&&d(a);let g=0;for(const e of u){const[n,r]=y(e,{start:t.start+8+g,length:e.length});a=m(n,r,a,i),g+=e.length+1}}return a}function m(e,t,n,i){const r=e.split("="),[s,c]=y(r[0],{start:t.start,length:r[0].length});if(1===r.length&&s&&[l,p].some((e=>s===e)))return n;const d=(0,a.getDiagLevelDiagnosticRules)(),u=(0,a.getBooleanDiagnosticRules)(),m=r.length>0?r.slice(1).join("="):"",[g,h]=y(m,{start:t.start+r[0].length+1,length:m.length});if(d.find((e=>e===s))){const e=function(e){switch(e){case"false":case"none":return"none";case"true":case"error":return"error";case"warning":return"warning";case"information":return"information";default:return}}(g);if(void 0!==e)n[s]=e;else{const e={message:o.Localizer.Diagnostic.pyrightCommentInvalidDiagnosticSeverityValue(),range:g?h:c};i.push(e)}}else if(u.find((e=>e===s))){const e=function(e){if("false"===e)return!1;if("true"===e)return!0;return}(g);if(void 0!==e)n[s]=e;else{const e={message:o.Localizer.Diagnostic.pyrightCommentInvalidDiagnosticBoolValue(),range:g?h:c};i.push(e)}}else if(s){const e={message:g?o.Localizer.Diagnostic.pyrightCommentUnknownDiagnosticRule().format({rule:s}):o.Localizer.Diagnostic.pyrightCommentUnknownDirective().format({directive:s}),range:c};i.push(e)}else{const e={message:o.Localizer.Diagnostic.pyrightCommentMissingDirective(),range:c};i.push(e)}return n}function y(e,t){(0,i.assert)(e.length===t.length);const n=e.trimStart();let a=t;if(n!==e){const t=e.length-n.length;a={start:a.start+t,length:a.length-t}}const r=n.trimEnd();return r!==n&&(a={start:a.start,length:a.length-n.length+r.length}),(0,i.assert)(r.length===a.length),[r,a]}t.getFileLevelDirectives=function(e,t,n,i,r){let o=(0,a.cloneDiagnosticRuleSet)(n);i&&c(o);for(let n=0;n<e.count;n++){const a=e.getItemAt(n);if(a.comments)for(const e of a.comments){const[n,a]=y(e.value,{start:e.start,length:e.length});o=u(n,a,(()=>(0,s.convertOffsetToPosition)(e.start,t).character<=1),o,r)}}return o}},54750:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.populateTypeVarContextBasedOnExpectedType=t.assignTypeToTypeVar=void 0;const a=n(83501),i=n(99661),r=n(7461),s=n(51458),o=n(33029),l=n(43024);t.assignTypeToTypeVar=function(e,t,n,p,c,d=0,u=0){let m=!0;const y=0!=(2&d);if(!t.scopeId)return!0;if(!c.hasSolveForScope(t.scopeId)){if((0,s.isAnyOrUnknown)(n)||(0,s.isClass)(n)&&s.ClassType.derivesFromAnyOrUnknown(n))return!0;if(t.details.isParamSpec&&(0,s.isFunction)(n)&&s.FunctionType.isParamSpecValue(n)&&s.FunctionType.shouldSkipArgsKwargsCompatibilityCheck(n))return!0;if((0,s.isNever)(n)&&0==(1&d))return!0;if(0!=(512&d))return!0;if(m=!1,!t.details.isSynthesized)return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(n,t))),!1}if(0!=(8&d))return e.assignType(e.makeTopLevelTypeVarsConcrete(t),e.makeTopLevelTypeVarsConcrete(n),p,void 0,void 0,d,u);if(t.details.isParamSpec)return function(e,t,n,a,r,l=0){let p=!0;return r.doForEachSignature((c=>{if((0,s.isTypeVar)(n)&&n.details.isParamSpec){const e=c.getParamSpecType(t);if(!e)return void(!r.isLocked()&&r.hasSolveForScope(t.scopeId)&&r.setTypeVarType(t,(0,o.convertTypeToParamSpecValue)(n)));if(0===e.details.parameters.length&&e.details.paramSpec&&(0,s.isTypeSame)(e.details.paramSpec,n,{},l))return}else if((0,s.isFunction)(n)){const a=n,i=n.details.parameters.map(((e,t)=>({category:e.category,name:e.name,isNameSynthesized:e.isNameSynthesized,hasDefault:!!e.hasDefault,defaultValueExpression:e.defaultValueExpression,type:s.FunctionType.getEffectiveParameterType(a,t)}))),p=c.getParamSpecType(t);if(!p){if(!r.isLocked()&&r.hasSolveForScope(t.scopeId)){const e=s.FunctionType.createInstance("","","",n.details.flags);i.forEach((t=>{s.FunctionType.addParameter(e,t)})),e.details.typeVarScopeId=n.details.typeVarScopeId,e.details.paramSpecTypeVarScopeId=n.details.paramSpecTypeVarScopeId,e.details.docString=n.details.docString,e.details.paramSpec=n.details.paramSpec,r.setTypeVarType(t,e)}return}if(p.details.paramSpec===n.details.paramSpec){const t=(0,o.convertParamSpecValueToType)(p,!0),a=s.FunctionType.createInstance("","","",n.details.flags);if(i.forEach((e=>{s.FunctionType.addParameter(a,e)})),a.details.typeVarScopeId=n.details.typeVarScopeId,e.assignType(t,a,void 0,void 0,void 0,32,l))return}}else if((0,s.isAnyOrUnknown)(n))return;null==a||a.addMessage(i.Localizer.DiagnosticAddendum.typeParamSpec().format({type:e.printType(n),name:t.details.name})),p=!1})),p}(e,t,n,p,c,u);if(t.details.isVariadic&&!t.isVariadicInUnion&&!(0,s.isUnpacked)(n)){const t=e.getTupleClassType();n=t&&(0,s.isInstantiableClass)(t)?(0,o.convertToInstance)((0,o.specializeTupleClass)(t,[{type:n,isUnbounded:!1}],!0,!0)):s.UnknownType.create()}(0,s.isTypeVar)(n)&&n.details.isVariadic&&n.isVariadicUnpacked&&!n.isVariadicInUnion&&!t.details.isVariadic&&(n=s.TypeVarType.cloneForUnpacked(n,!0)),s.TypeBase.isInstantiable(t)&&(0,s.isClassInstance)(n)&&s.ClassType.isBuiltIn(n,"type")&&!n.typeArguments&&(n=s.AnyType.create());const g=c.getPrimarySignature().getTypeVar(t),h=null==g?void 0:g.narrowBound;let f=null==g?void 0:g.wideBound;if(f||t.details.isSynthesizedSelf||(f=t.details.boundType),t.details.constraints.length>0){let a;const r=e.makeTopLevelTypeVarsConcrete(n);if((0,s.isTypeVar)(n))e.assignType(t,r,void 0,new l.TypeVarContext(t.scopeId),void 0,0,u)&&(a=n,s.TypeBase.isInstantiable(n)&&(a=(0,o.convertToInstance)(n,!1)));else{let n,i=!0;a=(0,o.mapSubtypes)(r,(a=>{let r,l;return(0,s.isAnyOrUnknown)(a)?a:(t.details.constraints.forEach(((n,i)=>{const p=s.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(n):n;e.assignType(p,a,void 0,void 0,void 0,0,u)&&(r&&!e.assignType(s.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(r):r,p,void 0,void 0,void 0,0,u)||(r=(0,o.addConditionToType)(n,(0,o.getTypeCondition)(a)),l=i))})),r||y||(i=!1),void 0===l||(0,o.getTypeCondition)(a)||(void 0!==n&&n!==l&&(i=!1),n=l),r)})),!(0,s.isNever)(a)&&i||(a=void 0),!a&&(0,s.isUnion)(r)&&(a=t.details.constraints.find((n=>{const a=s.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(n):n;return e.assignType(a,r,void 0,void 0,void 0,0,u)})))}if(!a)return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeConstrainedTypeVar().format({type:e.printType(n),name:t.details.name})),!1;if(h&&!(0,s.isAnyOrUnknown)(h)){if(!e.assignType(h,a,void 0,void 0,void 0,0,u)){if(!e.assignType(a,h,void 0,void 0,void 0,0,u))return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeConstrainedTypeVar().format({type:e.printType(a),name:e.printType(h)})),!1;!c.isLocked()&&m&&c.setTypeVarType(t,a)}}else!c.isLocked()&&m&&c.setTypeVarType(t,a);return!0}let T=h,v=f;const b=p?new a.DiagnosticAddendum:void 0;let _=n;if(0==(2048&d)&&(0,s.isClass)(_)&&_.includeSubclasses&&(_=(0,o.specializeWithDefaultTypeArgs)(_)),s.TypeBase.isInstantiable(t))if((0,o.isEffectivelyInstantiable)(_))_=(0,o.convertToInstance)(_,!1);else{const a=e.makeTopLevelTypeVarsConcrete(_);if(!(0,o.isEffectivelyInstantiable)(a))return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(n,t))),!1;_=(0,o.convertToInstance)(a)}else if((0,s.isTypeVar)(n)&&s.TypeBase.isInstantiable(n)&&(0,s.isTypeSame)((0,o.convertToInstance)(n),t))return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(_,t))),!1;if(0!=(1024&d))g||(0!=(1&d)?(T=_,v=_):y?T=_:v=_);else if(y){if(f){if(!(0,s.isTypeSame)(f,_,{},u))if(e.assignType(f,e.makeTopLevelTypeVarsConcrete(_),b,void 0,void 0,512&d,u))(0,s.isAny)(f)||(v=_);else if(!e.assignType(_,f,b,void 0,void 0,512&d,u))return p&&b&&(p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(f,_))),p.addAddendum(b)),!1}else v=_;if(h&&!e.assignType(v,h,void 0,void 0,void 0,512&d,u))return p&&b&&(p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(h,v))),p.addAddendum(b)),!1}else{if(h){if(!(0,s.isTypeSame)(h,_,{},u))if(e.assignType(h,_,b,void 0,void 0,d,u))T=(0,o.isPartlyUnknown)(h)&&!(0,s.isUnknown)(_)&&e.assignType(_,h,void 0,void 0,void 0,512&d,u)?_:(0,o.applySolvedTypeVars)(h,c);else{if(c.isLocked())return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(_,h))),!1;if(e.assignType(_,h,void 0,void 0,void 0,512&d,u))T=_;else if((0,s.isVariadicTypeVar)(t)){const t=function(e,t){if(!(0,s.isUnpackedClass)(e)||!(0,s.isUnpackedClass)(t))return;if(!e.tupleTypeArguments||!t.tupleTypeArguments||e.tupleTypeArguments.length!==t.tupleTypeArguments.length)return;let n=!0;const a=e.tupleTypeArguments.map(((e,a)=>{const i=t.tupleTypeArguments[a];return e.isUnbounded!==i.isUnbounded&&(n=!1),{isUnbounded:e.isUnbounded,type:(0,s.combineTypes)([e.type,i.type])}}));if(!n)return;return(0,o.specializeTupleClass)(e,a,!0,!0)}(h,_);if(!t)return null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(h,_))),!1;T=t}else{const n=e.getObjectType(),a=(0,o.applySolvedTypeVars)(h,c);T=(0,s.isUnion)(a)&&a.subtypes.length>r.maxSubtypesForInferredType&&void 0!==t.details.boundType&&n&&(0,s.isClassInstance)(n)?(0,s.combineTypes)([a,n],64):(0,s.combineTypes)([a,_],64)}}}else T=_;if(f&&T&&!(0,s.isTypeSame)(f,T,{},u)){let t=!0;(0,s.isTypeVar)(f)&&((0,s.isTypeSame)(T,f)||(0,s.isUnion)(T)&&T.subtypes.some((e=>(0,s.isTypeSame)(e,f))))&&(t=!1);const n=t?e.makeTopLevelTypeVarsConcrete(f,!0):f;if(!e.assignType(n,T,null==p?void 0:p.createAddendum(),void 0,void 0,512,u))return p&&b&&p.addMessage(i.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(T,n))),!1}}if(t.details.boundType){const a=T||v;if(s.TypeBase.isInstantiable(t)&&!s.TypeBase.isInstantiable(n))return!1;const r=t.details.isSynthesizedSelf?c:new l.TypeVarContext(t.scopeId);if(!e.assignType(t.details.boundType,e.makeTopLevelTypeVarsConcrete(a),null==p?void 0:p.createAddendum(),r,void 0,512&d,u))return t.details.isSynthesized||null==p||p.addMessage(i.Localizer.DiagnosticAddendum.typeBound().format({sourceType:e.printType(a),destType:e.printType(t.details.boundType),name:s.TypeVarType.getReadableName(t)})),!1}if(!c.isLocked()&&m){let n;if(T&&0==(1152&d)){const a=(0,s.isVariadicTypeVar)(t)?function(e,t){if(!(0,s.isUnpackedClass)(t)||!t.tupleTypeArguments)return t;let n=!1;const a=t.tupleTypeArguments.map((t=>{const a=e.stripLiteralValue(t.type);return a!==t.type&&(n=!0),{isUnbounded:t.isUnbounded,type:a}}));if(!n)return t;return(0,o.specializeTupleClass)(t,a,!0,!0)}(e,T):e.stripLiteralValue(T);a!==T&&(v&&!e.assignType(v,a)||(n=a))}c.setTypeVarType(t,T,n,v)}return!0},t.populateTypeVarContextBasedOnExpectedType=function(e,t,n,a,i,r=void 0){if((0,s.isAny)(n))return t.details.typeParameters.forEach((e=>{a.setTypeVarType(e,n)})),!0;if((0,s.isTypeVar)(n)&&n.details.isSynthesizedSelf&&n.details.boundType&&(n=n.details.boundType),!(0,s.isClass)(n))return!1;const p=n.typeArguments;if(!p)return e.assignType(t,n,void 0,a,void 0,1024);if(e.inferTypeParameterVarianceForClass(t),s.ClassType.isSameGenericClass(n,t)){const e=(0,o.buildTypeVarContextFromSpecializedClass)(n);return e.getPrimarySignature().getTypeVars().forEach((t=>{let n=e.getPrimarySignature().getTypeVarType(t.typeVar);if(n&&i&&(n=(0,o.transformExpectedType)(n,i,r)),n){const e=s.TypeVarType.getVariance(t.typeVar);a.setTypeVarType(t.typeVar,3===e?void 0:n,void 0,4===e?void 0:n),t.tupleTypes&&a.setTupleTypeVar(t.typeVar,t.tupleTypes.map((e=>{let t=e.type;return i&&(t=(0,o.transformExpectedType)(e.type,i,r)),{type:t,isUnbounded:e.isUnbounded}})))}})),!0}const c=(0,o.getTypeVarScopeId)(n),d=s.ClassType.getTypeParameters(n).map(((e,t)=>{const n=s.TypeVarType.createInstance(`__dest${t}`);return n.details.isSynthesized=!0,n.details.declaredVariance=2,n.scopeId=c,n})),u=s.ClassType.cloneForSpecialization(n,d,!0),m=s.ClassType.getTypeParameters(t).map(((e,t)=>{const n=s.TypeVarType.createInstance(`__source${t}`);return n.details.isSynthesized=!0,n.details.synthesizedIndex=t,n.details.isExemptFromBoundCheck=!0,s.TypeVarType.cloneAsInScopePlaceholder(n)})),y=s.ClassType.cloneForSpecialization(t,m,!0),g=new l.TypeVarContext(c);if(e.assignType(u,y,void 0,g,void 0,1024)){let e=!0;return d.forEach(((t,n)=>{let l=g.getPrimarySignature().getTypeVarType(t);const c=[];if(l&&(0,s.isUnion)(l)){let e;l.subtypes.forEach((t=>{(0,s.isTypeVar)(t)&&t.details.isSynthesized&&void 0!==t.details.synthesizedIndex&&!e?e=t:c.push(t)})),e&&(l=e)}if(l&&(0,s.isTypeVar)(l)&&l.details.isSynthesized&&void 0!==l.details.synthesizedIndex){const d=s.ClassType.getTypeParameters(y)[l.details.synthesizedIndex];if(n<p.length){let l=(0,o.transformPossibleRecursiveTypeAlias)(p[n]);if(c.length>0&&(l=(0,s.combineTypes)([l,...c])),i&&(l=(0,o.transformExpectedType)(l,i,r)),l){const n=s.TypeVarType.getVariance(t);a.getPrimarySignature().getTypeVarType(d)&&(e=!1,l=s.UnknownType.create()),a.setTypeVarType(d,3===n?void 0:l,void 0,4===n?void 0:l)}else e=!1}}})),e}return!1}},90281:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyConstructorTransform=t.hasConstructorTransform=void 0;const a=n(5284),i=n(83501),r=n(28513),s=n(99661),o=n(21),l=n(45341),p=n(32966),c=n(16682),d=n(51458),u=n(33029),m=n(43024);function y(e,t,n,l,c){const y=new Map,g=(0,p.getParameterListDetails)(c);let h=!1,f=!1;const T=new m.TypeVarContext((0,u.getTypeVarScopeId)(c));n.slice(1).forEach(((n,a)=>{var l,m,v,b,_,I,C,k;if(n.valueExpression)if(n.name){const a=g.params.find((e=>{var t;return e.param.name===(null===(t=n.name)||void 0===t?void 0:t.value)&&e.source!==p.ParameterSource.PositionOnly}));if(a){const l=a.param.name,p=d.FunctionType.getEffectiveParameterType(c,a.index);if(y.has(l))t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.paramAlreadyAssigned().format({name:n.name.value}),n.name),h=!0;else{const a=new i.DiagnosticAddendum,d=e.getTypeOfExpression(n.valueExpression,void 0,(0,u.makeInferenceContext)(p));e.assignType(p,d.type,a,T)||(t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.argAssignmentParamFunction().format({argType:e.printType(d.type),paramType:e.printType(p),functionName:c.details.name,paramName:l}),null!==(k=n.valueExpression)&&void 0!==k?k:t),h=!0),y.set(l,!0)}}else if(void 0===g.kwargsIndex)t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.paramNameMissing().format({name:n.name.value}),n.name),h=!0;else{const a=d.FunctionType.getEffectiveParameterType(c,g.params[g.kwargsIndex].index),l=new i.DiagnosticAddendum,p=e.getTypeOfExpression(n.valueExpression,void 0,(0,u.makeInferenceContext)(a));e.assignType(a,p.type,l,T)||(t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.argAssignmentParamFunction().format({argType:e.printType(p.type),paramType:e.printType(a),functionName:c.details.name,paramName:null!==(I=g.params[g.kwargsIndex].param.name)&&void 0!==I?I:""}),null!==(C=n.valueExpression)&&void 0!==C?C:t),h=!0)}}else if(a>=g.params.length||g.params[a].source===p.ParameterSource.KeywordOnly)if(void 0!==g.argsIndex){const a=d.FunctionType.getEffectiveParameterType(c,g.params[g.argsIndex].index),p=new i.DiagnosticAddendum,y=e.getTypeOfExpression(n.valueExpression,void 0,(0,u.makeInferenceContext)(a));e.assignType(a,y.type,p,T)||(t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.argAssignmentParamFunction().format({argType:e.printType(y.type),paramType:e.printType(a),functionName:c.details.name,paramName:null!==(l=g.params[g.argsIndex].param.name)&&void 0!==l?l:""}),null!==(m=n.valueExpression)&&void 0!==m?m:t),h=!0)}else f||t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,1===g.positionParamCount?s.Localizer.Diagnostic.argPositionalExpectedOne():s.Localizer.Diagnostic.argPositionalExpectedCount().format({expected:g.positionParamCount}),null!==(v=n.valueExpression)&&void 0!==v?v:t),f=!0,h=!0;else{const l=d.FunctionType.getEffectiveParameterType(c,a),p=new i.DiagnosticAddendum,m=null!==(b=g.params[a].param.name)&&void 0!==b?b:"",f=e.getTypeOfExpression(n.valueExpression,void 0,(0,u.makeInferenceContext)(l));e.assignType(l,f.type,p,T)||(t&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.argAssignmentParamFunction().format({argType:e.printType(f.type),paramType:e.printType(l),functionName:c.details.name,paramName:m}),null!==(_=n.valueExpression)&&void 0!==_?_:t),h=!0),y.set(m,!1)}}));const v=(0,u.applySolvedTypeVars)(c,T);if(!(0,d.isFunction)(v))return;const b=v.details.parameters.map(((e,t)=>{const n={...e};return n.type=d.FunctionType.getEffectiveParameterType(v,t),e.name&&y.get(e.name)&&(n.hasDefault=!0),n})),_=b.filter((e=>2!==e.category&&(1===e.category||(!e.name||!y.has(e.name))))),I=b.filter((e=>e.name&&y.get(e.name))),C=b.filter((e=>2===e.category)),k=[];(0,a.appendArray)(k,_),(0,a.appendArray)(k,I),(0,a.appendArray)(k,C);const S=d.FunctionType.createInstance(l.details.name,l.details.fullName,l.details.moduleName,l.details.flags,v.details.docString);return l.details.parameters.length>0&&d.FunctionType.addParameter(S,l.details.parameters[0]),k.forEach((e=>{d.FunctionType.addParameter(S,e)})),S.details.declaredReturnType=v.details.declaredReturnType?d.FunctionType.getSpecializedReturnType(v):v.inferredReturnType,S.details.declaration=l.details.declaration,S.details.typeVarScopeId=v.details.typeVarScopeId,{returnType:S,isTypeIncomplete:!1,argumentErrors:h}}t.hasConstructorTransform=function(e){return"functools.partial"===e.details.fullName},t.applyConstructorTransform=function(e,t,n,a,i){return"functools.partial"===a.details.fullName?function(e,t,n,a){if(!(0,d.isClassInstance)(a.returnType)||"functools.partial"!==a.returnType.details.fullName)return a;const i=(0,u.lookUpObjectMember)(a.returnType,"__call__");if(!i||!(0,d.isTypeSame)((0,u.convertToInstance)(i.classType),a.returnType))return a;const p=e.getTypeOfMember(i);if(!(0,d.isFunction)(p)||p.details.parameters.length<1)return a;if(n.length<1)return a;const m=e.getTypeOfArgument(n[0]);let g=m.type;(0,d.isTypeVar)(g)&&(g=e.makeTopLevelTypeVarsConcrete(g));if((0,d.isInstantiableClass)(g)){const t=(0,l.createFunctionFromConstructor)(e,g);t&&(g=t)}if(e.inferReturnTypeIfNecessary(g),n.some((e=>0!==e.argumentCategory)))return a;if((0,d.isFunction)(g)){const i=y(e,t,n,p,g);if(!i)return a;const r=d.ClassType.cloneForSymbolTableUpdate(a.returnType);return r.details.fields.set("__call__",c.Symbol.createWithType(4,i.returnType)),{returnType:r,isTypeIncomplete:a.isTypeIncomplete,argumentErrors:i.argumentErrors}}if((0,d.isOverloadedFunction)(g)){const i=[];let l=!1;if(d.OverloadedFunctionType.getOverloads(g).forEach((t=>{const a=y(e,void 0,n,p,t);a&&(a.argumentErrors?l=!0:(0,d.isFunction)(a.returnType)&&i.push(a.returnType))})),0===i.length)return l&&e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,r.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.noOverload().format({name:g.overloads[0].details.name}),t),a;const u=d.ClassType.cloneForSymbolTableUpdate(a.returnType);let m;return m=1===i.length?i[0]:d.OverloadedFunctionType.create(i.map((e=>d.FunctionType.cloneWithNewFlags(e,256|e.details.flags)))),u.details.fields.set("__call__",c.Symbol.createWithType(4,m)),{returnType:u,isTypeIncomplete:a.isTypeIncomplete,argumentErrors:!1}}return a}(e,t,n,i):i}},45341:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createFunctionFromConstructor=t.validateConstructorArguments=void 0;const a=n(5284),i=n(28513),r=n(99661),s=n(21),o=n(54750),l=n(90281),p=n(66455),c=n(33029),d=n(43024),u=n(51458);function m(e,t,n,l,m,f,T){var v,b;let _,I=!1,C=!1,k=!1;const S=[];let w,A;if(T){const i=y(e,t,n,l,m,f,T,!0);i.argumentErrors?C=!0:(0,a.appendArray)(S,null!==(v=i.overloadsUsedForCall)&&void 0!==v?v:[]),i.isTypeIncomplete&&(k=!0),w=i.returnType}if(!w||function(e){var t;if(!e||!(0,u.isFunction)(e))return!1;if(e.details.paramSpec)return!1;const n=e.details.parameters;if(2!==n.length)return!1;if(1!==n[0].category||2!==n[1].category)return!1;const a=null!==(t=e.details.declaredReturnType)&&void 0!==t?t:e.inferredReturnType;if(!a||!(0,u.isTypeVar)(a)||!a.details.isSynthesizedSelf)return!1;return!0}(null==T?void 0:T.type)?w=u.ClassType.cloneAsInstance(l):(0,u.isNever)(w)||(0,u.isClassInstance)(w)||(w=(0,c.applySolvedTypeVars)(u.ClassType.cloneAsInstance(l),new d.TypeVarContext((0,c.getTypeVarScopeId)(l)),{unknownIfNotFound:!0})),!C&&!(0,u.isNever)(w)&&!function(e,t,n){const a=e.makeTopLevelTypeVarsConcrete(n);let i=!1;return(0,c.doForEachSubtype)(a,(e=>{if(!(0,u.isAnyOrUnknown)(e))if((0,u.isClassInstance)(e)){const n=[];u.ClassType.isDerivedFrom(e,t,n)||(i=!0)}else i=!0})),i}(e,l,w)){let i=w;if((0,c.isPartlyUnknown)(i)&&(i=u.ClassType.cloneAsInstance(l)),A=e.getTypeOfObjectMember(t,i,"__init__",{method:"get"},void 0,68),A){const r=function(e,t,n,i,r,s,l){let m,y=!1,f=!1;const T=[];s&&(m=(0,c.mapSubtypes)(s.expectedType,(s=>{if(s=(0,c.transformPossibleRecursiveTypeAlias)(s),(0,u.isClassInstance)(s)&&u.ClassType.isSameGenericClass(i,s)&&i.typeArguments)return;const m=new d.TypeVarContext((0,c.getTypeVarScopeId)(i));if(m.addSolveForScope((0,c.getTypeVarScopeId)(l)),(0,o.populateTypeVarContextBasedOnExpectedType)(e,u.ClassType.cloneAsInstance(i),s,m,(0,p.getTypeVarScopesForNode)(t),t.start)){const o=(0,c.applySolvedTypeVars)(l,m);let p;if(p=e.useSpeculativeMode(t,(()=>e.validateCallArguments(t,n,{type:o},m.clone(),r))),!p.argumentErrors)return p=e.validateCallArguments(t,n,{type:o},m,r),p.isTypeIncomplete&&(y=!0),p.argumentErrors&&(f=!0),p.overloadsUsedForCall&&(0,a.appendArray)(T,p.overloadsUsedForCall),g(e,i,s,m)}})),((0,u.isNever)(m)||f)&&(m=void 0));if(!m){const a=i.typeArguments?(0,c.buildTypeVarContextFromSpecializedClass)(i):new d.TypeVarContext((0,c.getTypeVarScopeId)(i));a.addSolveForScope((0,c.getTypeVarScopeId)(l));const s=e.validateCallArguments(t,n,{type:l},a,r);let o=i;s.specializedInitSelfType&&(0,u.isClassInstance)(s.specializedInitSelfType)&&u.ClassType.isSameGenericClass(s.specializedInitSelfType,o)&&(o=u.ClassType.cloneAsInstantiable(s.specializedInitSelfType)),m=h(e,o,void 0,a),s.isTypeIncomplete&&(y=!0),s.argumentErrors?f=!0:s.overloadsUsedForCall&&T.push(...s.overloadsUsedForCall)}return{argumentErrors:f,returnType:m,isTypeIncomplete:y,overloadsUsedForCall:T}}(e,t,n,i,m,f,A.type);r.argumentErrors?C=!0:r.overloadsUsedForCall&&S.push(...r.overloadsUsedForCall),r.isTypeIncomplete&&(k=!0),_=r.returnType,I=!0,m=!0}}if(!I&&T&&(e.isSpeculativeModeInUse(t)||y(e,t,n,l,m,f,T,!1),I=!0,_=w),!T&&!A){const m=function(e,t,n,a,l){let m=!1;if(n.length>0&&n.some((e=>0===e.argumentCategory))){const n=(0,s.getFileInfo)(t);e.addDiagnostic(n.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,r.Localizer.Diagnostic.constructorNoArgs().format({type:a.aliasName||a.details.name}),t),m=!0}if(!l&&a.typeArguments)return{argumentErrors:m,overloadsUsedForCall:[],returnType:(0,c.convertToInstance)(a)};const y=new d.TypeVarContext((0,c.getTypeVarScopeId)(a));l&&(0,o.populateTypeVarContextBasedOnExpectedType)(e,u.ClassType.cloneAsInstance(a),l.expectedType,y,(0,p.getTypeVarScopesForNode)(t),t.start);return{argumentErrors:m,overloadsUsedForCall:[],returnType:h(e,a,l,y)}}(e,t,n,l,f);m.argumentErrors?C=!0:m.overloadsUsedForCall&&(0,a.appendArray)(S,m.overloadsUsedForCall),m.isTypeIncomplete&&(k=!0),_=null!==(b=m.returnType)&&void 0!==b?b:u.UnknownType.create()}return{argumentErrors:C,returnType:_,isTypeIncomplete:k,overloadsUsedForCall:S}}function y(e,t,n,a,i,r,s,o){let l,p=!1,m=!1;const y=[],g=new d.TypeVarContext((0,c.getTypeVarScopeId)(a));g.addSolveForScope((0,c.getTypeVarScopeId)(s.type)),a.typeAliasInfo&&g.addSolveForScope(a.typeAliasInfo.typeVarScopeId);const f=e.useSpeculativeMode(o?t:void 0,(()=>e.validateCallArguments(t,n,s,g,i,r)));return f.isTypeIncomplete&&(p=!0),f.argumentErrors?(m=!0,g.unlock(),e.validateCallArguments(t,n,s,g,i)):(l=f.returnType,0===y.length&&f.overloadsUsedForCall&&y.push(...f.overloadsUsedForCall)),l?(0,u.isClassInstance)(l)&&(0,c.isTupleClass)(l)&&!l.tupleTypeArguments&&(l.typeArguments&&1===l.typeArguments.length&&(l=(0,c.specializeTupleClass)(l,[{type:l.typeArguments[0],isUnbounded:!0}])),l=function(e,t){let n=e;t&&(0,u.isClassInstance)(t.expectedType)&&(0,c.isTupleClass)(t.expectedType)&&t.expectedType.tupleTypeArguments&&(n=(0,c.specializeTupleClass)(e,t.expectedType.tupleTypeArguments));return n}(l,r)):l=h(e,a,r,g),{argumentErrors:m,returnType:l,isTypeIncomplete:p,overloadsUsedForCall:y}}function g(e,t,n,a){const i=(0,c.applySolvedTypeVars)(u.ClassType.cloneAsInstance(t),a,{applyInScopePlaceholders:!0});if(e.assignType(n,i))return(0,u.isAny)(n)?n:i}function h(e,t,n,a){let i=!0;if(0===t.details.typeParameters.length||t.typeArguments)return u.ClassType.cloneAsInstance(t);if(n){const r=(0,c.mapSubtypes)(n.expectedType,(n=>g(e,t,n,a)));if(!(0,u.isNever)(r))return r;t.typeArguments&&(i=!1)}const r=(0,c.applySolvedTypeVars)(t,a,{unknownIfNotFound:i});return u.ClassType.cloneAsInstance(r)}t.validateConstructorArguments=function(e,t,n,a,i,r){var s;const o=function(e,t,n,a,i,r){const s=a.details.effectiveMetaclass;if(s&&(0,u.isInstantiableClass)(s)&&!u.ClassType.isSameGenericClass(s,a)){const o=e.getTypeOfClassMemberName(t,s,!0,"__call__",{method:"get"},void 0,352,a);if(o){const s=e.validateCallArguments(t,n,o,void 0,i,r);if(!s.returnType||(0,u.isUnknown)(s.returnType)){const t=new d.TypeVarContext((0,c.getTypeVarScopeId)(a));s.returnType=h(e,a,r,t)}return s}}return}(e,t,n,a,i,r);if(o){const t=null!==(s=o.returnType)&&void 0!==s?s:u.UnknownType.create();if(o.argumentErrors||!e.assignType((0,c.convertToInstance)(a),t))return o}const p=e.getTypeOfClassMemberName(t,a,!1,"__new__",{method:"get"},void 0,21,a),y=(0,l.hasConstructorTransform)(a);let g=e.useSpeculativeMode(y?t:void 0,(()=>m(e,t,n,a,i,r,p))),f=!y||g.argumentErrors;if(y)if(g.argumentErrors)m(e,t,n,a,i,r,p),f=!0;else if(g.returnType){const i=(0,l.applyConstructorTransform)(e,t,n,a,{argumentErrors:!!g.argumentErrors,returnType:g.returnType,isTypeIncomplete:!!g.isTypeIncomplete});g.returnType=i.returnType,i.isTypeIncomplete&&(g.isTypeIncomplete=!0),i.argumentErrors&&(g.argumentErrors=!0),f=!0}return f||n.forEach((t=>{t.valueExpression&&!e.isSpeculativeModeInUse(t.valueExpression)&&e.getTypeOfExpression(t.valueExpression)})),(null==o?void 0:o.returnType)&&(!g.returnType||(0,u.isAnyOrUnknown)(g.returnType)?(0,u.isAnyOrUnknown)(o.returnType)||(g={...g,returnType:o.returnType}):g.returnType&&(0,u.isNever)(g.returnType)&&(g={...g,returnType:o.returnType})),g},t.createFunctionFromConstructor=function(e,t,n=0){const a=(0,c.lookUpClassMember)(t,"__init__",12);if(a){const s=e.getTypeOfMember(a),o=u.ClassType.cloneAsInstance(t);function l(a){let i=e.bindFunctionToClassOrObject(o,a,void 0,void 0,n);return i&&(i=u.FunctionType.clone(i),i.details.declaredReturnType=o,i.details.typeVarScopeId=a.details.typeVarScopeId,i.specializedTypes&&(i.specializedTypes.returnType=o),!i.details.docString&&t.details.docString&&(i.details.docString=t.details.docString),i.details.flags&=-5,i.details.constructorTypeVarScopeId=(0,c.getTypeVarScopeId)(t)),i}if((0,u.isFunction)(s))return l(s);if((0,u.isOverloadedFunction)(s)){const p=[];if(s.overloads.forEach((e=>{const t=l(e);t&&p.push(t)})),0===p.length)return;return 1===p.length?p[0]:u.OverloadedFunctionType.create(p)}}const i=(0,c.lookUpClassMember)(t,"__new__",12);if(i){const d=e.getTypeOfMember(i),m=a=>{let i=e.bindFunctionToClassOrObject(t,a,void 0,void 0,n,!0);return i&&(i=u.FunctionType.clone(i),i.details.typeVarScopeId=a.details.typeVarScopeId,!i.details.docString&&t.details.docString&&(i.details.docString=t.details.docString),i.details.flags&=-6,i.details.constructorTypeVarScopeId=(0,c.getTypeVarScopeId)(t)),i};if((0,u.isFunction)(d))return m(d);if((0,u.isOverloadedFunction)(d)){const y=[];if(d.overloads.forEach((e=>{const t=m(e);t&&y.push(t)})),0===y.length)return;return 1===y.length?y[0]:u.OverloadedFunctionType.create(y)}}const r=u.FunctionType.createSynthesizedInstance("__new__",0);return r.details.declaredReturnType=u.ClassType.cloneAsInstance(t),u.FunctionType.addDefaultParameters(r),!r.details.docString&&t.details.docString&&(r.details.docString=t.details.docString),r}},5838:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyDataClassDecorator=t.applyDataClassDefaultBehaviors=t.applyDataClassClassBehaviorOverrides=t.getDataclassDecoratorBehaviors=t.validateDataClassTransformDecorator=t.synthesizeDataClassMethods=void 0;const s=n(30795),o=n(83501),l=n(28513),p=n(99661),c=r(n(21)),d=n(21),u=n(45341),m=n(46288),y=n(66455),g=n(93890),h=n(16682),f=n(48466),T=n(51458),v=n(33029),b=n(43024);function _(e,t){let n;return(0,T.isFunction)(e)?n=e.details.fullName:(0,T.isOverloadedFunction)(e)?n=e.overloads[0].details.fullName:(0,T.isInstantiableClass)(e)&&(n=e.details.fullName),!!n&&t.some((e=>e===n))}function I(e,t,n,a,i){switch(a){case"order":!0===i?n.details.flags|=64:!1===i&&(n.details.flags&=-65);break;case"kw_only":!1===i?n.details.flags&=-2097153:!0===i&&(n.details.flags|=2097152);break;case"frozen":{let a=!1,r=!1;!1===i?n.details.flags&=-9:!0===i&&(n.details.flags|=8),n.details.baseClasses.forEach((e=>{(0,T.isInstantiableClass)(e)&&T.ClassType.isDataClass(e)&&(T.ClassType.isFrozenDataClass(e)?r=!0:e.details.classDataClassTransform||e.details.declaredMetaclass&&(0,T.isInstantiableClass)(e.details.declaredMetaclass)&&e.details.declaredMetaclass.details.classDataClassTransform||(a=!0))})),i?a&&e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassBaseClassNotFrozen(),t):r&&e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassBaseClassFrozen(),t);break}case"init":!1===i?n.details.flags|=16:!0===i&&(n.details.flags&=-17);break;case"eq":!1===i?n.details.flags|=32:!0===i&&(n.details.flags&=-33);break;case"slots":!0===i?(n.details.flags|=33554432,n.details.localSlotsNames&&e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassSlotsOverwrite(),t)):!1===i&&(n.details.flags&=-33554433);break;case"hash":case"unsafe_hash":!0===i&&(n.details.flags|=67108864)}}function C(e,t,n,a,i){let r=!1;a.forEach((t=>{t.valueExpression&&t.name&&(!function(e,t,n,a,i){const r=c.getFileInfo(t);I(e,t,n,a,(0,g.evaluateStaticBoolExpression)(i,r.executionEnvironment,r.definedConstants))}(e,t.name,n,t.name.value,t.valueExpression),"frozen"===t.name.value&&(r=!0))})),r||I(e,t,n,"frozen",i.frozen)}function k(e,t){e.details.dataClassBehaviors=t,e.details.flags|=4,t.keywordOnlyParams&&(e.details.flags|=2097152),t.generateEq||(e.details.flags|=32),t.generateOrder&&(e.details.flags|=64),t.frozen&&(e.details.flags|=8)}t.synthesizeDataClassMethods=function(e,t,n,a,i,r){var I;(0,s.assert)(T.ClassType.isDataClass(n));const C=(0,v.synthesizeTypeVarForSelfCls)(n,!0),k=T.FunctionType.createSynthesizedInstance("__new__",1),S=T.FunctionType.createSynthesizedInstance("__init__");T.FunctionType.addParameter(k,{category:0,name:"cls",type:C,hasDeclaredType:!0}),T.FunctionType.addDefaultParameters(k),k.details.declaredReturnType=(0,v.convertToInstance)(C);const w={category:0,name:"self",type:(0,v.synthesizeTypeVarForSelfCls)(n,!1),hasDeclaredType:!0};T.FunctionType.addParameter(S,w),S.details.declaredReturnType=T.NoneType.createInstance();const A=[],x=[],P=function(e,t){let n=!0;return T.ClassType.getReverseMro(e).forEach((e=>{if((0,T.isInstantiableClass)(e)){const n=(0,v.buildTypeVarContextFromSpecializedClass)(e);T.ClassType.getDataClassEntries(e).forEach((e=>{const a=t.findIndex((t=>t.name===e.name)),i={...e};i.type=(0,v.applySolvedTypeVars)(i.type,n),e.isClassVar?a>=0&&t.splice(a,1):a>=0?t[a]=i:t.push(i)}))}else n=!1})),n}(n,x);P||T.FunctionType.addDefaultParameters(S);const D=[];let N=!1;n.details.fields.forEach((i=>{var r,s,o;if(!i.isIgnoredForProtocolMatch()){const d=i.getTypedDeclarations().find((e=>{if(1!==e.type)return!1;const t=(0,y.getEnclosingClassOrFunction)(e.node);return!(!t||10!==t.nodeType)}));if(d){let i,o,u,m=d.node;for(;m&&3!==m.nodeType;){if(54===m.nodeType){3===(null===(r=m.parent)||void 0===r?void 0:r.nodeType)&&(m=m.parent);break}m=m.parent}if(!m)return;let y,h,f=!1,b=T.ClassType.isDataClassKeywordOnlyParams(n)||N,I=!0;if(3===m.nodeType){if(54===m.leftExpression.nodeType&&38===m.leftExpression.valueExpression.nodeType){i=m.leftExpression.valueExpression;const t=m;u=()=>e.getTypeOfAnnotation(t.leftExpression.typeAnnotation,{isVariableAnnotation:!0,allowFinal:!0,allowClassVar:!0})}if(f=!0,y=m.rightExpression,9===m.rightExpression.nodeType){const a=e.getTypeOfExpression(m.rightExpression.leftExpression,2),i=a.type;if(_(i,(null===(s=n.details.dataClassBehaviors)||void 0===s?void 0:s.fieldDescriptorNames)||[])){const n=m.rightExpression.arguments.find((e=>{var t;return"init"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(n&&n.valueExpression){const e=c.getFileInfo(t);!1===(0,g.evaluateStaticBoolExpression)(n.valueExpression,e.executionEnvironment,e.definedConstants)&&(I=!1)}else{let t;if((0,T.isFunction)(i))t=i;else if((0,T.isOverloadedFunction)(i))t=e.getBestOverloadForArguments(m.rightExpression,{type:i,isIncomplete:a.isIncomplete},m.rightExpression.arguments);else if((0,T.isInstantiableClass)(i)){const n=e.getBoundMethod(i,"__init__");n&&((0,T.isFunction)(n)?t=n:(0,T.isOverloadedFunction)(n)&&(t=e.getBestOverloadForArguments(m.rightExpression,{type:n},m.rightExpression.arguments)))}if(t){const e=t.details.parameters.find((e=>"init"===e.name));e&&e.defaultValueExpression&&e.hasDeclaredType&&(0,T.isClass)(e.type)&&T.ClassType.isBuiltIn(e.type,"bool")&&(0,v.isLiteralType)(e.type)&&!1===e.type.literalValue&&(I=!1)}}const r=m.rightExpression.arguments.find((e=>{var t;return"kw_only"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(r&&r.valueExpression){const e=c.getFileInfo(t),n=(0,g.evaluateStaticBoolExpression)(r.valueExpression,e.executionEnvironment,e.definedConstants);!1===n?b=!1:!0===n&&(b=!0)}const s=m.rightExpression.arguments.find((e=>{var t,n,a;return"default"===(null===(t=e.name)||void 0===t?void 0:t.value)||"default_factory"===(null===(n=e.name)||void 0===n?void 0:n.value)||"factory"===(null===(a=e.name)||void 0===a?void 0:a.value)}));f=!!s,(null==s?void 0:s.valueExpression)&&(y=s.valueExpression);const l=m.rightExpression.arguments.find((e=>{var t;return"alias"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(l){const t=e.getTypeOfExpression(l.valueExpression).type;(0,T.isClassInstance)(t)&&T.ClassType.isBuiltIn(t,"str")&&(0,v.isLiteralType)(t)&&(o=t.literalValue)}const p=m.rightExpression.arguments.find((e=>{var t;return"converter"===(null===(t=e.name)||void 0===t?void 0:t.value)}));p&&p.valueExpression&&(h=p)}}}else if(54===m.nodeType&&38===m.valueExpression.nodeType){i=m.valueExpression;const t=m;if(u=()=>e.getTypeOfAnnotation(t.typeAnnotation,{isVariableAnnotation:!0,allowFinal:!0,allowClassVar:!0}),"_"===m.valueExpression.value){const e=u();(0,T.isClassInstance)(e)&&T.ClassType.isBuiltIn(e,"KW_ONLY")&&(N=!0,i=void 0,u=void 0)}}if(i&&u){const r=i.value,s=n.details.fields.get(r),d=null==s?void 0:s.getDeclarations().some((e=>1===e.type&&e.isFinal));if((null==s?void 0:s.isClassVar())&&!d){const e=x.findIndex((e=>e.name===r));e>=0&&x.splice(e,1);const t={name:r,classType:n,alias:o,isKeywordOnly:!1,hasDefault:f,defaultValueExpression:y,includeInInit:I,nameNode:i,type:T.UnknownType.create(),isClassVar:!0,converter:h};A.push(t)}else{const s={name:r,classType:n,alias:o,isKeywordOnly:b,hasDefault:f,defaultValueExpression:y,includeInInit:I,nameNode:i,type:T.UnknownType.create(),isClassVar:!1,converter:h};D.push({entry:s,evaluator:u});let d=A.findIndex((e=>e.name===r));if(d>=0?A[d]=s:A.push(s),d=x.findIndex((e=>e.name===r)),d>=0){const e=x[d];!s.hasDefault&&e.hasDefault&&e.includeInInit&&(s.hasDefault=!0,s.defaultValueExpression=e.defaultValueExpression,f=!0),x[d]=s}else x.push(s),d=x.length-1;if(!b&&I&&!a&&!f){const n=x.findIndex((e=>e.hasDefault&&e.includeInInit&&!e.isKeywordOnly));n>=0&&n<d&&e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassFieldWithDefault(),i)}}}}else{const a=i.getDeclarations();if(0===a.length)return;const r=a[a.length-1];if(1!==r.type)return;const s=r.node.parent;if(!s||3!==s.nodeType)return;if(9===s.rightExpression.nodeType){_(e.getTypeOfExpression(s.rightExpression.leftExpression,2).type,(null===(o=n.details.dataClassBehaviors)||void 0===o?void 0:o.fieldDescriptorNames)||[])&&e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassFieldWithoutAnnotation(),s.rightExpression)}}}})),n.details.dataClassEntries=A,D.forEach((e=>{e.entry.type=e.evaluator()}));const F=n.details.fields,E=[];a||i||(P&&(x.forEach((a=>{if(a.includeInInit){let i=a.type;if(a.classType!==n&&(0,v.requiresSpecialization)(i)){const e=new b.TypeVarContext((0,v.getTypeVarScopeId)(a.classType));(0,v.populateTypeVarContextForSelfType)(e,a.classType,n),i=(0,v.applySolvedTypeVars)(i,e)}if(i=function(e,t){if(!(0,T.isClassInstance)(t))return t;const n=(0,v.lookUpObjectMember)(t,"__set__");if(!n)return t;const a=e.getTypeOfMember(n);if(!(0,T.isFunction)(a))return t;const i=e.bindFunctionToClassOrObject(t,a);if(!i||!(0,T.isFunction)(i)||i.details.parameters.length<2)return t;return T.FunctionType.getEffectiveParameterType(i,1)}(e,i),a.converter){const n=i;i=function(e,t,n,a){var i;const r=function(e,t){if((0,T.isFunction)(t)||(0,T.isOverloadedFunction)(t))return t;if((0,T.isClassInstance)(t))return e.getBoundMethod(t,"__call__");if((0,T.isInstantiableClass)(t))return(0,u.createFunctionFromConstructor)(e,t);return}(e,e.getTypeOfExpression(t.valueExpression).type);if(!r)return n;const s=T.TypeVarType.createInstance("__converterInput");s.scopeId=(0,y.getScopeIdForNode)(t);const d=T.FunctionType.createSynthesizedInstance("");if(d.details.typeVarScopeId=s.scopeId,d.details.declaredReturnType=n,T.FunctionType.addParameter(d,{category:0,name:"__input",type:s,hasDeclaredType:!0}),T.FunctionType.addParameter(d,{category:0,name:"",type:T.UnknownType.create()}),(0,T.isFunction)(r)){const u=new b.TypeVarContext(s.scopeId),m=new o.DiagnosticAddendum;if(e.assignType(d,r,m,u)){return(0,v.applySolvedTypeVars)(s,u,{unknownIfNotFound:!0})}e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassConverterFunction().format({argType:e.printType(r),fieldType:e.printType(n),fieldName:a})+m.getString(),t,null!==(i=m.getEffectiveTextRange())&&void 0!==i?i:t)}else{const i=[],u=new o.DiagnosticAddendum;if(T.OverloadedFunctionType.getOverloads(r).forEach((t=>{const n=new b.TypeVarContext(s.scopeId);if(e.assignType(d,t,u,n)){const e=(0,v.applySolvedTypeVars)(s,n,{unknownIfNotFound:!0});i.push(e)}})),i.length>0)return(0,T.combineTypes)(i);e.addDiagnostic(c.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,l.DiagnosticRule.reportGeneralTypeIssues,p.Localizer.Diagnostic.dataClassConverterOverloads().format({funcName:r.overloads[0].details.name||"<anonymous function>",fieldType:e.printType(n),fieldName:a})+u.getString(),t)}return n}(e,a.converter,i,a.name),F.set(a.name,function(e,t,n,a,i,r){const s=(0,d.getFileInfo)(t),o=e.getBuiltInType(t,"type"),l=`__converterDescriptor_${a}`,p=T.ClassType.createInstantiable(l,(0,y.getClassFullName)(n,s.moduleName,l),s.moduleName,s.filePath,0,(0,y.getTypeSourceId)(n),void 0,(0,T.isInstantiableClass)(o)?o:T.UnknownType.create());p.details.baseClasses.push(e.getBuiltInType(t,"object")),(0,v.computeMroLinearization)(p);const c=p.details.fields,u=(0,v.synthesizeTypeVarForSelfCls)(p,!1),m=T.FunctionType.createSynthesizedInstance("__set__");T.FunctionType.addParameter(m,{category:0,name:"self",type:u,hasDeclaredType:!0}),T.FunctionType.addParameter(m,{category:0,name:"obj",type:T.AnyType.create(),hasDeclaredType:!0}),T.FunctionType.addParameter(m,{category:0,name:"value",type:r,hasDeclaredType:!0}),m.details.declaredReturnType=T.NoneType.createInstance();const g=h.Symbol.createWithType(4,m);c.set("__set__",g);const f=T.FunctionType.createSynthesizedInstance("__get__");T.FunctionType.addParameter(f,{category:0,name:"self",type:u,hasDeclaredType:!0}),T.FunctionType.addParameter(f,{category:0,name:"obj",type:T.AnyType.create(),hasDeclaredType:!0}),T.FunctionType.addParameter(f,{category:0,name:"objtype",type:T.AnyType.create(),hasDeclaredType:!0}),f.details.declaredReturnType=i;const b=h.Symbol.createWithType(4,f);return c.set("__get__",b),h.Symbol.createWithType(4,T.ClassType.cloneAsInstance(p))}(e,t,a.converter,a.name,n,i))}const r=a.alias||a.name;!a.alias&&a.nameNode&&(0,f.isPrivateName)(a.nameNode.value)&&e.addError(p.Localizer.Diagnostic.dataClassFieldWithPrivateName(),a.nameNode);const s={category:0,name:r,hasDefault:a.hasDefault,defaultValueExpression:a.defaultValueExpression,type:i,hasDeclaredType:!0};a.isKeywordOnly?E.push(s):T.FunctionType.addParameter(S,s)}})),E.length>0&&(T.FunctionType.addParameter(S,{category:1,type:T.AnyType.create()}),E.forEach((e=>{T.FunctionType.addParameter(S,e)})))),F.set("__init__",h.Symbol.createWithType(4,S)),F.set("__new__",h.Symbol.createWithType(4,k)));const z=e.getBuiltInType(t,"str"),M=e.getBuiltInType(t,"tuple");if(M&&(0,T.isInstantiableClass)(M)&&z&&(0,T.isInstantiableClass)(z)&&!F.has("__match_args__")){const e=[];x.forEach((t=>{t.includeInInit&&!t.isKeywordOnly&&e.push(t.name)}));const t=e.map((e=>({type:T.ClassType.cloneAsInstance(T.ClassType.cloneWithLiteral(z,e)),isUnbounded:!1}))),n=T.ClassType.cloneAsInstance((0,v.specializeTupleClass)(M,t));F.set("__match_args__",h.Symbol.createWithType(4,n))}const O=(n,a)=>{const i=T.FunctionType.createSynthesizedInstance(n);T.FunctionType.addParameter(i,w),T.FunctionType.addParameter(i,{category:0,name:"other",type:a,hasDeclaredType:!0}),i.details.declaredReturnType=e.getBuiltInObject(t,"bool"),F.get(n)||F.set(n,h.Symbol.createWithType(4,i))};if(T.ClassType.isSkipSynthesizedDataClassEq(n)||O("__eq__",e.getBuiltInObject(t,"object")),T.ClassType.isSynthesizedDataclassOrder(n)){const e=T.ClassType.cloneAsInstance(n);["__lt__","__le__","__gt__","__ge__"].forEach((t=>{O(t,e)}))}let V=!T.ClassType.isSkipSynthesizedDataClassEq(n)&&T.ClassType.isFrozenDataClass(n);const R=!T.ClassType.isSkipSynthesizedDataClassEq(n)&&!T.ClassType.isFrozenDataClass(n);if(r&&(V=!1),T.ClassType.isSynthesizeDataClassUnsafeHash(n)&&(V=!0),V){const n=T.FunctionType.createSynthesizedInstance("__hash__");T.FunctionType.addParameter(n,w),n.details.declaredReturnType=e.getBuiltInObject(t,"int"),F.set("__hash__",h.Symbol.createWithType(4100,n))}else R&&!r&&F.set("__hash__",h.Symbol.createWithType(4100,T.NoneType.createInstance()));let L=e.getBuiltInType(t,"dict");if((0,T.isInstantiableClass)(L)&&(L=T.ClassType.cloneAsInstance(T.ClassType.cloneForSpecialization(L,[e.getBuiltInObject(t,"str"),T.AnyType.create()],!0))),F.set("__dataclass_fields__",h.Symbol.createWithType(132,L)),T.ClassType.isGeneratedDataClassSlots(n)&&void 0===n.details.localSlotsNames&&(n.details.localSlotsNames=A.map((e=>e.name))),T.ClassType.isGeneratedDataClassSlots(n)){let n=null!==(I=e.getTypingType(t,"Iterable"))&&void 0!==I?I:T.UnknownType.create();(0,T.isInstantiableClass)(n)&&(n=T.ClassType.cloneAsInstance(T.ClassType.cloneForSpecialization(n,[e.getBuiltInObject(t,"str")],!0))),F.set("__slots__",h.Symbol.createWithType(132,n))}(0,m.updateNamedTupleBaseClass)(n,x.map((e=>e.type)),!0)&&(0,v.computeMroLinearization)(n)},t.validateDataClassTransformDecorator=function(e,t){const n={keywordOnlyParams:!1,generateEq:!0,generateOrder:!1,frozen:!1,fieldDescriptorNames:[]},a=c.getFileInfo(t);return t.arguments.forEach((t=>{if(t.name&&0===t.argumentCategory)switch(t.name.value){case"kw_only_default":{const i=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===i)return void e.addError(p.Localizer.Diagnostic.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.keywordOnlyParams=i;break}case"eq_default":{const i=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===i)return void e.addError(p.Localizer.Diagnostic.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.generateEq=i;break}case"order_default":{const i=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===i)return void e.addError(p.Localizer.Diagnostic.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.generateOrder=i;break}case"frozen_default":{const i=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===i)return void e.addError(p.Localizer.Diagnostic.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.frozen=i;break}case"field_descriptors":case"field_specifiers":{const a=e.getTypeOfExpression(t.valueExpression).type;if(!(0,T.isClassInstance)(a)||!T.ClassType.isBuiltIn(a,"tuple")||!a.tupleTypeArguments||a.tupleTypeArguments.some((e=>!(0,T.isInstantiableClass)(e.type)&&!(0,T.isFunction)(e.type)&&!(0,T.isOverloadedFunction)(e.type))))return void e.addError(p.Localizer.Diagnostic.dataClassTransformFieldSpecifier().format({type:e.printType(a)}),t.valueExpression);n.fieldDescriptorNames||(n.fieldDescriptorNames=[]),a.tupleTypeArguments.forEach((e=>{(0,T.isInstantiableClass)(e.type)||(0,T.isFunction)(e.type)?n.fieldDescriptorNames.push(e.type.details.fullName):(0,T.isOverloadedFunction)(e.type)&&n.fieldDescriptorNames.push(e.type.overloads[0].details.fullName)}));break}default:e.addError(p.Localizer.Diagnostic.dataClassTransformUnknownArgument().format({name:t.name.value}),t.valueExpression)}else e.addError(p.Localizer.Diagnostic.dataClassTransformPositionalParam(),t)})),n},t.getDataclassDecoratorBehaviors=function(e){var t;let n;if((0,T.isFunction)(e)?n=e:(0,T.isOverloadedFunction)(e)&&(n=null!==(t=e.overloads.find((e=>!!e.details.decoratorDataClassBehaviors)))&&void 0!==t?t:e.overloads[0]),n)return n.details.decoratorDataClassBehaviors?n.details.decoratorDataClassBehaviors:"dataclasses.dataclass"===n.details.fullName?{keywordOnlyParams:!1,generateEq:!0,generateOrder:!1,frozen:!1,fieldDescriptorNames:["dataclasses.field","dataclasses.Field"]}:void 0},t.applyDataClassClassBehaviorOverrides=C,t.applyDataClassDefaultBehaviors=k,t.applyDataClassDecorator=function(e,t,n,a,i){var r;k(n,a),C(e,t,n,null!==(r=null==i?void 0:i.arguments)&&void 0!==r?r:[],a)}},44660:(e,t)=>{function n(e){return 8===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.isUnresolvedAliasDeclaration=t.isIntrinsicDeclaration=t.isSpecialBuiltInClassDeclaration=t.isAliasDeclaration=t.isVariableDeclaration=t.isTypeAliasDeclaration=t.isTypeParameterDeclaration=t.isParameterDeclaration=t.isClassDeclaration=t.isFunctionDeclaration=t.UnresolvedModuleMarker=void 0,t.UnresolvedModuleMarker="*** unresolved ***",t.isFunctionDeclaration=function(e){return 5===e.type},t.isClassDeclaration=function(e){return 6===e.type},t.isParameterDeclaration=function(e){return 2===e.type},t.isTypeParameterDeclaration=function(e){return 3===e.type},t.isTypeAliasDeclaration=function(e){return 4===e.type},t.isVariableDeclaration=function(e){return 1===e.type},t.isAliasDeclaration=n,t.isSpecialBuiltInClassDeclaration=function(e){return 7===e.type},t.isIntrinsicDeclaration=function(e){return 0===e.type},t.isUnresolvedAliasDeclaration=function(e){return n(e)&&e.path===t.UnresolvedModuleMarker}},2848:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveAliasDeclaration=t.createSynthesizedAliasDeclaration=t.getDeclarationsWithUsesLocalNameRemoved=t.isDefinedInFile=t.getNameNodeForDeclaration=t.getNameFromDeclaration=t.areDeclarationsSame=t.hasTypeForDeclaration=void 0;const a=n(6698),i=n(44660),r=n(66455);t.hasTypeForDeclaration=function(e){switch(e.type){case 0:case 6:case 7:case 5:case 3:case 4:return!0;case 2:{if(e.node.typeAnnotation||e.node.typeAnnotationComment)return!0;const t=e.node.parent;if(28===(null==t?void 0:t.nodeType)&&t.functionAnnotationComment&&!t.functionAnnotationComment.isParamListEllipsis){const n=t.functionAnnotationComment.paramTypeAnnotations;return!(t.parameters.length>n.length&&e.node===t.parameters[0])}return!1}case 1:return!!e.typeAnnotationNode;case 8:return!1}},t.areDeclarationsSame=function(e,t,n=!1,a=!1){if(e.type!==t.type)return!1;if(e.path!==t.path)return!1;if(!(a&&8===e.type||e.range.start.line===t.range.start.line&&e.range.start.character===t.range.start.character))return!1;if(8===e.type&&8===t.type){if(e.symbolName!==t.symbolName||e.usesLocalName!==t.usesLocalName)return!1;if(n)return!0;if(e.firstNamePart!==t.firstNamePart)return!1}return!0},t.getNameFromDeclaration=function(e){var t;switch(e.type){case 8:return e.symbolName;case 6:case 5:case 3:return e.node.name.value;case 2:return null===(t=e.node.name)||void 0===t?void 0:t.value;case 1:return 38===e.node.nodeType?e.node.value:void 0;case 0:case 7:return}throw new Error("Shouldn't reach here")},t.getNameNodeForDeclaration=function(e){var t,n;switch(e.type){case 8:return 21===e.node.nodeType?null!==(t=e.node.alias)&&void 0!==t?t:e.node.module.nameParts[0]:23===e.node.nodeType?null!==(n=e.node.alias)&&void 0!==n?n:e.node.name:e.node.module.nameParts[0];case 6:case 5:case 3:case 2:return e.node.name;case 1:return 38===e.node.nodeType?e.node:void 0;case 0:case 7:return}throw new Error("Shouldn't reach here")},t.isDefinedInFile=function(e,t){var n;return(0,i.isAliasDeclaration)(e)?(null===(n=(0,r.getFileInfoFromNode)(e.node))||void 0===n?void 0:n.filePath)===t:e.path===t},t.getDeclarationsWithUsesLocalNameRemoved=function(e){return e.map((e=>{if(8!==e.type)return e;const t={...e};return t.usesLocalName=!1,t}))},t.createSynthesizedAliasDeclaration=function(e){return{type:8,node:void 0,path:e,loadSymbolsFromPath:!1,range:(0,a.getEmptyRange)(),implicitImports:new Map,usesLocalName:!1,moduleName:"",isInExceptSuite:!1}},t.resolveAliasDeclaration=function e(t,n,a){let i=n;const r=[];let s,o,l=!1,p=!1;for(;;){if(8!==i.type||!i.symbolName)return{declaration:i,isPrivate:l,privatePyTypedImported:s,privatePyTypedImporter:o};if(!a.resolveLocalNames&&i.usesLocalName)return{declaration:i,isPrivate:l,privatePyTypedImported:s,privatePyTypedImporter:o};let c;i.path&&i.loadSymbolsFromPath&&(c=t(i.path,{skipFileNeededCheck:a.skipFileNeededCheck}));const d=c?c.symbolTable.get(i.symbolName):void 0;if(!d){if(i.submoduleFallback){if(i.symbolName&&i.path&&8===i.submoduleFallback.type&&i.submoduleFallback.path){if(!t(i.submoduleFallback.path,{skipFileNeededCheck:a.skipFileNeededCheck,skipParsing:!0}))return}return e(t,i.submoduleFallback,a)}return i.isNativeLib?{declaration:void 0,isPrivate:l}:void 0}if(d.isPrivateMember()&&(l=!0),d.isExternallyHidden()&&!a.allowExternallyHiddenAccess)return;let u=d.getTypedDeclarations();if(u=u.filter((e=>!e.isInExceptSuite)),0===u.length&&(u=d.getDeclarations(),u=u.filter((e=>!e.isInExceptSuite))),0===u.length&&(u=d.getDeclarations()),0===u.length)return;const m=u.filter((e=>!r.includes(e)));if(i=m.length>0?m[m.length-1]:u[u.length-1],(null==c?void 0:c.isInPyTypedPackage)&&(p?d.isPrivatePyTypedImport()||(s=null!=s?s:null==i?void 0:i.moduleName):(d.isPrivatePyTypedImport()&&(o=null==i?void 0:i.moduleName),p=!0)),r.find((e=>e===i)))return i.path===n.path&&8===i.type&&i.submoduleFallback?e(t,i.submoduleFallback,a):{declaration:n,isPrivate:l,privatePyTypedImported:s,privatePyTypedImporter:o};r.push(i)}}},64891:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addOverloadsToFunctionType=t.applyClassDecorator=t.applyFunctionDecorator=t.getFunctionFlagsFromDecorators=void 0;const a=n(5284),i=n(28513),r=n(99661),s=n(21),o=n(5838),l=n(79282),p=n(33029),c=n(51458);function d(e,t,n){let a=(0,s.getFileInfo)(t).isStubFile?4:0;9!==t.expression.nodeType&&(a|=2);const i=e.getTypeOfExpression(t.expression,a);if((0,c.isFunction)(i.type)&&"type_check_only"===i.type.details.builtInName)return n;if((0,c.isInstantiableClass)(i.type)&&c.ClassType.isBuiltIn(i.type,"classmethod")&&(0,p.isProperty)(n))return n;const r=[{argumentCategory:0,typeResult:{type:n}}],o=e.validateCallArguments(t.expression,r,i,void 0,!0).returnType||c.UnknownType.create();return!(0,c.isFunction)(o)||o.details.declaredReturnType||o.details.parameters.some(((e,t)=>!(e.name&&!e.hasDeclaredType)||0===e.category&&(0!==t||!e.isTypeInferred)))?(0,p.isPartlyUnknown)(o)&&(0,c.isFunction)(i.type)&&!i.type.details.parameters.find((e=>void 0!==e.typeAnnotation))&&void 0===i.type.details.declaredReturnType?n:o:n}function u(e){return 9===e.expression.nodeType&&e.expression.arguments.length>0&&0===e.expression.arguments[0].argumentCategory&&48===e.expression.arguments[0].valueExpression.nodeType&&1===e.expression.arguments[0].valueExpression.strings.length?e.expression.arguments[0].valueExpression.strings[0].value:""}t.getFunctionFlagsFromDecorators=function(e,t,n){const a=(0,s.getFileInfo)(t);let i=0;if(n){"__new__"===t.name.value&&(i|=1);["__init_subclass__","__class_getitem__"].some((e=>t.name.value===e))&&(i|=2)}for(const r of t.decorators){let t=a.isStubFile?4:0;9!==r.expression.nodeType&&(t|=2);const s=e.getTypeOfExpression(r.expression,t).type;(0,c.isFunction)(s)?"abstractmethod"===s.details.builtInName?n&&(i|=8):"final"===s.details.builtInName?i|=8192:"override"===s.details.builtInName&&(i|=262144):(0,c.isInstantiableClass)(s)&&(c.ClassType.isBuiltIn(s,"staticmethod")?n&&(i|=4):c.ClassType.isBuiltIn(s,"classmethod")&&n&&(i|=2))}return i},t.applyFunctionDecorator=function(e,t,n,a,i){let r=(0,s.getFileInfo)(a).isStubFile?4:0;9!==a.expression.nodeType&&(r|=2);const m=e.getTypeOfExpression(a.expression,r).type;if(((0,c.isInstantiableClass)(m)&&c.ClassType.isSpecialBuiltIn(m,"overload")||(0,c.isFunction)(m)&&"overload"===m.details.builtInName)&&(0,c.isFunction)(t))return t.details.flags|=256,n.details.flags|=256,t;if(9===a.expression.nodeType){const i=e.getTypeOfExpression(a.expression.leftExpression,2|r).type;if((0,c.isFunction)(i)){if("__dataclass_transform__"===i.details.name||"dataclass_transform"===i.details.builtInName)return n.details.decoratorDataClassBehaviors=(0,o.validateDataClassTransformDecorator)(e,a.expression),t;if("deprecated"===i.details.builtInName)return n.details.deprecatedMessage=u(a),t}if((0,c.isOverloadedFunction)(i)&&i.overloads.length>0&&"deprecated"===i.overloads[0].details.builtInName)return n.details.deprecatedMessage=u(a),t}let y=d(e,a,t);if((0,c.isFunction)(m)){if("abstractmethod"===m.details.builtInName)return t;if("deprecated"===m.details.builtInName)return n.details.deprecatedMessage=u(a),t;if(35===a.expression.nodeType){const n=e.getTypeOfExpression(a.expression.leftExpression,2|r).type;if((0,p.isProperty)(n)){const r=a.expression.memberName.value;if("setter"===r)return(0,c.isFunction)(t)?((0,l.validatePropertyMethod)(e,t,a),(0,l.clonePropertyWithSetter)(e,n,t,i)):t;if("deleter"===r)return(0,c.isFunction)(t)?((0,l.validatePropertyMethod)(e,t,a),(0,l.clonePropertyWithDeleter)(e,n,t,i)):t}}}else if((0,c.isOverloadedFunction)(m)){if(m.overloads.length>0&&"deprecated"===m.overloads[0].details.builtInName)return n.details.deprecatedMessage=u(a),t}else if((0,c.isInstantiableClass)(m)){if(c.ClassType.isBuiltIn(m))switch(m.details.name){case"classmethod":case"staticmethod":{const e="classmethod"===m.details.name?2:4;if((0,c.isFunction)(t)&&0==(t.details.flags&e)){const n=c.FunctionType.clone(t);return n.details.flags&=-8,n.details.flags|=e,n}return t}}if(c.ClassType.isPropertyClass(m)){if((0,c.isFunction)(t))return(0,l.validatePropertyMethod)(e,t,a),(0,l.createProperty)(e,a,m,t);if((0,c.isClassInstance)(t)){const n=e.getBoundMethod(t,"__call__");return n&&(0,c.isFunction)(n)?(0,l.createProperty)(e,a,m,n):c.UnknownType.create()}}}return(0,c.isFunction)(t)&&(0,c.isFunction)(y)&&(y=c.FunctionType.clone(y),c.FunctionType.isOverloaded(t)&&(y.details.flags|=256),y.details.docString||(y.details.docString=t.details.docString)),y},t.applyClassDecorator=function(e,t,n,a){let i=(0,s.getFileInfo)(a).isStubFile?4:0;9!==a.expression.nodeType&&(i|=2);const r=e.getTypeOfExpression(a.expression,i).type;if(9===a.expression.nodeType){const r=e.getTypeOfExpression(a.expression.leftExpression,2|i).type;if((0,c.isFunction)(r))if("__dataclass_transform__"===r.details.name||"dataclass_transform"===r.details.builtInName)n.details.classDataClassTransform=(0,o.validateDataClassTransformDecorator)(e,a.expression);else if("deprecated"===r.details.builtInName)return n.details.deprecatedMessage=u(a),t;if((0,c.isOverloadedFunction)(r)&&r.overloads.length>0&&"deprecated"===r.overloads[0].details.builtInName)return n.details.deprecatedMessage=u(a),t}if((0,c.isOverloadedFunction)(r)){const i=(0,o.getDataclassDecoratorBehaviors)(r);if(i)return(0,o.applyDataClassDecorator)(e,a,n,i,void 0),t;if(r.overloads.length>0&&"deprecated"===r.overloads[0].details.builtInName)return n.details.deprecatedMessage=u(a),t}else if((0,c.isFunction)(r)){if("final"===r.details.builtInName)return n.details.flags|=4096,t;if("deprecated"===r.details.builtInName)return n.details.deprecatedMessage=u(a),t;if("runtime_checkable"===r.details.builtInName)return n.details.flags|=32768,t;let s,l;if(9===a.expression.nodeType){l=a.expression;const t=e.getTypeOfExpression(l.leftExpression,2|i).type;s=(0,o.getDataclassDecoratorBehaviors)(t)}else{const t=e.getTypeOfExpression(a.expression,i).type;s=(0,o.getDataclassDecoratorBehaviors)(t)}if(s)return(0,o.applyDataClassDecorator)(e,a,n,s,l),t}return d(e,a,t)},t.addOverloadsToFunctionType=function(e,t,n){let o;const l=(0,s.getDeclaration)(t);l&&(o=l);const p=e.lookUpSymbolRecursive(t,t.name.value,!1);if(p){const l=p.symbol.getDeclarations(),d=l.findIndex((e=>e===o));if(d>0){for(let t=0;t<d;t++){const n=l[t];5===n.type&&e.getTypeOfFunction(n.node)}let o=[];const p=l[d-1];if(5===p.type){const t=e.getTypeOfFunction(p.node);t&&((0,c.isFunction)(t.decoratedType)?c.FunctionType.isOverloaded(t.decoratedType)&&o.push(t.decoratedType):(0,c.isOverloadedFunction)(t.decoratedType)&&(0,a.appendArray)(o,t.decoratedType.overloads))}if(o.push(n),1===o.length)return o[0];const u=o.find((e=>!c.FunctionType.isOverloaded(e)));(null==u?void 0:u.details.docString)&&(o=o.map((e=>c.FunctionType.isOverloaded(e)&&!e.details.docString?c.FunctionType.cloneWithDocString(e,u.details.docString):e)));const m=c.OverloadedFunctionType.create(o),y=o[o.length-2];return c.FunctionType.isAbstractMethod(y)!==c.FunctionType.isAbstractMethod(n)&&e.addDiagnostic((0,s.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,r.Localizer.Diagnostic.overloadAbstractMismatch().format({name:t.name.value}),t.name),m}}return n}},67673:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDocStringToPlainText=t.convertDocStringToMarkdown=void 0;const a=n(91128);t.convertDocStringToMarkdown=function(e){return new E(e).convert()},t.convertDocStringToPlainText=function(e){const t=(0,a.cleanAndSplitDocString)(e),n=[];for(const e of t){const t=n.length>0?n[n.length-1]:void 0;M(e)&&M(t)||n.push(e)}return n.join("\n").trimEnd()};const i=/\S|$/,r=/\S/,s=/^\s*~~~+$/,o=/^\s*\+\+\++$/,l=/^\s*===+\s+===+$/,p=/^\s*---+\s+---+$/,c=/^(\s*)-\s/,d=/^(\s*)\*\s/,u=/^(\s*)\d+\.\s/,m=/^(\s+\* )(.*)$/,y=/^\s*\.\. /,g=/^\s*\.\.\s+(\w+)::\s*(.*)$/,h=/ *>>> /,f=/^\s*:(param|arg|type|return|rtype|raise|except|var|ivar|cvar|copyright|license)/,T=/^\.[\s\t]+(@\w)/gm,v=/^(\.\s{3})|^(\.)/,b=[{exp:/^\s*=+(\s+=+)+$/,replacement:"="},{exp:/^\s*-+(\s+-+)+$/,replacement:"-"},{exp:/^\s*~+(\s+-+)+$/,replacement:"~"},{exp:/^\s*\++(\s+\++)+$/,replacement:"+"}],_=/\s/g,I=/``/g,C=/~/g,k=/\+/g,S=/(?<!\\)([_*~[\]])/g,w=/(\[.*\]\(.*\))/g,A=/^\s*(?<block>`{3}(?!`)|~{3}(?!~))(\w*)/,x=/^\s*(?<block>`{3}(?!`)|~{3}(?!~))/,P=[{exp:/</g,replacement:"&lt;"},{exp:/>/g,replacement:"&gt;"}],D="  \n",N=/^\s*::$/,F=[{exp:/\s+::$/g,replacement:""},{exp:/(\S)\s*::$/g,replacement:"$1:"},{exp:/:[\w_\-+:.]+:`/g,replacement:"`"},{exp:/`:[\w_\-+:.]+:/g,replacement:"`"}];class E{constructor(e){this._builder="",this._skipAppendEmptyLine=!0,this._insideInlineCode=!1,this._appendDirectiveBlock=!1,this._stateStack=[],this._lineNum=0,this._blockIndent=0,this._state=this._parseText,this._input=e,this._lines=(0,a.cleanAndSplitDocString)(e)}convert(){for(T.test(this._input)&&(this._lines=this._lines.map((e=>e.replace(v,""))));void 0!==this._currentLineOrUndefined();){const e=this._state,t=this._lineNum;if(this._state(),this._state===e&&this._lineNum===t)break}return this._state===this._parseBacktickBlock||this._state===this._parseDocTest||this._state===this._parseLiteralBlock?this._trimOutputAndAppendLine(this._lastBacktickString||"```"):this._insideInlineCode&&this._trimOutputAndAppendLine("`",!0),this._builder.trim()}_eatLine(){this._lineNum++}_currentLineOrUndefined(){return this._lineNum<this._lines.length?this._lines[this._lineNum]:void 0}_currentLine(){return this._currentLineOrUndefined()||""}_currentIndent(){return z(this._currentLine())}_prevIndent(){var e;return z(null!==(e=this._lineAt(this._lineNum-1))&&void 0!==e?e:"")}_lineAt(e){return e<this._lines.length?this._lines[e]:void 0}_nextBlockIndent(){return z(this._lines.slice(this._lineNum+1).find((e=>!M(e)))||"")}_currentLineIsOutsideBlock(){return this._currentIndent()<this._blockIndent}_currentLineWithinBlock(){return this._currentLine().substr(this._blockIndent)}_pushAndSetState(e){this._state===this._parseText&&(this._insideInlineCode=!1),this._stateStack.push(this._state),this._state=e}_popState(){this._state=this._stateStack.splice(0,1)[0],this._state===this._parseText&&(this._insideInlineCode=!1)}_parseText(){if(M(this._currentLineOrUndefined()))return void(this._state=this._parseEmpty);if(this._beginBacktickBlock())return;if(this._beginLiteralBlock())return;if(this._beginDocTest())return;if(this._beginDirective())return;if(this._beginList())return;if(this._beginFieldList())return;if(this._beginTableBlock())return;const e=this._formatPlainTextIndent(this._currentLine());this._appendTextLine(e),this._eatLine()}_formatPlainTextIndent(e){const t=this._lineAt(this._lineNum-1),n=this._prevIndent(),a=this._currentIndent();return!(a>n)||M(t)||this._builder.endsWith(D)||this._builder.endsWith("\n\n")||O(t)||(this._builder=this._builder.slice(0,-1)+D),n>a&&!M(t)&&!this._builder.endsWith(D)&&!this._builder.endsWith("\n\n")&&(this._builder=this._builder.slice(0,-1)+D),e=0===n||this._builder.endsWith(D)||this._builder.endsWith("\n\n")?this._convertIndent(e):e.trimStart()}_convertIndent(e){return e=e.replace(/^([ \t]+)(.+)$/g,((e,t,n)=>"&nbsp;".repeat(t.length)+n))}_escapeHtml(e){return P.forEach((t=>{e=e.replace(t.exp,t.replacement)})),e}_appendTextLine(e){const t=(e=this._preprocessTextLine(e)).split("`");for(let e=0;e<t.length;e++){let n=t[e];if(e>0&&(this._insideInlineCode=!this._insideInlineCode,this._append("`")),this._insideInlineCode){this._append(n);continue}if(n=this._escapeHtml(n),0===e){if(1===t.length){for(const e of b)if(e.exp.test(n)){n=n.replace(_,e.replacement);break}if(s.test(n)){this._append(n.replace(C,"-"));continue}if(o.test(n)){this._append(n.replace(k,"-"));continue}}const e=m.exec(n);null!==e&&3===e.length&&(this._append(e[1]),n=e[2])}n.split(w).forEach((e=>{w.test(e)?this._append(e):this._append(e.replace(S,"\\$1"))}))}this._builder+="\n"}_preprocessTextLine(e){return N.test(e)?"":(F.forEach((t=>e=e.replace(t.exp,t.replacement))),e=e.replace(I,"`"))}_parseEmpty(){if(M(this._currentLineOrUndefined()))return this._appendLine(),void this._eatLine();this._state=this._parseText}_beginMinIndentCodeBlock(e){this._appendLine("```"),this._pushAndSetState(e),this._blockIndent=this._currentIndent()}_beginBacktickBlock(){const e=this._currentLine().match(A);return null!==e&&(this._blockIndent=this._currentIndent(),this._lastBacktickString=e[1],this._appendLine(e[1]+e[2]),this._pushAndSetState(this._parseBacktickBlock),this._eatLine(),!0)}_parseBacktickBlock(){if(x.test(this._currentLine())&&this._currentIndent()===this._blockIndent){const e=this._currentLine().match(x);this._lastBacktickString=e?e[1]:"```",this._appendLine(this._lastBacktickString),this._appendLine(),this._popState()}else this._appendLine(this._currentLine());this._eatLine()}_beginDocTest(){return!!h.test(this._currentLine())&&(this._beginMinIndentCodeBlock(this._parseDocTest),this._appendLine(this._currentLineWithinBlock()),this._eatLine(),!0)}_parseDocTest(){if(this._currentLineIsOutsideBlock()||M(this._currentLine()))return this._trimOutputAndAppendLine("```"),this._appendLine(),void this._popState();this._appendLine(this._currentLineWithinBlock()),this._eatLine()}_beginLiteralBlock(){const e=this._lineAt(this._lineNum-1);if(void 0===e)return!1;if(!M(e))return!1;let t=this._lineNum-2;for(;t>=0;t--){const e=this._lineAt(t);if(!M(e)){if(e.endsWith("::"))break;return!1}}return!(t<0)&&(0===this._currentIndent()?(this._appendLine("```"),this._pushAndSetState(this._parseLiteralBlockSingleLine),!0):(this._beginMinIndentCodeBlock(this._parseLiteralBlock),!0))}_parseLiteralBlock(){if(M(this._currentLineOrUndefined()))return this._appendLine(),void this._eatLine();const e=this._lineAt(this._lineNum-1);if(this._currentLineIsOutsideBlock()&&M(e))return this._trimOutputAndAppendLine("```"),this._appendLine(),void this._popState();this._appendLine(this._currentLine()),this._eatLine()}_parseLiteralBlockSingleLine(){this._appendLine(this._currentLine()),this._appendLine("```"),this._appendLine(),this._popState(),this._eatLine()}_beginDirective(){return!!y.test(this._currentLine())&&(this._pushAndSetState(this._parseDirective),this._blockIndent=this._nextBlockIndent(),this._appendDirectiveBlock=!1,!0)}_beginFieldList(){if(this._insideInlineCode)return!1;let e=this._currentLine();if(e.startsWith("@"))return this._appendLine(),this._appendTextLine(e),this._eatLine(),!0;const t=!(null==e?void 0:e.endsWith(":"))&&!(null==e?void 0:e.endsWith("::"))&&!!e.match(/^\s*.*?\w+(\s*\(.*?\))*\s*:\s*\w+/g),n=f.test(e);if(t||n){const t=this._lineAt(this._lineNum-1);return this._builder.endsWith(D)||this._builder.endsWith("\n\n")||O(t)||(this._builder=this._builder.slice(0,-1)+D),e=this._convertIndent(e),this._appendTextLine(e),this._eatLine(),!0}return!1}_beginTableBlock(){if(this._insideInlineCode)return!1;const e=this._currentLine();return!!l.test(e)&&(this._tableState={header:e.trimStart(),inHeader:!0},this._eatLine(),this._pushAndSetState(this._parseTableBlock),!0)}_parseTableBlock(){if(M(this._currentLineOrUndefined())||!this._tableState)return this._tableState=void 0,void this._popState();let e=this._currentLine();if(l.test(e))return this._eatLine(),this._appendLine("\n<br/>\n"),this._popState(),void(this._tableState=void 0);{let t="|";const n=this._tableState.header.split(" "),a=[];if(this._tableState.inHeader){do{let t=0;for(let i=0;i<n.length;i++){const r=n[i].length+1,s=e.slice(t,t+r);void 0===a[i]?a[i]=`${s} `:a[i]=a[i].concat(`<br>${s} `),t+=r}this._eatLine(),e=this._currentLine()}while(!M(this._currentLineOrUndefined())&&!p.test(e)&&!l.test(e));this._tableState.inHeader=!1,a.forEach((e=>{t+=`${e}|`})),this._appendLine(t);const i=e.trimStart().replace(/=/g,"-").replace(" ","|");this._appendLine(`|${i}|`),this._eatLine()}else{let a=0;n.forEach((n=>{const i=n.length+1,r=e.slice(a,a+i);t+=`${r}|`,a+=i})),this._appendLine(t),this._eatLine()}}}_beginList(){if(this._insideInlineCode)return!1;let e=this._currentLine();const t=c.exec(e);if(2===(null==t?void 0:t.length))return t[1].length>=4&&(e=" ".repeat(t[1].length/2)+e.trimLeft()),this._appendTextLine(e),this._eatLine(),this._state!==this._parseList&&this._pushAndSetState(this._parseList),!0;const n=d.exec(e);if(2===(null==n?void 0:n.length))return 0===n[1].length?e=e=" "+e:n[1].length>=4&&(e=" ".repeat(n[1].length/2)+e.trimLeft()),this._appendTextLine(e),this._eatLine(),this._state!==this._parseList&&this._pushAndSetState(this._parseList),!0;const a=u.exec(e);return 2===(null==a?void 0:a.length)&&(this._appendTextLine(e),this._eatLine(),!0)}_parseList(){if(M(this._currentLineOrUndefined())||this._currentLineIsOutsideBlock())return void this._popState();if(!this._beginList()){const e=this._currentLine().trimStart();this._appendTextLine(e),this._eatLine()}}_parseDirective(){const e=g.exec(this._currentLine());if(null!==e&&3===e.length){const t=e[1],n=e[2];"class"===t&&(this._appendDirectiveBlock=!0,this._appendLine(),this._appendLine("```"),this._appendLine(n),this._appendLine("```"),this._appendLine())}0===this._blockIndent?this._popState():this._state=this._parseDirectiveBlock,this._eatLine()}_parseDirectiveBlock(){M(this._currentLineOrUndefined())||!this._currentLineIsOutsideBlock()?(this._appendDirectiveBlock&&this._appendTextLine(this._currentLine().trimLeft()),this._eatLine()):this._popState()}_appendLine(e){M(e)?this._skipAppendEmptyLine||(this._builder+="\n",this._skipAppendEmptyLine=!0):(this._builder+=e+"\n",this._skipAppendEmptyLine=!1)}_append(e){this._builder+=e,this._skipAppendEmptyLine=!1}_trimOutputAndAppendLine(e,t=!1){this._builder=this._builder.trimRight(),this._skipAppendEmptyLine=!1,t||this._appendLine(),this._appendLine(e)}}function z(e){return e.search(i)}function M(e){return void 0===e||!r.test(e)}function O(e){var t,n;return void 0!==e&&(null!==(n=null===(t=e.match(/^\s*[#`~=-]{3,}/))||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0}},91128:(e,t)=>{function n(e){const t=e.replace(/\r/g,"").replace(/\t/g,"        ").split("\n");let n=Number.MAX_VALUE;t.forEach(((e,a)=>{if(t.length<=1||a>0){const t=e.trimLeft();t&&(n=Math.min(n,e.length-t.length))}})),n>=Number.MAX_VALUE&&(n=0);const a=[];for(t.forEach(((e,t)=>{0===t?a.push(e.trim()):a.push(e.substr(n).trimRight())}));a.length>0&&0===a[0].length;)a.shift();for(;a.length>0&&0===a[a.length-1].length;)a.pop();return a}Object.defineProperty(t,"__esModule",{value:!0}),t.extractParameterDocumentation=t.cleanAndSplitDocString=t.cleanDocString=void 0,t.cleanDocString=function(e){return n(e).join("\n")},t.cleanAndSplitDocString=n,t.extractParameterDocumentation=function(e,t){if(!e||!t)return;const a=n(e);for(const e of a){const n=e.trim();let a=n.indexOf("@param "+t);if(a>=0)return n.substr(a+7);if(a=n.indexOf(":param "+t),a>=0)return n.substr(a+7);if(a=n.indexOf(t+": "),a>=0)return n.substr(a);if(a=n.indexOf(t+" ("),a>=0)return n.substr(a)}}},92814:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEnumAutoValueType=t.getTypeOfEnumMember=t.isDeclInEnumClass=t.transformTypeForPossibleEnumClass=t.createEnumType=t.isKnownEnumType=void 0;const a=n(30795),i=n(21),r=n(66455),s=n(16682),o=n(48466),l=n(36906),p=n(33029),c=n(51458);t.isKnownEnumType=function(e){return["Enum","IntEnum","StrEnum","Flag","IntFlag"].some((t=>t===e))},t.createEnumType=function(e,t,n,a){const o=(0,i.getFileInfo)(t);if(0===a.length)return;const l=a[0];if(0!==l.argumentCategory||!l.valueExpression||48!==l.valueExpression.nodeType||1!==l.valueExpression.strings.length||49!==l.valueExpression.strings[0].nodeType)return;const d=l.valueExpression.strings.map((e=>e.value)).join(""),u=c.ClassType.createInstantiable(d,(0,r.getClassFullName)(t,o.moduleName,d),o.moduleName,o.filePath,1048576,(0,r.getTypeSourceId)(t),void 0,n.details.effectiveMetaclass);u.details.baseClasses.push(n),(0,p.computeMroLinearization)(u);const m=u.details.fields;if(m.set("__class__",s.Symbol.createWithType(68,u)),a.length<2)return;const y=a[1];if(0!==y.argumentCategory||!y.valueExpression)return;const g=e.getBuiltInType(t,"int");if(!g||!(0,c.isInstantiableClass)(g))return;const h=c.ClassType.cloneAsInstance(u);if(48===y.valueExpression.nodeType){if(!y.valueExpression.strings.every((e=>49===e.nodeType)))return;const e=y.valueExpression.strings.map((e=>e.value)).join("").trim().split(/[\s,]+/);for(const[t,n]of e.entries()){if(!n)return;const e=c.ClassType.cloneWithLiteral(c.ClassType.cloneAsInstance(g),t+1),a=new c.EnumLiteral(u.details.fullName,u.details.name,n,e),i=s.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,a));m.set(n,i)}return u}if(31===y.valueExpression.nodeType||52===y.valueExpression.nodeType){const t=31===y.valueExpression.nodeType?y.valueExpression.entries:y.valueExpression.expressions;if(0===t.length)return;let n=!1;for(const[a,i]of t.entries()){let t,r;if(0===a&&(n=48===i.nodeType),48===i.nodeType){if(!n)return;t=i,r=c.ClassType.cloneWithLiteral(c.ClassType.cloneAsInstance(g),a+1)}else{if(52!==i.nodeType)return;if(n)return;if(2!==i.expressions.length)return;t=i.expressions[0],r=e.getTypeOfExpression(i.expressions[1]).type}if(48!==t.nodeType||1!==t.strings.length||49!==t.strings[0].nodeType)return;const o=t.strings[0].value,l=new c.EnumLiteral(u.details.fullName,u.details.name,o,r),p=s.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,l));m.set(o,p)}}if(15===y.valueExpression.nodeType){const t=y.valueExpression.entries;if(0===t.length)return;for(const n of t){if(17!==n.nodeType)return;const t=n.keyExpression,a=e.getTypeOfExpression(n.valueExpression).type;if(48!==t.nodeType||1!==t.strings.length||49!==t.strings[0].nodeType)return;const i=t.strings[0].value,r=new c.EnumLiteral(u.details.fullName,u.details.name,i,a),o=s.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,r));m.set(i,o)}}return u},t.transformTypeForPossibleEnumClass=function(e,t,n){var a,s,l;const d=(0,r.getEnclosingClass)(t,!0);if(!d)return;const u=e.getTypeOfClass(d);if(!u||!c.ClassType.isEnumClass(u.classType))return;let m=!1,y=!1;const g=(0,r.getParentNodeOfType)(t,3);let h;if(g&&(0,r.isNodeContainedWithin)(t,g.leftExpression)?(m=!0,(0,r.getParentNodeOfType)(t,52)&&(y=!0)):(0,i.getFileInfo)(t).isStubFile&&54===(null===(a=t.parent)||void 0===a?void 0:a.nodeType)&&t.parent.valueExpression===t&&(m=!0),(0,o.isSingleDunderName)(t.value)&&(m=!1),"name"!==t.value&&"value"!==t.value||(m=!1),(0,p.lookUpClassMember)(u.classType,"__new__",2)?h=c.AnyType.create():(h=n(),y&&(h=null!==(l=null===(s=e.getTypeOfIterator({type:h},!1,void 0))||void 0===s?void 0:s.type)&&void 0!==l?l:c.UnknownType.create())),(0,c.isClassInstance)(h)&&h.details.fields.get("__get__")&&(m=!1),m){const e=new c.EnumLiteral(u.classType.details.fullName,u.classType.details.name,t.value,h);return c.ClassType.cloneAsInstance(c.ClassType.cloneWithLiteral(u.classType,e))}},t.isDeclInEnumClass=function(e,t){const n=(0,r.getEnclosingClass)(t.node,!0);if(!n)return!1;const a=e.getTypeOfClass(n);return!!a&&c.ClassType.isEnumClass(a.classType)},t.getTypeOfEnumMember=function(e,t,n,i,r){if(!c.ClassType.isEnumClass(n))return;const s=n.literalValue;if("name"===i||"_name_"===i){const i=e.getBuiltInType(t,"str");if(!(0,c.isInstantiableClass)(i))return;const o=e=>c.ClassType.cloneAsInstance(c.ClassType.cloneWithLiteral(i,e.itemName));if(s)return(0,a.assert)(s instanceof c.EnumLiteral),{type:o(s),isIncomplete:r};const p=(0,l.enumerateLiteralsForType)(e,n);if(p&&p.length>0)return{type:(0,c.combineTypes)(p.map((e=>{const t=e.literalValue;return(0,a.assert)(t instanceof c.EnumLiteral),o(t)}))),isIncomplete:r}}if("value"===i||"_value_"===i){const t=n.details.effectiveMetaclass;if(t&&(0,c.isClass)(t)&&!c.ClassType.isBuiltIn(t))return{type:c.AnyType.create(),isIncomplete:r};if(s)return(0,a.assert)(s instanceof c.EnumLiteral),{type:s.itemType,isIncomplete:r};const i=(0,l.enumerateLiteralsForType)(e,n);if(i&&i.length>0)return{type:(0,c.combineTypes)(i.map((e=>{const t=e.literalValue;return(0,a.assert)(t instanceof c.EnumLiteral),t.itemType}))),isIncomplete:r}}},t.getEnumAutoValueType=function(e,t){const n=(0,r.getEnclosingClass)(t);if(n){const a=e.getTypeOfClass(n);if(a){const n=e.getTypeOfObjectMember(t,c.ClassType.cloneAsInstance(a.classType),"_generate_next_value_");if(n&&(0,c.isFunction)(n.type)&&n.classType&&(0,c.isClass)(n.classType)&&!c.ClassType.isBuiltIn(n.classType,"Enum")&&n.type.details.declaredReturnType)return n.type.details.declaredReturnType}}return e.getBuiltInObject(t,"int")}},19948:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyFunctionTransform=void 0;const a=n(28513),i=n(99661),r=n(21),s=n(16682),o=n(51458),l=n(33029);t.applyFunctionTransform=function(e,t,n,p,c){return(0,o.isFunction)(p)&&"functools.total_ordering"===p.details.fullName?function(e,t,n,p){var c;if(1!==n.length)return p;const d=null===(c=n[0].typeResult)||void 0===c?void 0:c.type;if(!d||!(0,o.isInstantiableClass)(d)||d.includeSubclasses)return p;const u=["__lt__","__le__","__gt__","__ge__"],m=o.ClassType.cloneAsInstance(d);let y;const g=u.filter((e=>{const t=(0,l.lookUpObjectMember)(m,e,8);return t&&!y&&(y=t),!t}));if(!y)return e.addDiagnostic((0,r.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,a.DiagnosticRule.reportGeneralTypeIssues,i.Localizer.Diagnostic.totalOrderingMissingMethod(),t),p;let h;const f=e.getTypeOfMember(y);(0,o.isFunction)(f)&&f.details.parameters.length>=2&&f.details.parameters[1].hasDeclaredType&&(h=f.details.parameters[1].type);if(!h){const n=e.getBuiltInObject(t,"object");if(!n||!(0,o.isClassInstance)(n))return p;h=n}const T=e.getBuiltInObject(t,"bool");if(!T||!(0,o.isClassInstance)(T))return p;const v={category:0,name:"self",type:(0,l.synthesizeTypeVarForSelfCls)(d,!1),hasDeclaredType:!0},b={category:0,name:"__value",type:h,hasDeclaredType:!0};return g.forEach((e=>{const t=o.FunctionType.createSynthesizedInstance(e);o.FunctionType.addParameter(t,v),o.FunctionType.addParameter(t,b),t.details.declaredReturnType=T,d.details.fields.set(e,s.Symbol.createWithType(4,t))})),p}(e,t,n,c):c}},24161:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImportResolver=t.supportedFileExtensions=t.supportedSourceFileExtensions=t.createImportedModuleDescriptor=void 0;const s=n(5284),o=n(59750),l=n(15813),p=n(81844),c=n(86513),d=r(n(92828)),u=n(92828),m=n(60628),y=n(74188),g=n(87710),h=n(20533),f=n(41097),T=r(n(24873)),v=r(n(48466)),b=n(48466);t.createImportedModuleDescriptor=function(e){if(0===e.length)return{leadingDots:0,nameParts:[],importedSymbols:new Set};let t=0,n=0;for(;t<e.length&&"."===e[t];t++)n++;return{leadingDots:n,nameParts:e.slice(t).split("."),importedSymbols:new Set}};const _=[".pyd",".so",".dylib"];t.supportedSourceFileExtensions=[".py",".pyi"],t.supportedFileExtensions=[...t.supportedSourceFileExtensions,..._];t.ImportResolver=class{constructor(e,t,n){this.fileSystem=e,this._configOptions=t,this.host=n,this._cachedImportResults=new Map,this._cachedModuleNameResults=new Map,this._cachedEntriesForPath=new Map,this.cachedParentImportResults=new h.ParentDirectoryCache((()=>this.getPythonSearchPaths([])))}invalidateCache(){this._cachedImportResults=new Map,this._cachedModuleNameResults=new Map,this.cachedParentImportResults.reset(),this._stdlibModules=void 0,this._invalidateFileSystemCache(),y.SupportPartialStubs.is(this.fileSystem)&&this.fileSystem.clearPartialStubs()}resolveImport(e,t,n){return this.resolveImportInternal(e,t,n)}getCompletionSuggestions(e,t,n){const a=this._getCompletionSuggestionsStrict(e,t,n);if(n.leadingDots>0)return a;const i=this.getParentImportResolutionRoot(e,t.root);let r=(0,p.ensureTrailingDirectorySeparator)((0,p.getDirectoryPath)((0,p.normalizePathCase)(this.fileSystem,(0,p.normalizePath)(e))));for(;this._shouldWalkUp(r,i,t);){let i;if(this._getCompletionSuggestionsAbsolute(e,t,r,n,a,!1),[i,r]=this._tryWalkUp(r),!i)break}return a}getConfigOptions(){return this._configOptions}setConfigOptions(e){this._configOptions=e,this.invalidateCache()}getSourceFilesFromStub(e,t,n){const a=[];if(this._cachedImportResults.forEach((t=>{t.forEach((t=>{if(t.isStubFile&&t.isImportFound&&t.nonStubImportResult&&t.resolvedPaths[t.resolvedPaths.length-1]===e&&t.nonStubImportResult.isImportFound){const e=t.nonStubImportResult.resolvedPaths[t.nonStubImportResult.resolvedPaths.length-1];(e.endsWith(".py")||e.endsWith(".pyi"))&&a.push(e)}}))})),0===a.length){const t=(0,p.changeAnyExtension)(e,".py");this.dirExistsCached(t)&&a.push(t)}if(0===a.length){const n=this.getImportRoots(t),i=[];for(const t of n)if((0,p.containsPath)(t,e,!0)){const n=(0,p.getRelativePathComponentsFromDirectory)(t,e,!0);if(n.length>1){n[1].endsWith(l.stubsSuffix)&&(n[1]=n[1].substr(0,n[1].length-l.stubsSuffix.length));const e=(0,p.combinePathComponents)(n);e&&i.push(e)}}for(const e of i)for(const t of n){const n=(0,p.resolvePaths)(t,e);let i=(0,p.changeAnyExtension)(n,".py");if(this.fileExistsCached(i))a.push(i);else{const e=(0,p.stripFileExtension)(i);e.endsWith("__init__")?(i=e.substr(0,e.length-9)+".py",this.fileExistsCached(i)&&a.push(i)):(i=(0,p.combinePaths)(e,"__init__.py"),this.fileExistsCached(i)&&a.push(i))}}}return a}getModuleNameForImport(e,t,n=!1){const a=(0,s.getOrAdd)(this._cachedModuleNameResults,t.root,(()=>new Map));return(0,s.getOrAdd)(a,e,(()=>this._getModuleNameForImport(e,t,n)))}getTypeshedStdLibPath(e){return this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,[])}getTypeshedThirdPartyPath(e){return this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,[])}isStdlibModule(e,t){return this._stdlibModules||(this._stdlibModules=this._buildStdlibCache(this.getTypeshedStdLibPath(t))),this._stdlibModules.has(e.nameParts.join("."))}getImportRoots(e,t=!1){const n=[],a=[],i=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,n);if(i&&a.push(i),e.root&&a.push(e.root),(0,s.appendArray)(a,e.extraPaths),this._configOptions.stubPath&&a.push(this._configOptions.stubPath),t){const e=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,n);e&&a.push((0,p.combinePaths)(e,"..."))}else{const e=this._getThirdPartyTypeshedPackageRoots(n);(0,s.appendArray)(a,e)}const r=this.getTypeshedPathEx(e,n);r&&a.push(r);const o=this.getPythonSearchPaths(n);return o.length>0&&(0,s.appendArray)(a,o),a}ensurePartialStubPackages(e){if(!y.SupportPartialStubs.is(this.fileSystem))return!1;if(this.fileSystem.isPartialStubPackagesScanned(e))return!1;const t=this.fileSystem,n=[],a=[],i=this.getTypeshedPathEx(e,n);return r(this._configOptions.stubPath),r(e.root),e.extraPaths.forEach((e=>r(e))),r(i),this.getPythonSearchPaths(n).forEach((e=>r(e))),this.fileSystem.processPartialStubPackages(a,this.getImportRoots(e),i),this._invalidateFileSystemCache(),!0;function r(e){e&&!t.isPathScanned(e)&&a.push(e)}}getPythonSearchPaths(e){if(!this._cachedPythonSearchPaths){const e=[],t=(T.findPythonSearchPaths(this.fileSystem,this._configOptions,this.host,e)||[]).map((e=>this.fileSystem.realCasePath(e)));this._cachedPythonSearchPaths={paths:Array.from(new Set(t)),failureInfo:e}}return e.push(...this._cachedPythonSearchPaths.failureInfo),this._cachedPythonSearchPaths.paths}getTypeshedStdlibExcludeList(e,t){const n=this._getStdlibTypeshedPath(e,t,[]),a=[];return n?(this._cachedTypeshedStdLibModuleVersions||(this._cachedTypeshedStdLibModuleVersions=this._readTypeshedStdLibVersions(e,[])),this._cachedTypeshedStdLibModuleVersions.forEach(((e,i)=>{if(void 0!==e.max&&t>e.max){const e=(0,p.combinePaths)(n,...i.split("."));a.push(e);const t=e+".pyi";a.push(t)}})),a):a}readdirEntriesCached(e){const t=this._cachedEntriesForPath.get(e);if(t)return t;let n;try{n=this.fileSystem.readdirEntriesSync(e)}catch{n=[]}return this._cachedEntriesForPath.set(e,n),n}resolveImportInternal(e,t,n){const a=this.formatImportName(n),i=this._resolveImportStrict(a,e,t,n,[]);if(i.isImportFound||n.leadingDots>0)return i;e=(0,p.normalizePathCase)(this.fileSystem,(0,p.normalizePath)(e));const r=(0,p.ensureTrailingDirectorySeparator)((0,p.getDirectoryPath)(e)),s=this.cachedParentImportResults.getImportResult(r,a,i);if(s)return this.filterImplicitImports(s,n.importedSymbols);const o=this.getParentImportResolutionRoot(e,t.root);if(!this.cachedParentImportResults.checkValidPath(this.fileSystem,e,o))return i;const l={importPath:void 0};let c=r;for(;this._shouldWalkUp(c,o,t);){const i=this.resolveAbsoluteImport(e,c,t,n,a,[],void 0,void 0,!1,!0);if(this.cachedParentImportResults.checked(c,a,l),i.isImportFound)return l.importPath=c,this.cachedParentImportResults.add({importResult:i,path:c,importName:a}),this.filterImplicitImports(i,n.importedSymbols);let r;if([r,c]=this._tryWalkUp(c),!r)break}return this.cachedParentImportResults.checked(c,a,l),i}fileExistsCached(e){var t,n;const a=this._splitPath(e);if(!a[0]||!a[1])return!!this.fileSystem.existsSync(e)&&(null!==(n=null===(t=(0,p.tryStat)(this.fileSystem,e))||void 0===t?void 0:t.isFile())&&void 0!==n&&n);const i=this.readdirEntriesCached(a[0]).find((e=>e.name===a[1]));if(null==i?void 0:i.isFile())return!0;if(null==i?void 0:i.isSymbolicLink()){const t=(0,p.tryRealpath)(this.fileSystem,e);if(t&&this.fileSystem.existsSync(t)&&(0,p.isFile)(this.fileSystem,t))return!0}return!1}dirExistsCached(e){var t,n;const a=this._splitPath(e);if(!a[0]||!a[1])return!!this.fileSystem.existsSync(e)&&(null!==(n=null===(t=(0,p.tryStat)(this.fileSystem,e))||void 0===t?void 0:t.isDirectory())&&void 0!==n&&n);const i=this.readdirEntriesCached(a[0]).find((e=>e.name===a[1]));if(null==i?void 0:i.isDirectory())return!0;if(null==i?void 0:i.isSymbolicLink()){const t=(0,p.tryRealpath)(this.fileSystem,e);if(t&&this.fileSystem.existsSync(t)&&(0,p.isDirectory)(this.fileSystem,t))return!0}return!1}addResultsToCache(e,t,n,a,i,r){const o=i&&i.leadingDots>0?e:"";return(0,s.getOrAdd)(this._cachedImportResults,t.root,(()=>new Map)).set(this._getImportCacheKey(o,n,r),a),this.filterImplicitImports(a,null==i?void 0:i.importedSymbols)}resolveAbsoluteImport(e,t,n,a,i,r,s=!1,o=!1,l=!1,p=!0,c=!1){if(p&&l){const e=this._resolveAbsoluteImport(t,n,a,i,r,s,!1,!0,!0,!0);if(e.packageDirectory&&(!e.isNamespacePackage||e.isImportFound))return e}return this._resolveAbsoluteImport(t,n,a,i,r,s,o,!1,p,c)}getTypeshedPathEx(e,t){}resolveImportEx(e,t,n,a,i=[],r=!0){}resolveNativeImportEx(e,t,n=[]){}getNativeModuleName(e){const t=(0,p.getFileExtension)(e,!1).toLowerCase();if(this._isNativeModuleFileExtension(t))return(0,p.stripFileExtension)((0,p.stripFileExtension)(e))}getModuleNameFromPath(e,t,n=!1){const a=this.getModuleNameInfoFromPath(e,t,n);if(a&&!a.containsInvalidCharacters)return a.moduleName}getModuleNameInfoFromPath(e,t,n=!1){e=(0,p.ensureTrailingDirectorySeparator)(e);let a=(0,p.stripFileExtension)(t);if(this._isNativeModuleFileExtension((0,p.getFileExtension)(t))&&(a=(0,p.stripFileExtension)(a)),!a.startsWith(e))return;a.endsWith("__init__")&&(a=a.substr(0,a.length-9));const i=a.substr(e.length),r=(0,p.getPathComponents)(i);if(r.shift(),n){if(0===r.length)return;r.shift()}if(0===r.length)return;r[0].endsWith(l.stubsSuffix)&&(r[0]=r[0].substr(0,r[0].length-l.stubsSuffix.length));const s=r.some((e=>!this._isIdentifier(e)));return{moduleName:r.join("."),containsInvalidCharacters:s}}filterImplicitImports(e,t){if(void 0===t){const t=Object.assign({},e);return t.filteredImplicitImports=new Map,t}if(0===t.size)return e;if(0===e.implicitImports.size)return e;const n=new Map;if(e.implicitImports.forEach((e=>{t.has(e.name)&&n.set(e.name,e)})),n.size===e.implicitImports.size)return e;const a=Object.assign({},e);return a.filteredImplicitImports=n,a}formatImportName(e){return".".repeat(e.leadingDots)+e.nameParts.join(".")}getParentImportResolutionRoot(e,t){return t?(0,p.ensureTrailingDirectorySeparator)((0,p.normalizePathCase)(this.fileSystem,(0,p.normalizePath)(t))):(0,p.ensureTrailingDirectorySeparator)((0,p.getDirectoryPath)(e))}_resolveImportStrict(e,t,n,a,i){const r=(0,o.matchFileSpecs)(this._configOptions,t),s={importName:e,isRelative:!1,isImportFound:!1,isPartlyResolved:!1,isNamespacePackage:!1,isInitFilePresent:!1,isStubPackage:!1,importFailureInfo:i,resolvedPaths:[],importType:2,isStubFile:!1,isNativeLib:!1,implicitImports:new Map,filteredImplicitImports:new Map,nonStubImportResult:void 0};if(this.ensurePartialStubPackages(n),a.leadingDots>0){const s=this._lookUpResultsInCache(t,n,e,a,r);if(s)return s;const o=this._resolveRelativeImport(t,n,a,e,i);if(o)return o.isRelative=!0,this.addResultsToCache(t,n,e,o,a,r)}else{const i=this._lookUpResultsInCache(t,n,e,a,r);if(i){if(!(i.isImportFound&&i.isNamespacePackage&&!this._isNamespacePackageResolved(a,i.implicitImports)))return i}const o=this._resolveBestAbsoluteImport(t,n,a,!0);if(o)return o.isStubFile&&(o.nonStubImportResult=this._resolveBestAbsoluteImport(t,n,a,!1)||s),this.addResultsToCache(t,n,e,o,a,r)}return this.addResultsToCache(t,n,e,s,void 0,r)}_getCompletionSuggestionsStrict(e,t,n){const a=[],i=new Map;if(n.leadingDots>0)this._getCompletionSuggestionsRelative(e,t,n,i);else{n.nameParts.length>0&&this._getCompletionSuggestionsTypeshedPath(e,t,n,!0,i),t.root&&this._getCompletionSuggestionsAbsolute(e,t,t.root,n,i);for(const a of t.extraPaths)this._getCompletionSuggestionsAbsolute(e,t,a,n,i);this._configOptions.stubPath&&this._getCompletionSuggestionsAbsolute(e,t,this._configOptions.stubPath,n,i),this._getCompletionSuggestionsTypeshedPath(e,t,n,!1,i);const r=this.getPythonSearchPaths(a);for(const a of r)this._getCompletionSuggestionsAbsolute(e,t,a,n,i)}return i}_getModuleNameForImport(e,t,n){let a,i=0,r=!1;const s=[];let o;const l=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,t.pythonVersion,s);if(l&&(a=this.getModuleNameFromPath(l,e),a)){const e={leadingDots:0,nameParts:a.split("."),importedSymbols:void 0};if(this._isStdlibTypeshedStubValidForVersion(e,this._configOptions.typeshedPath,t.pythonVersion,[]))return{moduleName:a,importType:i,isLocalTypingsFile:r}}if(t.root){const n=this.getModuleNameInfoFromPath(t.root,e);n&&(n.containsInvalidCharacters?o=n.moduleName:a=n.moduleName),i=2}for(const n of t.extraPaths){const t=this.getModuleNameInfoFromPath(n,e);if(t)if(t.containsInvalidCharacters)o=t.moduleName;else{const e=t.moduleName;(!a||e&&e.length<a.length)&&(a=e,i=2)}}if(this._configOptions.stubPath){const t=this.getModuleNameInfoFromPath(this._configOptions.stubPath,e);if(t)if(t.containsInvalidCharacters)o=t.moduleName;else{const e=t.moduleName;(!a||e&&e.length<a.length)&&(a=e,i=2,r=!0)}}const p=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,s);if(p){const t=this.getModuleNameFromPath(p,e,!0);(!a||t&&t.length<a.length)&&(a=t,i=1)}const c=this.getTypeshedPathEx(t,s);if(c){const t=this.getModuleNameFromPath(c,e);(!a||t&&t.length<a.length)&&(a=t,i=1)}const d=this.getPythonSearchPaths(s);for(const t of d){const n=this.getModuleNameInfoFromPath(t,e);if(n)if(n.containsInvalidCharacters)o=n.moduleName;else{const e=n.moduleName;(!a||e&&e.length<a.length)&&(a=e,i=1)}}return a?{moduleName:a,importType:i,isLocalTypingsFile:r}:n&&o?{moduleName:o,importType:i,isLocalTypingsFile:r}:{moduleName:"",importType:2,isLocalTypingsFile:r}}_invalidateFileSystemCache(){this._cachedEntriesForPath.clear()}_splitPath(e){const t=(0,p.getPathComponents)(e);if(t.length<=1)return[e,""];return[(0,p.combinePathComponents)(t.slice(0,-1)),t[t.length-1]]}_resolveAbsoluteImport(e,t,n,a,i,r,s,o,c,d){o?i.push(`Attempting to resolve stub package using root path '${e}'`):i.push(`Attempting to resolve using root path '${e}'`);const u=[];let m,y,g,h=e,T=!1,v=!1,b=!1,_=!1,I=!1,C=new Map;if(0===n.nameParts.length){const e="__init__",t=(0,p.combinePaths)(h,e+".py"),n=(0,p.combinePaths)(h,e+".pyi");c&&this.fileExistsCached(n)?(i.push(`Resolved import with file '${n}'`),u.push(n),_=!0):this.fileExistsCached(t)?(i.push(`Resolved import with file '${t}'`),u.push(t)):(i.push(`Partially resolved import with directory '${h}'`),u.push(""),T=!0),C=this._findImplicitImports(a,h,[t,n])}else for(let e=0;e<n.nameParts.length;e++){const r=0===e,g=e===n.nameParts.length-1;h=(0,p.combinePaths)(h,n.nameParts[e]),o&&r&&(h+=l.stubsSuffix,b=!0);const k=this.dirExistsCached(h);if(k){r&&(m=h);const e="__init__",t=(0,p.combinePaths)(h,e+".py"),a=(0,p.combinePaths)(h,e+".pyi");if(v=!1,c&&this.fileExistsCached(a)?(i.push(`Resolved import with file '${a}'`),u.push(a),g&&(_=!0),v=!0):this.fileExistsCached(t)&&(i.push(`Resolved import with file '${t}'`),u.push(t),v=!0),!y&&d&&this.fileExistsCached((0,p.combinePaths)(h,"py.typed"))&&(y=(0,f.getPyTypedInfo)(this.fileSystem,h)),!g){v||(u.push(""),T=!0,y=void 0);continue}if(v){C=this._findImplicitImports(n.nameParts.join("."),h,[t,a]);break}}let S=(0,p.stripTrailingDirectorySeparator)(h);const w=(0,p.getFileName)(S);S=(0,p.getDirectoryPath)(S);const A=(0,p.combinePaths)(S,w+".py"),x=(0,p.combinePaths)(S,w+".pyi");if(c&&this.fileExistsCached(x))i.push(`Resolved import with file '${x}'`),u.push(x),g&&(_=!0);else if(this.fileExistsCached(A))i.push(`Resolved import with file '${A}'`),u.push(A);else{if(s&&this.dirExistsCached(S)){const e=this._getFilesInDirectory(S).find((e=>this._isNativeModuleFileName(w,e)));if(e){const r=(0,p.combinePaths)(S,e);I=this._resolveNativeModuleStub(r,t,a,n,i,u)}}!I&&k?(i.push(`Partially resolved import with directory '${h}'`),u.push(""),g&&(C=this._findImplicitImports(a,h,[A,x]),T=!0)):I&&i.push(`Did not find file '${x}' or '${A}'`)}break}const k=u.length>0&&u.length<n.nameParts.length;return g=r?u.length>0:u.length>=n.nameParts.length,{importName:a,isRelative:!1,isNamespacePackage:T,isInitFilePresent:v,isStubPackage:b,isImportFound:g,isPartlyResolved:k,importFailureInfo:i,importType:2,resolvedPaths:u,searchPath:e,isStubFile:_,isNativeLib:I,implicitImports:C,pyTypedInfo:y,filteredImplicitImports:C,packageDirectory:m}}_getImportCacheKey(e,t,n){return`${e}-${t}-${n}`}_lookUpResultsInCache(e,t,n,a,i){const r=this._cachedImportResults.get(t.root);if(!r)return;const s=a.leadingDots>0?e:"",o=r.get(this._getImportCacheKey(s,n,i));return o?this.filterImplicitImports(o,a.importedSymbols):void 0}_isNamespacePackageResolved(e,t){if(e.importedSymbols){if(!Array.from(e.importedSymbols.keys()).some((e=>t.has(e))))return!1}else if(0===t.size)return!1;return!0}_resolveBestAbsoluteImport(e,t,n,a){const i=this.formatImportName(n),r=[];if(a&&this._configOptions.stubPath){r.push(`Looking in stubPath '${this._configOptions.stubPath}'`);const s=this.resolveAbsoluteImport(e,this._configOptions.stubPath,t,n,i,r,void 0,!1,!0,a,!1);if(s.isImportFound){if(s.importType=2,s.isLocalTypingsFile=!0,!s.isNamespacePackage||s.resolvedPaths[s.resolvedPaths.length-1])return s;if(this._isNamespacePackageResolved(n,s.implicitImports))return s}}let s,o;t.root&&(r.push(`Looking in root directory of execution environment '${t.root}'`),o=this.resolveAbsoluteImport(e,t.root,t,n,i,r,void 0,!0,!0,a,!1),s=o);for(const l of t.extraPaths)r.push(`Looking in extraPath '${l}'`),o=this.resolveAbsoluteImport(e,l,t,n,i,r,void 0,!0,!0,a,!1),s=this._pickBestImport(s,o,n);const l=this.getPythonSearchPaths(r);if(l.length>0)for(const o of l){r.push(`Looking in python search path '${o}'`);const l=this.resolveAbsoluteImport(e,o,t,n,i,r,false,!0,!0,a,!0);l&&(l.importType=1,s=this._pickBestImport(s,l,n))}else r.push("No python interpreter search path");if(t.root!==this._getTypeshedRoot(this._configOptions.typeshedPath,r)&&(null==s?void 0:s.pyTypedInfo)&&!s.isPartlyResolved)return s;const p=this.resolveImportEx(e,t,n,i,r,a);if(p)return p;if(a&&n.nameParts.length>0){r.push("Looking for typeshed stdlib path");const e=this._findTypeshedPath(t,n,i,!0,r);if(e)return e.isStdlibTypeshedFile=!0,e;r.push("Looking for typeshed third-party path");const a=this._findTypeshedPath(t,n,i,!1,r);a&&(a.isThirdPartyTypeshedFile=!0,s=this._pickBestImport(s,a,n))}return s}_pickBestImport(e,t,n){if(!e)return t;if(!t)return e;if(t.isImportFound){const a=e.resolvedPaths.findIndex((e=>!!e)),i=t.resolvedPaths.findIndex((e=>!!e));if(a!==i)return a<0?t:i<0||a<i?e:t;if(!e.isImportFound)return t;if(e.isNamespacePackage&&t.isNamespacePackage&&n.importedSymbols&&!this._isNamespacePackageResolved(n,e.implicitImports)){if(this._isNamespacePackageResolved(n,t.implicitImports))return t;if(e.isInitFilePresent&&!t.isInitFilePresent)return e;if(!e.isInitFilePresent&&t.isInitFilePresent)return t}if(e.pyTypedInfo&&!t.pyTypedInfo)return e;if(!e.pyTypedInfo&&t.pyTypedInfo)return t;if(e.isStubFile&&!t.isStubFile)return e;if(!e.isStubFile&&t.isStubFile)return t;if(e.resolvedPaths.length>t.resolvedPaths.length)return t}else if(t.isPartlyResolved){const n=e.resolvedPaths.findIndex((e=>!!e)),a=t.resolvedPaths.findIndex((e=>!!e));if(n!==a)return n<0?t:a<0||n<a?e:t}return e}_isIdentifier(e){for(let t=0;t<e.length;t++)if(0===t?!(0,m.isIdentifierStartChar)(e.charCodeAt(t)):!(0,m.isIdentifierChar)(e.charCodeAt(t)))return!1;return!0}_findTypeshedPath(e,t,n,a,i){let r;if(i.push(`Looking for typeshed ${a?T.stdLibFolderName:T.thirdPartyFolderName} path`),a){const n=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,i,t);n&&(r=[n])}else r=this._getThirdPartyTypeshedPackagePaths(t,i);if(r)for(const s of r)if(this.dirExistsCached(s)){const r=this.resolveAbsoluteImport(void 0,s,e,t,n,i);if(r.isImportFound)return r.importType=a?0:1,r}i.push("Typeshed path not found")}_buildStdlibCache(e){const t=new Set;if(e){const n=(e,a)=>{this.readdirEntriesCached(e).forEach((i=>{if(i.isDirectory()){const t=(0,p.combinePaths)(e,i.name);n(t,a?`${a}.${i.name}`:i.name)}else if(i.name.includes(".py")){const e=(0,p.stripFileExtension)(i.name);e.startsWith("_")||t.add(a?`${a}.${e}`:e)}}))};n(e,void 0)}return t}_buildTypeshedThirdPartyPackageMap(e){this._cachedTypeshedThirdPartyPackagePaths=new Map,e&&this.readdirEntriesCached(e).forEach((t=>{if(t.isDirectory()){const n=(0,p.combinePaths)(e,t.name);this.readdirEntriesCached(n).forEach((e=>{if("@python2"!==e.name)if(e.isDirectory()){const t=this._cachedTypeshedThirdPartyPackagePaths.get(e.name);t?t.push(n):this._cachedTypeshedThirdPartyPackagePaths.set(e.name,[n])}else if(e.isFile()&&e.name.endsWith(".pyi")){const t=(0,p.stripFileExtension)(e.name),a=this._cachedTypeshedThirdPartyPackagePaths.get(t);a?a.push(n):this._cachedTypeshedThirdPartyPackagePaths.set(t,[n])}}))}}));const t=Array.from(this._cachedTypeshedThirdPartyPackagePaths.values()).flatMap((e=>e));this._cachedTypeshedThirdPartyPackageRoots=Array.from(new Set(t)).sort()}_getCompletionSuggestionsTypeshedPath(e,t,n,a,i){const r=[];let s;if(a){const e=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,t.pythonVersion,r,n);e&&(s=[e])}else{s=this._getThirdPartyTypeshedPackagePaths(n,r,!1);const e=this.getTypeshedPathEx(t,r);e&&(s=null!=s?s:[],s.push(e))}s&&s.forEach((a=>{this.dirExistsCached(a)&&this._getCompletionSuggestionsAbsolute(e,t,a,n,i)}))}_getStdlibTypeshedPath(e,t,n,a){const i=this._getTypeshedSubdirectory(!0,e,n);if(!i||!a||this._isStdlibTypeshedStubValidForVersion(a,e,t,n))return i}_getThirdPartyTypeshedPath(e,t){return this._getTypeshedSubdirectory(!1,e,t)}_isStdlibTypeshedStubValidForVersion(e,t,n,a){this._cachedTypeshedStdLibModuleVersions||(this._cachedTypeshedStdLibModuleVersions=this._readTypeshedStdLibVersions(t,a));for(let t=1;t<=e.nameParts.length;t++){const a=e.nameParts.slice(0,t),i=this._cachedTypeshedStdLibModuleVersions.get(a.join("."));if(i){if(n<i.min)return!1;if(void 0!==i.max&&n>i.max)return!1}}return!0}_readTypeshedStdLibVersions(e,t){const n=new Map,a=this._getTypeshedSubdirectory(!0,e,t);if(a){const e=(0,p.combinePaths)(a,"VERSIONS");try{const a=this.fileSystem.statSync(e);if(a.size>0&&a.size<262144){this.fileSystem.readFileSync(e,"utf8").split(/\r?\n/).forEach((e=>{const t=e.split("#")[0].split(":");if(2!==t.length)return;const a=t[1].split("-");if(a.length>2)return;const i=t[0].trim();if(!i)return;let r=a[0].trim();r.endsWith("+")&&(r=r.substr(0,r.length-1));let s,o=(0,c.versionFromString)(r);o||(o=c.PythonVersion.V3_0),a.length>1&&(s=(0,c.versionFromString)(a[1].trim())),n.set(i,{min:o,max:s})}))}else t.push("Typeshed stdlib VERSIONS file is unexpectedly large")}catch(e){t.push(`Could not read typeshed stdlib VERSIONS file: '${JSON.stringify(e)}'`)}}return n}_getThirdPartyTypeshedPackagePaths(e,t,n=!0){const a=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,t);this._cachedTypeshedThirdPartyPackagePaths||this._buildTypeshedThirdPartyPackageMap(a);const i=e.nameParts.length>0?e.nameParts[0]:"";return n?this._cachedTypeshedThirdPartyPackagePaths.get(i):i?(0,s.flatten)((0,s.getMapValues)(this._cachedTypeshedThirdPartyPackagePaths,(e=>e.startsWith(i)))):[]}_getThirdPartyTypeshedPackageRoots(e){const t=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,e);return this._cachedTypeshedThirdPartyPackagePaths||this._buildTypeshedThirdPartyPackageMap(t),this._cachedTypeshedThirdPartyPackageRoots}_getTypeshedRoot(e,t){if(void 0!==this._cachedTypeshedRoot)return this._cachedTypeshedRoot;let n="";return e&&this.dirExistsCached(e)&&(n=e),n||(n=T.getTypeShedFallbackPath(this.fileSystem)||""),this._cachedTypeshedRoot=n,n}_getTypeshedSubdirectory(e,t,n){if(e){if(void 0!==this._cachedTypeshedStdLibPath)return this._cachedTypeshedStdLibPath}else if(void 0!==this._cachedTypeshedThirdPartyPath)return this._cachedTypeshedThirdPartyPath;let a=this._getTypeshedRoot(t,n);if(a=T.getTypeshedSubdirectory(a,e),this.dirExistsCached(a))return e?this._cachedTypeshedStdLibPath=a:this._cachedTypeshedThirdPartyPath=a,a}_resolveRelativeImport(e,t,n,a,i){i.push("Attempting to resolve relative import");const r=(0,g.getDirectoryLeadingDotsPointsTo)((0,p.getDirectoryPath)(e),n.leadingDots);if(!r)return void i.push(`Invalid relative path '${a}'`);const s=this.resolveAbsoluteImport(e,r,t,n,a,i,!1,!0);return s&&s.isStubFile&&(s.nonStubImportResult=this.resolveAbsoluteImport(e,r,t,n,a,i,!1,!0,!1,!1)||{importName:a,isRelative:!0,isImportFound:!1,isPartlyResolved:!1,isNamespacePackage:!1,isStubPackage:!1,importFailureInfo:i,resolvedPaths:[],importType:2,isStubFile:!1,isNativeLib:!1,implicitImports:[],filteredImplicitImports:[],nonStubImportResult:void 0}),s}_getCompletionSuggestionsRelative(e,t,n,a){const i=(0,g.getDirectoryLeadingDotsPointsTo)((0,p.getDirectoryPath)(e),n.leadingDots);i&&this._getCompletionSuggestionsAbsolute(e,t,i,n,a)}_getFilesInDirectory(e){const t=this.readdirEntriesCached(e),n=t.filter((e=>e.isFile())).map((e=>e.name));return t.forEach((t=>{var a;const i=(0,p.combinePaths)(e,t.name);t.isSymbolicLink()&&(null===(a=(0,p.tryStat)(this.fileSystem,i))||void 0===a?void 0:a.isFile())&&n.push(t.name)})),n}_getCompletionSuggestionsAbsolute(e,t,n,a,i,r=!0){let s=n;const o=a.nameParts.map((e=>e));a.hasTrailingDot&&o.push("");const l=a.leadingDots,c=o.slice(0,-1);if(0===o.length)this._addFilteredSuggestionsAbsolute(e,t,s,"",i,l,c,r);else for(let n=0;n<o.length&&(n===o.length-1&&this._addFilteredSuggestionsAbsolute(e,t,s,o[n],i,l,c,r),s=(0,p.combinePaths)(s,o[n]),this.dirExistsCached(s));n++);}_addFilteredSuggestionsAbsolute(e,n,a,i,r,s,o,l){const c=(0,p.getFileSystemEntriesFromDirEntries)(this.readdirEntriesCached(a),this.fileSystem,a);c.files.forEach((c=>{const u=(0,p.getFileExtension)(c,!1).toLowerCase(),m=(0,p.stripFileExtension)(c,!0);if(t.supportedFileExtensions.some((e=>e===u))){if("__init__"===m)return;if(i&&!d.isPatternInSymbol(i,m))return;if(!this._isUniqueValidSuggestion(m,r)||!this._isResolvableSuggestion(m,s,o,e,n,l))return;r.set(m,(0,p.combinePaths)(a,c))}})),c.directories.forEach((t=>{if(i&&!t.startsWith(i))return;if(!this._isUniqueValidSuggestion(t,r)||!this._isResolvableSuggestion(t,s,o,e,n,l))return;const c=(0,p.combinePaths)(a,t,"__init__.pyi");if(this.fileExistsCached(c))return void r.set(t,c);const d=(0,p.combinePaths)(a,t,"__init__.py");this.fileExistsCached(d)?r.set(t,d):r.set(t,"")}))}_isResolvableSuggestion(e,t,n,a,i,r){const s={leadingDots:t,nameParts:[...n,e],importedSymbols:new Set};let o;if(r){const e=this.formatImportName(s),t=[];o=this._resolveImportStrict(e,a,i,s,t)}else o=this.resolveImportInternal(a,i,s);return!(!o||!o.isImportFound||v.isPrivateOrProtectedName(e)&&void 0!==o.pyTypedInfo)}_isUniqueValidSuggestion(e,t){return!t.has(e)&&(!/[.-]/.test(e)&&(!(0,b.isDunderName)(e)||"__future__"===e))}_findImplicitImports(e,t,n){const a=new Map,i=(0,p.getFileSystemEntriesFromDirEntries)(this.readdirEntriesCached(t),this.fileSystem,t);for(const r of i.files){const i=(0,p.getFileExtension)(r);let s,o=!1;if(".py"===i||".pyi"===i)s=(0,p.stripFileExtension)(r);else{if(!this._isNativeModuleFileExtension(i)||this.fileExistsCached(`${r}.py`)||this.fileExistsCached(`${r}.pyi`))continue;s=r.substr(0,r.indexOf(".")),o=!0}const l=(0,p.combinePaths)(t,r);if(!n.find((e=>e===l))){const n={isStubFile:r.endsWith(".pyi"),isNativeLib:o,name:s,path:l},i=a.get(n.name);if(!i||!i.isStubFile){if(o){const a=(0,p.combinePaths)(t,r),i=this.resolveNativeImportEx(a,`${e}.${s}`,[]);i&&(n.path=i,n.isNativeLib=!1)}a.set(n.name,n)}}}for(const e of i.directories){const i=(0,p.combinePaths)(t,e,"__init__.py"),r=i+"i";let s=!1,o="";if(this.fileExistsCached(r)?(s=!0,o=r):this.fileExistsCached(i)&&(o=i),o&&!n.find((e=>e===o))){const n={isStubFile:s,isNativeLib:!1,name:e,path:o,pyTypedInfo:(0,f.getPyTypedInfo)(this.fileSystem,(0,p.combinePaths)(t,e))};a.set(n.name,n)}}return a}_resolveNativeModuleStub(e,t,n,a,i,r){let s=n;if(a.leadingDots>0){const n=this.getModuleNameForImport(e,t);s=n.moduleName.length>0?n.moduleName:s}const o=this.resolveNativeImportEx(e,s,i);return o?(i.push(`Resolved native import ${n} with stub '${o}'`),r.push(o),!1):(i.push(`Resolved import with file '${e}'`),r.push(e),!0)}_isNativeModuleFileName(e,t){const n=(0,p.getFileExtension)(t,!1).toLowerCase(),a=(0,p.stripFileExtension)(t,!0);return this._isNativeModuleFileExtension(n)&&(0,u.equateStringsCaseInsensitive)(e,a)}_isNativeModuleFileExtension(e){return _.some((t=>t===e))}_tryWalkUp(e){return(0,p.isDiskPathRoot)(e)?[!1,""]:[!0,(0,p.ensureTrailingDirectorySeparator)((0,p.normalizePathCase)(this.fileSystem,(0,p.normalizePath)((0,p.combinePaths)(e,".."))))]}_shouldWalkUp(e,t,n){return e.length>t.length||e===t&&!n.root}}},87710:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.haveSameParentModule=t.getResolvedFilePath=t.getDirectoryLeadingDotsPointsTo=t.getRelativeModuleName=t.getTextRangeForImportNameDeletion=t.getImportGroupFromModuleNameAndType=t.getAllImportNames=t.getContainingImportStatement=t.getTextEditsForAutoImportInsertion=t.getTextEditsForAutoImportInsertions=t.getTextEditsForAutoImportSymbolAddition=t.getTopLevelImports=t.compareImportStatements=t.getImportGroup=void 0;const s=n(88711),o=n(5284),l=n(81844),p=n(96541),c=n(92828),d=n(6698),u=r(n(21)),m=r(n(48466));function y(e){return e.importResult?0===e.importResult.importType?0:1===e.importResult.importType||e.importResult.isLocalTypingsFile?1:e.importResult.isRelative?3:2:2}function g(e){return m.isConstantName(e)?0:m.isTypeAliasName(e)?1:2}function h(e,t){const n=g(e)-g(t);if(0!==n)return n;const a=e.replace(/_/g,"="),i=t.replace(/_/g,"=");return(0,c.compareStringsCaseSensitive)(a,i)}function f(e,t,n,a){let i;for(const t of n.imports){if(h(t.name.value,e)>0)break;i=t}let r=!1,s="";if(n.imports.length>0){const e=(0,p.convertOffsetToPosition)(n.start,a.tokenizerOutput.lines),t=(0,p.convertOffsetToPosition)(n.imports[0].start,a.tokenizerOutput.lines),i=n.imports.length>1?(0,p.convertOffsetToPosition)(n.imports[1].start,a.tokenizerOutput.lines):void 0;if(t.line>e.line&&(void 0===i||i.line>t.line)){const e=a.tokenizerOutput.lines.getItemAt(t.line);s=a.text.substr(e.start,t.character),/^\s*$/.test(s)&&(r=!0)}}const o=i?d.TextRange.getEnd(i):n.imports.length>0?n.imports[0].start:n.start+n.length,l=(0,p.convertOffsetToPosition)(o,a.tokenizerOutput.lines),c=t?`${e} as ${t}`:`${e}`;let u;if(r){const e=a.tokenizerOutput.predominantEndOfLineSequence;u=i?`,${e}${s}${c}`:`${c},${e}${s}`}else u=i?`, ${c}`:`${c}, `;return{range:{start:l,end:l},importName:e,replacementText:u}}function T(e,t){if(t.length<2)return t.map((e=>i(e)));const n=[...(0,o.createMapFromItems)(t,(e=>`${e.importGroup} ${d.Range.print(e.range)}`))].sort(((e,t)=>(0,c.compareStringsCaseSensitive)(e[0],t[0]))).map((e=>e[1])),a=[];for(const t of n)1===t.length?a.push(i(t[0])):a.push({range:t[0].range,replacementText:t[0].preChange+t.map((e=>e.importStatement)).sort(((e,t)=>r(e,t))).join(e.tokenizerOutput.predominantEndOfLineSequence)+t[0].postChange});return a;function i(e){return{range:e.range,replacementText:e.preChange+e.importStatement+e.postChange}}function r(e,t){const n=e.startsWith("import");return n===t.startsWith("import")?e<t?-1:1:n?-1:1}}function v(e,t,n,a,i,r){const s=[];0===(e=Array.isArray(e)?e:[e]).length&&e.push({});const l=(0,o.createMapFromItems)(e,(e=>e.name?"from":"import")),c=l.get("import");c&&g(c,(e=>`import ${e.join(", ")}`));const u=l.get("from");return u&&g(u,(e=>{var n;return`from ${null!==(n=t.nameForImportFrom)&&void 0!==n?n:t.name} import ${e.join(", ")}`})),s;function g(e,l){const c=e.map((e=>function(e,t){const n=e.name?e.name:t;return{sortText:n,text:e.alias?`${n} as ${e.alias}`:n}}(e,t.name))).sort(((e,t)=>h(e.sortText,t.sortText))).reduce(((e,t)=>(0,o.addIfUnique)(e,t.text)),[]);s.push(function(e,t,n,a,i,r){let s,o="",l="";const c=(0,p.convertPositionToOffset)(r,i.tokenizerOutput.lines);if(t.orderedImports.length>0&&c>t.orderedImports[0].node.start){let e=!0,r=t.orderedImports[0],c=0;for(const s of t.orderedImports){const l=s.importResult?y(s):c;if(a<l){!e&&c<a&&(o=i.tokenizerOutput.predominantEndOfLineSequence+o);break}if(a===l&&s.moduleName>n)break;if(s.followsNonImportStatement){a>c&&(o=i.tokenizerOutput.predominantEndOfLineSequence+o);break}s===t.orderedImports[t.orderedImports.length-1]&&a>l&&(o=i.tokenizerOutput.predominantEndOfLineSequence+o),e=!e&&a<c&&a===l,c=l,r=s}r?(e?l+=i.tokenizerOutput.predominantEndOfLineSequence:o=i.tokenizerOutput.predominantEndOfLineSequence+o,s=(0,p.convertOffsetToPosition)(e?r.node.start:d.TextRange.getEnd(r.node),i.tokenizerOutput.lines)):s={line:0,character:0}}else{s={line:0,character:0};let e=!1;for(const t of i.parseTree.statements){let n=!0;if(47===t.nodeType&&1===t.statements.length){const e=t.statements[0];(48===e.nodeType||3===e.nodeType&&38===e.leftExpression.nodeType&&m.isDunderName(e.leftExpression.value))&&(n=!1)}if(n){s=(0,p.convertOffsetToPosition)(t.start,i.tokenizerOutput.lines),e=!1;break}s=(0,p.convertOffsetToPosition)(t.start+t.length,i.tokenizerOutput.lines),e=!0}l=l+i.tokenizerOutput.predominantEndOfLineSequence+i.tokenizerOutput.predominantEndOfLineSequence,e?o=i.tokenizerOutput.predominantEndOfLineSequence+o:l+=i.tokenizerOutput.predominantEndOfLineSequence}return{range:{start:s,end:s},preChange:o,importStatement:e,postChange:l,importGroup:a}}(l(c),n,t.name,a,i,r))}}function b(e){let t="";for(let n=0;n<e.leadingDots;n++)t+=".";return t+=e.nameParts.map((e=>e.value)).join("."),t}function _(e){let t=2;return e.isLocalTypingsFile||1===e.importType?t=1:0===e.importType&&(t=0),t}t.getImportGroup=y,t.compareImportStatements=function(e,t){const n=y(e),a=y(t);return n<a?-1:n>a?1:e.moduleName<t.moduleName?-1:1},t.getTopLevelImports=function(e,t=!1){const n={orderedImports:[],mapByFilePath:new Map};let a=!1,i=!1;return e.statements.forEach((e=>{47===e.nodeType?e.statements.forEach((e=>{20===e.nodeType?(i=!0,function(e,t,n){e.list.forEach((a=>{const i=u.getImportInfo(a.module);let r;i&&i.isImportFound&&(r=i.resolvedPaths[i.resolvedPaths.length-1]);const s={node:e,subnode:a,importResult:i,resolvedPath:r,moduleName:b(a.module),followsNonImportStatement:n};t.orderedImports.push(s),r&&(t.mapByFilePath.has(r)||t.mapByFilePath.set(r,s))}))}(e,n,a),a=!1):22===e.nodeType?(i=!0,function(e,t,n,a){var i;const r=u.getImportInfo(e.module);let s;r&&r.isImportFound&&(s=r.resolvedPaths[r.resolvedPaths.length-1]);if(a&&r){t.implicitImports=null!==(i=t.implicitImports)&&void 0!==i?i:new Map;for(const n of r.implicitImports.values()){const a=e.imports.find((e=>e.name.value===n.name));a&&t.implicitImports.set(n.path,a)}}const o={node:e,importResult:r,resolvedPath:s,moduleName:b(e.module),followsNonImportStatement:n};if(t.orderedImports.push(o),s){const e=t.mapByFilePath.get(s);(!e||20===e.node.nodeType||e.moduleName.length>o.moduleName.length)&&t.mapByFilePath.set(s,o)}}(e,n,a,t),a=!1):a=i})):a=i})),n},t.getTextEditsForAutoImportSymbolAddition=function(e,t,n){const a=[];if(!t.node||22!==t.node.nodeType||t.node.isWildcardImport)return a;const i=t.node;if(0===(e=(Array.isArray(e)?e:[e]).filter((e=>!!e.name&&!i.imports.some((t=>t.name.value===e.name&&t.alias===e.alias))))).length)return a;for(const i of e)a.push(f(i.name,i.alias,t.node,n));const r=(0,o.createMapFromItems)(a,(e=>d.Range.print(e.range))),s=[];for(const e of r.values())1===e.length?s.push(e[0]):s.push({range:e[0].range,replacementText:e.sort(((e,t)=>h(e.importName,t.importName))).map((e=>e.replacementText)).join("")});return s},t.getTextEditsForAutoImportInsertions=function(e,t,n,a){const i=[];if(0===(e=Array.isArray(e)?e:[e]).length)return[];const r=(0,o.createMapFromItems)(e,(e=>{var t;return`${e.module.moduleName}-${null!==(t=e.nameForImportFrom)&&void 0!==t?t:""}`}));for(const e of r.values())(0,o.appendArray)(i,v(e,{name:e[0].module.moduleName,nameForImportFrom:e[0].nameForImportFrom},t,_(e[0].module),n,a));return T(n,i)},t.getTextEditsForAutoImportInsertion=function(e,t,n,a,i,r){return T(i,v(e,t,n,a,i,r))},t.getContainingImportStatement=function(e,t){for(;e&&((0,s.throwIfCancellationRequested)(t),20!==e.nodeType&&22!==e.nodeType);)e=e.parent;return e},t.getAllImportNames=function(e){if(20===e.nodeType){return e.list}return e.imports},t.getImportGroupFromModuleNameAndType=_,t.getTextRangeForImportNameDeletion=function(e,...t){const n=[];for(const a of function(e){if(0===e.length)return[];if(1===e.length)return[{start:e[0],end:e[0]}];const t=[];let n=e[0],a=n;for(const i of e)a!==i&&(a+1!==i?(t.push({start:n,end:a}),n=i,a=i):a=i);return t.push({start:n,end:a}),t}(t)){const t=e[a.start],i=e[a.end];if(0===a.start&&e.length===a.end-a.start+1)n.push(d.TextRange.fromBounds(t.start,d.TextRange.getEnd(i)));else if(a.end===e.length-1){const t=d.TextRange.getEnd(e[a.start-1]),r=d.TextRange.getEnd(i)-t;n.push({start:t,length:r})}else{const i=t.start,r=e[a.end+1].start-i;n.push({start:i,length:r})}}return n},t.getRelativeModuleName=function(e,t,n,a=!1,i){let r,s=t;(i=void 0!==i?i:(0,l.isFile)(e,t))&&(s=(0,l.getDirectoryPath)(t));let o=n;if(i){o=(0,l.getDirectoryPath)(n);const e=(0,l.stripFileExtension)((0,l.getFileName)(n));"__init__"!==e?r=e:a&&(r=(0,l.getFileName)(o),o=(0,l.getDirectoryPath)(o))}const p=(0,l.getRelativePathComponentsFromDirectory)(s,o,(t=>e.realCasePath(t)));let c=".";for(let e=1;e<p.length;e++){const t=p[e];c+=".."===t?".":t,".."!==t&&e!==p.length-1&&(c+=".")}return r&&(c="."===c[c.length-1]?c+r:c+"."+r),c},t.getDirectoryLeadingDotsPointsTo=function(e,t){let n=e;for(let e=1;e<t;e++){if(""===n)return;n=(0,l.getDirectoryPath)(n)}return n},t.getResolvedFilePath=function(e){if(e&&e.isImportFound&&0!==e.resolvedPaths.length)return 1===e.resolvedPaths.length&&""===e.resolvedPaths[0]?e.packageDirectory?e.packageDirectory:e.searchPath?e.searchPath:void 0:e.resolvedPaths[e.resolvedPaths.length-1]},t.haveSameParentModule=function(e,t){if(e.length!==t.length)return!1;let n=0;for(n=0;n<e.length-1&&e[n]===t[n];n++);return n===e.length-1}},46288:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.updateNamedTupleBaseClass=t.createNamedTupleType=void 0;const s=n(96541),o=n(6698),l=n(99661),p=n(72610),c=n(21),d=r(n(66455)),u=n(93890),m=n(16682),y=n(33029),g=n(51458);function h(e,t,n){let a=!1;return e.details.baseClasses=e.details.baseClasses.map((e=>{if(!(0,g.isInstantiableClass)(e)||!g.ClassType.isBuiltIn(e,"NamedTuple"))return e;const i=[];n?t.forEach((e=>{i.push({type:e,isUnbounded:!1})})):i.push({type:t.length>0?(0,g.combineTypes)(t):g.UnknownType.create(),isUnbounded:!0});const r=g.ClassType.cloneForSpecialization(e,[],n);return r.details={...r.details},r.details.baseClasses=r.details.baseClasses.map((e=>(0,g.isInstantiableClass)(e)&&g.ClassType.isBuiltIn(e,"tuple")?(0,y.specializeTupleClass)(e,i,n):e)),(0,y.computeMroLinearization)(r),a=!0,r})),a}function f(e,t,n,a,i){return p.Tokenizer.isPythonKeyword(t)?n?`_${i}`:(e.addError(l.Localizer.Diagnostic.namedTupleNameKeyword(),a),t):t}t.createNamedTupleType=function(e,t,n,a){var i,r,p;const T=(0,c.getFileInfo)(t);let v="namedtuple",b=!1;if(!a){const e=n.find((e=>{var t;return 0===e.argumentCategory&&"rename"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(null==e?void 0:e.valueExpression){!0===(0,u.evaluateStaticBoolExpression)(e.valueExpression,T.executionEnvironment,T.definedConstants)&&(b=!0)}}if(0===n.length)e.addError(l.Localizer.Diagnostic.namedTupleFirstArg(),t);else{const a=n[0];0!==a.argumentCategory?e.addError(l.Localizer.Diagnostic.namedTupleFirstArg(),n[0].valueExpression||t):a.valueExpression&&48===a.valueExpression.nodeType&&(v=a.valueExpression.strings.map((e=>e.value)).join(""))}const _=n.find((e=>{var t;return"defaults"===(null===(t=e.name)||void 0===t?void 0:t.value)}));let I=0;if(_&&_.valueExpression){const t=e.getTypeOfExpression(_.valueExpression).type;I=(0,g.isClassInstance)(t)&&(0,y.isTupleClass)(t)&&!(0,y.isUnboundedTupleClass)(t)&&t.tupleTypeArguments?t.tupleTypeArguments.length:void 0}const C=e.getTypingType(t,"NamedTuple")||g.UnknownType.create(),k=g.ClassType.createInstantiable(v,d.getClassFullName(t,T.moduleName,v),T.moduleName,T.filePath,16777216,d.getTypeSourceId(t),void 0,(0,g.isInstantiableClass)(C)?C.details.effectiveMetaclass:g.UnknownType.create());k.details.baseClasses.push(C),k.details.typeVarScopeId=d.getScopeIdForNode(t);const S=k.details.fields;S.set("__class__",m.Symbol.createWithType(68,k));const w=(0,y.synthesizeTypeVarForSelfCls)(k,!0),A=g.FunctionType.createSynthesizedInstance("__new__",1);A.details.declaredReturnType=(0,y.convertToInstance)(w),d.isAssignmentToDefaultsFollowingNamedTuple(t)&&(A.details.flags|=32),A.details.typeVarScopeId=k.details.typeVarScopeId,g.FunctionType.addParameter(A,{category:0,name:"cls",type:w,hasDeclaredType:!0});const x=[],P={category:0,name:"self",type:(0,y.synthesizeTypeVarForSelfCls)(k,!1),hasDeclaredType:!0};let D=!1;const N=[];if(n.length<2)e.addError(l.Localizer.Diagnostic.namedTupleSecondArg(),t),D=!0;else{const t=n[1];if(0!==t.argumentCategory)D=!0;else if(!a&&t.valueExpression&&48===t.valueExpression.nodeType){const n=t.valueExpression.strings.map((e=>e.value)).join("").split(/[,\s]+/),i=void 0===I?0:Math.max(0,n.length-I);n.forEach(((n,r)=>{if(n=n.trim()){n=f(e,n,b,t.valueExpression,r);const l=g.UnknownType.create(),p={category:0,name:n,type:l,hasDeclaredType:a,hasDefault:r>=i};g.FunctionType.addParameter(A,p);const c=m.Symbol.createWithType(8,l);x.push(n);const d=t.valueExpression,u={type:1,node:d,isRuntimeTypeExpression:!0,path:T.filePath,range:(0,s.convertOffsetsToRange)(d.start,o.TextRange.getEnd(d),T.lines),moduleName:T.moduleName,isInExceptSuite:!1};c.addDeclaration(u),S.set(n,c),N.push(l)}}))}else if(31===(null===(i=t.valueExpression)||void 0===i?void 0:i.nodeType)||52===(null===(r=t.valueExpression)||void 0===r?void 0:r.nodeType)){const n=t.valueExpression,i=new Map,r=31===(null===(p=t.valueExpression)||void 0===p?void 0:p.nodeType)?t.valueExpression.entries:t.valueExpression.expressions,c=void 0===I?0:Math.max(0,r.length-I);r.forEach(((t,n)=>{let r,p,d,u="";a?52===t.nodeType&&2===t.expressions.length?(d=t.expressions[0],r=t.expressions[1],p=(0,y.convertToInstance)(e.getTypeOfExpressionExpectingType(r).type)):e.addError(l.Localizer.Diagnostic.namedTupleNameType(),t):(d=t,p=g.UnknownType.create()),d&&48===d.nodeType?(u=d.strings.map((e=>e.value)).join(""),u?u=f(e,u,b,d,n):e.addError(l.Localizer.Diagnostic.namedTupleEmptyName(),d)):D=!0,u||(u=`_${n.toString()}`),i.has(u)&&e.addError(l.Localizer.Diagnostic.namedTupleNameUnique(),d||t),i.set(u,u),p||(p=g.UnknownType.create());const h={category:0,name:u,type:p,hasDeclaredType:a,hasDefault:n>=c};g.FunctionType.addParameter(A,h),N.push(p),x.push(u);const v=m.Symbol.createWithType(2056,p);if(d&&48===d.nodeType){const e={type:1,node:d,path:T.filePath,typeAnnotationNode:r,range:(0,s.convertOffsetsToRange)(d.start,o.TextRange.getEnd(d),T.lines),moduleName:T.moduleName,isInExceptSuite:!1};v.addDeclaration(e)}S.set(u,v)})),e.setTypeForNode(n)}else D=!0}D&&(A.details.parameters=[],g.FunctionType.addDefaultParameters(A),N.push(g.AnyType.create(!1)),N.push(g.AnyType.create(!0)));const F=g.FunctionType.createSynthesizedInstance("__init__");g.FunctionType.addParameter(F,P),g.FunctionType.addDefaultParameters(F),F.details.declaredReturnType=g.NoneType.createInstance(),S.set("__new__",m.Symbol.createWithType(4,A)),S.set("__init__",m.Symbol.createWithType(4,F));const E=g.FunctionType.createSynthesizedInstance("keys"),z=g.FunctionType.createSynthesizedInstance("items");E.details.declaredReturnType=e.getBuiltInObject(t,"list",[e.getBuiltInObject(t,"str")]),z.details.declaredReturnType=E.details.declaredReturnType,S.set("keys",m.Symbol.createWithType(8,E)),S.set("items",m.Symbol.createWithType(8,z));const M=g.FunctionType.createSynthesizedInstance("__len__");if(M.details.declaredReturnType=e.getBuiltInObject(t,"int"),g.FunctionType.addParameter(M,P),S.set("__len__",m.Symbol.createWithType(4,M)),D){const n=g.FunctionType.createSynthesizedInstance("__getattribute__");n.details.declaredReturnType=g.AnyType.create(),g.FunctionType.addParameter(n,P),g.FunctionType.addParameter(n,{category:0,name:"name",type:e.getBuiltInObject(t,"str")}),S.set("__getattribute__",m.Symbol.createWithType(4,n))}const O=e.getBuiltInType(t,"tuple"),V=e.getBuiltInType(t,"str");if(!D&&V&&(0,g.isInstantiableClass)(V)&&O&&(0,g.isInstantiableClass)(O)){const e=x.map((e=>({type:g.ClassType.cloneAsInstance(g.ClassType.cloneWithLiteral(V,e)),isUnbounded:!1}))),t=g.ClassType.cloneAsInstance((0,y.specializeTupleClass)(O,e));S.set("__match_args__",m.Symbol.createWithType(4,t))}return h(k,N,!D),(0,y.computeMroLinearization)(k),k},t.updateNamedTupleBaseClass=h},63250:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTypeOfTernaryOperation=t.getTypeOfUnaryOperation=t.getTypeOfAugmentedAssignment=t.getTypeOfBinaryOperation=t.validateBinaryOperation=void 0;const a=n(83501),i=n(28513),r=n(86513),s=n(99661),o=n(21),l=n(66455),p=n(93890),c=n(33029),d=n(51458),u={0:["__add__","__radd__"],33:["__sub__","__rsub__"],26:["__mul__","__rmul__"],13:["__floordiv__","__rfloordiv__"],10:["__truediv__","__rtruediv__"],24:["__mod__","__rmod__"],29:["__pow__","__rpow__"],22:["__matmul__","__rmatmul__"],3:["__and__","__rand__"],6:["__or__","__ror__"],8:["__xor__","__rxor__"],17:["__lshift__","__rlshift__"],31:["__rshift__","__rrshift__"],12:["__eq__","__eq__"],28:["__ne__","__ne__"],20:["__lt__","__gt__"],21:["__le__","__ge__"],15:["__gt__","__lt__"],16:["__ge__","__le__"]},m={36:!0,37:!0,39:!0,40:!0,41:!0,42:!0},y=64;function g(e,t,n,a,i,r,o,p){const g=n.type,h=a.type;let T,v=e.makeTopLevelTypeVarsConcrete(g);if(void 0!==m[t]){if(36===t){if(!e.canBeTruthy(v))return g;if(!e.canBeFalsy(v))return h;if(v=e.removeTruthinessFromType(v),(0,d.isNever)(h))return v}else if(37===t){if(!e.canBeFalsy(v))return g;if(!e.canBeTruthy(v))return h;if(v=e.removeFalsinessFromType(v),(0,d.isNever)(h))return v}if((0,d.isNever)(g)||(0,d.isNever)(h))return d.NeverType.createNever();41===t||42===t?(T=e.mapSubtypesExpandTypeVars(h,void 0,((r,p)=>e.mapSubtypesExpandTypeVars(v,(0,c.getTypeCondition)(r),(u=>{var m;if((0,d.isAnyOrUnknown)(u)||(0,d.isAnyOrUnknown)(p))return(0,c.preserveUnknown)(u,r);let y=e.getTypeOfMagicMethodReturn(r,[{type:u,isIncomplete:n.isIncomplete}],"__contains__",i,void 0);if(!y){const t=null===(m=e.getTypeOfIterator({type:r,isIncomplete:a.isIncomplete},!1,void 0))||void 0===m?void 0:m.type;t&&e.assignType(t,u)&&(y=e.getBuiltInObject(i,"bool"))}return y||o.addMessage(s.Localizer.Diagnostic.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t),leftType:e.printType(u),rightType:e.printType(r)})),y})))),T&&!(0,d.isNever)(T)&&(T=e.getBuiltInObject(i,"bool"))):T=e.mapSubtypesExpandTypeVars(v,void 0,((n,a)=>e.mapSubtypesExpandTypeVars(h,(0,c.getTypeCondition)(n),((n,r)=>36===t||37===t?(0,d.combineTypes)([a,r]):e.getBuiltInObject(i,"bool")))))}else if(u[t]){if((0,d.isNever)(g)||(0,d.isNever)(h))return d.NeverType.createNever();if(p.isLiteralMathAllowed){const e=(0,c.getLiteralTypeClassName)(g);if(e&&!(0,c.getTypeCondition)(g)){if(e===(0,c.getLiteralTypeClassName)(h)&&!(0,c.getTypeCondition)(h)&&(0,c.getUnionSubtypeCount)(g)*(0,c.getUnionSubtypeCount)(h)<y)if("str"===e||"bytes"===e)0===t&&(T=(0,c.mapSubtypes)(g,(e=>(0,c.mapSubtypes)(h,(t=>{const n=e,a=t;return d.ClassType.cloneWithLiteral(n,n.literalValue+a.literalValue)})))));else if("int"===e&&(0===t||33===t||26===t||13===t||24===t)){let e=!0;T=(0,c.mapSubtypes)(g,(n=>(0,c.mapSubtypes)(h,(a=>{try{const i=n,r=a,s=BigInt(i.literalValue),o=BigInt(r.literalValue);let l;return 0===t?l=s+o:33===t?l=s-o:26===t?l=s*o:13===t?o!==BigInt(0)&&(l=s/o):24===t&&o!==BigInt(0)&&(l=s%o),void 0===l||"number"==typeof l&&isNaN(l)?void(e=!1):(l>=Number.MIN_SAFE_INTEGER&&l<=Number.MAX_SAFE_INTEGER&&(l=Number(l)),d.ClassType.cloneWithLiteral(i,l))}catch{return void(e=!1)}})))),e||(T=void 0)}}}T||(T=e.mapSubtypesExpandTypeVars(g,void 0,((m,y)=>e.mapSubtypesExpandTypeVars(h,(0,c.getTypeCondition)(m),((g,h)=>{if((0,d.isAnyOrUnknown)(y)||(0,d.isAnyOrUnknown)(h))return(0,c.preserveUnknown)(y,h);const T=e.getTupleClassType();if(p.isTupleAddAllowed&&0===t&&(0,d.isClassInstance)(m)&&(0,c.isTupleClass)(m)&&m.tupleTypeArguments&&!(0,c.isUnboundedTupleClass)(m)&&(0,d.isClassInstance)(g)&&(0,c.isTupleClass)(g)&&g.tupleTypeArguments&&!(0,c.isUnboundedTupleClass)(g)&&T&&(0,d.isInstantiableClass)(T))return d.ClassType.cloneAsInstance((0,c.specializeTupleClass)(T,[...m.tupleTypeArguments,...g.tupleTypeArguments]));const v=u[t][0];let b=e.getTypeOfMagicMethodReturn(f(e,y),[{type:h,isIncomplete:a.isIncomplete}],v,i,r);if(b||y===m||(b=e.getTypeOfMagicMethodReturn(f(e,m),[{type:h,isIncomplete:a.isIncomplete}],v,i,r)),b||h===g||(b=e.getTypeOfMagicMethodReturn(f(e,m),[{type:g,isIncomplete:a.isIncomplete}],v,i,r)),!b){const a=u[t][1];b=e.getTypeOfMagicMethodReturn(f(e,h),[{type:y,isIncomplete:n.isIncomplete}],a,i,r),b||h===g||(b=e.getTypeOfMagicMethodReturn(f(e,g),[{type:y,isIncomplete:n.isIncomplete}],a,i,r)),b||y===m||(b=e.getTypeOfMagicMethodReturn(f(e,g),[{type:m,isIncomplete:n.isIncomplete}],a,i,r))}return b||(r?o.addMessage(s.Localizer.Diagnostic.typeNotSupportBinaryOperatorBidirectional().format({operator:(0,l.printOperator)(t),leftType:e.printType(m),rightType:e.printType(g),expectedType:e.printType(r.expectedType)})):o.addMessage(s.Localizer.Diagnostic.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t),leftType:e.printType(m),rightType:e.printType(g)}))),b})))))}return T&&(0,d.isNever)(T)?void 0:T}function h(e,t){if(!(0,d.isInstantiableClass)(e))return!1;const n=e.details.effectiveMetaclass;if(!n||!(0,d.isInstantiableClass)(n))return!1;if(d.ClassType.isBuiltIn(n,"type"))return!1;const a=(0,c.lookUpClassMember)(n,t);return!!a&&(!(0,d.isInstantiableClass)(a.classType)||!d.ClassType.isBuiltIn(a.classType,"type"))}function f(e,t){if((0,d.isFunction)(t)||(0,d.isOverloadedFunction)(t)){const t=e.getObjectType();if(t)return t}return t}t.validateBinaryOperation=g,t.getTypeOfBinaryOperation=function e(t,n,p,u){const y=n.leftExpression;let f=n.rightExpression,T=!1,v=!1;(0,l.operatorSupportsChaining)(n.operator)&&7===f.nodeType&&!f.parenthesized&&(0,l.operatorSupportsChaining)(f.operator)&&(e(t,f,p,u),f=f.leftExpression);let b,_=37===n.operator||36===n.operator?null==u?void 0:u.expectedType:void 0;26===n.operator&&u&&(0,d.isClassInstance)(u.expectedType)&&d.ClassType.isBuiltIn(u.expectedType,"list")&&u.expectedType.typeArguments&&u.expectedType.typeArguments.length>=1&&31===n.leftExpression.nodeType&&(b=u.expectedType);const I=null!=_?_:b,C=t.getTypeOfExpression(y,p,(0,c.makeInferenceContext)(I));let k=C.type;_||(37===n.operator||36===n.operator||0===n.operator&&31===n.rightExpression.nodeType||6===n.operator&&(0,d.isClassInstance)(k)&&d.ClassType.isTypedDictClass(k))&&(_=k);const S=t.getTypeOfExpression(f,p,(0,c.makeInferenceContext)(_));let w=S.type;if((C.isIncomplete||S.isIncomplete)&&(T=!0),6===n.operator&&!h(k,"__or__")&&!h(w,"__ror__")){let e=w,a=k;if(!(0,d.isNoneInstance)(k)&&(0,d.isNoneInstance)(w)?e=d.NoneType.createType():!(0,d.isNoneInstance)(w)&&(0,d.isNoneInstance)(k)&&(a=d.NoneType.createType()),(0,c.isUnionableType)([a,e])){const l=(0,o.getFileInfo)(n);if(l.isStubFile||0!=(4&p)||l.executionEnvironment.pythonVersion>=r.PythonVersion.V3_10||(0,d.isAnyOrUnknown)(a)||t.addError(s.Localizer.Diagnostic.unionSyntaxIllegal(),n,n.operatorToken),!t.validateTypeArg({...C,node:y},{allowVariadicTypeVar:!0,allowUnpackedTuples:!0})||!t.validateTypeArg({...S,node:f},{allowVariadicTypeVar:!0,allowUnpackedTuples:!0}))return{type:d.UnknownType.create()};a=t.reportMissingTypeArguments(n.leftExpression,a,128|p),e=t.reportMissingTypeArguments(n.rightExpression,e,128|p);const c=(0,d.combineTypes)([a,e]);if((0,d.isUnion)(c)&&d.TypeBase.setSpecialForm(c),!l.isStubFile){let e,n,a;if(48===y.nodeType?(e=y,n=f,a=w):48===f.nodeType&&(e=f,n=y,a=k),e&&n&&a){let n=!0;(0,d.isClass)(a)&&(a.isTypeArgumentExplicit&&!(0,d.isClassInstance)(a)||(n=!1)),n||t.addDiagnostic(l.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.unionForwardReferenceNotAllowed(),e)}}return{type:c}}}let A=!1;void 0===m[n.operator]&&(12===n.operator||28===n.operator?k=(0,d.removeNoneFromUnion)(k):A=(0,c.isOptionalType)(k),12!==n.operator&&28!==n.operator||(w=(0,d.removeNoneFromUnion)(w)));const x=new a.DiagnosticAddendum,P=!(0,l.isWithinLoop)(n),D=!(0,d.isUnion)(k);let N=g(t,n.operator,{type:k,isIncomplete:C.isIncomplete},{type:w,isIncomplete:S.isIncomplete},n,u,x,{isLiteralMathAllowed:P,isTupleAddAllowed:D});if(!x.isEmpty()||!N){if(v=!0,!T){const e=(0,o.getFileInfo)(n);if(A&&1===x.getMessages().length)t.addDiagnostic(e.diagnosticRuleSet.reportOptionalOperand,i.DiagnosticRule.reportOptionalOperand,s.Localizer.Diagnostic.noneOperator().format({operator:(0,l.printOperator)(n.operator)}),n.leftExpression);else{let a="";((0,d.isUnion)(t.makeTopLevelTypeVarsConcrete(k))||(0,d.isUnion)(t.makeTopLevelTypeVarsConcrete(w)))&&(a=x.getString()),t.addDiagnostic(e.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(n.operator),leftType:t.printType(k),rightType:t.printType(w)})+a,n)}}N=d.UnknownType.create()}return{type:N,isIncomplete:T,typeErrors:v}},t.getTypeOfAugmentedAssignment=function(e,t,n){const r={1:["__iadd__",0],34:["__isub__",33],27:["__imul__",26],14:["__ifloordiv__",13],11:["__itruediv__",10],25:["__imod__",24],30:["__ipow__",29],23:["__imatmul__",22],4:["__iand__",3],7:["__ior__",6],9:["__ixor__",8],18:["__ilshift__",17],32:["__irshift__",31]};let p,u;const m=new a.DiagnosticAddendum,h=e.getTypeOfExpression(t.leftExpression),f=h.type;let T;7===t.operator&&(T=f);const v=e.getTypeOfExpression(t.rightExpression,void 0,(0,c.makeInferenceContext)(T)),b=v.type,_=!!v.isIncomplete||!!h.isIncomplete;if((0,d.isNever)(f)||(0,d.isNever)(b))u={type:d.NeverType.createNever(),isIncomplete:_};else{if(p=e.mapSubtypesExpandTypeVars(f,void 0,((a,i)=>e.mapSubtypesExpandTypeVars(b,(0,c.getTypeCondition)(a),((s,o)=>{if((0,d.isAnyOrUnknown)(i)||(0,d.isAnyOrUnknown)(o))return(0,c.preserveUnknown)(i,o);const p=r[t.operator][0];let u=e.getTypeOfMagicMethodReturn(i,[{type:o,isIncomplete:v.isIncomplete}],p,t,n);if(u||i===a||(u=e.getTypeOfMagicMethodReturn(a,[{type:o,isIncomplete:v.isIncomplete}],p,t,n)),u||o===s||(u=e.getTypeOfMagicMethodReturn(a,[{type:s,isIncomplete:v.isIncomplete}],p,t,n)),!u){const a=r[t.operator][1],s=!(0,l.isWithinLoop)(t)&&(0,c.getUnionSubtypeCount)(f)*(0,c.getUnionSubtypeCount)(b)<y,p=!(0,d.isUnion)(f);u=g(e,a,{type:i,isIncomplete:h.isIncomplete},{type:o,isIncomplete:v.isIncomplete},t,n,m,{isLiteralMathAllowed:s,isTupleAddAllowed:p})}return u})))),!m.isEmpty()||!p||(0,d.isNever)(p)){if(!_){const n=(0,o.getFileInfo)(t);e.addDiagnostic(n.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t.operator),leftType:e.printType(f),rightType:e.printType(b)})+m.getString(),t)}p=d.UnknownType.create()}u={type:p,isIncomplete:_}}return e.assignTypeToExpression(t.destExpression,u.type,!!u.isIncomplete,t.rightExpression),u},t.getTypeOfUnaryOperation=function(e,t,n){const a=e.getTypeOfExpression(t.expression);let r=e.makeTopLevelTypeVarsConcrete(a.type);const p=a.isIncomplete;if((0,d.isNever)(r))return{type:d.NeverType.createNever(),isIncomplete:p};const u={0:"__pos__",33:"__neg__",5:"__invert__"};let m;if(38!==t.operator&&(0,c.isOptionalType)(r)&&(e.addDiagnostic((0,o.getFileInfo)(t).diagnosticRuleSet.reportOptionalOperand,i.DiagnosticRule.reportOptionalOperand,s.Localizer.Diagnostic.noneOperator().format({operator:(0,l.printOperator)(t.operator)}),t.expression),r=(0,d.removeNoneFromUnion)(r)),!a.isIncomplete){const e=(0,c.getLiteralTypeClassName)(r);"int"===e?0===t.operator?m=r:33===t.operator&&(m=(0,c.mapSubtypes)(r,(e=>{const t=e;return d.ClassType.cloneWithLiteral(t,-t.literalValue)}))):"bool"===e&&38===t.operator&&(m=(0,c.mapSubtypes)(r,(e=>{const t=e;return d.ClassType.cloneWithLiteral(t,!t.literalValue)})))}if(!m)if(38===t.operator)m=e.getBuiltInObject(t,"bool"),m||(m=d.UnknownType.create());else{if((0,d.isAnyOrUnknown)(r))m=r;else{const a=u[t.operator];m=e.getTypeOfMagicMethodReturn(r,[],a,t,n)}if(!m){const a=(0,o.getFileInfo)(t);n?e.addDiagnostic(a.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.typeNotSupportUnaryOperatorBidirectional().format({operator:(0,l.printOperator)(t.operator),type:e.printType(r),expectedType:e.printType(n.expectedType)}),t):e.addDiagnostic(a.diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,s.Localizer.Diagnostic.typeNotSupportUnaryOperator().format({operator:(0,l.printOperator)(t.operator),type:e.printType(r)}),t),m=d.UnknownType.create()}}return{type:m,isIncomplete:p}},t.getTypeOfTernaryOperation=function(e,t,n,a){e.getTypeOfExpression(t.testExpression);const i=[];let r=!1,s=!1;const l=(0,o.getFileInfo)(t),c=(0,p.evaluateStaticBoolExpression)(t.testExpression,l.executionEnvironment,l.definedConstants);if(!1!==c&&e.isNodeReachable(t.ifExpression)){const o=e.getTypeOfExpression(t.ifExpression,n,a);i.push(o.type),o.isIncomplete&&(r=!0),o.typeErrors&&(s=!0)}if(!0!==c&&e.isNodeReachable(t.elseExpression)){const o=e.getTypeOfExpression(t.elseExpression,n,a);i.push(o.type),o.isIncomplete&&(r=!0),o.typeErrors&&(s=!0)}return{type:(0,d.combineTypes)(i),isIncomplete:r,typeErrors:s}}},32966:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getParameterListDetails=t.ParameterSource=t.isTypedKwargs=void 0;const a=n(48466),i=n(51458),r=n(33029);var s;t.isTypedKwargs=function(e){return 2===e.category&&(0,i.isClassInstance)(e.type)&&(0,i.isUnpackedClass)(e.type)&&i.ClassType.isTypedDictClass(e.type)&&!!e.type.details.typedDictEntries},function(e){e[e.PositionOnly=0]="PositionOnly",e[e.PositionOrKeyword=1]="PositionOrKeyword",e[e.KeywordOnly=2]="KeywordOnly"}(s=t.ParameterSource||(t.ParameterSource={})),t.getParameterListDetails=function(e){const t={firstPositionOrKeywordIndex:0,positionParamCount:0,positionOnlyParamCount:0,params:[],hasUnpackedVariadicTypeVar:!1,hasUnpackedTypedDict:!1};let n=e.details.parameters.findIndex((e=>(0,i.isPositionOnlySeparator)(e)));if(n<0)for(let t=0;t<e.details.parameters.length;t++){const i=e.details.parameters[t];if(0!==i.category)break;if(!i.name)break;if((0,a.isDunderName)(i.name)||!i.name.startsWith("__"))break;n=t+1}n>=0&&(t.firstPositionOrKeywordIndex=n);for(let a=0;a<n&&!e.details.parameters[a].hasDefault;a++)t.positionOnlyParamCount++;let o=!1;const l=(a,r,l,p,c)=>{if(a.name){let d;d=void 0!==c?c:1===a.category?s.PositionOnly:o?s.KeywordOnly:n>=0&&r<n?s.PositionOnly:s.PositionOrKeyword,t.params.push({param:a,index:r,type:null!=l?l:i.FunctionType.getEffectiveParameterType(e,r),defaultArgType:p,source:d})}};return e.details.parameters.forEach(((a,p)=>{var c,d;if(1===a.category){const r=i.FunctionType.getEffectiveParameterType(e,p);if(a.name&&(0,i.isUnpackedClass)(r)&&r.tupleTypeArguments){const e=p<t.positionOnlyParamCount;r.tupleTypeArguments.forEach(((n,r)=>{const o=(0,i.isVariadicTypeVar)(n.type)||n.isUnbounded?1:0;1===o&&(t.argsIndex=t.params.length),(0,i.isVariadicTypeVar)(a.type)&&(t.hasUnpackedVariadicTypeVar=!0),l({category:o,name:`${a.name}[${r.toString()}]`,isNameSynthesized:!0,type:n.type,hasDeclaredType:!0},p,n.type,void 0,s.PositionOnly),0===o&&t.positionParamCount++,r>0&&e&&t.positionOnlyParamCount++})),!o&&(n<0||p>=n)&&(t.firstKeywordOnlyIndex=t.params.length,o=!0)}else a.name&&void 0===t.argsIndex&&(t.argsIndex=t.params.length,(0,i.isVariadicTypeVar)(a.type)&&(t.hasUnpackedVariadicTypeVar=!0)),!o&&(n<0||p>=n)&&(t.firstKeywordOnlyIndex=t.params.length,a.name&&t.firstKeywordOnlyIndex++,o=!0),l(a,p)}else if(2===a.category){o=!0;const n=i.FunctionType.getEffectiveParameterType(e,p);if((0,i.isClassInstance)(n)&&(0,i.isUnpackedClass)(n)&&n.details.typedDictEntries){void 0===t.firstKeywordOnlyIndex&&(t.firstKeywordOnlyIndex=t.params.length);const e=n;n.details.typedDictEntries.forEach(((t,n)=>{const a=(0,r.partiallySpecializeType)(t.valueType,e);l({category:0,name:n,type:a,hasDeclaredType:!0,hasDefault:!t.isRequired},p,a)})),t.hasUnpackedTypedDict=!0,t.unpackedKwargsTypedDictType=n}else a.name&&(void 0===t.kwargsIndex&&(t.kwargsIndex=t.params.length),void 0===t.firstKeywordOnlyIndex&&(t.firstKeywordOnlyIndex=t.params.length),l(a,p))}else 0===a.category&&(a.name&&!o&&t.positionParamCount++,l(a,p,void 0,(null===(c=e.specializedTypes)||void 0===c?void 0:c.parameterDefaultArgs)?null===(d=e.specializedTypes)||void 0===d?void 0:d.parameterDefaultArgs[p]:void 0))})),t}},20533:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParentDirectoryCache=void 0;const a=n(5284),i=n(81844);t.ParentDirectoryCache=class{constructor(e){this._importRootGetter=e,this._importChecked=new Map,this._cachedResults=new Map,this._libPathCache=void 0}getImportResult(e,t,n){var a,i,r,s;const o=null===(a=this._cachedResults.get(t))||void 0===a?void 0:a.get(e);if(o)return null!=o?o:n;const l=null===(i=this._importChecked.get(t))||void 0===i?void 0:i.get(e);return l?l.importPath&&null!==(s=null===(r=this._cachedResults.get(t))||void 0===r?void 0:r.get(l.importPath))&&void 0!==s?s:n:void 0}checkValidPath(e,t,n){var a;return!!t.startsWith(n)&&(this._libPathCache=null!==(a=this._libPathCache)&&void 0!==a?a:this._importRootGetter().map((t=>(0,i.ensureTrailingDirectorySeparator)((0,i.normalizePathCase)(e,(0,i.normalizePath)(t))))).filter((e=>e!==n)).filter((e=>e.startsWith(n))),!this._libPathCache.some((e=>t.startsWith(e))))}checked(e,t,n){(0,a.getOrAdd)(this._importChecked,t,(()=>new Map)).set(e,n)}add(e){(0,a.getOrAdd)(this._cachedResults,e.importName,(()=>new Map)).set(e.path,e.importResult)}reset(){this._importChecked.clear(),this._cachedResults.clear(),this._libPathCache=void 0}}},7508:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreeCleanerWalker=void 0;const s=r(n(21)),o=n(59438);class l extends o.ParseTreeWalker{constructor(e){super(),this._parseTree=e}clean(){this.walk(this._parseTree)}visitNode(e){return s.cleanNodeAnalysisInfo(e),super.visitNode(e)}}t.ParseTreeCleanerWalker=l},66455:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isWhitespace=t.getTokenAtLeft=t.getTokenIndexAtLeft=t.getCallNodeAndActiveParameterIndex=t.getEnclosingParameter=t.CallNodeWalker=t.NameNodeWalker=t.isAssignmentToDefaultsFollowingNamedTuple=t.isDocString=t.getDocString=t.isWithinAssertExpression=t.isWithinTryBlock=t.isWithinLoop=t.isWithinAnnotationComment=t.isWithinTypeAnnotation=t.isWithinDefaultParamInitializer=t.isPartialMatchingExpression=t.isMatchingExpression=t.containsAwaitNode=t.isSuiteEmpty=t.isNodeContainedWithinNodeType=t.getParentAnnotationNode=t.getParentNodeOfType=t.isNodeContainedWithin=t.isRequiredAllowedForAssignmentTarget=t.isClassVarAllowedForAssignmentTarget=t.isFinalAllowedForAssignmentTarget=t.getTypeAnnotationNode=t.getExecutionScopeNode=t.getTypeVarScopeNode=t.getEvaluationScopeNode=t.getEvaluationNodeForAssignmentExpression=t.getEnclosingSuiteOrModule=t.getEnclosingClassOrFunction=t.getEnclosingLambda=t.getEnclosingFunction=t.getEnclosingClassOrModule=t.getEnclosingModule=t.getEnclosingClass=t.getEnclosingSuite=t.getCallForName=t.printOperator=t.printExpression=t.printArgument=t.getTypeSourceId=t.getClassFullName=t.isCompliantWithNodeRangeRules=t.findNodeByOffset=t.findNodeByPosition=t.getNodeDepth=void 0,t.getTypeVarScopesForNode=t.getScopeIdForNode=t.getVariableDocStringNode=t.operatorSupportsChaining=t.isValidLocationForFutureImport=t.isUnannotatedFunction=t.isBlankLine=t.getFullStatementRange=t.getStringValueRange=t.getStringNodeValueRange=t.isLastNameOfDottedName=t.isFirstNameOfDottedName=t.getFirstNameOfDottedName=t.getDottedName=t.getDecoratorName=t.getDottedNameWithGivenNodeAsLastName=t.getFirstAncestorOrSelf=t.getFirstAncestorOrSelfOfKind=t.isLastNameOfModuleName=t.isFromImportAlias=t.isFromImportName=t.isFromImportModuleName=t.isImportAlias=t.isImportModuleName=t.getTypeAnnotationForParameter=t.isFunctionSuiteEmpty=t.getFileInfoFromNode=t.getModuleNode=t.isWriteAccess=t.printParseNodeType=t.getTokenOverlapping=t.getTokenAt=t.getTokenAtIndex=void 0;const s=r(n(21)),o=n(79251),l=n(30795),p=n(96541),c=n(6698),d=n(10154),u=n(29597),m=n(21),y=n(59438);function g(e,t){if(t<e.start||t>c.TextRange.getEnd(e))return;let n=(0,y.getChildNodes)(e);if(h(e)&&n.length>20){const e=(0,d.getIndexContaining)(n,t);e>=0&&(n=[n[e]])}for(const a of n){if(!a)continue;const n=g(a,t);if(n)return 5===e.nodeType&&n===e.leftExpression?e.destExpression:n}return e}function h(e){return 3!==e.nodeType&&48!==e.nodeType}function f(e,t){let n="";return 1===e.argumentCategory?n="*":2===e.argumentCategory&&(n="**"),e.name&&(n+=e.name.value+"="),n+=T(e.valueExpression,t),n}function T(e,t=0){switch(e.nodeType){case 38:return e.value;case 35:return T(e.leftExpression,t)+"."+e.memberName.value;case 9:{let n=T(e.leftExpression,t);return 35!==e.leftExpression.nodeType&&38!==e.leftExpression.nodeType&&24!==e.leftExpression.nodeType&&9!==e.leftExpression.nodeType&&(n=`(${n})`),n+"("+e.arguments.map((e=>f(e,t))).join(", ")+")"}case 24:return T(e.baseExpression,t)+"["+e.items.map((e=>f(e,t))).join(", ")+(e.trailingComma?",":"")+"]";case 55:{const n=v(e.operator)+T(e.expression,t);return e.parenthesized?`(${n})`:n}case 7:{const n=T(e.leftExpression,t)+" "+v(e.operator)+" "+T(e.rightExpression,t);return e.parenthesized?`(${n})`:n}case 40:{let t=e.value.toString();return t.endsWith("n")&&(t=t.substring(0,t.length-1)),e.isImaginary&&(t+="j"),t}case 48:return 1&t&&e.typeAnnotation?T(e.typeAnnotation,t):e.strings.map((e=>T(e,t))).join(" ");case 49:{let n="";8&e.token.flags&&(n+="r"),16&e.token.flags&&(n+="u"),32&e.token.flags&&(n+="b"),64&e.token.flags&&(n+="f");let a=e.token.escapedValue;if(0==(2&t)){const e=32;a=a.substring(0,e)}return 4&e.token.flags?1&e.token.flags?n+=`'''${a}'''`:n+=`"""${a}"""`:1&e.token.flags?n+=`'${a}'`:n+=`"${a}"`,n}case 3:return T(e.leftExpression,t)+" = "+T(e.rightExpression,t);case 4:return T(e.name,t)+" := "+T(e.rightExpression,t);case 54:return T(e.valueExpression,t)+": "+T(e.typeAnnotation,t);case 5:return T(e.leftExpression,t)+" "+v(e.operator)+" "+T(e.rightExpression,t);case 6:{const n="await "+T(e.expression,t);return e.parenthesized?`(${n})`:n}case 51:return T(e.ifExpression,t)+" if "+T(e.testExpression,t)+" else "+T(e.elseExpression,t);case 31:return`[${e.entries.map((e=>T(e,t))).join(", ")}]`;case 56:return"*"+T(e.expression,t);case 52:{const n=e.expressions.map((e=>T(e,t)));return 1===n.length?`(${n[0]}, )`:`(${n.join(", ")})`}case 60:return e.expression?"yield "+T(e.expression,t):"yield";case 61:return"yield from "+T(e.expression,t);case 18:return"...";case 32:{let n="<ListExpression>";if((0,u.isExpressionNode)(e.expression))n=T(e.expression,t);else if(17===e.expression.nodeType){n=`${T(e.expression.keyExpression,t)}: ${T(e.expression.valueExpression,t)}`}return n=n+" "+e.forIfNodes.map((e=>33===e.nodeType?(e.isAsync?"async ":"")+"for "+T(e.targetExpression,t)+` in ${T(e.iterableExpression,t)}`:`if ${T(e.testExpression,t)}`)).join(" "),e.isParenthesized?`(${n}})`:n}case 46:{let n="";return e.startValue||e.endValue||e.stepValue?(e.startValue&&(n+=T(e.startValue,t)),e.endValue&&(n+=": "+T(e.endValue,t)),e.stepValue&&(n+=": "+T(e.stepValue,t))):n+=":",n}case 30:return"lambda "+e.parameters.map((e=>{let n="";return 1===e.category?n+="*":2===e.category&&(n+="**"),e.name?n+=e.name.value:0===e.category&&(n+="/"),e.defaultValue&&(n+=" = "+T(e.defaultValue,t)),n})).join(", ")+": "+T(e.expression,t);case 11:if(33===e.constType)return"True";if(15===e.constType)return"False";if(9===e.constType)return"__debug__";if(26===e.constType)return"None";break;case 15:{const n=`${e.entries.map((e=>17===e.nodeType?`${T(e.keyExpression,t)}: ${T(e.valueExpression,t)}`:16===e.nodeType?`**${T(e.expandExpression,t)}`:T(e,t)))}`;return n?`{ ${n} }`:"{}"}case 45:return e.entries.map((e=>T(e,t))).join(", ")}return"<Expression>"}function v(e){const t={0:"+",1:"+=",2:"=",3:"&",4:"&=",5:"~",6:"|",7:"|=",8:"^",9:"^=",10:"/",11:"/=",12:"==",13:"//",14:"//=",15:">",16:">=",17:"<<",18:"<<=",19:"<>",20:"<",21:"<=",22:"@",23:"@=",24:"%",25:"%=",26:"*",27:"*=",28:"!=",29:"**",30:"**=",31:">>",32:">>=",33:"-",34:"-=",36:"and",37:"or",38:"not",39:"is",40:"is not",41:"in",42:"not in"};return t[e]?t[e]:"unknown"}function b(e,t=!1){let n=e.parent;for(;n;){if(10===n.nodeType)return n;if(36===n.nodeType)return;if(28===n.nodeType&&t)return;n=n.parent}}function _(e){let t,n=e.parent;for(;n;){if(28===n.nodeType&&!n.decorators.some((e=>e===t)))return n;if(10===n.nodeType)return;t=n,n=n.parent}}function I(e){let t,n,a=e,i=!1;for(;a;){switch(41===a.nodeType&&t===a.name&&(i=!0),a.nodeType){case 28:if(a.parameters.some((e=>e===t))){if(i&&void 0!==(0,m.getScope)(a))return a}else if(t===a.suite&&void 0!==(0,m.getScope)(a))return a;break;case 30:if(a.parameters.some((e=>e===t))){if(i&&void 0!==(0,m.getScope)(a))return a}else if((!t||t===a.expression)&&void 0!==(0,m.getScope)(a))return a;break;case 10:if(t===a.suite&&void 0!==(0,m.getScope)(a))return a;break;case 32:if(void 0!==(0,m.getScope)(a)){if(!(t===a.forIfNodes[0]&&33===a.forIfNodes[0].nodeType&&a.forIfNodes[0].iterableExpression===n))return a}break;case 36:if(void 0!==(0,m.getScope)(a))return a}n=t,t=a,a=a.parent}(0,l.fail)("Did not find evaluation scope")}function C(e){let t,n=e;for(;n;){switch(n.nodeType){case 28:case 10:if(!n.decorators.some((e=>e===t)))return n;break;case 77:return n}t=n,n=n.parent}}function k(e,t){let n=e;for(;n;){if(n.nodeType===t)return n;n=n.parent}}function S(e,t){if(38===e.nodeType)return 38===t.nodeType?e.value===t.value:4===t.nodeType&&e.value===t.name.value;if(35===e.nodeType&&35===t.nodeType)return S(e.leftExpression,t.leftExpression)&&e.memberName.value===t.memberName.value;if(24===e.nodeType&&24===t.nodeType){if(!S(e.baseExpression,t.baseExpression))return!1;if(1!==t.items.length||t.trailingComma||t.items[0].name||0!==t.items[0].argumentCategory)return!1;const n=e.items[0].valueExpression;if(40===n.nodeType){const e=t.items[0].valueExpression;return!(40!==e.nodeType||e.isImaginary||!e.isInteger)&&n.value===e.value}if(55===n.nodeType&&33===n.operator&&40===n.expression.nodeType){const e=t.items[0].valueExpression;return!(55!==e.nodeType||33!==e.operator||40!==e.expression.nodeType||e.expression.isImaginary||!e.expression.isInteger)&&n.expression.value===e.expression.value}if(48===n.nodeType){const e=n,a=t.items[0].valueExpression;if(1===e.strings.length&&49===e.strings[0].nodeType&&48===a.nodeType&&1===a.strings.length&&49===a.strings[0].nodeType)return e.strings[0].value===a.strings[0].value}return!1}return!1}function w(e){if(0===e.statements.length||48!==e.statements[0].nodeType)return!1;const t=e.statements[0].strings;return 0!==t.length&&!t.some((e=>27===e.nodeType))}t.getNodeDepth=function(e){let t=0,n=e;for(;n;)t++,n=n.parent;return t},t.findNodeByPosition=function(e,t,n){const a=(0,p.convertPositionToOffset)(t,n);if(void 0!==a)return g(e,a)},t.findNodeByOffset=g,t.isCompliantWithNodeRangeRules=h,t.getClassFullName=function(e,t,n){const a=[n];let i=e;for(;i;)i=b(i),i&&a.push(i.name.value);return a.push(t),a.reverse().join(".")},t.getTypeSourceId=function(e){return e.start},t.printArgument=f,t.printExpression=T,t.printOperator=v,t.getCallForName=function(e){var t,n,a;return 9===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.leftExpression===e?e.parent:35===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&e.parent.memberName===e&&9===(null===(a=e.parent.parent)||void 0===a?void 0:a.nodeType)&&e.parent.parent.leftExpression===e.parent?e.parent.parent:void 0},t.getEnclosingSuite=function(e){let t=e.parent;for(;t;){if(50===t.nodeType)return t;t=t.parent}},t.getEnclosingClass=b,t.getEnclosingModule=function(e){let t=e.parent;for(;t;){if(36===t.nodeType)return t;t=t.parent}(0,l.fail)("Module node not found")},t.getEnclosingClassOrModule=function(e,t=!1){let n=e.parent;for(;n;){if(10===n.nodeType)return n;if(36===n.nodeType)return n;if(28===n.nodeType&&t)return;n=n.parent}},t.getEnclosingFunction=_,t.getEnclosingLambda=function(e){let t=e.parent;for(;t;){if(30===t.nodeType)return t;if(50===t.nodeType)return;t=t.parent}},t.getEnclosingClassOrFunction=function(e){let t=e.parent;for(;t;){if(28===t.nodeType)return t;if(10===t.nodeType)return t;t=t.parent}},t.getEnclosingSuiteOrModule=function(e,t=!1,n=!0){let a=e.parent;for(;a;){if(50===a.nodeType)return a;if(36===a.nodeType)return a;if(30===a.nodeType&&n)return;if(28===a.nodeType&&t)return;a=a.parent}},t.getEvaluationNodeForAssignmentExpression=function(e){let t=!1,n=I(e);for(;void 0!==n;)switch(n.nodeType){case 28:case 30:case 36:return n;case 10:return t?void 0:n;case 32:t=!0,n=I(n.parent);break;default:return}},t.getEvaluationScopeNode=I,t.getTypeVarScopeNode=C,t.getExecutionScopeNode=function(e){let t=I(e);for(;10===t.nodeType||32===t.nodeType;)t=I(t.parent);return t},t.getTypeAnnotationNode=function(e){let t=e,n=e.parent;for(;n;){if(54===n.nodeType){if(n.typeAnnotation===t)return n;break}t=n,n=n.parent}},t.isFinalAllowedForAssignmentTarget=function(e){if(38===e.nodeType)return!0;if(35===e.nodeType){if(38!==e.leftExpression.nodeType)return!1;if(!b(e))return!1;const t=_(e);return!!t&&"__init__"===t.name.value}return!1},t.isClassVarAllowedForAssignmentTarget=function(e){return!!b(e,!0)},t.isRequiredAllowedForAssignmentTarget=function(e){return!!b(e,!0)},t.isNodeContainedWithin=function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parent}return!1},t.getParentNodeOfType=k,t.getParentAnnotationNode=function(e){let t,n=e;for(;n;){if(28===n.nodeType)return t===n.returnTypeAnnotation?t:void 0;if(41===n.nodeType)return t===n.typeAnnotation||t===n.typeAnnotationComment?t:void 0;if(3===n.nodeType)return t===n.typeAnnotationComment?t:void 0;if(54===n.nodeType)return t===n.typeAnnotation?t:void 0;if(62===n.nodeType)return t===n.returnTypeAnnotation||n.paramTypeAnnotations.some((e=>e===t))?((0,l.assert)(!t||(0,u.isExpressionNode)(t)),t):void 0;t=n,n=n.parent}},t.isNodeContainedWithinNodeType=function(e,t){return void 0!==k(e,t)},t.isSuiteEmpty=function(e){let t=!1;for(const n of e.statements){if(47!==n.nodeType)return!1;for(const e of n.statements)if(18===e.nodeType)t=!0;else if(48!==e.nodeType)return!1}return t},t.containsAwaitNode=function(e){let t=!1;class n extends y.ParseTreeWalker{visitAwait(e){return t=!0,!1}}return(new n).walk(e),t},t.isMatchingExpression=S,t.isPartialMatchingExpression=function e(t,n){return 35===t.nodeType?S(t.leftExpression,n)||e(t.leftExpression,n):24===t.nodeType&&(S(t.baseExpression,n)||e(t.baseExpression,n))},t.isWithinDefaultParamInitializer=function(e){let t,n=e;for(;n;){if(41===n.nodeType&&t===n.defaultValue)return!0;if(30===n.nodeType||28===n.nodeType||10===n.nodeType||36===n.nodeType)return!1;t=n,n=n.parent}return!1},t.isWithinTypeAnnotation=function(e,t){let n,a=e,i=!1;for(;a;){if(41===a.nodeType&&(n===a.typeAnnotation||n===a.typeAnnotationComment))return i||!t;if(28===a.nodeType&&n===a.returnTypeAnnotation)return i||!t;if(28===a.nodeType&&n===a.functionAnnotationComment)return!0;if(54===a.nodeType&&n===a.typeAnnotation)return i||!t;if(3===a.nodeType&&n===a.typeAnnotationComment)return!0;if(48===a.nodeType&&n===a.typeAnnotation&&(i=!0),30===a.nodeType||28===a.nodeType||10===a.nodeType||36===a.nodeType)return!1;n=a,a=a.parent}return!1},t.isWithinAnnotationComment=function(e){let t,n=e;for(;n;){if(28===n.nodeType&&t===n.functionAnnotationComment)return!0;if(3===n.nodeType&&t===n.typeAnnotationComment)return!0;if(30===n.nodeType||28===n.nodeType||10===n.nodeType||36===n.nodeType)return!1;t=n,n=n.parent}return!1},t.isWithinLoop=function(e){let t=e;for(;t;){switch(t.nodeType){case 26:case 57:return!0}t=t.parent}return!1},t.isWithinTryBlock=function(e,t=!1){let n,a=e;for(;a;){switch(a.nodeType){case 53:return a.trySuite===n;case 58:if(t&&a.suite===n)return!0;break;case 28:case 36:case 10:return!1}n=a,a=a.parent}return!1},t.isWithinAssertExpression=function(e){let t,n=e;for(;n;){if(2===n.nodeType)return n.testExpression===t;t=n,n=n.parent}return!1},t.getDocString=function(e){if(0===e.length)return;if(47!==e[0].nodeType)return;if(!w(e[0]))return;const t=e[0].statements[0].strings;return 1===t.length?t[0].value:t.map((e=>e.value)).join("")},t.isDocString=w,t.isAssignmentToDefaultsFollowingNamedTuple=function(e){var t,n;if(9!==e.nodeType||!e.parent||3!==e.parent.nodeType||38!==e.parent.leftExpression.nodeType||!e.parent.parent||47!==e.parent.parent.nodeType)return!1;const a=e.parent.leftExpression.value,i=e.parent.parent;if(i.statements[0]!==e.parent||!i.parent||36!==i.parent.nodeType&&50!==i.parent.nodeType)return!1;const r=i.parent;let s=r.statements.findIndex((e=>e===i));if(s<0)return!1;for(s++;s<r.statements.length;){const e=r.statements[s];if(47!==e.nodeType)break;if(48!==(null===(t=e.statements[0])||void 0===t?void 0:t.nodeType)){if(3===(null===(n=e.statements[0])||void 0===n?void 0:n.nodeType)){const t=e.statements[0];if(35===t.leftExpression.nodeType&&"__defaults__"===t.leftExpression.memberName.value){const e=t.leftExpression.leftExpression;if(35===e.nodeType&&"__new__"===e.memberName.value&&38===e.leftExpression.nodeType&&e.leftExpression.value===a)return!0}}break}s++}return!1};class A extends y.ParseTreeWalker{constructor(e){super(),this._callback=e}visitName(e){return this._callback(e,this._subscriptIndex,this._baseExpression),!0}visitIndex(e){this.walk(e.baseExpression);const t=this._subscriptIndex,n=this._baseExpression;return this._baseExpression=e.baseExpression,e.items.forEach(((e,t)=>{this._subscriptIndex=t,this.walk(e)})),this._subscriptIndex=t,this._baseExpression=n,!1}}t.NameNodeWalker=A;class x extends y.ParseTreeWalker{constructor(e){super(),this._callback=e}visitCall(e){return this._callback(e),!0}}function P(e,t,n=!1,a=!1){const i=e.getItemAtPosition(t);if(i<0)return-1;for(let r=i;r>=0;r--){const i=e.getItemAt(r);if((a||0!==i.length)&&((n||!D(i))&&c.TextRange.getEnd(i)<=t))return r}return-1}function D(e){return 2===e.type||3===e.type||4===e.type}function N(e,t){if(!(t<0))return e.getItemAt(t)}function F(e,t){return N(e,e.getItemAtPosition(t))}function E(e){let t=e;for(;t&&36!==t.nodeType;)t=t.parent;return t}function z(e,t){return M(e,(e=>e.nodeType===t))}function M(e,t){for(const n of function*(e){for(;void 0!==e;)yield e,e=e.parent}(e))if(t(n))return n}function O(e){if(38===e.nodeType)return[e];const t=[];return function e(t,n){if(38===t.nodeType)return n.push(t),!0;if(n.push(t.memberName),38===t.leftExpression.nodeType||35===t.leftExpression.nodeType)return e(t.leftExpression,n);return!1}(e,t)?t.reverse():void 0}function V(e){const t=e.quoteMarkLength,n=!(65536&e.flags);return c.TextRange.create(e.start+t,e.length-t-(n?t:0))}function R(e,t){const n=e.tokenizerOutput.lines.getItemAt(t);return(0,o.containsOnlyWhitespace)(e.text,n)}function L(e){let t="";(10===e.nodeType||28===e.nodeType)&&(t=e.name.value);return`${s.getFileInfo(e).filePath}.${e.start.toString()}-${t}`}t.CallNodeWalker=x,t.getEnclosingParameter=function(e){let t=e;for(;t;){if(41===t.nodeType)return t;t=t.parent}},t.getCallNodeAndActiveParameterIndex=function(e,t,n){let a,i=e;for(;void 0!==i;){if(9===i.nodeType&&d(n,i,t)){a=i;break}i=i.parent}if(!a||!a.arguments)return;const r=c.TextRange.getEnd(a);if(t>r)return;const s=F(n,r-1);if(t===r&&14===(null==s?void 0:s.type))return;let o=!1,l=-1,p=!1;return a.arguments.forEach(((e,a)=>{if(o)return;let i=e.start;const r=n.getItemAtPosition(i);r>=0&&(i=c.TextRange.getEnd(n.getItemAt(r-1)));let s=c.TextRange.getEnd(e);const d=n.getItemAtPosition(s);if(d>=0)for(let e=d;e<n.count;e++){const t=n.getItemAt(e);switch(t.type){case 12:case 14:break;default:continue}s=c.TextRange.getEnd(t);break}t<s&&(l=a,p=t>=i,o=!0)})),o||(l=a.arguments.length+1),{callNode:a,activeIndex:l,activeOrFake:p};function d(e,t,n){const a=t.leftExpression.length>0?c.TextRange.getEnd(t.leftExpression)-1:t.leftExpression.start,i=c.TextRange.getEnd(t);if(n<a||i<n)return!1;if(t.arguments.length>0){const e=t.arguments[0].start,a=c.TextRange.getEnd(t.arguments[t.arguments.length-1]);if(e<=n&&n<a)return!0}const r=e.getItemAtPosition(a);if(r<0||e.count<=r)return!0;const s=e.getItemAt(r+1);return!(13===s.type&&n<c.TextRange.getEnd(s))}},t.getTokenIndexAtLeft=P,t.getTokenAtLeft=function(e,t,n=!1,a=!1){const i=P(e,t,n,a);if(!(i<0))return e.getItemAt(i)},t.isWhitespace=D,t.getTokenAtIndex=N,t.getTokenAt=F,t.getTokenOverlapping=function(e,t){const n=e.getItemAtPosition(t);if(n<0)return;const a=e.getItemAt(n);return c.TextRange.overlaps(a,t)?a:void 0},t.printParseNodeType=function(e){switch(e){case 0:return"Error";case 1:return"Argument";case 2:return"Assert";case 3:return"Assignment";case 4:return"AssignmentExpression";case 5:return"AugmentedAssignment";case 6:return"Await";case 7:return"BinaryOperation";case 8:return"Break";case 9:return"Call";case 10:return"Class";case 11:return"Constant";case 12:return"Continue";case 13:return"Decorator";case 14:return"Del";case 15:return"Dictionary";case 16:return"DictionaryExpandEntry";case 17:return"DictionaryKeyEntry";case 18:return"Ellipsis";case 19:return"If";case 20:return"Import";case 21:return"ImportAs";case 22:return"ImportFrom";case 23:return"ImportFromAs";case 24:return"Index";case 25:return"Except";case 26:return"For";case 27:return"FormatString";case 28:return"Function";case 29:return"Global";case 30:return"Lambda";case 31:return"List";case 32:return"ListComprehension";case 33:return"ListComprehensionFor";case 34:return"ListComprehensionIf";case 35:return"MemberAccess";case 36:return"Module";case 37:return"ModuleName";case 38:return"Name";case 39:return"Nonlocal";case 40:return"Number";case 41:return"Parameter";case 42:return"Pass";case 43:return"Raise";case 44:return"Return";case 45:return"Set";case 46:return"Slice";case 47:return"StatementList";case 48:return"StringList";case 49:return"String";case 50:return"Suite";case 51:return"Ternary";case 52:return"Tuple";case 53:return"Try";case 54:return"TypeAnnotation";case 55:return"UnaryOperation";case 56:return"Unpack";case 57:return"While";case 58:return"With";case 59:return"WithItem";case 60:return"Yield";case 61:return"YieldFrom";case 62:return"FunctionAnnotation";case 63:return"Match";case 64:return"Case";case 65:return"PatternSequence";case 66:return"PatternAs";case 67:return"PatternLiteral";case 68:return"PatternClass";case 69:return"PatternCapture";case 70:return"PatternMapping";case 71:return"PatternMappingKeyEntry";case 72:return"PatternMappingExpandEntry";case 73:return"PatternValue";case 74:return"PatternClassArgument";case 75:return"TypeParameter";case 76:return"TypeParameterList";case 77:return"TypeAlias"}(0,l.assertNever)(e)},t.isWriteAccess=function(e){let t=e,n=t.parent;for(;n;){switch(n.nodeType){case 3:case 5:return t===n.leftExpression;case 4:case 25:return t===n.name;case 14:return!0;case 26:case 33:return t===n.targetExpression;case 21:return t===n.alias||n.module.nameParts.length>0&&t===n.module.nameParts[0];case 23:return t===n.alias||!n.alias&&t===n.name;case 35:if(t!==n.memberName)return!1;break;case 58:return n.withItems.some((e=>e===t));case 54:if(t===n.typeAnnotation)return!1;break;case 28:case 10:case 36:return!1}t=n,n=n.parent}return!1},t.getModuleNode=E,t.getFileInfoFromNode=function(e){const t=E(e);return t?s.getFileInfo(t):void 0},t.isFunctionSuiteEmpty=function(e){let t=!0;return e.suite.statements.forEach((e=>{0!==e.nodeType&&(47===e.nodeType?e.statements.forEach((e=>{18!==e.nodeType&&48!==e.nodeType&&42!==e.nodeType&&(t=!1)})):t=!1)})),t},t.getTypeAnnotationForParameter=function(e,t){if(t>=e.parameters.length)return;const n=e.parameters[t];if(n.typeAnnotation)return n.typeAnnotation;if(n.typeAnnotationComment)return n.typeAnnotationComment;if(!e.functionAnnotationComment||e.functionAnnotationComment.isParamListEllipsis)return;let a=0;const i=e.functionAnnotationComment.paramTypeAnnotations;i.length<e.parameters.length&&(a=1);const r=t-a;return r<0||r>=i.length?void 0:i[r]},t.isImportModuleName=function(e){var t,n;return 21===(null===(n=null===(t=z(e,37))||void 0===t?void 0:t.parent)||void 0===n?void 0:n.nodeType)},t.isImportAlias=function(e){var t;return 21===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.alias===e},t.isFromImportModuleName=function(e){var t,n;return 22===(null===(n=null===(t=z(e,37))||void 0===t?void 0:t.parent)||void 0===n?void 0:n.nodeType)},t.isFromImportName=function(e){var t;return 23===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.name===e},t.isFromImportAlias=function(e){var t;return 23===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.alias===e},t.isLastNameOfModuleName=function(e){var t;if(37!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType))return!1;const n=e.parent;return 0!==n.nameParts.length&&n.nameParts[n.nameParts.length-1]===e},t.getFirstAncestorOrSelfOfKind=z,t.getFirstAncestorOrSelf=M,t.getDottedNameWithGivenNodeAsLastName=function(e){var t;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||e.parent.leftExpression===e?e:e.parent},t.getDecoratorName=function(e){return function e(t){var n;return 38===t.nodeType||35===t.nodeType?null===(n=O(t))||void 0===n?void 0:n.map((e=>e.value)).join("."):9===t.nodeType?e(t.leftExpression):void 0}(e.expression)},t.getDottedName=O,t.getFirstNameOfDottedName=function e(t){return 38===t.nodeType?t:38===t.leftExpression.nodeType||35===t.leftExpression.nodeType?e(t.leftExpression):void 0},t.isFirstNameOfDottedName=function(e){var t;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||e.parent.leftExpression===e},t.isLastNameOfDottedName=function(e){var t,n;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||(38===e.parent.leftExpression.nodeType||35===e.parent.leftExpression.nodeType)&&(e.parent.leftExpression!==e&&35!==(null===(n=e.parent.parent)||void 0===n?void 0:n.nodeType))},t.getStringNodeValueRange=function(e){return V(e.token)},t.getStringValueRange=V,t.getFullStatementRange=function(e,t,n){var a;const i=t.tokenizerOutput,r=(0,p.convertTextRangeToRange)(e,i.lines),s=null!==(a=function(e,t,n){const a=n.tokens.getItemAtPosition(t);if(a<0)return;let i=a;for(;i>0;i--){const t=n.tokens.getItemAt(i);if((0,p.convertTextRangeToRange)(t,n.lines).end.line!==e.start.line)break}for(let t=a-1;t>i;t--){const a=n.tokens.getItemAt(t);if(3!==a.type&&4!==a.type){if(2===a.type)return;return e.start}}return}(r,e.start,i))&&void 0!==a?a:{line:r.start.line,character:0},o=function(e,t,n){const a=n.tokens.getItemAtPosition(t);if(a<0)return;let i=a;for(;i<n.tokens.count;i++){const t=n.tokens.getItemAt(i),a=(0,p.convertTextRangeToRange)(t,n.lines);if(e.end.line!==a.start.line)break}let r=!1;for(let e=a;e<i;e++){const t=n.tokens.getItemAt(e);if(11===t.type||2===t.type){r=!0;continue}if(!r)continue;return(0,p.convertTextRangeToRange)(t,n.lines).start}return}(r,c.TextRange.getEnd(e),i);if(o)return{start:s,end:o};if(r.end.line===i.lines.count-1)return{start:s,end:r.end};let l=1;if(n&&n.includeTrailingBlankLines)for(let e=l;r.end.line+e<i.lines.count;e++)if(!R(t,r.end.line+e)){l=e;break}return{start:s,end:{line:r.end.line+l,character:0}}},t.isBlankLine=R,t.isUnannotatedFunction=function(e){return void 0===e.returnTypeAnnotation&&e.parameters.every((e=>void 0===e.typeAnnotation&&void 0===e.typeAnnotationComment))},t.isValidLocationForFutureImport=function(e){const t=E(e);(0,l.assert)(t);let n=!1;for(const a of t.statements){if(47!==a.nodeType)return!1;for(const t of a.statements){if(t===e)return!0;if(48===t.nodeType){if(n)return!1;n=!0}else{if(22!==t.nodeType)return!1;if(0!==t.module.leadingDots||1!==t.module.nameParts.length||"__future__"!==t.module.nameParts[0].value)return!1}}}return!1},t.operatorSupportsChaining=function(e){switch(e){case 12:case 28:case 20:case 21:case 15:case 16:case 39:case 40:case 41:case 42:return!0}return!1},t.getVariableDocStringNode=function(e){var t,n,a,i;let r,s=e;for(;s&&3!==s.nodeType;)54!==s.nodeType||r||(r=s),s=s.parent;if(3!==(null==s?void 0:s.nodeType)){if(!r)return;s=r}const o=s.parent;if(47!==(null==o?void 0:o.nodeType))return;const l=o.parent;if(!l||36!==l.nodeType&&50!==l.nodeType)return;const p=l.statements.findIndex((e=>e===o));if(p<0||p===l.statements.length-1)return;const c=l.statements[p+1];if(47!==c.nodeType||!w(c))return;let d=!1;if(36===(null===(t=null==o?void 0:o.parent)||void 0===t?void 0:t.nodeType))d=!0;else if(50===(null===(n=null==o?void 0:o.parent)||void 0===n?void 0:n.nodeType)&&10===(null===(i=null===(a=null==o?void 0:o.parent)||void 0===a?void 0:a.parent)||void 0===i?void 0:i.nodeType))d=!0;else{const e=_(o);e&&"__init__"===e.name.value&&b(e,!0)&&(d=!0)}return d?c.statements[0]:void 0},t.getScopeIdForNode=L,t.getTypeVarScopesForNode=function(e){const t=[];let n=e;for(;n&&(n=C(n),n);)t.push(L(n)),n=n.parent;return t}},59438:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreeWalker=t.ParseTreeVisitor=t.getChildNodes=void 0;const s=r(n(30795));function o(e){var t,n;switch(e.nodeType){case 0:return[e.child,...null!==(t=e.decorators)&&void 0!==t?t:[]];case 1:return[e.name,e.valueExpression];case 2:return[e.testExpression,e.exceptionExpression];case 4:return[e.name,e.rightExpression];case 3:return[e.leftExpression,e.rightExpression,e.typeAnnotationComment];case 5:case 7:return[e.leftExpression,e.rightExpression];case 6:case 13:case 67:case 73:case 55:case 56:case 60:case 61:return[e.expression];case 8:case 11:case 12:case 18:case 38:case 40:case 42:case 49:return[];case 9:return[e.leftExpression,...e.arguments];case 64:return[e.pattern,e.guardExpression,e.suite];case 10:return[...e.decorators,e.name,e.typeParameters,...e.arguments,e.suite];case 14:case 52:return e.expressions;case 15:case 31:case 45:return e.entries;case 16:return[e.expandExpression];case 17:return[e.keyExpression,e.valueExpression];case 19:return[e.testExpression,e.ifSuite,e.elseSuite];case 20:return e.list;case 21:return[e.module,e.alias];case 22:return[e.module,...e.imports];case 23:return[e.name,e.alias];case 24:return[e.baseExpression,...e.items];case 25:return[e.typeExpression,e.name,e.exceptSuite];case 26:return[e.targetExpression,e.iterableExpression,e.forSuite,e.elseSuite];case 27:return[...e.fieldExpressions,...null!==(n=e.formatExpressions)&&void 0!==n?n:[]];case 28:return[...e.decorators,e.name,e.typeParameters,...e.parameters,e.returnTypeAnnotation,e.functionAnnotationComment,e.suite];case 62:return[...e.paramTypeAnnotations,e.returnTypeAnnotation];case 29:case 39:return e.nameList;case 30:return[...e.parameters,e.expression];case 32:return[e.expression,...e.forIfNodes];case 33:return[e.targetExpression,e.iterableExpression];case 34:return[e.testExpression];case 63:return[e.subjectExpression,...e.cases];case 35:return[e.leftExpression,e.memberName];case 37:return e.nameParts;case 36:case 50:return[...e.statements];case 41:return[e.name,e.typeAnnotation,e.typeAnnotationComment,e.defaultValue];case 66:return[...e.orPatterns,e.target];case 68:return[e.className,...e.arguments];case 74:return[e.name,e.pattern];case 69:case 72:return[e.target];case 71:return[e.keyPattern,e.valuePattern];case 70:case 65:return[...e.entries];case 43:return[e.typeExpression,e.valueExpression,e.tracebackExpression];case 44:return[e.returnExpression];case 46:return[e.startValue,e.endValue,e.stepValue];case 47:return e.statements;case 48:return[e.typeAnnotation,...e.strings];case 51:return[e.ifExpression,e.testExpression,e.elseExpression];case 53:return[e.trySuite,...e.exceptClauses,e.elseSuite,e.finallySuite];case 77:return[e.name,e.typeParameters,e.expression];case 54:return[e.valueExpression,e.typeAnnotation];case 75:return[e.name,e.boundExpression,e.defaultExpression];case 76:return[...e.parameters];case 57:return[e.testExpression,e.whileSuite,e.elseSuite];case 58:return[...e.withItems,e.suite];case 59:return[e.expression,e.target];default:s.assertNever(e,`Unknown node type ${e}`)}}t.getChildNodes=o;class l{constructor(e){this._default=e}visit(e){switch(e.nodeType){case 0:return this.visitError(e);case 1:return this.visitArgument(e);case 2:return this.visitAssert(e);case 4:return this.visitAssignmentExpression(e);case 3:return this.visitAssignment(e);case 5:return this.visitAugmentedAssignment(e);case 6:return this.visitAwait(e);case 7:return this.visitBinaryOperation(e);case 8:return this.visitBreak(e);case 9:return this.visitCall(e);case 64:return this.visitCase(e);case 10:return this.visitClass(e);case 11:return this.visitConstant(e);case 12:return this.visitContinue(e);case 13:return this.visitDecorator(e);case 14:return this.visitDel(e);case 15:return this.visitDictionary(e);case 16:return this.visitDictionaryExpandEntry(e);case 17:return this.visitDictionaryKeyEntry(e);case 18:return this.visitEllipsis(e);case 19:return this.visitIf(e);case 20:return this.visitImport(e);case 21:return this.visitImportAs(e);case 22:return this.visitImportFrom(e);case 23:return this.visitImportFromAs(e);case 24:return this.visitIndex(e);case 25:return this.visitExcept(e);case 26:return this.visitFor(e);case 27:return this.visitFormatString(e);case 28:return this.visitFunction(e);case 62:return this.visitFunctionAnnotation(e);case 29:return this.visitGlobal(e);case 30:return this.visitLambda(e);case 31:return this.visitList(e);case 32:return this.visitListComprehension(e);case 33:return this.visitListComprehensionFor(e);case 34:return this.visitListComprehensionIf(e);case 63:return this.visitMatch(e);case 35:return this.visitMemberAccess(e);case 37:return this.visitModuleName(e);case 36:return this.visitModule(e);case 38:return this.visitName(e);case 39:return this.visitNonlocal(e);case 40:return this.visitNumber(e);case 41:return this.visitParameter(e);case 42:return this.visitPass(e);case 66:return this.visitPatternAs(e);case 68:return this.visitPatternClass(e);case 74:return this.visitPatternClassArgument(e);case 69:return this.visitPatternCapture(e);case 67:return this.visitPatternLiteral(e);case 72:return this.visitPatternMappingExpandEntry(e);case 71:return this.visitPatternMappingKeyEntry(e);case 70:return this.visitPatternMapping(e);case 65:return this.visitPatternSequence(e);case 73:return this.visitPatternValue(e);case 43:return this.visitRaise(e);case 44:return this.visitReturn(e);case 45:return this.visitSet(e);case 46:return this.visitSlice(e);case 47:return this.visitStatementList(e);case 48:return this.visitStringList(e);case 49:return this.visitString(e);case 50:return this.visitSuite(e);case 51:return this.visitTernary(e);case 52:return this.visitTuple(e);case 53:return this.visitTry(e);case 77:return this.visitTypeAlias(e);case 54:return this.visitTypeAnnotation(e);case 75:return this.visitTypeParameter(e);case 76:return this.visitTypeParameterList(e);case 55:return this.visitUnaryOperation(e);case 56:return this.visitUnpack(e);case 57:return this.visitWhile(e);case 58:return this.visitWith(e);case 59:return this.visitWithItem(e);case 60:return this.visitYield(e);case 61:return this.visitYieldFrom(e);default:s.assertNever(e,`Unknown node type ${e}`)}}visitArgument(e){return this._default}visitAssert(e){return this._default}visitAssignment(e){return this._default}visitAssignmentExpression(e){return this._default}visitAugmentedAssignment(e){return this._default}visitAwait(e){return this._default}visitBinaryOperation(e){return this._default}visitBreak(e){return this._default}visitCall(e){return this._default}visitCase(e){return this._default}visitClass(e){return this._default}visitTernary(e){return this._default}visitContinue(e){return this._default}visitConstant(e){return this._default}visitDecorator(e){return this._default}visitDel(e){return this._default}visitDictionary(e){return this._default}visitDictionaryKeyEntry(e){return this._default}visitDictionaryExpandEntry(e){return this._default}visitError(e){return this._default}visitEllipsis(e){return this._default}visitIf(e){return this._default}visitImport(e){return this._default}visitImportAs(e){return this._default}visitImportFrom(e){return this._default}visitImportFromAs(e){return this._default}visitIndex(e){return this._default}visitExcept(e){return this._default}visitFor(e){return this._default}visitFormatString(e){return this._default}visitFunction(e){return this._default}visitFunctionAnnotation(e){return this._default}visitGlobal(e){return this._default}visitLambda(e){return this._default}visitList(e){return this._default}visitListComprehension(e){return this._default}visitListComprehensionFor(e){return this._default}visitListComprehensionIf(e){return this._default}visitMatch(e){return this._default}visitMemberAccess(e){return this._default}visitModule(e){return this._default}visitModuleName(e){return this._default}visitName(e){return this._default}visitNonlocal(e){return this._default}visitNumber(e){return this._default}visitParameter(e){return this._default}visitPass(e){return this._default}visitPatternCapture(e){return this._default}visitPatternClass(e){return this._default}visitPatternClassArgument(e){return this._default}visitPatternAs(e){return this._default}visitPatternLiteral(e){return this._default}visitPatternMappingExpandEntry(e){return this._default}visitPatternSequence(e){return this._default}visitPatternValue(e){return this._default}visitPatternMappingKeyEntry(e){return this._default}visitPatternMapping(e){return this._default}visitRaise(e){return this._default}visitReturn(e){return this._default}visitSet(e){return this._default}visitSlice(e){return this._default}visitStatementList(e){return this._default}visitString(e){return this._default}visitStringList(e){return this._default}visitSuite(e){return this._default}visitTuple(e){return this._default}visitTry(e){return this._default}visitTypeAlias(e){return this._default}visitTypeAnnotation(e){return this._default}visitTypeParameter(e){return this._default}visitTypeParameterList(e){return this._default}visitUnaryOperation(e){return this._default}visitUnpack(e){return this._default}visitWhile(e){return this._default}visitWith(e){return this._default}visitWithItem(e){return this._default}visitYield(e){return this._default}visitYieldFrom(e){return this._default}}t.ParseTreeVisitor=l;t.ParseTreeWalker=class extends l{constructor(){super(!0)}walk(e){const t=this.visitNode(e);t.length>0&&this.walkMultiple(t)}walkMultiple(e){e.forEach((e=>{e&&this.walk(e)}))}visitNode(e){return this.visit(e)?o(e):[]}}},78140:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPatternSubtypeNarrowingCallback=t.validateClassPattern=t.assignTypeToPatternTargets=t.checkForUnusedPattern=t.narrowTypeBasedOnPattern=void 0;const a=n(5284),i=n(30795),r=n(83501),s=n(28513),o=n(99661),l=n(21),p=n(54750),c=n(66455),d=n(2026),u=n(36906),m=n(51458),y=n(33029),g=n(43024),h=["builtins.bool","builtins.bytearray","builtins.bytes","builtins.dict","builtins.float","builtins.frozenset","builtins.int","builtins.list","builtins.set","builtins.str","builtins.tuple"];function f(e,t,n,i){switch(n.nodeType){case 65:return function(e,t,n,i){t=(0,y.transformPossibleRecursiveTypeAlias)(t);let r=I(e,n,t);return r=r.filter((t=>{var r;if(t.isDefiniteNoMatch)return!i;let s=!0,o=!0;const l=[];let p=t.isTuple;!i&&t.isIndeterminateLength&&(p=!1),t.isIndeterminateLength&&(1===n.entries.length&&0===n.starEntryIndex||(o=!1));let c=0;if(n.entries.forEach(((r,d)=>{const u=C(e,n,t,d,n.entries.length,n.starEntryIndex,!0),g=f(e,u,r,i);i?d===n.starEntryIndex?(0,m.isClassInstance)(g)&&g.tupleTypeArguments&&!(0,y.isUnboundedTupleClass)(g)&&g.tupleTypeArguments?(0,a.appendArray)(l,g.tupleTypeArguments.map((e=>e.type))):(l.push(g),p=!1):(l.push(g),(0,m.isNever)(g)&&(s=!1)):(t.isPotentialNoMatch&&(o=!1),(0,m.isNever)(g)?l.push(u):(o=!1,c++,l.push(g)),d===n.starEntryIndex&&(p=!1))})),!i){if(o)return!1;if(p&&1===c){const a=e.getBuiltInType(n,"tuple");a&&(0,m.isInstantiableClass)(a)&&(t.subtype=m.ClassType.cloneAsInstance((0,y.specializeTupleClass)(a,l.map((e=>({type:e,isUnbounded:!1}))))))}return!0}if(s){if(p){const a=e.getBuiltInType(n,"tuple");a&&(0,m.isInstantiableClass)(a)&&(t.subtype=m.ClassType.cloneAsInstance((0,y.specializeTupleClass)(a,l.map((e=>({type:e,isUnbounded:!1}))))))}if(t.isPotentialNoMatch){const a=e.getTypingType(n,"Sequence");if(a&&(0,m.isInstantiableClass)(a)){let n=e.stripLiteralValue((0,m.combineTypes)(l));n=null!==(r=(0,y.containsAnyOrUnknown)(n,!1))&&void 0!==r?r:n,t.subtype=m.ClassType.cloneAsInstance(m.ClassType.cloneForSpecialization(a,[n],!0))}}}return s})),(0,m.combineTypes)(r.map((e=>e.subtype)))}(e,t,n,i);case 67:return function(e,t,n,a){const i=e.getTypeOfExpression(n.expression).type;if(!a)return(0,y.mapSubtypes)(t,(t=>{if(!((0,m.isClassInstance)(i)&&(0,y.isLiteralType)(i)&&(0,m.isClassInstance)(t)&&(0,y.isLiteralType)(t)&&e.assignType(i,t)||(0,m.isNoneInstance)(t)&&(0,m.isNoneInstance)(i)))return(0,m.isClassInstance)(t)&&m.ClassType.isBuiltIn(t,"bool")&&void 0===t.literalValue&&(0,m.isClassInstance)(i)&&m.ClassType.isBuiltIn(i,"bool")&&void 0!==i.literalValue?m.ClassType.cloneWithLiteral(i,!i.literalValue):t}));return(0,y.mapSubtypes)(t,(t=>e.assignType(t,i)?i:(0,m.isClassInstance)(i)&&(0,y.isLiteralType)(i)&&(0,m.isClassInstance)(t)&&!(0,y.isLiteralType)(t)&&e.assignType(m.ClassType.cloneWithLiteral(i,void 0),t)?t:void 0))}(e,t,n,i);case 68:return function(e,t,n,a){let i=e.getTypeOfExpression(n.className,2).type;(0,m.isClass)(i)&&!i.typeAliasInfo&&(i=(0,y.specializeClassType)(i));if(!a){if(!(0,m.isInstantiableClass)(i))return t;let r=i;r.details.typeParameters.length>0&&(r=m.ClassType.cloneForSpecialization(r,void 0,!1));const s=(0,y.convertToInstance)(r),o=(0,y.isMetaclassInstance)(s);return e.mapSubtypesExpandTypeVars(t,void 0,((t,i)=>{var l;if(o&&(0,m.isInstantiableClass)(t)){const n=null!==(l=t.details.effectiveMetaclass)&&void 0!==l?l:m.UnknownType.create();if((0,m.isInstantiableClass)(r)&&e.assignType(r,n))return;return t}if(!(0,m.isNoneInstance)(t)&&!(0,m.isClassInstance)(t))return i;if((0,m.isNoneInstance)(t)&&(0,m.isInstantiableClass)(r)&&m.ClassType.isBuiltIn(r,"NoneType"))return;if(!e.assignType(s,t))return t;if(0===n.arguments.length){if((0,m.isClass)(s)&&(0,m.isClass)(t)&&m.ClassType.isSameGenericClass(s,t))return;return t}if(!e.assignType(t,s)&&(0,m.isClass)(t)&&!m.ClassType.isFinal(t))return t;let p=[];n.arguments.some((e=>!e.name))&&(0,m.isClass)(t)&&(p=T(e,t));for(let r=0;r<n.arguments.length;r++){const s=b(e,n.arguments[r],r,p,t,a);if(!(0,m.isNever)(s))return i}}))}if(!m.TypeBase.isInstantiable(i)&&!(0,m.isNever)(i))return e.addDiagnostic((0,l.getFileInfo)(n).diagnosticRuleSet.reportGeneralTypeIssues,s.DiagnosticRule.reportGeneralTypeIssues,o.Localizer.DiagnosticAddendum.typeNotClass().format({type:e.printType(i)}),n.className),m.NeverType.createNever();return e.mapSubtypesExpandTypeVars(i,void 0,((i,r)=>{if((0,m.isAnyOrUnknown)(i))return r;if((0,m.isInstantiableClass)(i)){const s=(0,y.convertToInstance)(i),o=(0,y.isMetaclassInstance)(s);return e.mapSubtypesExpandTypeVars(t,void 0,(t=>{var s;if((0,m.isAnyOrUnknown)(t))return(0,y.convertToInstance)(r);if(o&&(0,m.isInstantiableClass)(t)){const n=null!==(s=t.details.effectiveMetaclass)&&void 0!==s?s:m.UnknownType.create();return e.assignType(i,n)||e.assignType(n,i)?t:void 0}if((0,m.isNoneInstance)(t)&&(0,m.isInstantiableClass)(i)&&m.ClassType.isBuiltIn(i,"NoneType"))return t;if((0,m.isClassInstance)(t)){let s;if(e.assignType(i,m.ClassType.cloneAsInstantiable(t)))s=t;else{if(!e.assignType(m.ClassType.cloneAsInstantiable(t),i))return;if(s=(0,y.addConditionToType)((0,y.convertToInstance)(r),(0,y.getTypeCondition)(t)),(0,m.isInstantiableClass)(r)&&(0,m.isClassInstance)(t)&&(m.ClassType.isSpecialBuiltIn(r)||r.details.typeParameters.length>0)){const n=new g.TypeVarContext((0,y.getTypeVarScopeId)(r)),a=m.ClassType.cloneForSpecialization(r,void 0,!1),i=m.ClassType.cloneAsInstance(a);(0,p.populateTypeVarContextBasedOnExpectedType)(e,i,t,n,void 0,void 0)&&(s=(0,y.applySolvedTypeVars)(i,n,{unknownIfNotFound:!0}))}}let o=[];n.arguments.some((e=>!e.name))&&(o=T(e,i));let l=!0;if(n.arguments.forEach(((t,n)=>{const i=b(e,t,n,o,s,a);(0,m.isNever)(i)&&(l=!1)})),l)return s}}))}}))}(e,t,n,i);case 66:return function(e,t,n,a){let i=t;if(!a)return n.orPatterns.forEach((t=>{i=f(e,i,t,!1)})),i;const r=n.orPatterns.map((t=>{const n=f(e,i,t,!0);return i=f(e,i,t,!1),n}));return(0,m.combineTypes)(r)}(e,t,n,i);case 70:return function(e,t,n,a){if(t=(0,y.transformPossibleRecursiveTypeAlias)(t),!a){if(1!==n.entries.length||71!==n.entries[0].nodeType)return t;const a=n.entries[0].keyPattern,i=n.entries[0].valuePattern;if(67!==a.nodeType||66!==i.nodeType||!i.orPatterns.every((e=>67===e.nodeType)))return t;const r=e.getTypeOfExpression(a.expression).type;if(!(0,m.isClassInstance)(r)||!m.ClassType.isBuiltIn(r,"str")||void 0===r.literalValue)return t;const s=r.literalValue,o=i.orPatterns.map((t=>e.getTypeOfExpression(t.expression).type));return(0,y.mapSubtypes)(t,(t=>{if((0,m.isClassInstance)(t)&&m.ClassType.isTypedDictClass(t)){const n=(0,d.getTypedDictMembersForClass)(e,t,!0).get(s);if(n&&(n.isRequired||n.isProvided)&&(0,m.isClassInstance)(n.valueType)){const e=n.valueType;if(o.some((t=>(0,m.isClassInstance)(t)&&m.ClassType.isSameGenericClass(t,e)&&t.literalValue===e.literalValue)))return}}return t}))}let i=_(e,t);return i=i.filter((t=>{let i=!0;return n.entries.forEach((r=>{if(t.typedDict){if(71===r.nodeType){const s=f(e,e.getBuiltInObject(n,"str"),r.keyPattern,a);(0,m.isNever)(s)&&(i=!1);const o=(0,y.mapSubtypes)(s,(n=>{var a;if((0,m.isAnyOrUnknown)(n))return n;if((0,m.isClassInstance)(n)&&m.ClassType.isBuiltIn(n,"str")){if(!(0,y.isLiteralType)(n))return m.UnknownType.create();const i=(0,d.getTypedDictMembersForClass)(e,t.typedDict).get(n.literalValue);if(i){const s=f(e,i.valueType,r.valuePattern,!0);if(!(0,m.isNever)(s)){if(!i.isRequired&&!i.isProvided&&(0,m.isTypeSame)(t.subtype,t.typedDict)){const e=new Map(null!==(a=t.typedDict.typedDictNarrowedEntries)&&void 0!==a?a:[]);e.set(n.literalValue,{valueType:i.valueType,isReadOnly:i.isReadOnly,isRequired:!1,isProvided:!0}),t.subtype=m.ClassType.cloneAsInstance(m.ClassType.cloneForNarrowedTypedDictEntries(m.ClassType.cloneAsInstantiable(t.typedDict),e)),t.typedDict=t.subtype}return s}}}}));(0,m.isNever)(o)&&(i=!1)}}else if(t.dictTypeArgs&&71===r.nodeType){const n=f(e,t.dictTypeArgs.key,r.keyPattern,a),s=f(e,t.dictTypeArgs.value,r.valuePattern,a);((0,m.isNever)(n)||(0,m.isNever)(s))&&(i=!1)}})),i})),(0,m.combineTypes)(i.map((e=>e.subtype)))}(e,t,n,i);case 73:return function(e,t,n,a){const i=e.getTypeOfExpression(n.expression).type,r=[];return e.mapSubtypesExpandTypeVars(i,void 0,((i,s)=>{r.push(e.mapSubtypesExpandTypeVars(t,(0,y.getTypeCondition)(i),(t=>{if(!a){if((0,m.isClassInstance)(t)&&m.ClassType.isEnumClass(t)&&!(0,y.isLiteralType)(t)&&(0,m.isClassInstance)(i)&&(0,m.isSameWithoutLiteralValue)(t,i)&&(0,y.isLiteralType)(i)){const n=(0,u.enumerateLiteralsForType)(e,t);if(n)return(0,m.combineTypes)(n.filter((e=>!m.ClassType.isLiteralValueSame(i,e))))}else if((0,m.isClassInstance)(t)&&(0,m.isClassInstance)(i)&&(0,y.isLiteralType)(t)&&m.ClassType.isLiteralValueSame(i,t))return;return t}if((0,m.isNever)(i)||(0,m.isNever)(t))return m.NeverType.createNever();if((0,m.isAnyOrUnknown)(i)||(0,m.isAnyOrUnknown)(t))return(0,m.isUnknown)(i)||(0,m.isUnknown)(t)?(0,y.preserveUnknown)(i,t):m.AnyType.create();return e.useSpeculativeMode(n.expression,(()=>e.getTypeOfMagicMethodReturn(i,[{type:t}],"__eq__",n.expression,void 0)))?s:void 0})))})),(0,m.combineTypes)(r)}(e,t,n,i);case 69:return i?t:m.NeverType.createNever();case 0:return t}}function T(e,t){const n=(0,y.lookUpClassMember)(t,"__match_args__");if(n){const t=e.getTypeOfMember(n);if((0,m.isClassInstance)(t)&&(0,y.isTupleClass)(t)&&!(0,y.isUnboundedTupleClass)(t)&&t.tupleTypeArguments){const e=t.tupleTypeArguments;if(e.every((e=>(0,m.isClassInstance)(e.type)&&m.ClassType.isBuiltIn(e.type,"str")&&(0,y.isLiteralType)(e.type))))return e.map((e=>e.type.literalValue))}}return[]}function v(e){return h.some((t=>e.details.fullName===t))}function b(e,t,n,a,i,r){var s;let o;if(t.name?o=t.name.value:n<a.length&&(o=a[n]),(0,m.isAnyOrUnknown)(i))return i;if(!(0,m.isClass)(i))return m.UnknownType.create();let l,p=!1,c=i;if(!t.name&&(0,m.isClass)(i)&&0===n&&(v(i)?p=!0:0===a.length&&i.details.mro.forEach((e=>{(0,m.isClass)(e)&&v(e)&&(c=e,p=!0)}))),p)l=m.ClassType.cloneAsInstance(c);else if(o&&(l=null===(s=e.useSpeculativeMode(t,(()=>e.getTypeOfObjectMember(t,m.ClassType.cloneAsInstance(i),o))))||void 0===s?void 0:s.type),!l){if(!r)return i;if(m.ClassType.isFinal(i))return m.NeverType.createNever();l=m.UnknownType.create()}return f(e,l,t.pattern,r)}function _(e,t){const n=[];return(0,y.doForEachSubtype)(t,(t=>{const a=e.makeTopLevelTypeVarsConcrete(t);if((0,m.isAnyOrUnknown)(a))n.push({subtype:t,dictTypeArgs:{key:a,value:a}});else if((0,m.isClassInstance)(a))if(m.ClassType.isTypedDictClass(a))n.push({subtype:t,typedDict:a});else{let e;for(const t of a.details.mro)if((0,m.isInstantiableClass)(t)&&m.ClassType.isBuiltIn(t,"Mapping")){e=t;break}if(e){const i=(0,y.partiallySpecializeType)(e,a);i.typeArguments&&i.typeArguments.length>=2&&n.push({subtype:t,dictTypeArgs:{key:i.typeArguments[0],value:i.typeArguments[1]}})}}})),n}function I(e,t,n){const a=t.entries.length,i=t.starEntryIndex,r=[],s=void 0===i?a:a-1;return(0,y.doForEachSubtype)(n,(n=>{const a=e.makeTopLevelTypeVarsConcrete(n);let o,l=!1;if((0,m.isClassInstance)(a)){for(const e of a.details.mro){if(!(0,m.isInstantiableClass)(e))break;if(m.ClassType.isBuiltIn(e,"str")||m.ClassType.isBuiltIn(e,"bytes")||m.ClassType.isBuiltIn(e,"bytearray"))return;if(m.ClassType.isBuiltIn(e,"Sequence")){o=e;break}if((0,y.isTupleClass)(e)){o=e;break}}if(o){const e=(0,y.partiallySpecializeType)(o,a);(0,y.isTupleClass)(e)?e.tupleTypeArguments&&((0,y.isUnboundedTupleClass)(e)?(r.push({subtype:n,entryTypes:[(0,m.combineTypes)(e.tupleTypeArguments.map((e=>e.type)))],isIndeterminateLength:!0,isTuple:!0,isDefiniteNoMatch:!1}),l=!0):e.tupleTypeArguments.length>=s&&(void 0!==i||e.tupleTypeArguments.length===s)&&(r.push({subtype:n,entryTypes:e.tupleTypeArguments.map((e=>e.type)),isIndeterminateLength:!1,isTuple:!0,isDefiniteNoMatch:!1}),l=!0)):(r.push({subtype:n,entryTypes:[e.typeArguments&&e.typeArguments.length>0?e.typeArguments[0]:m.UnknownType.create()],isIndeterminateLength:!0,isDefiniteNoMatch:!1}),l=!0)}}if(!l){const a=e.getTypingType(t,"Sequence");if(a&&(0,m.isInstantiableClass)(a)){const i=new g.TypeVarContext((0,y.getTypeVarScopeId)(a));if((0,p.populateTypeVarContextBasedOnExpectedType)(e,m.ClassType.cloneAsInstance(a),n,i,(0,c.getTypeVarScopesForNode)(t),t.start)){const e=(0,y.applySolvedTypeVars)(m.ClassType.cloneAsInstantiable(a),i);if(e.typeArguments&&e.typeArguments.length>0)return void r.push({subtype:n,entryTypes:[e.typeArguments[0]],isIndeterminateLength:!0,isDefiniteNoMatch:!1,isPotentialNoMatch:!0})}if(e.assignType(n,m.ClassType.cloneForSpecialization(m.ClassType.cloneAsInstance(a),[m.UnknownType.create()],!0)))return void r.push({subtype:n,entryTypes:[m.UnknownType.create()],isIndeterminateLength:!0,isDefiniteNoMatch:!1,isPotentialNoMatch:!0})}r.push({subtype:n,entryTypes:[],isIndeterminateLength:!0,isDefiniteNoMatch:!0})}})),r}function C(e,t,n,a,r,s,o){if(n.isIndeterminateLength){let i=n.entryTypes[0];return o||a!==s||(0,m.isNever)(i)||(i=k(e,t,i)),i}if(void 0===s||a<s)return n.entryTypes[a];if(a===s){const a=n.entryTypes.slice(s,s+n.entryTypes.length-r+1).map((t=>e.stripLiteralValue(t)));let i=(0,m.combineTypes)(a);return o||(i=k(e,t,i)),i}const l=n.entryTypes.length-(r-a);return(0,i.assert)(l>=0&&l<n.entryTypes.length),n.entryTypes[l]}function k(e,t,n){var a;if((0,m.isNever)(n))return n;const i=(0,y.convertToInstance)(e.getBuiltInObject(t,"list"));return i&&(0,m.isClassInstance)(i)?(n=null!==(a=(0,y.containsAnyOrUnknown)(n,!1))&&void 0!==a?a:n,m.ClassType.cloneForSpecialization(i,[n],!0)):m.UnknownType.create()}function S(e,t,n){e.addDiagnostic((0,l.getFileInfo)(t).diagnosticRuleSet.reportUnnecessaryComparison,s.DiagnosticRule.reportUnnecessaryComparison,o.Localizer.Diagnostic.patternNeverMatches().format({type:e.printType(n)}),t)}t.narrowTypeBasedOnPattern=f,t.checkForUnusedPattern=function(e,t,n){if((0,m.isNever)(n))S(e,t,n);else if(66===t.nodeType&&t.orPatterns.length>1)t.orPatterns.forEach((t=>{const a=f(e,n,t,!0);(0,m.isNever)(a)&&S(e,t,n),n=f(e,n,t,!1)}));else{const a=f(e,n,t,!0);(0,m.isNever)(a)&&S(e,t,n)}},t.assignTypeToPatternTargets=function e(t,n,a,i){const p=f(t,n,i,!0);switch(i.nodeType){case 65:{const n=I(t,i,p).filter((e=>!e.isDefiniteNoMatch));i.entries.forEach(((r,s)=>{const o=(0,m.combineTypes)(n.map((e=>C(t,i,e,s,i.entries.length,i.starEntryIndex,!1))));e(t,o,a,r)}));break}case 66:{i.target&&t.assignTypeToExpression(i.target,p,a,i.target);let n=p;i.orPatterns.forEach((i=>{e(t,n,a,i),n=f(t,n,i,!1)}));break}case 69:if(i.isWildcard){if(!a){const e=(0,l.getFileInfo)(i);if((0,m.isUnknown)(p))t.addDiagnostic(e.diagnosticRuleSet.reportUnknownVariableType,s.DiagnosticRule.reportUnknownVariableType,o.Localizer.Diagnostic.wildcardPatternTypeUnknown(),i.target);else if((0,y.isPartlyUnknown)(p)){const n=new r.DiagnosticAddendum;n.addMessage(o.Localizer.DiagnosticAddendum.typeOfSymbol().format({name:"_",type:t.printType(p,{expandTypeAlias:!0})})),t.addDiagnostic(e.diagnosticRuleSet.reportUnknownVariableType,s.DiagnosticRule.reportUnknownVariableType,o.Localizer.Diagnostic.wildcardPatternTypePartiallyUnknown()+n.getString(),i.target)}}}else t.assignTypeToExpression(i.target,p,a,i.target);break;case 70:{const n=_(t,p);i.entries.forEach((r=>{const s=[],o=[];n.forEach((e=>{if(e.typedDict)if(71===r.nodeType){const n=f(t,t.getBuiltInObject(i,"str"),r.keyPattern,!0);s.push(n),(0,y.doForEachSubtype)(n,(n=>{if((0,m.isClassInstance)(n)&&m.ClassType.isBuiltIn(n,"str")&&(0,y.isLiteralType)(n)){const a=(0,d.getTypedDictMembersForClass)(t,e.typedDict).get(n.literalValue);o.push(a?a.valueType:m.UnknownType.create())}else o.push(m.UnknownType.create())}))}else 72===r.nodeType&&(s.push(t.getBuiltInObject(i,"str")),o.push(m.UnknownType.create()));else if(e.dictTypeArgs)if(71===r.nodeType){const n=f(t,e.dictTypeArgs.key,r.keyPattern,!0);s.push(n),o.push(f(t,e.dictTypeArgs.value,r.valuePattern,!0))}else 72===r.nodeType&&(s.push(e.dictTypeArgs.key),o.push(e.dictTypeArgs.value))}));const l=(0,m.combineTypes)(s),p=(0,m.combineTypes)(o);if(71===r.nodeType)e(t,l,a,r.keyPattern),e(t,p,a,r.valuePattern);else if(72===r.nodeType){const e=t.getBuiltInType(i,"dict"),n=t.getBuiltInObject(i,"str"),s=e&&(0,m.isInstantiableClass)(e)&&(0,m.isClassInstance)(n)?m.ClassType.cloneAsInstance(m.ClassType.cloneForSpecialization(e,[l,p],!0)):m.UnknownType.create();t.assignTypeToExpression(r.target,s,a,r.target)}}));break}case 68:{const n=i.arguments.map((e=>[]));t.mapSubtypesExpandTypeVars(p,void 0,(e=>{(0,m.isClassInstance)(e)?(0,y.doForEachSubtype)(p,(a=>{const r=t.makeTopLevelTypeVarsConcrete(a);if((0,m.isAnyOrUnknown)(r))i.arguments.forEach(((e,t)=>{n[t].push(r)}));else if((0,m.isClassInstance)(r)){let a=[];i.arguments.some((e=>!e.name))&&(a=T(t,m.ClassType.cloneAsInstantiable(e))),i.arguments.forEach(((i,r)=>{const s=b(t,i,r,a,m.ClassType.cloneAsInstantiable(e),!0);n[r].push(s)}))}})):i.arguments.forEach(((e,t)=>{n[t].push(m.UnknownType.create())}))})),i.arguments.forEach(((i,r)=>{e(t,(0,m.combineTypes)(n[r]),a,i.pattern)}));break}}return p},t.validateClassPattern=function(e,t){const n=e.getTypeOfExpression(t.className,2).type;if(!(0,m.isAnyOrUnknown)(n))if(n.typeAliasInfo&&(0,m.isInstantiableClass)(n)&&n.typeArguments&&n.isTypeArgumentExplicit)e.addDiagnostic((0,l.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,s.DiagnosticRule.reportGeneralTypeIssues,o.Localizer.Diagnostic.classPatternTypeAlias().format({type:e.printType(n)}),t.className);else if((0,m.isInstantiableClass)(n)){h.some((e=>n.details.fullName===e))&&(t.arguments.length>1?e.addDiagnostic((0,l.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,s.DiagnosticRule.reportGeneralTypeIssues,o.Localizer.Diagnostic.classPatternBuiltInArgCount(),t.arguments[1]):1===t.arguments.length&&t.arguments[0].name&&e.addDiagnostic((0,l.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,s.DiagnosticRule.reportGeneralTypeIssues,o.Localizer.Diagnostic.classPatternBuiltInArgPositional(),t.arguments[0].name))}else(0,m.isNever)(n)||e.addDiagnostic((0,l.getFileInfo)(t).diagnosticRuleSet.reportGeneralTypeIssues,s.DiagnosticRule.reportGeneralTypeIssues,o.Localizer.DiagnosticAddendum.typeNotClass().format({type:e.printType(n)}),t.className)},t.getPatternSubtypeNarrowingCallback=function(e,t,n){if(24===n.nodeType&&1===n.items.length&&!n.trailingComma&&0===n.items[0].argumentCategory&&(0,c.isMatchingExpression)(t,n.baseExpression)){const t=e.getTypeOfExpression(n.items[0].valueExpression),a=t.type;if((0,m.isClassInstance)(a)&&(0,y.isLiteralType)(a)&&m.ClassType.isBuiltIn(a,["int","str"])){const i=e.getTypeOfExpression(n.baseExpression,2),r=i.type;return n=>{let s;if((0,m.isNever)(n)?s=m.NeverType.createNever():(0,m.isClassInstance)(n)&&void 0!==n.literalValue&&(s=m.ClassType.isBuiltIn(a,"str")?(0,u.narrowTypeForDiscriminatedDictEntryComparison)(e,r,a,n,!0):(0,u.narrowTypeForDiscriminatedTupleComparison)(e,r,a,n,!0)),s)return{type:s,isIncomplete:t.isIncomplete||i.isIncomplete}}}}if(52===n.nodeType){const a=n.expressions.findIndex((e=>(0,c.isMatchingExpression)(t,e)));if(a>=0){const t=e.getTypeOfExpression(n.expressions[a]);return e=>{let n=!0;const i=[];return(0,y.doForEachSubtype)(e,(e=>{(0,m.isClassInstance)(e)&&m.ClassType.isBuiltIn(e,"tuple")&&e.tupleTypeArguments&&a<e.tupleTypeArguments.length&&e.tupleTypeArguments.every((e=>!e.isUnbounded))?i.push(e.tupleTypeArguments[a].type):n=!1})),n?{type:(0,m.combineTypes)(i),isIncomplete:t.isIncomplete}:void 0}}}}},12394:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const s=n(29335),o=n(80327),l=n(88711),p=n(59750),c=n(1395),d=r(n(30795)),u=n(30795),m=n(13490),y=n(41209),g=n(81844),h=n(96541),f=n(6698),T=n(59273),v=r(n(21)),b=n(5084),_=n(33866),I=n(66455),C=n(17741),k=n(37648),S=n(9584),w=n(51021),A=n(43271),x=n(10823),P={createSourceFile:(e,t,n,a,i,r,s,o,l,p)=>new C.SourceFile(e,t,n,a,i,r,s,o,l,p)};class D{constructor(e,t,n,a,i,r,s,o){this._disableChecker=r,this._sourceFileList=[],this._sourceFileMap=new Map,this._parsedFileCount=0,this._isEditMode=!1,this._lookUpImport=(e,t)=>{var n;let a;if("string"==typeof e)a=this.getSourceFileInfo(e);else{const t=this._importResolver.resolveImport(e.importingFilePath,this._configOptions.findExecEnvironment(e.importingFilePath),{leadingDots:0,nameParts:e.nameParts,importedSymbols:void 0});if(t.isImportFound&&!t.isNativeLib&&t.resolvedPaths.length>0){let e=t.resolvedPaths[t.resolvedPaths.length-1];e&&(a=this.getSourceFileInfo(e),a||(e=(0,g.normalizePathCase)(this.fileSystem,e),this.addTrackedFile(e),a=this.getSourceFileInfo(e)))}}if(!a)return;if(null==t?void 0:t.skipParsing)return{symbolTable:new Map,dunderAllNames:void 0,usesUnsupportedDunderAllForm:!1,get docString(){},isInPyTypedPackage:!1};a.sourceFile.isBindingRequired()&&T.timingStats.typeCheckerTime.subtractFromTime((()=>{this._bindFile(a,void 0,null==t?void 0:t.skipFileNeededCheck)}));const i=a.sourceFile.getModuleSymbolTable();if(!i)return;const r=a.sourceFile.getParseResults(),s=r.parseTree,o=v.getFileInfo(s),l=v.getDunderAllInfo(r.parseTree);return{symbolTable:i,dunderAllNames:null==l?void 0:l.names,usesUnsupportedDunderAllForm:null!==(n=null==l?void 0:l.usesUnsupportedDunderAllForm)&&void 0!==n&&n,get docString(){return(0,I.getDocString)(s.statements)},isInPyTypedPackage:o.isInPyTypedPackage}},this._console=n||new c.StandardConsole,this._logTracker=null!=a?a:new y.LogTracker(n,"FG"),this._importResolver=e,this._configOptions=t,this._sourceFileFactory=null!=i?i:P,this._cacheManager=null!=s?s:new b.CacheManager,this._cacheManager.registerCacheOwner(this),this._createNewEvaluator(),this._id=null!=o?o:`Prog_${D._nextId}`,D._nextId+=1}get id(){return this._id}get console(){return this._console}get rootPath(){return this._configOptions.projectRoot}get evaluator(){return this._evaluator}get configOptions(){return this._configOptions}get importResolver(){return this._importResolver}get fileSystem(){return this._importResolver.fileSystem}dispose(){this._cacheManager.unregisterCacheOwner(this)}enterEditMode(){this._isEditMode=!0,this._sourceFileList.forEach((e=>{e.sourceFile.enterEditMode()}))}exitEditMode(){const e=[];return this._sourceFileList.forEach((t=>{const n=t.sourceFile.exitEditMode();if(n){this._updateSourceFileImports(t,this.configOptions);const a=o.TextDocument.create(t.sourceFile.getFilePath(),"python",1,t.sourceFile.getFileContent()||"");e.push({filePath:t.sourceFile.getFilePath(),range:{start:{line:0,character:0},end:{line:a.lineCount,character:0}},replacementText:n})}})),this._isEditMode=!1,e}setConfigOptions(e){this._configOptions=e,this._importResolver.setConfigOptions(e),this._createNewEvaluator()}setImportResolver(e){this._importResolver=e,this._createNewEvaluator()}setTrackedFiles(e){if(this._sourceFileList.length>0){const t=new Map;e.forEach((e=>{t.set((0,g.normalizePathCase)(this.fileSystem,e),e)})),this._sourceFileList.forEach((e=>{const n=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());t.has(n)||(e.isTracked=!1)}))}return this.addTrackedFiles(e),this._removeUnneededFiles()}setPreCheckCallback(e){this._preCheckCallback=e}setAllowedThirdPartyImports(e){this._allowedThirdPartyImports=e}addTrackedFiles(e,t=!1,n=!1){e.forEach((e=>{this.addTrackedFile(e,t,n)}))}addInterimFile(e){let t=this.getSourceFileInfo(e);return t||(t=this._createInterimFileInfo(e),this._addToSourceFileListAndMap(t)),t}addTrackedFile(e,t=!1,n=!1){let a=this.getSourceFileInfo(e);const i=this._getImportNameForFile(e);if(a)return a.sourceFile.setModuleName(i),a.isTracked=!0,a.sourceFile;const r=this._sourceFileFactory.createSourceFile(this.fileSystem,e,i,t,n,this._isEditMode,this._console,this._logTracker);return a={sourceFile:r,isTracked:!0,isOpenByClient:!1,isTypeshedFile:!1,isThirdPartyImport:t,isThirdPartyPyTypedPresent:n,diagnosticsVersion:void 0,imports:[],importedBy:[],shadows:[],shadowedBy:[]},this._addToSourceFileListAndMap(a),r}setFileOpened(e,t,n,a){var i,r;let s=this.getSourceFileInfo(e);if(s)s.isOpenByClient=!0,s.diagnosticsVersion=0;else{const t=this._getImportNameForFile(e),n=this._sourceFileFactory.createSourceFile(this.fileSystem,e,t,!1,!1,this._isEditMode,this._console,this._logTracker,null==a?void 0:a.realFilePath,null!==(i=null==a?void 0:a.ipythonMode)&&void 0!==i?i:C.IPythonMode.None),o=null==a?void 0:a.chainedFilePath;s={sourceFile:n,isTracked:null!==(r=null==a?void 0:a.isTracked)&&void 0!==r&&r,chainedSourceFile:o?this.getSourceFileInfo(o):void 0,isOpenByClient:!0,isTypeshedFile:!1,isThirdPartyImport:!1,isThirdPartyPyTypedPresent:!1,diagnosticsVersion:void 0,imports:[],importedBy:[],shadows:[],shadowedBy:[]},this._addToSourceFileListAndMap(s)}(0,k.verifyNoCyclesInChainedFiles)(s),s.sourceFile.setClientVersion(t,n)}getChainedFilePath(e){var t;const n=this.getSourceFileInfo(e);return null===(t=null==n?void 0:n.chainedSourceFile)||void 0===t?void 0:t.sourceFile.getFilePath()}updateChainedFilePath(e,t){const n=this.getSourceFileInfo(e);n&&(n.chainedSourceFile=t?this.getSourceFileInfo(t):void 0,n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,new Set),(0,k.verifyNoCyclesInChainedFiles)(n))}setFileClosed(e,t){const n=this.getSourceFileInfo(e);return n&&(n.isOpenByClient=!1,n.isTracked=null!=t?t:n.isTracked,n.sourceFile.setClientVersion(null,""),n.sourceFile.didContentsChangeOnDisk()&&(n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,new Set))),this._removeUnneededFiles()}markAllFilesDirty(e){const t=new Set;this._sourceFileList.forEach((n=>{e?n.sourceFile.markDirty():n.sourceFile.didContentsChangeOnDisk()&&(n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,t))})),t.size>0&&this._createNewEvaluator()}markFilesDirty(e,t){const n=new Set;e.forEach((e=>{const a=this.getSourceFileInfo(e);if(a){const i=(0,g.getFileName)(e);if("builtins.pyi"===i||"__builtins__.pyi"===i)return void this.markAllFilesDirty(t);(t||!a.isOpenByClient&&a.sourceFile.didContentsChangeOnDisk())&&(a.sourceFile.markDirty(),this._markFileDirtyRecursive(a,n))}})),n.size>0&&this._createNewEvaluator()}getFileCount(e=!0){return e?this._sourceFileList.filter((e=>(0,k.isUserCode)(e))).length:this._sourceFileList.length}getUserFileCount(){return this._sourceFileList.filter((e=>(0,k.isUserCode)(e))).length}getUserFiles(){return this._sourceFileList.filter((e=>(0,k.isUserCode)(e)))}getOpened(){return this._sourceFileList.filter((e=>e.isOpenByClient))}getFilesToAnalyzeCount(){let e=0;return this._disableChecker||this._sourceFileList.forEach((t=>{t.sourceFile.isCheckingRequired()&&this._shouldCheckFile(t)&&e++})),e}isCheckingOnlyOpenFiles(){return this._configOptions.checkOnlyOpenFiles||!1}functionSignatureDisplay(){return this._configOptions.functionSignatureDisplay}containsSourceFileIn(e){const t=(0,g.normalizePathCase)(this.fileSystem,e);for(const e of this._sourceFileMap.keys())if(e.startsWith(t))return!0;return!1}owns(e){const t=this.getSourceFileInfo(e);return t?t.isTracked:(0,p.matchFileSpecs)(this._configOptions,e)}getSourceFile(e){const t=this.getSourceFileInfo(e);if(t)return t.sourceFile}getBoundSourceFile(e){var t;return null===(t=this.getBoundSourceFileInfo(e))||void 0===t?void 0:t.sourceFile}getSourceFileInfoList(){return this._sourceFileList}getSourceFileInfo(e){return this._sourceFileMap.get((0,g.normalizePathCase)(this.fileSystem,e))}getBoundSourceFileInfo(e,t,n){const a=this.getSourceFileInfo(e);if(a)return this._bindFile(a,t,n),a}analyze(e,t=s.CancellationToken.None){return this._runEvaluatorWithCancellationToken(t,(()=>{const n=new T.Duration,a=this._sourceFileList.filter((e=>e.isOpenByClient&&e.sourceFile.isCheckingRequired()));if(a.length>0){const i=e?e.openFilesTimeInMs:Number.MAX_VALUE;for(const e of a)if(this._checkTypes(e,t)&&n.getDurationInMilliseconds()>i)return!0;if(void 0!==e)return!0}if(!this._configOptions.checkOnlyOpenFiles){const a=e?e.noOpenFilesTimeInMs:Number.MAX_VALUE;for(const e of this._sourceFileList)if((0,k.isUserCode)(e)&&this._checkTypes(e,t)&&n.getDurationInMilliseconds()>a)return!0}return!1}))}analyzeFile(e,t=s.CancellationToken.None){return this._runEvaluatorWithCancellationToken(t,(()=>{const n=this.getSourceFileInfo(e);return!(!n||!this._checkTypes(n,t))}))}run(e,t){var n;return(null!==(n=this._evaluator)&&void 0!==n?n:this._createNewEvaluator()).runWithCancellationToken(t,(()=>e(this)))}runEditMode(e,t){var n;if(this._isEditMode){(null!==(n=this._evaluator)&&void 0!==n?n:this._createNewEvaluator()).runWithCancellationToken(t,(()=>e(this)))}}getSourceMapper(e,t,n,a){const i=this.getSourceFileInfo(e),r=this._configOptions.findExecEnvironment(e);return this._createSourceMapper(r,t,i,n,a)}getParseResults(e){var t;return null===(t=this.getBoundSourceFile(e))||void 0===t?void 0:t.getParseResults()}handleMemoryHighUsage(){this._handleMemoryHighUsage()}printDetailedAnalysisTimes(){const e=this._sourceFileList.filter((e=>void 0!==e.sourceFile.getCheckTime())).sort(((e,t)=>t.sourceFile.getCheckTime()-e.sourceFile.getCheckTime()));this._console.info(""),this._console.info("Analysis time by file"),e.forEach((e=>{const t=e.sourceFile.getCheckTime();this._console.info(`${t}ms: ${e.sourceFile.getFilePath()}`)}))}printDependencies(e,t){const n=this._importResolver.fileSystem,a=this._sourceFileList.filter((e=>!e.isTypeshedFile)).sort(((e,t)=>n.getOriginalFilePath(e.sourceFile.getFilePath())<n.getOriginalFilePath(t.sourceFile.getFilePath())?1:-1)),i=[];a.forEach((a=>{this._console.info("");let r=n.getOriginalFilePath(a.sourceFile.getFilePath());const s=(0,g.getRelativePath)(r,e);s&&(r=s),this._console.info(`${r}`),this._console.info(` Imports     ${a.imports.length} file`+(1===a.imports.length?"":"s")),t&&a.imports.forEach((e=>{this._console.info(`    ${n.getOriginalFilePath(e.sourceFile.getFilePath())}`)})),this._console.info(` Imported by ${a.importedBy.length} file`+(1===a.importedBy.length?"":"s")),t&&a.importedBy.forEach((e=>{this._console.info(`    ${n.getOriginalFilePath(e.sourceFile.getFilePath())}`)})),0===a.importedBy.length&&i.push(a.sourceFile)})),i.length>0&&(this._console.info(""),this._console.info(`${i.length} file${1===i.length?"":"s"} not explicitly imported`),i.forEach((e=>{this._console.info(`    ${n.getOriginalFilePath(e.getFilePath())}`)})))}writeTypeStub(e,t,n,a){for(const i of this._sourceFileList){(0,l.throwIfCancellationRequested)(a);const r=i.sourceFile.getFilePath(),s=(0,g.getRelativePath)(r,e);if(void 0!==s){let e=(0,g.normalizePath)((0,g.combinePaths)(n,s));e=t?(0,g.combinePaths)((0,g.getDirectoryPath)(e),"__init__.pyi"):(0,g.stripFileExtension)(e)+".pyi";const r=(0,g.getDirectoryPath)(e);try{(0,g.makeDirectories)(this.fileSystem,r,n)}catch(e){throw new Error(`Could not create directory for '${r}'`)}this._bindFile(i),this._runEvaluatorWithCancellationToken(a,(()=>{new x.TypeStubWriter(e,i.sourceFile,this._evaluator).write()})),this._handleMemoryHighUsage()}}}getTypeOfSymbol(e){this._handleMemoryHighUsage();return(this._evaluator||this._createNewEvaluator()).getEffectiveTypeOfSymbol(e)}printType(e,t){this._handleMemoryHighUsage();return(this._evaluator||this._createNewEvaluator()).printType(e,t)}getTextOnRange(e,t,n){const a=this.getSourceFileInfo(e);if(!a)return;const i=a.sourceFile,r=i.getOpenFileContents();return void 0!==r?this._runEvaluatorWithCancellationToken(n,(()=>{this._parseFile(a);const e=i.getParseResults(),n=(0,h.convertRangeToTextRange)(t,e.tokenizerOutput.lines);if(n)return r.substr(n.start,n.length)})):void 0}getDiagnostics(e){const t=this._removeUnneededFiles();return this._sourceFileList.forEach((n=>{if(this._shouldCheckFile(n)){const a=n.sourceFile.getDiagnostics(e,n.diagnosticsVersion);void 0!==a&&(t.push({filePath:n.sourceFile.getFilePath(),version:n.sourceFile.getClientVersion(),diagnostics:a}),n.diagnosticsVersion=n.sourceFile.getDiagnosticVersion())}else!n.isOpenByClient&&e.checkOnlyOpenFiles&&void 0!==n.diagnosticsVersion&&(t.push({filePath:n.sourceFile.getFilePath(),version:n.sourceFile.getClientVersion(),diagnostics:[]}),n.diagnosticsVersion=void 0)})),t}getDiagnosticsForRange(e,t){const n=this.getSourceFile(e);if(!n)return[];const a=n.getDiagnostics(this._configOptions);return a?a.filter((e=>(0,f.doRangesIntersect)(e.range,t))):[]}clone(){var e,t;const n=new D(this._importResolver,this._configOptions,this._console,new y.LogTracker(this._console,"Cloned")),a=this.getUserFiles();n.setTrackedFiles(a.map((e=>e.sourceFile.getFilePath()))),n.markAllFilesDirty(!0);for(const a of this.getOpened()){const i=a.sourceFile.getClientVersion();void 0!==i&&n.setFileOpened(a.sourceFile.getFilePath(),i,null!==(e=a.sourceFile.getOpenFileContents())&&void 0!==e?e:"",{chainedFilePath:null===(t=a.chainedSourceFile)||void 0===t?void 0:t.sourceFile.getFilePath(),ipythonMode:a.sourceFile.getIPythonMode(),isTracked:a.isTracked,realFilePath:a.sourceFile.getRealFilePath()})}return n}getCacheUsage(){const e=this._evaluator.getTypeCacheEntryCount()/75e4,t=this._parsedFileCount/1e3;return Math.max(e,t)}emptyCache(){this._createNewEvaluator(),this._discardCachedParseResults(),this._parsedFileCount=0,m.Extensions.getProgramExtensions(this.rootPath).forEach((e=>e.clearCache?e.clearCache():null))}_handleMemoryHighUsage(){if(this._cacheManager.getCacheUsage()>.75){const e=this._cacheManager.getUsedHeapRatio(this._configOptions.verboseOutput?this._console:void 0),t=15099494.4;(this._evaluator.getTypeCacheEntryCount()>t||e>.9)&&this._cacheManager.emptyCache(this._console)}}_discardCachedParseResults(){for(const e of this._sourceFileList)e.sourceFile.dropParseAndBindInfo()}_runEvaluatorWithCancellationToken(e,t){try{return e?this._evaluator.runWithCancellationToken(e,t):t()}catch(e){throw l.OperationCanceledException.is(e)||this._createNewEvaluator(),e}}_removeUnneededFiles(){const e=[];for(let t=0;t<this._sourceFileList.length;){const n=this._sourceFileList[t];this._isFileNeeded(n)?(this._shouldCheckFile(n)||void 0===n.diagnosticsVersion||(e.push({filePath:n.sourceFile.getFilePath(),version:n.sourceFile.getClientVersion(),diagnostics:[]}),n.diagnosticsVersion=void 0),t++):(void 0!==n.diagnosticsVersion&&e.push({filePath:n.sourceFile.getFilePath(),version:n.sourceFile.getClientVersion(),diagnostics:[]}),n.sourceFile.prepareForClose(),this._removeSourceFileFromListAndMap(n.sourceFile.getFilePath(),t),n.imports.forEach((a=>{const i=a.importedBy.findIndex((e=>e===n));if(!(i<0||(a.importedBy.splice(i,1),this._isFileNeeded(a)))){const n=this._sourceFileList.findIndex((e=>e===a));n>=0&&n<t&&(void 0!==a.diagnosticsVersion&&e.push({filePath:a.sourceFile.getFilePath(),version:a.sourceFile.getClientVersion(),diagnostics:[]}),a.sourceFile.prepareForClose(),this._removeSourceFileFromListAndMap(a.sourceFile.getFilePath(),n),t--)}})),n.shadowedBy.forEach((e=>{e.shadows=e.shadows.filter((e=>e!==n))})),n.shadowedBy=[])}return e}_isFileNeeded(e,t){return!e.sourceFile.isFileDeleted()&&(!!(t||e.isTracked||e.isOpenByClient)||(e.shadows.length>0||0!==e.importedBy.length&&this._isImportNeededRecursive(e,new Set)))}_isImportNeededRecursive(e,t){if(e.isTracked||e.isOpenByClient||e.shadows.length>0)return!0;const n=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());if(t.has(n))return!1;t.add(n);for(const n of e.importedBy)if(this._isImportNeededRecursive(n,t))return!0;return!1}_createSourceMapper(e,t,n,a,i){return new S.SourceMapper(this._importResolver,e,this._evaluator,((e,t)=>{let n=this.getSourceFileInfo(e);return n||(n=this.addInterimFile(e)),this._addShadowedFile(n,t),this.getBoundSourceFile(t)}),(e=>{let t=this.getBoundSourceFileInfo(e);return t||(t=this.addInterimFile(e),this._parseFile(t,void 0,!0)),t}),null!=a&&a,null!=i&&i,n,t)}_isImportAllowed(e,t,n){if(t.isNativeLib)return!1;let a=this._configOptions.useLibraryCodeForTypes||1===t.importType&&!!t.pyTypedInfo||2===t.importType&&e.isThirdPartyPyTypedPresent;return!((1===t.importType||e.isThirdPartyImport&&2===t.importType)&&(this._allowedThirdPartyImports?(t.isRelative||this._allowedThirdPartyImports.some((e=>t.importName===e||!!t.importName.startsWith(e+"."))))&&(a=!0):(e.isThirdPartyImport&&this._configOptions.useLibraryCodeForTypes||t.isNamespacePackage&&Array.from(t.filteredImplicitImports.values()).some((e=>!!e.pyTypedInfo)))&&(a=!0),!n))||a}_updateSourceFileImports(e,t){const n=[],a=e.sourceFile.getImports(),i=t=>{let n=!1,a=!1;return 1===t.importType?(n=!0,t.pyTypedInfo&&(a=!0)):e.isThirdPartyImport&&2===t.importType&&(n=!0,e.isThirdPartyPyTypedPresent&&(a=!0)),{isThirdPartyImport:n,isPyTypedPresent:a}},r=new Map;if(e.chainedSourceFile)if(e.chainedSourceFile.sourceFile.isFileDeleted())e.chainedSourceFile=void 0;else{const t=e.chainedSourceFile.sourceFile.getFilePath();r.set((0,g.normalizePathCase)(this.fileSystem,t),{path:t,isTypeshedFile:!1,isThirdPartyImport:!1,isPyTypedPresent:!1})}a.forEach((n=>{if(n.isImportFound){if(this._isImportAllowed(e,n,n.isStubFile)&&n.resolvedPaths.length>0){const e=n.resolvedPaths[n.resolvedPaths.length-1];if(e){const t=i(n);r.set((0,g.normalizePathCase)(this.fileSystem,e),{path:e,isTypeshedFile:!!n.isStdlibTypeshedFile||!!n.isThirdPartyTypeshedFile,isThirdPartyImport:t.isThirdPartyImport,isPyTypedPresent:t.isPyTypedPresent})}}n.filteredImplicitImports.forEach((t=>{if(this._isImportAllowed(e,n,t.isStubFile)&&!t.isNativeLib){const e=i(n);r.set((0,g.normalizePathCase)(this.fileSystem,t.path),{path:t.path,isTypeshedFile:!!n.isStdlibTypeshedFile||!!n.isThirdPartyTypeshedFile,isThirdPartyImport:e.isThirdPartyImport,isPyTypedPresent:e.isPyTypedPresent})}})),n.nonStubImportResult&&!n.nonStubImportResult.isImportFound&&(e.sourceFile.isStubFile()||n.isStdlibTypeshedFile||t.verboseOutput&&(this._console.info(`Could not resolve source for '${n.importName}' in file '${e.sourceFile.getFilePath()}'`),n.nonStubImportResult.importFailureInfo&&n.nonStubImportResult.importFailureInfo.forEach((e=>{this._console.info(`  ${e}`)}))))}else t.verboseOutput&&(this._console.info(`Could not import '${n.importName}' in file '${e.sourceFile.getFilePath()}'`),n.importFailureInfo&&n.importFailureInfo.forEach((e=>{this._console.info(`  ${e}`)})))}));const s=new Map;e.imports.forEach((t=>{const n=(0,g.normalizePathCase)(this.fileSystem,t.sourceFile.getFilePath());r.has(n)?s.set(n,t):t.importedBy=t.importedBy.filter((t=>(0,g.normalizePathCase)(this.fileSystem,t.sourceFile.getFilePath())!==(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath())))})),r.forEach(((t,a)=>{if(!s.has(a)){let i=this.getSourceFileInfo(t.path);if(!i){const e=this._getImportNameForFile(t.path);i={sourceFile:new C.SourceFile(this.fileSystem,t.path,e,t.isThirdPartyImport,t.isPyTypedPresent,this._isEditMode,this._console,this._logTracker),isTracked:!1,isOpenByClient:!1,isTypeshedFile:t.isTypeshedFile,isThirdPartyImport:t.isThirdPartyImport,isThirdPartyPyTypedPresent:t.isPyTypedPresent,diagnosticsVersion:void 0,imports:[],importedBy:[],shadows:[],shadowedBy:[]},this._addToSourceFileListAndMap(i),n.push(i)}i.importedBy.push(e),s.set(a,i)}})),e.imports=[],r.forEach(((t,n)=>{this.getSourceFileInfo(n)&&e.imports.push(this.getSourceFileInfo(n))})),e.builtinsImport=void 0;const o=e.sourceFile.getBuiltinsImport();if(o&&o.isImportFound){const t=o.resolvedPaths[o.resolvedPaths.length-1];e.builtinsImport=this.getSourceFileInfo(t)}e.ipythonDisplayImport=void 0;const l=e.sourceFile.getIPythonDisplayImport();if(l&&l.isImportFound){const t=l.resolvedPaths[l.resolvedPaths.length-1];e.ipythonDisplayImport=this.getSourceFileInfo(t)}return n}_removeSourceFileFromListAndMap(e,t){this._sourceFileMap.delete((0,g.normalizePathCase)(this.fileSystem,e)),this._sourceFileList.splice(t,1)}_addToSourceFileListAndMap(e){const t=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());(0,u.assert)(!this._sourceFileMap.has(t)),this._sourceFileList.push(e),this._sourceFileMap.set(t,e)}static _getPrintTypeFlags(e){let t=0;return e.diagnosticRuleSet.printUnknownAsAny&&(t|=1),e.diagnosticRuleSet.omitConditionalConstraint&&(t|=64),e.diagnosticRuleSet.omitTypeArgsIfUnknown&&(t|=2),e.diagnosticRuleSet.omitUnannotatedParamType&&(t|=4),e.diagnosticRuleSet.pep604Printing&&(t|=8),t}_getImportNameForFile(e){return this._importResolver.getModuleNameForImport(e,this._configOptions.getDefaultExecEnvironment(),!0).moduleName}_addShadowedFile(e,t){let n=this.getSourceFileInfo(t);return n||(n=this.addInterimFile(t)),n.shadows.includes(e)||n.shadows.push(e),e.shadowedBy.includes(n)||e.shadowedBy.push(n),n.sourceFile}_createInterimFileInfo(e){const t=this._getImportNameForFile(e);return{sourceFile:this._sourceFileFactory.createSourceFile(this.fileSystem,e,t,!1,!1,this._isEditMode,this._console,this._logTracker),isTracked:!1,isOpenByClient:!1,isTypeshedFile:!1,isThirdPartyImport:!1,isThirdPartyPyTypedPresent:!1,diagnosticsVersion:void 0,imports:[],importedBy:[],shadows:[],shadowedBy:[]}}_createNewEvaluator(){return this._evaluator&&this._evaluator.disposeEvaluator(),this._evaluator=(0,A.createTypeEvaluatorWithTracker)(this._lookUpImport,{printTypeFlags:D._getPrintTypeFlags(this._configOptions),logCalls:this._configOptions.logTypeEvaluationTime,minimumLoggingThreshold:this._configOptions.typeEvaluationTimeThreshold,evaluateUnknownImportsAsAny:!!this._configOptions.evaluateUnknownImportsAsAny,verifyTypeCacheEvaluatorFlags:!!this._configOptions.internalTestMode},this._logTracker,this._configOptions.logTypeEvaluationTime?(0,w.createTracePrinter)(this._importResolver.getImportRoots(this._configOptions.findExecEnvironment(this._configOptions.projectRoot))):void 0),this._evaluator}_parseFile(e,t,n){if(this._isFileNeeded(e,n)&&e.sourceFile.isParseRequired()&&(e.sourceFile.parse(this._configOptions,this._importResolver,t)&&(this._parsedFileCount++,this._updateSourceFileImports(e,this._configOptions)),e.sourceFile.isFileDeleted())){e.isTracked=!1;const t=new Set;this._markFileDirtyRecursive(e,t),this._importResolver.invalidateCache()}}_getImplicitImports(e){var t,n;if(e.builtinsImport===e)return;const a=e=>{if(e&&!e.sourceFile.isFileDeleted())return e};return null!==(n=null!==(t=a(e.chainedSourceFile))&&void 0!==t?t:a(e.ipythonDisplayImport))&&void 0!==n?n:e.builtinsImport}_bindImplicitImports(e,t){const n=[],a=new Set;let i=this._getImplicitImports(e);for(;i;){const e=i.sourceFile.getFilePath();a.has(e)&&d.fail("Found a cycle in implicit imports files"),a.add(e),n.push(i),this._parseFile(i,void 0,t),i=this._getImplicitImports(i)}if(0===n.length)return;let r=n.pop();for(;r;)this._bindFile(r,void 0,t,!0),r=n.pop()}_bindFile(e,t,n,a){var i,r;if(!this._isFileNeeded(e,n)||!e.sourceFile.isBindingRequired())return;this._parseFile(e,t,n);const s=t=>{if(!t||t===e)return;if(t.sourceFile.isFileDeleted())return;const n=t.sourceFile.getParseResults();if(!n)return;return v.getScope(n.parseTree)};let o;e.builtinsImport&&e.builtinsImport!==e&&(a||this._bindImplicitImports(e),o=null!==(r=null!==(i=s(e.chainedSourceFile))&&void 0!==i?i:s(e.ipythonDisplayImport))&&void 0!==r?r:s(e.builtinsImport));let l=e.sourceFile.getParseResults().futureImports;e.chainedSourceFile&&(l=this._getEffectiveFutureImports(l,e.chainedSourceFile)),e.effectiveFutureImports=l.size>0?l:void 0,e.sourceFile.bind(this._configOptions,this._lookUpImport,o,l)}_getEffectiveFutureImports(e,t){var n;const a=new Set(e);return null===(n=t.effectiveFutureImports)||void 0===n||n.forEach((e=>{a.add(e)})),a}_shouldCheckFile(e){return!!e.isOpenByClient||!(this._configOptions.checkOnlyOpenFiles||!e.isTracked)}_checkTypes(e,t,n){return this._logTracker.log(`analyzing: ${e.sourceFile.getFilePath()}`,(a=>{if(!this._isFileNeeded(e))return a.suppress(),!1;if(!e.sourceFile.isCheckingRequired())return a.suppress(),!1;if(!this._shouldCheckFile(e))return a.suppress(),!1;if(!this._disableChecker){const a=this._checkDependentFiles(e,n,t);if(this._bindFile(e),this._preCheckCallback){const t=e.sourceFile.getParseResults();t&&this._preCheckCallback(t,this._evaluator)}const i=this._configOptions.findExecEnvironment(e.sourceFile.getFilePath());e.sourceFile.check(this.configOptions,this._importResolver,this._evaluator,this._createSourceMapper(i,t,e),a)}if(this._handleMemoryHighUsage(),"none"!==this._configOptions.diagnosticRuleSet.reportImportCycles&&!this._allowedThirdPartyImports&&e.sourceFile.getIPythonMode()!==C.IPythonMode.CellDocs){const t=new Map;this._getImportsRecursive(e,t,0),t.forEach((e=>{T.timingStats.cycleDetectionTime.timeOperation((()=>{const t=new Map;this._detectAndReportImportCycles(e,t)||t.forEach((e=>{e.sourceFile.setNoCircularDependencyConfirmed()}))}))}))}return!0}))}_checkDependentFiles(e,t,n){if(e.sourceFile.getIPythonMode()!==C.IPythonMode.CellDocs)return;const a=!t,i=(t=null!=t?t:(0,k.createChainedByList)(this,e)).findIndex((t=>t===e));if(i<0)return;const r=i+1;if(r>=t.length)return;if(a){const e=this._cacheManager.pauseTracking();try{for(let e=t.length-1;e>=r;e--)this._checkTypes(t[e],n,t)}finally{e.dispose()}}const s=[];for(let e=r;e<t.length;e++){const n=t[e],a=null==n?void 0:n.sourceFile.getParseResults();if(!a)continue;const i=v.getFileInfo(a.parseTree);i&&i.accessedSymbolSet&&s.push(a)}return s}_getImportsRecursive(e,t,n){const a=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());if(!t.has(a))if(n>256)e.sourceFile.setHitMaxImportDepth(256);else{t.set(a,e),(0,k.isUserCode)(e)&&this._parseFile(e);for(const a of e.imports)this._getImportsRecursive(a,t,n+1)}}_detectAndReportImportCycles(e,t,n=[],a=new Map){if(e.sourceFile.isStubFile()||e.isThirdPartyImport)return!1;if(e.sourceFile.isNoCircularDependencyConfirmed())return!1;const i=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());t.set(i,e);let r=!1;if(a.has(i))r=!0,n.length>1&&e===n[0]&&this._logImportCycle(n);else{if(a.has(i))return!1;a.set(i,!0),n.push(e);for(const i of e.imports)this._detectAndReportImportCycles(i,t,n,a)&&(r=!0);a.set(i,!1),n.pop()}return r}_logImportCycle(e){const t=new _.CircularDependency;e.forEach((e=>{t.appendPath(e.sourceFile.getFilePath())})),t.normalizeOrder();const n=t.getPaths()[0],a=this.getSourceFileInfo(n);(0,u.assert)(void 0!==a),a.sourceFile.addCircularDependency(this.configOptions,t)}_markFileDirtyRecursive(e,t,n=!1){const a=(0,g.normalizePathCase)(this.fileSystem,e.sourceFile.getFilePath());if(t.has(a))return;e.sourceFile.markReanalysisRequired(n),t.add(a),e.importedBy.forEach((n=>{const a=n.chainedSourceFile===e;this._markFileDirtyRecursive(n,t,a)}));let i=e.chainedSourceFile;for(;i;){if(i.sourceFile.isCheckingRequired())return;i.sourceFile.markReanalysisRequired(!1),i=i.chainedSourceFile}}}t.Program=D,D._nextId=0},79282:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assignProperty=t.clonePropertyWithDeleter=t.clonePropertyWithSetter=t.createProperty=t.validatePropertyMethod=void 0;const a=n(83501),i=n(28513),r=n(99661),s=n(21),o=n(66455),l=n(16682),p=n(51458),c=n(33029);function d(e,t,n){const a=t.details.fields,i=p.FunctionType.createSynthesizedInstance("__get__",256);p.FunctionType.addParameter(i,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),p.FunctionType.addParameter(i,{category:0,name:"obj",type:p.NoneType.createInstance(),hasDeclaredType:!0}),p.FunctionType.addParameter(i,{category:0,name:"objtype",type:p.AnyType.create(),hasDeclaredType:!0,hasDefault:!0,defaultType:p.AnyType.create()}),i.details.declaredReturnType=p.FunctionType.isClassMethod(n)?p.FunctionType.getSpecializedReturnType(n):t,i.details.declaration=n.details.declaration,i.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);const r=p.FunctionType.createSynthesizedInstance("__get__",256);p.FunctionType.addParameter(r,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0});const s=n.details.parameters.length>0?n.details.parameters[0].type:p.AnyType.create();p.FunctionType.addParameter(r,{category:0,name:"obj",type:s,hasDeclaredType:!0}),p.FunctionType.addParameter(r,{category:0,name:"objtype",type:p.AnyType.create(),hasDeclaredType:!0,hasDefault:!0,defaultType:p.AnyType.create()}),r.details.declaredReturnType=p.FunctionType.getSpecializedReturnType(n),r.details.declaration=n.details.declaration,r.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);const o=p.OverloadedFunctionType.create([r,i]),d=l.Symbol.createWithType(4,o);a.set("__get__",d)}function u(e,t,n){const a=t.details.fields,i=p.FunctionType.createSynthesizedInstance("__set__");p.FunctionType.addParameter(i,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0});let r=n.details.parameters.length>0?n.details.parameters[0].type:p.AnyType.create();(0,p.isTypeVar)(r)&&r.details.isSynthesizedSelf&&(r=e.makeTopLevelTypeVarsConcrete(r)),p.FunctionType.addParameter(i,{category:0,name:"obj",type:(0,p.combineTypes)([r,p.NoneType.createInstance()]),hasDeclaredType:!0}),i.details.declaredReturnType=p.NoneType.createInstance(),i.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);let s=p.UnknownType.create();n.details.parameters.length>=2&&0===n.details.parameters[1].category&&n.details.parameters[1].name&&(s=n.details.parameters[1].type),p.FunctionType.addParameter(i,{category:0,name:"value",type:s,hasDeclaredType:!0});const o=l.Symbol.createWithType(4,i);a.set("__set__",o)}function m(e,t,n){const a=t.details.fields,i=p.FunctionType.createSynthesizedInstance("__delete__");p.FunctionType.addParameter(i,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),i.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);let r=n.details.parameters.length>0?n.details.parameters[0].type:p.AnyType.create();(0,p.isTypeVar)(r)&&r.details.isSynthesizedSelf&&(r=e.makeTopLevelTypeVarsConcrete(r)),p.FunctionType.addParameter(i,{category:0,name:"obj",type:(0,p.combineTypes)([r,p.NoneType.createInstance()]),hasDeclaredType:!0}),i.details.declaredReturnType=p.NoneType.createInstance();const s=l.Symbol.createWithType(4,i);a.set("__delete__",s)}function y(e,t){const n=t.details.fields,a=n.get("fget"),i=null==a?void 0:a.getSynthesizedType();i&&(0,p.isFunction)(i)&&d(0,t,i);const r=n.get("fset"),s=null==r?void 0:r.getSynthesizedType();s&&(0,p.isFunction)(s)&&u(e,t,s);const o=n.get("fdel"),l=null==o?void 0:o.getSynthesizedType();l&&(0,p.isFunction)(l)&&m(e,t,l)}function g(e){const t=e.details.fields;["getter","setter","deleter"].forEach((n=>{const a=p.FunctionType.createSynthesizedInstance(n);p.FunctionType.addParameter(a,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),p.FunctionType.addParameter(a,{category:0,name:"accessor",type:p.AnyType.create(),hasDeclaredType:!0}),a.details.declaredReturnType=e;const i=l.Symbol.createWithType(4,a);t.set(n,i)}))}t.validatePropertyMethod=function(e,t,n){p.FunctionType.isStaticMethod(t)&&e.addDiagnostic((0,s.getFileInfo)(n).diagnosticRuleSet.reportGeneralTypeIssues,i.DiagnosticRule.reportGeneralTypeIssues,r.Localizer.Diagnostic.propertyStaticMethod(),n)},t.createProperty=function(e,t,n,a){const i=(0,s.getFileInfo)(t),r=e.getBuiltInType(t,"type"),u=p.ClassType.isBuiltIn(n,"property")?(0,o.getTypeSourceId)(t):n.details.typeSourceId,m=p.ClassType.createInstantiable(n.details.name,(0,o.getClassFullName)(t,i.moduleName,`__property_${a.details.name}`),i.moduleName,i.filePath,2049,u,void 0,(0,p.isInstantiableClass)(r)?r:p.UnknownType.create());m.details.typeVarScopeId=n.details.typeVarScopeId;const h=e.getBuiltInType(t,"object");m.details.baseClasses.push((0,p.isInstantiableClass)(h)?h:p.UnknownType.create()),(0,c.computeMroLinearization)(m);const f=m.details.fields;n.details.fields.forEach(((e,t)=>{const n=["__get__","__set__","__delete__","fget","fset","fdel"];e.isIgnoredForProtocolMatch()||n.some((e=>e===t))||f.set(t,e)}));const T=p.ClassType.cloneAsInstance(m);m.isAsymmetricDescriptor=!1,y(e,T);const v=l.Symbol.createWithType(4,p.FunctionType.cloneWithNewFlags(a,4|a.details.flags));return f.set("fget",v),p.FunctionType.isClassMethod(a)&&(m.details.flags|=4194304),d(e,T,a),g(T),T},t.clonePropertyWithSetter=function(e,t,n,d){if(!(0,c.isProperty)(t))return t;const m=t,h=m.details.flags;let f=!!m.isAsymmetricDescriptor;const T=(0,s.getFileInfo)(d);if(d.parameters.length>=2){const t=(0,o.getTypeAnnotationForParameter)(d,1);if(t){const n=e.getGetterTypeFromProperty(m,!1);if(n&&!(0,p.isAnyOrUnknown)(n)){const s=e.getTypeOfAnnotation(t,{associateTypeVarsWithScope:!0});if("none"!==T.diagnosticRuleSet.reportPropertyTypeMismatch){const o=new a.DiagnosticAddendum;e.assignType(n,s,o)||e.addDiagnostic(T.diagnosticRuleSet.reportPropertyTypeMismatch,i.DiagnosticRule.reportPropertyTypeMismatch,r.Localizer.Diagnostic.setterGetterTypeMismatch()+o.getString(),t)}(0,p.isTypeSame)(n,s)||(f=!0)}}}const v=p.ClassType.createInstantiable(m.details.name,m.details.fullName,m.details.moduleName,(0,s.getFileInfo)(d).filePath,h,m.details.typeSourceId,m.details.declaredMetaclass,m.details.effectiveMetaclass);v.details.typeVarScopeId=m.details.typeVarScopeId;const b=e.getBuiltInType(d,"object");v.details.baseClasses.push((0,p.isInstantiableClass)(b)?b:p.UnknownType.create()),(0,c.computeMroLinearization)(v),v.isAsymmetricDescriptor=f;const _=p.ClassType.cloneAsInstance(v),I=v.details.fields;m.details.fields.forEach(((e,t)=>{e.isIgnoredForProtocolMatch()||I.set(t,e)})),y(e,_);const C=l.Symbol.createWithType(4,p.FunctionType.cloneWithNewFlags(n,4|n.details.flags));return I.set("fset",C),u(e,_,n),g(_),_},t.clonePropertyWithDeleter=function(e,t,n,a){var i;if(!(0,c.isProperty)(t))return t;const r=t,o=p.ClassType.createInstantiable(r.details.name,r.details.fullName,r.details.moduleName,(0,s.getFileInfo)(a).filePath,r.details.flags,r.details.typeSourceId,r.details.declaredMetaclass,r.details.effectiveMetaclass);o.details.typeVarScopeId=r.details.typeVarScopeId;const d=e.getBuiltInType(a,"object");o.details.baseClasses.push((0,p.isInstantiableClass)(d)?d:p.UnknownType.create()),(0,c.computeMroLinearization)(o);const u=p.ClassType.cloneAsInstance(o);o.isAsymmetricDescriptor=null!==(i=r.isAsymmetricDescriptor)&&void 0!==i&&i;const h=o.details.fields;r.details.fields.forEach(((e,t)=>{e.isIgnoredForProtocolMatch()||h.set(t,e)})),y(e,u);const f=l.Symbol.createWithType(4,p.FunctionType.cloneWithNewFlags(n,4|n.details.flags));return h.set("fdel",f),m(e,u,n),g(u),u},t.assignProperty=function(e,t,n,a,i,s,o,l,d=0){const u=p.ClassType.cloneAsInstance(i),m=p.ClassType.cloneAsInstance(a);let y=!0;return[{name:"fget",missingDiagMsg:r.Localizer.DiagnosticAddendum.missingGetter,incompatibleDiagMsg:r.Localizer.DiagnosticAddendum.incompatibleGetter},{name:"fset",missingDiagMsg:r.Localizer.DiagnosticAddendum.missingSetter,incompatibleDiagMsg:r.Localizer.DiagnosticAddendum.incompatibleSetter},{name:"fdel",missingDiagMsg:r.Localizer.DiagnosticAddendum.missingDeleter,incompatibleDiagMsg:r.Localizer.DiagnosticAddendum.incompatibleDeleter}].forEach((r=>{var g,h;const f=t.details.fields.get(r.name);let T=f?null===(g=e.getDeclaredTypeOfSymbol(f))||void 0===g?void 0:g.type:void 0;if(T&&(0,p.isFunction)(T)){const t=n.details.fields.get(r.name);let g=t?null===(h=e.getDeclaredTypeOfSymbol(t))||void 0===h?void 0:h.type:void 0;if(!g||!(0,p.isFunction)(g))return null==s||s.addMessage(r.missingDiagMsg()),void(y=!1);e.inferReturnTypeIfNecessary(g),g=(0,c.partiallySpecializeType)(g,i),e.inferReturnTypeIfNecessary(T),T=(0,c.partiallySpecializeType)(T,a),l&&(T=(0,c.applySolvedTypeVars)(T,l)),T=p.FunctionType.cloneWithNewFlags(T,-5&T.details.flags),g=p.FunctionType.cloneWithNewFlags(g,-5&g.details.flags);const f=e.bindFunctionToClassOrObject(m,T,void 0,void 0,d),v=e.bindFunctionToClassOrObject(u,g,void 0,void 0,d);f&&v&&e.assignType(f,v,s,o,void 0,0,d)||(y=!1)}})),y}},56370:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assignModuleToProtocol=t.assignClassToProtocol=void 0;const a=n(99661),i=n(79282),r=n(51458),s=n(33029),o=n(43024),l=[],p=32;function c(e,t,n){const a=new o.TypeVarContext((0,s.getTypeVarScopeId)(t));if(null==t?void 0:t.typeArguments){e.inferTypeParameterVarianceForClass(t);let i=t;n&&(i=(0,s.applySolvedTypeVars)(t,n,{useNarrowBoundOnly:!0})),t.details.typeParameters.forEach(((e,t)=>{if(t<i.typeArguments.length){const n=i.typeArguments[t];if(!(0,s.requiresSpecialization)(n)){const t=r.TypeVarType.getVariance(e);a.setTypeVarType(e,4!==t?n:void 0,void 0,3!==t?n:void 0)}}}))}return a}t.assignClassToProtocol=function(e,t,n,d,u,m,y,g,h){const f=0!=(1&y);if(h>r.maxTypeRecursionCount)return!0;if(h++,l.some((e=>(0,r.isTypeSame)(e.srcType,n)&&(0,r.isTypeSame)(e.destType,t))))return!f;if(!f){const e=function(e,t,n,a){var i;const s=null===(i=t.details.protocolCompatibility)||void 0===i?void 0:i.get(e.details.fullName);if(void 0===s)return;const o=s.find((i=>(0,r.isTypeSame)(i.destType,e)&&(0,r.isTypeSame)(i.srcType,t)&&i.treatSourceAsInstantiable===a&&i.flags===n));return null==o?void 0:o.isCompatible}(t,n,y,g);if(void 0!==e){if(e&&(!u||0===t.details.typeParameters.length))return!0;if(!e&&!d)return!1}}l.push({srcType:n,destType:t});let T=!0;try{T=function(e,t,n,l,p,d,u,m,y){if(0!=(1&u))return(0,r.isTypeSame)(t,n);const g=c(e,t,p),h=new o.TypeVarContext((0,s.getTypeVarScopeId)(t)),f=e.stripLiteralValue(n);if((0,s.populateTypeVarContextForSelfType)(h,t,f),r.ClassType.isTypedDictClass(n)){const t=e.getTypedDictClassType();t&&(0,r.isInstantiableClass)(t)&&(n=t)}let T=!0;const v=new Set,b=(0,s.buildTypeVarContextFromSpecializedClass)(n);let _=16&u;if(_|=(0,s.containsLiteralType)(n,!0)?128:0,t.details.mro.forEach((o=>{(0,r.isInstantiableClass)(o)&&r.ClassType.isProtocolClass(o)&&(T||l)&&o.details.fields.forEach(((p,c)=>{var d;if(!T&&!l)return;if(!p.isClassMember()||p.isIgnoredForProtocolMatch()||v.has(c))return;let u,I=!1;if(!m&&"__class_getitem__"===c)return;if("__slots__"===c)return;if(v.add(c),m&&n.details.effectiveMetaclass&&(0,r.isInstantiableClass)(n.details.effectiveMetaclass)&&(u=(0,s.lookUpClassMember)(n.details.effectiveMetaclass,c),u&&(b.addSolveForScope((0,s.getTypeVarScopeId)(n.details.effectiveMetaclass)),I=!0)),u||(u=(0,s.lookUpClassMember)(n,c)),!u)return null==l||l.addMessage(a.Localizer.DiagnosticAddendum.protocolMemberMissing().format({name:c})),void(T=!1);!p.isClassVar()||u.symbol.isClassVar()||u.symbol.isClassMember()||(null==l||l.addMessage(a.Localizer.DiagnosticAddendum.protocolMemberClassVar().format({name:c})),T=!1);let C,k=null===(d=e.getDeclaredTypeOfSymbol(p))||void 0===d?void 0:d.type;if(!k)return;if(r.ClassType.isSameGenericClass(o,t)||(k=(0,s.partiallySpecializeType)(k,o,n)),(0,r.isInstantiableClass)(u.classType)){const t=e.getEffectiveTypeOfSymbol(u.symbol);(0,r.isFunction)(t)&&e.inferReturnTypeIfNecessary(t),C=(0,s.partiallySpecializeType)(t,u.classType,f)}else C=r.UnknownType.create();if((0,r.isFunction)(C)||(0,r.isOverloadedFunction)(C)){if(I){const t=e.bindFunctionToClassOrObject(r.ClassType.cloneAsInstance(n),C,void 0,void 0,y,!1,n);if(t&&(C=(0,s.removeParamSpecVariadicsFromSignature)(t)),(0,r.isFunction)(k)||(0,r.isOverloadedFunction)(k)){const t=e.bindFunctionToClassOrObject(r.ClassType.cloneAsInstance(n),k,void 0,void 0,y,!1,n);t&&(k=(0,s.removeParamSpecVariadicsFromSignature)(t))}}else if((0,r.isInstantiableClass)(u.classType)){k=(0,s.applySolvedTypeVars)(k,h);const t=e.bindFunctionToClassOrObject(m?n:r.ClassType.cloneAsInstance(n),C,u.classType,void 0,y);if(t&&(C=(0,s.removeParamSpecVariadicsFromSignature)(t)),(0,r.isFunction)(k)||(0,r.isOverloadedFunction)(k)){const t=e.bindFunctionToClassOrObject(r.ClassType.cloneAsInstance(n),k,u.classType,void 0,y);t&&(k=(0,s.removeParamSpecVariadicsFromSignature)(t))}}}else k=(0,s.applySolvedTypeVars)(k,h);const S=null==l?void 0:l.createAddendum();if((0,r.isClassInstance)(k)&&r.ClassType.isPropertyClass(k))if((0,r.isClassInstance)(C)&&r.ClassType.isPropertyClass(C)&&!m)(0,i.assignProperty)(e,r.ClassType.cloneAsInstantiable(k),r.ClassType.cloneAsInstantiable(C),o,n,null==S?void 0:S.createAddendum(),g,h,y)||(S&&S.addMessage(a.Localizer.DiagnosticAddendum.memberTypeMismatch().format({name:c})),T=!1);else{const t=e.getGetterTypeFromProperty(k,!0);t&&e.assignType(t,C,null==S?void 0:S.createAddendum(),g,void 0,_,y)||(S&&S.addMessage(a.Localizer.DiagnosticAddendum.memberTypeMismatch().format({name:c})),T=!1)}else{const t=p.getDeclarations()[0],n=1===(null==t?void 0:t.type)&&!t.isFinal;e.assignType(k,C,null==S?void 0:S.createAddendum(),g,void 0,n?1|_:_,y)||(S&&(n&&S.addMessage(a.Localizer.DiagnosticAddendum.memberIsInvariant().format({name:c})),S.addMessage(a.Localizer.DiagnosticAddendum.memberTypeMismatch().format({name:c}))),T=!1)}const w=p.getTypedDeclarations().some((e=>1===e.type&&!!e.isFinal));w!==u.symbol.getTypedDeclarations().some((e=>1===e.type&&!!e.isFinal))&&(w?S&&S.addMessage(a.Localizer.DiagnosticAddendum.memberIsFinalInProtocol().format({name:c})):S&&S.addMessage(a.Localizer.DiagnosticAddendum.memberIsNotFinalInProtocol().format({name:c})),T=!1)}))})),T&&t.details.typeParameters.length>0){const n=r.ClassType.cloneForSpecialization(t,void 0,!1),a=(0,s.applySolvedTypeVars)(n,g);if(t.typeArguments)e.assignTypeArguments(t,a,l,p,d,u,y)||(T=!1);else if(p&&!p.isLocked())for(const e of t.details.typeParameters){const t=g.getPrimarySignature().getTypeVar(e);t&&p.setTypeVarType(e,null==t?void 0:t.narrowBound,null==t?void 0:t.narrowBoundNoLiterals,null==t?void 0:t.wideBound)}}return T}(e,t,n,d,u,m,y,g,h)}catch(e){throw l.pop(),e}return l.pop(),function(e,t,n,a,i){t.details.protocolCompatibility||(t.details.protocolCompatibility=new Map);let r=t.details.protocolCompatibility.get(e.details.fullName);r||(r=[],t.details.protocolCompatibility.set(e.details.fullName,r));r.push({destType:e,srcType:t,treatSourceAsInstantiable:a,flags:n,isCompatible:i}),r.length>p&&r.shift()}(t,n,y,g,T),T},t.assignModuleToProtocol=function(e,t,n,i,o,l,p){if(p>r.maxTypeRecursionCount)return!0;p++;let d=!0;const u=new Set,m=c(e,t,o);if(t.details.mro.forEach((o=>{(0,r.isInstantiableClass)(o)&&r.ClassType.isProtocolClass(o)&&o.details.fields.forEach(((o,l)=>{var c;if(!o.isClassMember()||o.isIgnoredForProtocolMatch()||u.has(l))return;u.add(l);const y=n.fields.get(l);if(!y)return null==i||i.addMessage(a.Localizer.DiagnosticAddendum.protocolMemberMissing().format({name:l})),void(d=!1);let g=null===(c=e.getDeclaredTypeOfSymbol(o))||void 0===c?void 0:c.type;if(!g)return;g=(0,s.partiallySpecializeType)(g,t);const h=e.getEffectiveTypeOfSymbol(y);if(((0,r.isFunction)(h)||(0,r.isOverloadedFunction)(h))&&((0,r.isFunction)(g)||(0,r.isOverloadedFunction)(g))){const n=e.bindFunctionToClassOrObject(r.ClassType.cloneAsInstance(t),g,t,void 0,p);n&&(g=n)}const f=null==i?void 0:i.createAddendum();e.assignType(g,h,null==f?void 0:f.createAddendum(),m,void 0,0,p)||(f&&f.addMessage(a.Localizer.DiagnosticAddendum.memberTypeMismatch().format({name:l})),d=!1)}))})),d&&t.details.typeParameters.length>0&&t.typeArguments){const n=r.ClassType.cloneForSpecialization(t,void 0,!1),a=(0,s.applySolvedTypeVars)(n,m);e.assignTypeArguments(t,a,i,o,void 0,l,p)||(d=!1)}return d}},41097:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPyTypedInfo=void 0;const a=n(81844);t.getPyTypedInfo=function(e,t){if(!e.existsSync(t)||!(0,a.isDirectory)(e,t))return;let n=!1;const i=(0,a.combinePaths)(t,"py.typed");if(!e.existsSync(t)||!(0,a.isFile)(e,i))return;const r=e.statSync(i);if(r.size>0&&r.size<65536){const t=e.readFileSync(i,"utf8");(t.match(/partial\n/)||t.match(/partial\r\n/))&&(n=!0)}return{pyTypedPath:i,isPartiallyTyped:n}}},24873:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getPathsFromPthFiles=t.isPythonBinary=t.findPythonSearchPaths=t.getTypeshedSubdirectory=t.getTypeShedFallbackPath=t.thirdPartyFolderName=t.stdLibFolderName=void 0;const s=n(79251),o=r(n(15813)),l=n(81844),p=n(86513);function c(e,t){const n=[];return e.readdirEntriesSync(t).filter((e=>(e.isFile()||e.isSymbolicLink())&&e.name.endsWith(".pth"))).sort(((e,t)=>(0,s.compareComparableValues)(e.name,t.name))).forEach((a=>{const i=(0,l.combinePaths)(t,a.name),r=(0,l.tryStat)(e,i);if((null==r?void 0:r.isFile())&&r.size>0&&r.size<65536){e.readFileSync(i,"utf8").split(/\r?\n/).forEach((a=>{const i=a.trim();if(i.length>0&&!i.startsWith("#")&&!i.match(/^import\s/)){const a=(0,l.combinePaths)(t,i);e.existsSync(a)&&(0,l.isDirectory)(e,a)&&n.push(a)}}))}})),n}function d(e,t){return!e.some((e=>e===t))&&(e.push(t),!0)}t.stdLibFolderName="stdlib",t.thirdPartyFolderName="stubs",t.getTypeShedFallbackPath=function(e){let t=e.getModulePath();if(!t)return;t=(0,l.getDirectoryPath)((0,l.ensureTrailingDirectorySeparator)((0,l.normalizePath)(t)));const n=(0,l.combinePaths)(t,o.typeshedFallback);if(e.existsSync(n))return n;const a=(0,l.combinePaths)((0,l.getDirectoryPath)(t),o.typeshedFallback);return e.existsSync(a)?a:void 0},t.getTypeshedSubdirectory=function(e,n){return(0,l.combinePaths)(e,n?t.stdLibFolderName:t.thirdPartyFolderName)},t.findPythonSearchPaths=function(e,t,n,a,i,r){if(a.push("Finding python search paths"),void 0!==t.venvPath&&t.venv){const n=t.venv,i=(0,l.combinePaths)(t.venvPath,n),r=[],s=[];if([o.lib,o.lib64,o.libAlternate].forEach((n=>{const c=function(e,t,n,a){if(!e.existsSync(t))return void a.push(`Did not find '${t}'`);a.push(`Found path '${t}'; looking for ${o.sitePackages}`);const i=(0,l.combinePaths)(t,o.sitePackages);if(e.existsSync(i))return a.push(`Found path '${i}'`),i;a.push(`Did not find '${i}', so looking for python subdirectory`);const r=(0,l.getFileSystemEntries)(e,t),s=r.directories.filter((n=>{if(n.startsWith("python3.")){const a=(0,l.combinePaths)(t,n,o.sitePackages);return e.existsSync(a)}return!1}));if(n){const e=s.find((e=>e===`python${(0,p.versionToString)(n)}`));if(e){const n=(0,l.combinePaths)(t,e,o.sitePackages);return a.push(`Found path '${n}'`),n}}if(s.length>0){const e=(0,l.combinePaths)(t,s[0],o.sitePackages);return a.push(`Found path '${e}'`),e}return}(e,(0,l.combinePaths)(i,n),t.defaultPythonVersion,a);c&&(d(r,c),s.push(c))})),s.forEach((t=>{c(e,t).forEach((e=>{d(r,e)}))})),r.length>0)return a.push(`Found the following '${o.sitePackages}' dirs`),r.forEach((e=>{a.push(`  ${e}`)})),r;a.push(`Did not find any '${o.sitePackages}' dirs. Falling back on python interpreter.`)}const s=n.getPythonSearchPaths(t.pythonPath,a);if(i&&r){return s.paths.filter((e=>!(0,l.containsPath)(r,e,!0)||(0,l.containsPath)(s.prefix,e,!0)))}return s.paths},t.isPythonBinary=function(e){return"python"===(e=e.trim())||"python3"===e},t.getPathsFromPthFiles=c},59083:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRegionComments=void 0;const a=n(96541);t.getRegionComments=function(e){const t=[];for(let n=0;n<e.tokenizerOutput.tokens.count;n++){const a=e.tokenizerOutput.tokens.getItemAt(n);if(a.comments)for(const n of a.comments){const a=s(n,e);void 0!==a&&t.push({type:a,comment:n})}}return t};const i=/^\s*region\b/,r=/^\s*endregion\b/;function s(e,t){const n=e.start-1,s=(0,a.convertOffsetToPosition)(n,t.tokenizerOutput.lines);if(0!==s.character){const e=n-s.character;if(t.text.slice(e,n).trimStart().length>0)return}const o=i.exec(e.value),l=r.exec(e.value);return o?0:l?1:void 0}},89126:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scope=void 0;const a=n(30795),i=n(16682);t.Scope=class{constructor(e,t){this.symbolTable=new Map,this.notLocalBindings=new Map,this.type=e,this.parent=t}getGlobalScope(){let e=this,t=!1;for(;e;){if(3===e.type||4===e.type)return{scope:e,isBeyondExecutionScope:t};1===e.type&&(t=!0),e=e.parent}return(0,a.fail)("failed to find scope"),{scope:this,isBeyondExecutionScope:t}}isIndependentlyExecutable(){return 3===this.type||1===this.type}lookUpSymbol(e){return this.symbolTable.get(e)}lookUpSymbolRecursive(e,t=!1,n=!1){const a=this.symbolTable.get(e);if(a){if(t&&a.isExternallyHidden())return;const e=a.getDeclarations();if(0===e.length||e.some((e=>1!==e.type||!e.isDefinedByMemberAccess)))return{symbol:a,isOutsideCallerModule:t,isBeyondExecutionScope:n,scope:this}}let i,r=n||this.isIndependentlyExecutable();if(1===this.notLocalBindings.get(e)){const e=this.getGlobalScope();e.scope!==this&&(i=e.scope,e.isBeyondExecutionScope&&(r=!0))}else i=this.parent;if(i)return i.lookUpSymbolRecursive(e,t||3===this.type,r)}addSymbol(e,t){const n=new i.Symbol(t);return this.symbolTable.set(e,n),n}getBindingType(e){return this.notLocalBindings.get(e)}setBindingType(e,t){return this.notLocalBindings.set(e,t)}setSlotsNames(e){this.slotsNames=e}getSlotsNames(){return this.slotsNames}}},60177:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findTopNodeInScope=t.getScopeHierarchy=t.getScopeForNode=t.getBuiltInScope=void 0;const a=n(21),i=n(66455);function r(e){const t=(0,i.getEvaluationScopeNode)(e);return(0,a.getScope)(t)}t.getBuiltInScope=function(e){let t=e;for(;4!==t.type;)t=t.parent;return t},t.getScopeForNode=r,t.getScopeHierarchy=function(e,t){const n=[];let a=e;for(;a;){const e=r(a);if(!e)return;if(0!==n.length&&n[n.length-1]===e||n.push(e),e===t)return n;a=a.parent}return t?void 0:n},t.findTopNodeInScope=function(e,t){let n,i=e,r=!1;for(;i;){if((0,a.getScope)(i)===t)r=!0;else if(r)return n;n=i,i=i.parent}}},85576:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyzerService=t.getNextServiceId=t.pyprojectTomlName=t.configFileNames=void 0;const s=r(n(11128)),o=r(n(53233)),l=n(88711),p=n(59750),c=n(1395),d=n(13490),u=n(47561),m=n(340),y=n(15813),g=n(81844),h=n(59273),f=n(24618),T=n(24161),v=n(24873),b=n(17741);t.configFileNames=["pyrightconfig.json"],t.pyprojectTomlName="pyproject.toml";const _=(0,g.normalizeSlashes)("/.git/");let I=1;function C(e){return`${e}_${I++}`}t.getNextServiceId=C;class k{constructor(e,t,n){var a,i,r,s,o;this._typeStubTargetIsSingleFile=!1,this._requireTrackedFileUpdate=!0,this._lastUserInteractionTime=Date.now(),this._disposed=!1,this._pendingLibraryChanges={changesOnly:!0},this._instanceName=e,this._executionRootPath="",this._options=n,this._options.serviceId=null!==(a=this._options.serviceId)&&void 0!==a?a:C(e),this._options.console=n.console||new c.StandardConsole,this._options.importResolverFactory=null!==(i=n.importResolverFactory)&&void 0!==i?i:k.createImportResolver,this._options.cancellationProvider=null!==(r=n.cancellationProvider)&&void 0!==r?r:new l.DefaultCancellationProvider,this._options.hostFactory=null!==(s=n.hostFactory)&&void 0!==s?s:()=>new m.NoAccessHost,this._options.configOptions=null!==(o=n.configOptions)&&void 0!==o?o:new p.ConfigOptions(process.cwd());const u=this._options.importResolverFactory(t,this._options.configOptions,this._options.hostFactory());this._backgroundAnalysisProgram=void 0!==this._options.backgroundAnalysisProgramFactory?this._options.backgroundAnalysisProgramFactory(this._options.serviceId,this._options.console,this._options.configOptions,u,this._options.backgroundAnalysis,this._options.maxAnalysisTime,this._options.cacheManager):new f.BackgroundAnalysisProgram(this._options.serviceId,this._options.console,this._options.configOptions,u,this._options.backgroundAnalysis,this._options.maxAnalysisTime,void 0,this._options.cacheManager);const y={addInterimFile:this.addInterimFile.bind(this),updateOpenFileContents:this.updateOpenFileContents.bind(this),setFileOpened:this.setFileOpened.bind(this)};d.Extensions.createProgramExtensions(this._program,y)}get fs(){return this._backgroundAnalysisProgram.importResolver.fileSystem}get cancellationProvider(){return this._options.cancellationProvider}get librarySearchPathsToWatch(){return this._librarySearchPathsToWatch}get backgroundAnalysisProgram(){return this._backgroundAnalysisProgram}get test_program(){return this._program}get id(){return this._options.serviceId}clone(e,t,n,a){var i;const r=new k(e,null!=a?a:this.fs,{...this._options,serviceId:t,backgroundAnalysis:n,skipScanningUserFiles:!0}),s=this.getUserFiles();r.backgroundAnalysisProgram.setTrackedFiles(s),r.backgroundAnalysisProgram.markAllFilesDirty(!0);for(const e of this.backgroundAnalysisProgram.program.getOpened()){const t=e.sourceFile.getClientVersion();void 0!==t&&r.setFileOpened(e.sourceFile.getFilePath(),t,e.sourceFile.getOpenFileContents(),e.sourceFile.getIPythonMode(),null===(i=e.chainedSourceFile)||void 0===i?void 0:i.sourceFile.getFilePath(),e.sourceFile.getRealFilePath())}return r}runEditMode(e,t){let n=[];this._backgroundAnalysisProgram.enterEditMode();try{this._program.runEditMode(e,t)}finally{n=this._backgroundAnalysisProgram.exitEditMode()}return t.isCancellationRequested?[]:n}dispose(){this._disposed||(this._backgroundAnalysisProgram.dispose(),d.Extensions.destroyProgramExtensions(this._program.id)),this._disposed=!0,this._removeSourceFileWatchers(),this._removeConfigFileWatcher(),this._removeLibraryFileWatcher(),this._clearReloadConfigTimer(),this._clearReanalysisTimer(),this._clearLibraryReanalysisTimer()}static createImportResolver(e,t,n){return new T.ImportResolver(e,t,n)}setCompletionCallback(e){this._onCompletionCallback=e,this._backgroundAnalysisProgram.setCompletionCallback(e)}setOptions(e){this._commandLineOptions=e;const t=this._hostFactory(),n=this._getConfigOptions(t,e);n.pythonPath&&n.ensureDefaultPythonVersion(t,this._console),n.ensureDefaultPythonPlatform(t,this._console),this._backgroundAnalysisProgram.setConfigOptions(n),this._executionRootPath=(0,g.normalizePath)((0,g.combinePaths)(e.executionRoot,n.projectRoot)),this._applyConfigOptions(t)}hasSourceFile(e){return this.backgroundAnalysisProgram.hasSourceFile(e)}isTracked(e){return this._program.owns(e)}getUserFiles(){return this._program.getUserFiles().map((e=>e.sourceFile.getFilePath()))}getOpenFiles(){return this._program.getOpened().map((e=>e.sourceFile.getFilePath()))}setFileOpened(e,t,n,a=b.IPythonMode.None,i,r){this._backgroundAnalysisProgram.setFileOpened(e,t,n,{isTracked:this.isTracked(e)||a!==b.IPythonMode.None,ipythonMode:a,chainedFilePath:i,realFilePath:r}),this._scheduleReanalysis(!1)}getChainedFilePath(e){return this._backgroundAnalysisProgram.getChainedFilePath(e)}updateChainedFilePath(e,t){this._backgroundAnalysisProgram.updateChainedFilePath(e,t),this._scheduleReanalysis(!1)}updateOpenFileContents(e,t,n,a=b.IPythonMode.None,i){this._backgroundAnalysisProgram.updateOpenFileContents(e,t,n,{isTracked:this.isTracked(e),ipythonMode:a,chainedFilePath:void 0,realFilePath:i}),this._scheduleReanalysis(!1)}setFileClosed(e,t){this._backgroundAnalysisProgram.setFileClosed(e,t),this._scheduleReanalysis(!1)}addInterimFile(e){this._backgroundAnalysisProgram.addInterimFile(e)}getParseResult(e){var t;return null===(t=this._program.getBoundSourceFile(e))||void 0===t?void 0:t.getParseResults()}getSourceFile(e){return this._program.getBoundSourceFile(e)}getTextOnRange(e,t,n){return this._program.getTextOnRange(e,t,n)}getEvaluator(){return this._program.evaluator}run(e,t){return this._program.run(e,t)}printStats(){this._console.info(""),this._console.info("Analysis stats");const e=this._program.getFileCount(!1);this._console.info("Total files parsed and bound: "+e.toString());const t=this._program.getUserFileCount();this._console.info("Total files checked: "+t.toString())}printDetailedAnalysisTimes(){this._program.printDetailedAnalysisTimes()}printDependencies(e){this._program.printDependencies(this._executionRootPath,e)}getDiagnosticsForRange(e,t,n){return this._backgroundAnalysisProgram.getDiagnosticsForRange(e,t,n)}getConfigOptions(){return this._configOptions}getImportResolver(){return this._backgroundAnalysisProgram.importResolver}recordUserInteractionTime(){this._lastUserInteractionTime=Date.now(),this._analyzeTimer&&this._scheduleReanalysis(!1)}test_getConfigOptions(e){return this._getConfigOptions(this._backgroundAnalysisProgram.host,e)}test_getFileNamesFromFileSpecs(){return this._getFileNamesFromFileSpecs()}test_shouldHandleSourceFileWatchChanges(e,t){return this._shouldHandleSourceFileWatchChanges(e,t)}writeTypeStub(e){var t;const n=this._getTypeStubFolder();this._program.writeTypeStub(null!==(t=this._typeStubTargetPath)&&void 0!==t?t:"",this._typeStubTargetIsSingleFile,n,e)}writeTypeStubInBackground(e){var t;const n=this._getTypeStubFolder();return this._backgroundAnalysisProgram.writeTypeStub(null!==(t=this._typeStubTargetPath)&&void 0!==t?t:"",this._typeStubTargetIsSingleFile,n,e)}invalidateAndForceReanalysis(e){this._backgroundAnalysisProgram.invalidateAndForceReanalysis(e)}restart(){this._applyConfigOptions(this._hostFactory()),this._backgroundAnalysisProgram.restart()}get _console(){return this._options.console}get _hostFactory(){return this._options.hostFactory}get _importResolverFactory(){return this._options.importResolverFactory}get _program(){return this._backgroundAnalysisProgram.program}get _configOptions(){return this._backgroundAnalysisProgram.configOptions}get _watchForSourceChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForSourceChanges)}get _watchForLibraryChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForLibraryChanges)&&!!this._options.libraryReanalysisTimeProvider}get _watchForConfigChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForConfigChanges)}get _typeCheckingMode(){var e;return null===(e=this._commandLineOptions)||void 0===e?void 0:e.typeCheckingMode}get _verboseOutput(){return!!this._configOptions.verboseOutput}get _typeStubTargetImportName(){var e;return null===(e=this._commandLineOptions)||void 0===e?void 0:e.typeStubTargetImportName}_getConfigOptions(e,t){var n,a,i;let r,s,o=t.executionRoot;t.configFilePath?(r=(0,g.combinePaths)(t.executionRoot,(0,g.normalizePath)(t.configFilePath)),this.fs.existsSync(r)?r.toLowerCase().endsWith(".json")?o=(0,g.getDirectoryPath)(r):(o=r,r=this._findConfigFile(r),r||this._console.info(`Configuration file not found at ${o}.`)):(this._console.info(`Configuration file not found at ${r}.`),r=t.executionRoot)):o&&(r=this._findConfigFile(o),r||t.fromVsCodeExtension||(r=this._findConfigFileHereOrUp(o)),r?o=(0,g.getDirectoryPath)(r):(this._console.log("No configuration file found."),r=void 0)),r||(s=this._findPyprojectTomlFile(o),s||t.fromVsCodeExtension||(s=this._findPyprojectTomlFileHereOrUp(o)),s?(o=(0,g.getDirectoryPath)(s),this._console.log(`pyproject.toml file found at ${o}.`)):this._console.log("No pyproject.toml file found."));const l=new p.ConfigOptions(o,this._typeCheckingMode),c=["**/node_modules","**/__pycache__","**/.*"];let d;if(t.pythonPath&&(this._console.info(`Setting pythonPath for service "${this._instanceName}": "${t.pythonPath}"`),l.pythonPath=t.pythonPath),l.defaultPythonPlatform=t.pythonPlatform,l.defaultPythonVersion=t.pythonVersion,l.ensureDefaultExtraPaths(this.fs,null!==(n=t.autoSearchPaths)&&void 0!==n&&n,t.extraPaths),t.fileSpecs.length>0&&t.fileSpecs.forEach((e=>{l.include.push((0,g.getFileSpec)(this.fs,o,e))})),t.excludeFileSpecs.length>0&&t.excludeFileSpecs.forEach((e=>{l.exclude.push((0,g.getFileSpec)(this.fs,o,e))})),t.ignoreFileSpecs.length>0&&t.ignoreFileSpecs.forEach((e=>{l.ignore.push((0,g.getFileSpec)(this.fs,o,e))})),!r&&t.executionRoot&&(0===t.fileSpecs.length&&l.include.push((0,g.getFileSpec)(this.fs,t.executionRoot,".")),0===t.excludeFileSpecs.length&&c.forEach((e=>{l.exclude.push((0,g.getFileSpec)(this.fs,t.executionRoot,e))}))),this._configFilePath=r||s,r?(this._console.info(`Loading configuration file at ${r}`),d=this._parseJsonConfigFile(r)):s&&(this._console.info(`Loading pyproject.toml file at ${s}`),d=this._parsePyprojectTomlFile(s)),d){l.initializeFromJson(d,this._typeCheckingMode,this._console,this.fs,e,t.diagnosticSeverityOverrides,t.fileSpecs.length>0);const n=(0,g.getDirectoryPath)(this._configFilePath);0===l.include.length&&(this._console.info(`No include entries specified; assuming ${n}`),l.include.push((0,g.getFileSpec)(this.fs,n,"."))),0===l.exclude.length&&(c.forEach((e=>{this._console.info(`Auto-excluding ${e}`),l.exclude.push((0,g.getFileSpec)(this.fs,n,e))})),void 0===l.autoExcludeVenv&&(l.autoExcludeVenv=!0))}else l.autoExcludeVenv=!0,l.applyDiagnosticOverrides(t.diagnosticSeverityOverrides);void 0!==t.analyzeUnannotatedFunctions&&(l.diagnosticRuleSet.analyzeUnannotatedFunctions=t.analyzeUnannotatedFunctions);const u=(e,n)=>{const a=t.fromVsCodeExtension?"the client settings":"a command-line option";this._console.warn(`The ${e} has been specified in both the config file and ${a}. The value in the config file (${n}) will take precedence`)};if(t.venvPath&&(l.venvPath?u("venvPath",l.venvPath):l.venvPath=t.venvPath),t.typeshedPath&&(l.typeshedPath?u("typeshedPath",l.typeshedPath):l.typeshedPath=t.typeshedPath),l.typeshedPath&&0===(0,g.comparePaths)(l.typeshedPath,o)&&void 0!==l.defaultPythonVersion){const e=this.getImportResolver().getTypeshedStdlibExcludeList(l.typeshedPath,l.defaultPythonVersion);this._console.info("Excluding typeshed stdlib stubs according to VERSIONS file:"),e.forEach((e=>{this._console.info(`    ${e}`),l.exclude.push((0,g.getFileSpec)(this.fs,t.executionRoot,e))}))}if(l.verboseOutput=null!==(a=t.verboseOutput)&&void 0!==a?a:l.verboseOutput,l.checkOnlyOpenFiles=!!t.checkOnlyOpenFiles,l.autoImportCompletions=!!t.autoImportCompletions,l.indexing=!!t.indexing,l.taskListTokens=t.taskListTokens,l.logTypeEvaluationTime=!!t.logTypeEvaluationTime,l.typeEvaluationTimeThreshold=t.typeEvaluationTimeThreshold,void 0===l.useLibraryCodeForTypes?l.useLibraryCodeForTypes=t.useLibraryCodeForTypes:void 0!==t.useLibraryCodeForTypes&&u("useLibraryCodeForTypes",l.useLibraryCodeForTypes),void 0===l.useLibraryCodeForTypes&&(l.useLibraryCodeForTypes=!0),t.stubPath&&(l.stubPath?u("stubPath",l.stubPath):l.stubPath=t.stubPath),l.stubPath?this.fs.existsSync(l.stubPath)&&(0,g.isDirectory)(this.fs,l.stubPath)||this._console.warn(`stubPath ${l.stubPath} is not a valid directory.`):l.stubPath=(0,g.normalizePath)((0,g.combinePaths)(l.projectRoot,y.defaultStubsDirectory)),l.venvPath&&(this.fs.existsSync(l.venvPath)&&(0,g.isDirectory)(this.fs,l.venvPath)||this._console.error(`venvPath ${l.venvPath} is not a valid directory.`),l.venv=null!==(i=l.venv)&&void 0!==i?i:this._configOptions.venv,l.venv)){const t=(0,g.combinePaths)(l.venvPath,l.venv);if(this.fs.existsSync(t)&&(0,g.isDirectory)(this.fs,t)){const t=[];void 0===(0,v.findPythonSearchPaths)(this.fs,l,e,t)&&(this._console.error(`site-packages directory cannot be located for venvPath ${l.venvPath} and venv ${l.venv}.`),l.verboseOutput&&t.forEach((e=>{this._console.error(`  ${e}`)})))}else this._console.error(`venv ${l.venv} subdirectory not found in venv path ${l.venvPath}.`)}return l.venv&&(l.venvPath||this._console.warn("venvPath not specified, so venv settings will be ignored.")),l.typeshedPath&&(this.fs.existsSync(l.typeshedPath)&&(0,g.isDirectory)(this.fs,l.typeshedPath)||this._console.error(`typeshedPath ${l.typeshedPath} is not a valid directory.`)),l}_getTypeStubFolder(){var e;const t=null!==(e=this._configOptions.stubPath)&&void 0!==e?e:(0,g.normalizePath)((0,g.combinePaths)(this._configOptions.projectRoot,y.defaultStubsDirectory));if(!this._typeStubTargetPath||!this._typeStubTargetImportName){const e=`Import '${this._typeStubTargetImportName}' could not be resolved`;throw this._console.error(e),new Error(e)}const n=this._typeStubTargetImportName.split(".");if(0===n[0].length){const e=`Import '${this._typeStubTargetImportName}' could not be resolved`;throw this._console.error(e),new Error(e)}try{this.fs.existsSync(t)||this.fs.mkdirSync(t)}catch(e){const n=`Could not create typings directory '${t}'`;throw this._console.error(n),new Error(n)}const a=(0,g.combinePaths)(t,n[0]),i=(0,g.combinePaths)(t,...n);try{this.fs.existsSync(i)||(0,g.makeDirectories)(this.fs,i,t)}catch(e){const t=`Could not create typings subdirectory '${i}'`;throw this._console.error(t),new Error(t)}return a}_findConfigFileHereOrUp(e){return(0,g.forEachAncestorDirectory)(e,(e=>this._findConfigFile(e)))}_findConfigFile(e){for(const n of t.configFileNames){const t=(0,g.combinePaths)(e,n);if(this.fs.existsSync(t))return t}}_findPyprojectTomlFileHereOrUp(e){return(0,g.forEachAncestorDirectory)(e,(e=>this._findPyprojectTomlFile(e)))}_findPyprojectTomlFile(e){const n=(0,g.combinePaths)(e,t.pyprojectTomlName);if(this.fs.existsSync(n))return n}_parseJsonConfigFile(e){return this._attemptParseFile(e,(e=>{const t=[],n=o.parse(e,t,{allowTrailingComma:!0});if(t.length>0)throw new Error("Errors parsing JSON file");return n}))}_parsePyprojectTomlFile(e){return this._attemptParseFile(e,((t,n)=>{try{const e=s.parse(t);if(e&&e.tool&&e.tool.pyright)return e.tool.pyright}catch(e){throw this._console.error(`Pyproject file parse attempt ${n} error: ${JSON.stringify(e)}`),e}this._console.info(`Pyproject file "${e}" has no "[tool.pyright]" section.`)}))}_attemptParseFile(e,t){let n="",a=0;for(;;){try{n=this.fs.readFileSync(e,"utf8")}catch{return this._console.error(`Config file "${e}" could not be read.`),void this._reportConfigParseError()}let i=!1;try{return t(n,a+1)}catch(e){i=!0}if(!i)break;if(a++>=5)return this._console.error(`Config file "${e}" could not be parsed. Verify that format is correct.`),void this._reportConfigParseError()}}_getFileNamesFromFileSpecs(){const e=new Map;return h.timingStats.findFilesTime.timeOperation((()=>{const t=this._matchFiles(this._configOptions.include,this._configOptions.exclude);for(const n of t)e.set(n,n)})),this._backgroundAnalysisProgram.program.getOpened().map((e=>e.sourceFile.getFilePath())).filter((e=>(0,p.matchFileSpecs)(this._program.configOptions,e))).forEach((t=>e.set(t,t))),Array.from(e.values())}_updateTrackedFileList(e){if(this._typeStubTargetImportName){const e=this._configOptions.findExecEnvironment(this._executionRootPath),t=(0,T.createImportedModuleDescriptor)(this._typeStubTargetImportName),n=this._backgroundAnalysisProgram.importResolver.resolveImport("",e,t);if(n.isImportFound){const e=[],t=n.resolvedPaths[n.resolvedPaths.length-1],a=(0,g.isFile)(this.fs,t),i=a&&"__init__"===(0,g.stripFileExtension)((0,g.getFileName)(t));let r=t;a&&(r=(0,g.getDirectoryPath)(r));for(let e=n.resolvedPaths.length-2;e>=0;e--)r=n.resolvedPaths[e]?n.resolvedPaths[e]:(0,g.getDirectoryPath)(r);(0,g.isDirectory)(this.fs,r)?this._typeStubTargetPath=r:(0,g.isFile)(this.fs,r)&&(this._typeStubTargetPath=(0,g.getDirectoryPath)(r)),t?(e.push(t),this._typeStubTargetIsSingleFile=1===n.resolvedPaths.length&&!i):this._typeStubTargetIsSingleFile=!1,n.filteredImplicitImports.forEach((t=>{const n=(0,g.getFileExtension)(t.path).toLowerCase();T.supportedSourceFileExtensions.some((e=>n===e))&&e.push(t.path)})),this._backgroundAnalysisProgram.setAllowedThirdPartyImports([this._typeStubTargetImportName]),this._backgroundAnalysisProgram.setTrackedFiles(e)}else this._console.error(`Import '${this._typeStubTargetImportName}' not found`)}else if(!this._options.skipScanningUserFiles){let t=[];this._console.log("Searching for source files"),t=this._getFileNamesFromFileSpecs(),this._backgroundAnalysisProgram.setConfigOptions(this._configOptions),this._backgroundAnalysisProgram.setTrackedFiles(t),this._backgroundAnalysisProgram.markAllFilesDirty(e),0===t.length?this._console.info("No source files found."):this._console.info(`Found ${t.length} source `+(1===t.length?"file":"files"))}this._requireTrackedFileUpdate=!1}_matchFiles(e,t){const n=[["bin","activate"],["Scripts","activate"],["pyvenv.cfg"]],a=[],i=Date.now();let r=!1;const s=(e,s,o)=>{if(!r){.001*(Date.now()-i)>=10&&(this._console.error('Enumeration of workspace source files is taking longer than 10 seconds.\nThis may be because:\n* You have opened your home directory or entire hard drive as a workspace\n* Your workspace contains a very large number of directories and files\n* Your workspace contains a symlink to a directory with many files\n* Your workspace is remote, and file enumeration is slow\nTo reduce this time, open a workspace directory with fewer files or add a pyrightconfig.json configuration file with an "exclude" section to exclude subdirectories from your workspace. For more details, refer to https://github.com/microsoft/pyright/blob/main/docs/configuration.md.'),r=!0)}if(this._configOptions.autoExcludeVenv&&n.some((t=>this.fs.existsSync((0,g.combinePaths)(e,...t)))))return g.FileSpec.isInPath(e,t)||t.push((0,g.getFileSpec)(this.fs,this._configOptions.projectRoot,`${e}/**`)),void this._console.info(`Auto-excluding ${e}`);const{files:p,directories:c}=(0,g.getFileSystemEntries)(this.fs,e);for(const n of p){const i=(0,g.combinePaths)(e,n);g.FileSpec.matchIncludeFileSpec(s,t,i)&&a.push(i)}for(const n of c){const a=(0,g.combinePaths)(e,n);(s.test(a)||o)&&(g.FileSpec.isInPath(a,t)||l(a,s,o))}},o=new Set,l=(e,t,n)=>{const a=(0,g.tryRealpath)(this.fs,e);if(a)if(o.has(a))this._console.warn(`Skipping recursive symlink "${e}" -> "${a}"`);else{o.add(a);try{s(e,t,n)}finally{o.delete(a)}}else this._console.warn(`Skipping broken link "${e}"`)};return e.forEach((e=>{if(!g.FileSpec.isInPath(e.wildcardRoot,t)){let t=!1;const n=(0,g.tryStat)(this.fs,e.wildcardRoot);(null==n?void 0:n.isFile())?(a.push(e.wildcardRoot),t=!0):(null==n?void 0:n.isDirectory())&&(l(e.wildcardRoot,e.regExp,e.hasDirectoryWildcard),t=!0),t||this._console.error(`File or directory "${e.wildcardRoot}" does not exist.`)}})),a}_removeSourceFileWatchers(){this._sourceFileWatcher&&(this._sourceFileWatcher.close(),this._sourceFileWatcher=void 0)}_updateSourceFileWatchers(){if(this._removeSourceFileWatchers(),this._watchForSourceChanges&&this._configOptions.include.length>0){const e=this._configOptions.include.map((e=>(0,g.combinePaths)(this._executionRootPath,e.wildcardRoot)));try{this._verboseOutput&&this._console.info(`Adding fs watcher for directories:\n ${e.join("\n")}`);const t=(0,u.ignoredWatchEventFunction)(e);this._sourceFileWatcher=this.fs.createFileSystemWatcher(e,((e,n)=>{if(!n)return;if(this._verboseOutput&&this._console.info(`SourceFile: Received fs event '${e}' for path '${n}'`),t(n))return;if(n.endsWith(".tmp")||n.endsWith(".git")||n.includes(_))return;const a=function(e,t,n,a,i){const r=(0,g.tryStat)(e,i);if("add"===a){if(!r)return;return{event:a,isFile:r.isFile()}}if("change"===a){if(!r){const e=!!n.getSourceFile(i);if(!e&&!n.containsSourceFileIn(i))return;return{event:"unlink",isFile:e}}return{event:a,isFile:r.isFile()}}return void t.warn(`Received unknown file change event: '${a}' for '${i}'`)}(this.fs,this._console,this._program,e,n);if(a&&this._shouldHandleSourceFileWatchChanges(n,a.isFile)){if(a.isFile&&"change"===a.event)return this._backgroundAnalysisProgram.markFilesDirty([n],!1),void this._scheduleReanalysis(!1);this.invalidateAndForceReanalysis(f.InvalidatedReason.SourceWatcherChanged),this._scheduleReanalysis(!0)}}))}catch{this._console.error(`Exception caught when installing fs watcher for:\n ${e.join("\n")}`)}}}_shouldHandleSourceFileWatchChanges(e,t){if(t)return!(!(0,g.hasPythonExtension)(e)||function(e){const t=(0,g.getFileName)(e),n=t.split(".");if(4===n.length&&n[3]===n[1]&&32===n[2].length)return!0;return!1}(e))&&!(!this.isTracked(e)&&!this._program.getSourceFileInfo(e));if(!(0,p.matchFileSpecs)(this._program.configOptions,e,!1))return!1;const n=(0,g.getDirectoryPath)(e);return!!(n.startsWith(this._configOptions.projectRoot)&&(this.fs.existsSync((0,g.combinePaths)(n,"__init__.py"))||this.fs.existsSync((0,g.combinePaths)(n,"__init__.pyi")))||this._program.containsSourceFileIn(e))}_removeLibraryFileWatcher(){this._libraryFileWatcher&&(this._libraryFileWatcher.close(),this._libraryFileWatcher=void 0)}_updateLibraryFileWatcher(){if(this._removeLibraryFileWatcher(),!this._watchForLibraryChanges)return void(this._librarySearchPathsToWatch=void 0);this._librarySearchPathsToWatch=(0,v.findPythonSearchPaths)(this.fs,this._backgroundAnalysisProgram.configOptions,this._backgroundAnalysisProgram.host,[],!0,this._executionRootPath);const e=this._librarySearchPathsToWatch;if(e&&e.length>0)try{this._verboseOutput&&this._console.info(`Adding fs watcher for library directories:\n ${e.join("\n")}`);const t=(0,u.ignoredWatchEventFunction)(e);this._libraryFileWatcher=this.fs.createFileSystemWatcher(e,((e,n)=>{if(!n)return;if(this._verboseOutput&&this._console.info(`LibraryFile: Received fs event '${e}' for path '${n}'`),t(n))return;const a="change"===e&&this.fs.existsSync(n);this._scheduleLibraryAnalysis(a)}))}catch{this._console.error(`Exception caught when installing fs watcher for:\n ${e.join("\n")}`)}}_clearLibraryReanalysisTimer(){var e;this._libraryReanalysisTimer&&(clearTimeout(this._libraryReanalysisTimer),this._libraryReanalysisTimer=void 0,null===(e=this._backgroundAnalysisProgram)||void 0===e||e.libraryUpdated())}_scheduleLibraryAnalysis(e){var t,n;if(this._disposed)return;this._clearLibraryReanalysisTimer();const a=null===(n=(t=this._options).libraryReanalysisTimeProvider)||void 0===n?void 0:n.call(t);a&&(this._pendingLibraryChanges.changesOnly=this._pendingLibraryChanges.changesOnly&&e,this._libraryReanalysisTimer=setTimeout((()=>{this._clearLibraryReanalysisTimer(),this.invalidateAndForceReanalysis(this._pendingLibraryChanges.changesOnly?f.InvalidatedReason.LibraryWatcherContentOnlyChanged:f.InvalidatedReason.LibraryWatcherChanged),this._scheduleReanalysis(!1),this._pendingLibraryChanges.changesOnly=!0}),a))}_removeConfigFileWatcher(){this._configFileWatcher&&(this._configFileWatcher.close(),this._configFileWatcher=void 0)}_updateConfigFileWatcher(){this._removeConfigFileWatcher(),this._watchForConfigChanges&&(this._configFilePath?this._configFileWatcher=this.fs.createFileSystemWatcher([this._configFilePath],(e=>{this._verboseOutput&&this._console.info(`Received fs event '${e}' for config file`),this._scheduleReloadConfigFile()})):this._executionRootPath&&(this._configFileWatcher=this.fs.createFileSystemWatcher([this._executionRootPath],((e,n)=>{if(n&&("add"===e||"change"===e)){const a=(0,g.getFileName)(n);a&&t.configFileNames.some((e=>e===a))&&(this._verboseOutput&&this._console.info(`Received fs event '${e}' for config file`),this._commandLineOptions&&this.setOptions(this._commandLineOptions))}}))))}_clearReloadConfigTimer(){this._reloadConfigTimer&&(clearTimeout(this._reloadConfigTimer),this._reloadConfigTimer=void 0)}_scheduleReloadConfigFile(){this._clearReloadConfigTimer(),this._reloadConfigTimer=setTimeout((()=>{this._clearReloadConfigTimer(),this._reloadConfigFile()}),100)}_reloadConfigFile(){if(this._updateConfigFileWatcher(),this._configFilePath){this._console.info(`Reloading configuration file at ${this._configFilePath}`);const e=this._backgroundAnalysisProgram.host,t=this._getConfigOptions(e,this._commandLineOptions);this._backgroundAnalysisProgram.setConfigOptions(t),this._applyConfigOptions(e)}}_applyConfigOptions(e){var t;const n=this._importResolverFactory(this.fs,this._backgroundAnalysisProgram.configOptions,e);if(this._backgroundAnalysisProgram.setImportResolver(n),(null===(t=this._commandLineOptions)||void 0===t?void 0:t.fromVsCodeExtension)||this._configOptions.verboseOutput){const e=this._configOptions.verboseOutput?c.LogLevel.Info:c.LogLevel.Log;for(const t of this._configOptions.getExecutionEnvironments()){(0,c.log)(this._console,e,`Search paths for ${t.root||"<default>"}`);n.getImportRoots(t,!0).forEach((t=>{(0,c.log)(this._console,e,`  ${t}`)}))}}this._updateLibraryFileWatcher(),this._updateConfigFileWatcher(),this._updateSourceFileWatchers(),this._updateTrackedFileList(!0),this._scheduleReanalysis(!1)}_clearReanalysisTimer(){this._analyzeTimer&&(clearTimeout(this._analyzeTimer),this._analyzeTimer=void 0)}_scheduleReanalysis(e){var t,n;if(this._disposed||!(null===(t=this._commandLineOptions)||void 0===t?void 0:t.enableAmbientAnalysis))return;e&&(this._requireTrackedFileUpdate=!0),null===(n=this._backgroundAnalysisCancellationSource)||void 0===n||n.cancel(),this._clearReanalysisTimer();const a=Date.now()-this._lastUserInteractionTime,i=Math.max(250-a,20);this._analyzeTimer=setTimeout((()=>{this._analyzeTimer=void 0,this._requireTrackedFileUpdate&&this._updateTrackedFileList(!1),this._backgroundAnalysisCancellationSource=this.cancellationProvider.createCancellationTokenSource();this._backgroundAnalysisProgram.startAnalysis(this._backgroundAnalysisCancellationSource.token)&&this._scheduleReanalysis(!1)}),i)}_reportConfigParseError(){this._onCompletionCallback&&this._onCompletionCallback({diagnostics:[],filesInProgram:0,filesRequiringAnalysis:0,checkingOnlyOpenFiles:!0,fatalErrorOccurred:!1,configParseErrorOccurred:!0,elapsedTime:0})}}t.AnalyzerService=k},17741:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceFile=t.IPythonMode=void 0;const s=n(71267),o=n(88711),l=n(5284),p=n(59750),c=n(1395),d=n(30795),u=n(83501),m=n(28513),y=n(58601),g=n(13490),h=n(41209),f=n(81844),T=n(96541),v=r(n(92828)),b=n(6698),_=n(10154),I=n(59273),C=n(99661),k=n(29597),S=n(92365),w=r(n(21)),A=n(43324),x=n(46892),P=r(n(67030)),D=n(7508),N=n(52007),F=52428800;var E;!function(e){e[e.None=0]="None",e[e.CellDocs=1]="CellDocs"}(E=t.IPythonMode||(t.IPythonMode={}));class z{constructor(){this.diagnosticVersion=0,this.fileContentsVersion=0,this.lastFileContentLength=void 0,this.lastFileContentHash=void 0,this.analyzedFileContentsVersion=-1,this.parseTreeNeedsCleaning=!1,this.isBindingInProgress=!1,this.parseDiagnostics=[],this.commentDiagnostics=[],this.bindDiagnostics=[],this.checkerDiagnostics=[],this.typeIgnoreLines=new Map,this.pyrightIgnoreLines=new Map,this.accumulatedDiagnostics=[],this.circularDependencies=[],this.noCircularDependencyConfirmed=!1,this.isBindingNeeded=!0,this.isCheckingNeeded=!0,this.isFileDeleted=!1}}t.SourceFile=class{constructor(e,t,n,a,i,r,o,l,d,u){this._writableData=new z,this._diagnosticRuleSet=(0,p.getBasicDiagnosticRuleSet)(),this._ipythonMode=E.None,this._isEditMode=!1,this.fileSystem=e,this._console=o||new c.StandardConsole,this._isEditMode=r,this._filePath=t,this._realFilePath=null!=d?d:t,this._moduleName=n,this._isStubFile=t.endsWith(".pyi"),this._isThirdPartyImport=a,this._isThirdPartyPyTypedPresent=i;const m=(0,f.getFileName)(t);this._isTypingStubFile=this._isStubFile&&(this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/typing.pyi"))||"typing_extensions.pyi"===m),this._isTypingExtensionsStubFile=this._isStubFile&&"typing_extensions.pyi"===m,this._isBuiltInStubFile=!1,this._isStubFile&&(this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/collections/__init__.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/asyncio/futures.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/asyncio/tasks.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/builtins.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/_importlib_modulespec.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/dataclasses.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/abc.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/enum.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/queue.pyi"))||this._filePath.endsWith((0,f.normalizeSlashes)("stdlib/types.pyi")))&&(this._isBuiltInStubFile=!0),this._logTracker=null!=l?l:new h.LogTracker(o,s.isMainThread?"FG":"BG"),this._ipythonMode=null!=u?u:E.None}getRealFilePath(){return this._realFilePath}getIPythonMode(){return this._ipythonMode}getFilePath(){return this._filePath}getModuleName(){return this._moduleName?this._moduleName:(0,f.stripFileExtension)((0,f.getFileName)(this._filePath))}setModuleName(e){this._moduleName=e}getDiagnosticVersion(){return this._writableData.diagnosticVersion}isStubFile(){return this._isStubFile}isThirdPartyPyTypedPresent(){return this._isThirdPartyPyTypedPresent}getDiagnostics(e,t){if(this._writableData.diagnosticVersion!==t)return this._writableData.accumulatedDiagnostics}getImports(){return this._writableData.imports||[]}getBuiltinsImport(){return this._writableData.builtinsImport}getIPythonDisplayImport(){return this._writableData.ipythonDisplayImport}getModuleSymbolTable(){return this._writableData.moduleSymbolTable}getCheckTime(){return this._writableData.checkTime}enterEditMode(){this._isEditMode=!0}exitEditMode(){if(this._isEditMode=!1,this._preEditData){const e=this._writableData.clientDocumentContents;return this._writableData=this._preEditData,this._preEditData=void 0,e}}didContentsChangeOnDisk(){if(this._writableData.clientDocumentContents)return!1;if(void 0===this._writableData.lastFileContentLength)return!1;try{const e=this.fileSystem.readFileSync(this._filePath,"utf8");if(e.length!==this._writableData.lastFileContentLength)return!0;if(v.hashString(e)!==this._writableData.lastFileContentHash)return!0}catch(e){return!0}return!1}dropParseAndBindInfo(){this._writableData.parseResults=void 0,this._writableData.moduleSymbolTable=void 0,this._writableData.isBindingNeeded=!0}markDirty(){this._writableData.fileContentsVersion++,this._writableData.noCircularDependencyConfirmed=!1,this._writableData.isCheckingNeeded=!0,this._writableData.isBindingNeeded=!0,this._writableData.moduleSymbolTable=void 0;const e=this.getFilePath();g.Extensions.getProgramExtensions(e).forEach((t=>t.fileDirty?t.fileDirty(e):null))}markReanalysisRequired(e){this._writableData.isCheckingNeeded=!0,this._writableData.noCircularDependencyConfirmed=!1,this._writableData.parseResults&&(this._writableData.parseResults.containsWildcardImport||void 0!==w.getDunderAllInfo(this._writableData.parseResults.parseTree)||e)&&(this._writableData.parseTreeNeedsCleaning=!0,this._writableData.isBindingNeeded=!0,this._writableData.moduleSymbolTable=void 0)}getFileContentsVersion(){return this._writableData.fileContentsVersion}getClientVersion(){return this._writableData.clientDocumentVersion}getOpenFileContents(){return this._writableData.clientDocumentContents}getFileContent(){const e=this.getOpenFileContents();if(void 0!==e)return e;try{const e=this.fileSystem.statSync(this._filePath);if(e.size>F)throw this._console.error(`File length of "${this._filePath}" is ${e.size} which exceeds the maximum supported file size of 52428800`),new Error("File larger than max");return this.fileSystem.readFileSync(this._filePath,"utf8")}catch(e){return}}setClientVersion(e,t){if(this._cachePreEditState(),null===e)this._writableData.clientDocumentVersion=void 0,this._writableData.clientDocumentContents=void 0;else{this._writableData.clientDocumentVersion=e,this._writableData.clientDocumentContents=t;const n=v.hashString(t);t.length===this._writableData.lastFileContentLength&&n===this._writableData.lastFileContentHash||this.markDirty(),this._writableData.lastFileContentLength=t.length,this._writableData.lastFileContentHash=n,this._writableData.isFileDeleted=!1}}prepareForClose(){}isFileDeleted(){return this._writableData.isFileDeleted}isParseRequired(){return!this._writableData.parseResults||this._writableData.analyzedFileContentsVersion!==this._writableData.fileContentsVersion}isBindingRequired(){return!this._writableData.isBindingInProgress&&(!!this.isParseRequired()||this._writableData.isBindingNeeded)}isCheckingRequired(){return this._writableData.isCheckingNeeded}getParseResults(){if(!this.isParseRequired())return this._writableData.parseResults}addCircularDependency(e,t){let n=!1;this._writableData.circularDependencies.length<4&&(this._writableData.circularDependencies.some((e=>e.isEqual(t)))||(this._writableData.circularDependencies.push(t),n=!0)),n&&this._recomputeDiagnostics(e)}setNoCircularDependencyConfirmed(){this._writableData.noCircularDependencyConfirmed=!0}isNoCircularDependencyConfirmed(){return!this.isParseRequired()&&this._writableData.noCircularDependencyConfirmed}setHitMaxImportDepth(e){this._writableData.hitMaxImportDepth=e}parse(e,t,n){return this._logTracker.log(`parsing: ${this._getPathForLogging(this._filePath)}`,(a=>{if(!this.isParseRequired())return a.suppress(),!1;const i=this.createDiagnosticSink();let r=this.getOpenFileContents();if(void 0===r)try{const e=I.timingStats.readFileTime.totalTime;I.timingStats.readFileTime.timeOperation((()=>{if(r=null!=n?n:this.getFileContent(),void 0===r)throw new Error("Can't get file content");this._writableData.lastFileContentLength=r.length,this._writableData.lastFileContentHash=v.hashString(r)})),a.add(`fs read ${I.timingStats.readFileTime.totalTime-e}ms`)}catch(e){i.addError("Source file could not be read",(0,b.getEmptyRange)()),r="",this.fileSystem.existsSync(this._realFilePath)||(this._writableData.isFileDeleted=!0)}try{const n=this._parseFile(e,this._filePath,r,this._ipythonMode,i);(0,d.assert)(void 0!==n&&void 0!==n.tokenizerOutput),this._writableData.parseResults=n,this._writableData.typeIgnoreLines=this._writableData.parseResults.tokenizerOutput.typeIgnoreLines,this._writableData.typeIgnoreAll=this._writableData.parseResults.tokenizerOutput.typeIgnoreAll,this._writableData.pyrightIgnoreLines=this._writableData.parseResults.tokenizerOutput.pyrightIgnoreLines;const a=e.findExecEnvironment(this._filePath);I.timingStats.resolveImportsTime.timeOperation((()=>{const e=this._resolveImports(t,n.importedModules,a);this._writableData.imports=e.imports,this._writableData.builtinsImport=e.builtinsImportResult,this._writableData.ipythonDisplayImport=e.ipythonDisplayImportResult,this._writableData.parseDiagnostics=i.fetchAndClear()}));const s=void 0!==e.strict.find((e=>e.regExp.test(this._realFilePath))),o=[];this._diagnosticRuleSet=P.getFileLevelDirectives(this._writableData.parseResults.tokenizerOutput.tokens,this._writableData.parseResults.tokenizerOutput.lines,e.diagnosticRuleSet,s,o),this._writableData.commentDiagnostics=[],o.forEach((e=>{this._writableData.commentDiagnostics.push(new u.Diagnostic(0,e.message,(0,T.convertTextRangeToRange)(e.range,this._writableData.parseResults.tokenizerOutput.lines)))}))}catch(e){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(C.Localizer.Diagnostic.internalParseError().format({file:this.getFilePath(),message:t})),this._writableData.parseResults={text:"",parseTree:k.ModuleNode.create({start:0,length:0}),importedModules:[],futureImports:new Set,tokenizerOutput:{tokens:new _.TextRangeCollection([]),lines:new _.TextRangeCollection([]),typeIgnoreAll:void 0,typeIgnoreLines:new Map,pyrightIgnoreLines:new Map,predominantEndOfLineSequence:"\n",predominantTabSequence:"    ",predominantSingleQuoteCharacter:"'"},containsWildcardImport:!1,typingSymbolAliases:new Map},this._writableData.imports=void 0,this._writableData.builtinsImport=void 0,this._writableData.ipythonDisplayImport=void 0;const n=this.createDiagnosticSink();n.addError(C.Localizer.Diagnostic.internalParseError().format({file:this.getFilePath(),message:t}),(0,b.getEmptyRange)()),this._writableData.parseDiagnostics=n.fetchAndClear()}return this._writableData.analyzedFileContentsVersion=this._writableData.fileContentsVersion,this._writableData.isBindingNeeded=!0,this._writableData.isCheckingNeeded=!0,this._writableData.parseTreeNeedsCleaning=!1,this._writableData.hitMaxImportDepth=void 0,this._recomputeDiagnostics(e),!0}))}bind(e,t,n,a){return(0,d.assert)(!this.isParseRequired(),"Bind called before parsing"),(0,d.assert)(this.isBindingRequired(),"Bind called unnecessarily"),(0,d.assert)(!this._writableData.isBindingInProgress,"Bind called while binding in progress"),(0,d.assert)(void 0!==this._writableData.parseResults,"Parse results not available"),this._logTracker.log(`binding: ${this._getPathForLogging(this._filePath)}`,(()=>{try{I.timingStats.bindTime.timeOperation((()=>{this._cleanParseTreeIfRequired();const i=this._buildFileInfo(e,this._writableData.parseResults.text,t,n,a);w.setFileInfo(this._writableData.parseResults.parseTree,i);const r=new A.Binder(i,e.indexGenerationMode);if(this._writableData.isBindingInProgress=!0,r.bindModule(this._writableData.parseResults.parseTree),e.internalTestMode){(new N.TestWalker).walk(this._writableData.parseResults.parseTree)}this._writableData.bindDiagnostics=i.diagnosticSink.fetchAndClear();const s=w.getScope(this._writableData.parseResults.parseTree);(0,d.assert)(void 0!==s,"Module scope not returned by binder"),this._writableData.moduleSymbolTable=s.symbolTable}))}catch(e){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(C.Localizer.Diagnostic.internalBindError().format({file:this.getFilePath(),message:t}));const n=this.createDiagnosticSink();n.addError(C.Localizer.Diagnostic.internalBindError().format({file:this.getFilePath(),message:t}),(0,b.getEmptyRange)()),this._writableData.bindDiagnostics=n.fetchAndClear()}finally{this._writableData.isBindingInProgress=!1}this._writableData.isCheckingNeeded=!0,this._writableData.isBindingNeeded=!1,this._recomputeDiagnostics(e)}))}check(e,t,n,a,i){return(0,d.assert)(!this.isParseRequired(),"Check called before parsing"),(0,d.assert)(!this.isBindingRequired(),"Check called before binding"),(0,d.assert)(!this._writableData.isBindingInProgress,"Check called while binding in progress"),(0,d.assert)(this.isCheckingRequired(),"Check called unnecessarily"),(0,d.assert)(void 0!==this._writableData.parseResults,"Parse results not available"),this._logTracker.log(`checking: ${this._getPathForLogging(this._filePath)}`,(()=>{try{I.timingStats.typeCheckerTime.timeOperation((()=>{const e=new I.Duration;new x.Checker(t,n,this._writableData.parseResults,a,i).check(),this._writableData.isCheckingNeeded=!1;const r=w.getFileInfo(this._writableData.parseResults.parseTree);this._writableData.checkerDiagnostics=r.diagnosticSink.fetchAndClear(),this._writableData.checkTime=e.getDurationInMilliseconds()}))}catch(e){if(!o.OperationCanceledException.is(e)){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(C.Localizer.Diagnostic.internalTypeCheckingError().format({file:this.getFilePath(),message:t}));const n=this.createDiagnosticSink();n.addError(C.Localizer.Diagnostic.internalTypeCheckingError().format({file:this.getFilePath(),message:t}),(0,b.getEmptyRange)()),this._writableData.checkerDiagnostics=n.fetchAndClear(),this._writableData.isCheckingNeeded=!1}throw e}finally{this._writableData.circularDependencies=[],this._recomputeDiagnostics(e)}}))}test_enableIPythonMode(e){this._ipythonMode=e?E.CellDocs:E.None}createParser(){return new S.Parser}createDiagnosticSink(){return new y.DiagnosticSink}createTextRangeDiagnosticSink(e){return new y.TextRangeDiagnosticSink(e)}_recomputeDiagnostics(e){this._writableData.diagnosticVersion++;let t=!0;this._isThirdPartyImport&&(t=!1);let n=[];(0,l.appendArray)(n,this._writableData.parseDiagnostics),(0,l.appendArray)(n,this._writableData.commentDiagnostics),(0,l.appendArray)(n,this._writableData.bindDiagnostics),(0,l.appendArray)(n,this._writableData.checkerDiagnostics);const a=n,i=new Map(this._writableData.typeIgnoreLines),r=new Map(this._writableData.pyrightIgnoreLines);this._diagnosticRuleSet.enableTypeIgnoreComments&&this._writableData.typeIgnoreLines.size>0&&(n=n.filter((e=>{if(3!==e.category&&4!==e.category&&5!==e.category)for(let t=e.range.start.line;t<=e.range.end.line;t++)if(this._writableData.typeIgnoreLines.has(t))return i.delete(t),!1;return!0}))),this._writableData.pyrightIgnoreLines.size>0&&(n=n.filter((e=>{if(4!==e.category&&5!==e.category)for(let t=e.range.start.line;t<=e.range.end.line;t++){const n=this._writableData.pyrightIgnoreLines.get(t);if(n){if(!n.rulesList)return r.delete(t),!1;const a=e.getRule();if(!a)return!0;if(n.rulesList.find((e=>e.text===a))){const e=r.get(t);if(null==e?void 0:e.rulesList){const n=e.rulesList.filter((e=>e.text!==a));0===n.length?r.delete(t):r.set(t,{range:e.range,rulesList:n})}return!1}return!0}}return!0})));const s=[];if("none"!==this._diagnosticRuleSet.reportUnnecessaryTypeIgnoreComment&&!this._writableData.isCheckingNeeded){const e=(0,u.convertLevelToCategory)(this._diagnosticRuleSet.reportUnnecessaryTypeIgnoreComment),t=a.filter((e=>0===e.category||1===e.category||2===e.category)),n=e=>a.find((t=>4===t.category&&t.range.start.line<=e.start.line&&t.range.end.line>=e.end.line));if(0===t.length&&void 0!==this._writableData.typeIgnoreAll){const t=this._writableData.typeIgnoreAll.range.start,a=t+this._writableData.typeIgnoreAll.range.length,i=(0,T.convertOffsetsToRange)(t,a,this._writableData.parseResults.tokenizerOutput.lines);!n(i)&&this._diagnosticRuleSet.enableTypeIgnoreComments&&s.push(new u.Diagnostic(e,C.Localizer.Diagnostic.unnecessaryTypeIgnore(),i))}i.forEach((t=>{var a;if(null===(a=this._writableData.parseResults)||void 0===a?void 0:a.tokenizerOutput.lines){const a=t.range.start,i=a+t.range.length,r=(0,T.convertOffsetsToRange)(a,i,this._writableData.parseResults.tokenizerOutput.lines);!n(r)&&this._diagnosticRuleSet.enableTypeIgnoreComments&&s.push(new u.Diagnostic(e,C.Localizer.Diagnostic.unnecessaryTypeIgnore(),r))}})),r.forEach((t=>{var a;if(null===(a=this._writableData.parseResults)||void 0===a?void 0:a.tokenizerOutput.lines)if(t.rulesList)t.rulesList.forEach((t=>{const a=t.range.start,i=a+t.range.length,r=(0,T.convertOffsetsToRange)(a,i,this._writableData.parseResults.tokenizerOutput.lines);n(r)||s.push(new u.Diagnostic(e,C.Localizer.Diagnostic.unnecessaryPyrightIgnoreRule().format({name:t.text}),r))}));else{const a=t.range.start,i=a+t.range.length,r=(0,T.convertOffsetsToRange)(a,i,this._writableData.parseResults.tokenizerOutput.lines);n(r)||s.push(new u.Diagnostic(e,C.Localizer.Diagnostic.unnecessaryPyrightIgnore(),r))}}))}if("none"!==this._diagnosticRuleSet.reportImportCycles&&this._writableData.circularDependencies.length>0){const e=(0,u.convertLevelToCategory)(this._diagnosticRuleSet.reportImportCycles);this._writableData.circularDependencies.forEach((t=>{const a=new u.Diagnostic(e,C.Localizer.Diagnostic.importCycleDetected()+"\n"+t.getPaths().map((e=>"  "+e)).join("\n"),(0,b.getEmptyRange)());a.setRule(m.DiagnosticRule.reportImportCycles),n.push(a)}))}void 0!==this._writableData.hitMaxImportDepth&&n.push(new u.Diagnostic(0,C.Localizer.Diagnostic.importDepthExceeded().format({depth:this._writableData.hitMaxImportDepth}),(0,b.getEmptyRange)())),this._addTaskListDiagnostics(e.taskListTokens,n),e.ignore.find((e=>e.regExp.test(this._realFilePath)))&&(n=[]),this._diagnosticRuleSet.enableTypeIgnoreComments&&void 0!==this._writableData.typeIgnoreAll&&(n=n.filter((e=>0!==e.category&&1!==e.category&&2!==e.category))),n=n.concat(s),t||(n=n.filter((e=>3===e.category||4===e.category||5===e.category))),this._writableData.accumulatedDiagnostics=n}_cachePreEditState(){void 0!==this._writableData.clientDocumentContents&&this._isEditMode&&!this._preEditData&&(this._preEditData=this._writableData,this._writableData=new z)}_addTaskListDiagnostics(e,t){var n,a;if(!e||0===e.length||!t)return;if(!(null===(a=null===(n=this._writableData.parseResults)||void 0===n?void 0:n.tokenizerOutput)||void 0===a?void 0:a.tokens))return;const i=this._writableData.parseResults.tokenizerOutput;for(let n=0;n<i.tokens.count;n++){const a=i.tokens.getItemAt(n);if(a.comments&&0!==a.comments.length)for(const n of a.comments)for(const a of e){const e="^[\\s]*"+a.text+"([\\s]*$|[\\W]+)";if(!RegExp(e,"i").test(n.value))continue;let r=n.start;r+=n.value.toLowerCase().indexOf(a.text.toLowerCase());const s=b.TextRange.getEnd(n),o=(0,T.convertOffsetsToRange)(r,s,i.lines);t.push(new u.Diagnostic(6,n.value.trim(),o,a.priority))}}}_buildFileInfo(e,t,n,a,i){(0,d.assert)(void 0!==this._writableData.parseResults,"Parse results not available");return{importLookup:n,futureImports:i,builtinsScope:a,diagnosticSink:this.createTextRangeDiagnosticSink(this._writableData.parseResults.tokenizerOutput.lines),executionEnvironment:e.findExecEnvironment(this._filePath),diagnosticRuleSet:this._diagnosticRuleSet,fileContents:t,lines:this._writableData.parseResults.tokenizerOutput.lines,typingSymbolAliases:this._writableData.parseResults.typingSymbolAliases,definedConstants:e.defineConstant,filePath:this._filePath,moduleName:this.getModuleName(),isStubFile:this._isStubFile,isTypingStubFile:this._isTypingStubFile,isTypingExtensionsStubFile:this._isTypingExtensionsStubFile,isBuiltInStubFile:this._isBuiltInStubFile,isInPyTypedPackage:this._isThirdPartyPyTypedPresent,ipythonMode:this._ipythonMode,accessedSymbolSet:new Set}}_cleanParseTreeIfRequired(){if(this._writableData.parseResults&&this._writableData.parseTreeNeedsCleaning){new D.ParseTreeCleanerWalker(this._writableData.parseResults.parseTree).clean(),this._writableData.parseTreeNeedsCleaning=!1}}_resolveImports(e,t,n){const a=[],i=(t,i=!1)=>{const r=e.resolveImport(this._filePath,n,{leadingDots:0,nameParts:t,importedSymbols:void 0});if(!i||r.isImportFound)return 0===r.resolvedPaths.length||r.resolvedPaths[0]!==this._filePath?(a.push(r),r):void 0};let r;this._isThirdPartyImport||this._isStubFile||(r=i(["__builtins__"],!0)),r||(r=i(["builtins"]));const s=this._ipythonMode?i(["IPython","display"]):void 0;for(const i of t){const t=e.resolveImport(this._filePath,n,{leadingDots:i.leadingDots,nameParts:i.nameParts,importedSymbols:i.importedSymbols});a.push(t),i.nameParts.length===i.nameNode.nameParts.length?w.setImportInfo(i.nameNode,t):((0,d.assert)(i.nameParts.length>0),(0,d.assert)(i.nameParts.length-1<i.nameNode.nameParts.length),w.setImportInfo(i.nameNode.nameParts[i.nameParts.length-1],t))}return{imports:a,builtinsImportResult:r,ipythonDisplayImportResult:s}}_getPathForLogging(e){return(0,h.getPathForLogging)(this.fileSystem,e)}_parseFile(e,t,n,a,i){var r;const s=e.findExecEnvironment(t),o=new S.ParseOptions;o.ipythonMode=a,t.endsWith("pyi")&&(o.isStubFile=!0),o.pythonVersion=s.pythonVersion,o.skipFunctionAndClassBody=null!==(r=e.indexGenerationMode)&&void 0!==r&&r;return this.createParser().parseSourceFile(n,o,i)}}},37648:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createChainedByList=t.verifyNoCyclesInChainedFiles=t.collectImportedByCells=t.isUserCode=void 0;const a=n(30795),i=n(17741);function r(e,t){e.importedBy.forEach((e=>{t.has(e)||(t.add(e),r(e,t))}))}t.isUserCode=function(e){return!!e&&e.isTracked&&!e.isThirdPartyImport&&!e.isTypeshedFile},t.collectImportedByCells=function(e,t){!function(e){for(const t of e.getSourceFileInfoList())t.sourceFile.getIPythonMode()===i.IPythonMode.CellDocs&&(e.getParseResults(t.sourceFile.getFilePath()),e.handleMemoryHighUsage())}(e);const n=new Set;return r(t,n),n},t.verifyNoCyclesInChainedFiles=function(e){let t=e.chainedSourceFile;if(!t)return;const n=new Set([e.sourceFile.getFilePath()]);for(;t;){const e=t.sourceFile.getFilePath();n.has(e)&&(0,a.fail)("Found a cycle in implicit imports files"),n.add(e),t=t.chainedSourceFile}},t.createChainedByList=function(e,t){const n=new Map;for(const t of e.getSourceFileInfoList())t.chainedSourceFile&&n.set(t.chainedSourceFile,t);const i=new Set,r=[t];let s=t;for(;s;)(0,a.assert)(!i.has(s),"detected a cycle in chained files"),i.add(s),s=n.get(s),s&&r.push(s);return r}},9584:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isStubFile=t.SourceMapper=void 0;const s=r(n(21)),o=r(n(66455)),l=n(5284),p=n(79251),c=n(30795),d=n(81844),u=n(44660),m=n(37648),y=n(60259),g=n(51458),h=n(33029);function f(e){return".pyi"===(0,d.getAnyExtensionFromPath)(e,[".pyi"],!1)}t.SourceMapper=class{constructor(e,t,n,a,i,r,s,o,l){this._importResolver=e,this._execEnv=t,this._evaluator=n,this._fileBinder=a,this._boundSourceGetter=i,this._mapCompiled=r,this._preferStubs=s,this._fromFile=o,this._cancelToken=l}findModules(e){var t;return(this._isStubThatShouldBeMappedToImplementation(e)?this._getBoundSourceFilesFromStubFile(e):[null===(t=this._boundSourceGetter(e))||void 0===t?void 0:t.sourceFile]).filter(p.isDefined).map((e=>{var t;return null===(t=e.getParseResults())||void 0===t?void 0:t.parseTree})).filter(p.isDefined)}getModuleNode(e){var t,n;return null===(n=null===(t=this._boundSourceGetter(e))||void 0===t?void 0:t.sourceFile.getParseResults())||void 0===n?void 0:n.parseTree}findDeclarations(e){return(0,u.isClassDeclaration)(e)?this._findClassOrTypeAliasDeclarations(e):(0,u.isFunctionDeclaration)(e)?this._findFunctionOrTypeAliasDeclarations(e):(0,u.isVariableDeclaration)(e)?this._findVariableDeclarations(e):(0,u.isParameterDeclaration)(e)?this._findParameterDeclarations(e):(0,u.isSpecialBuiltInClassDeclaration)(e)?this._findSpecialBuiltInClassDeclarations(e):[]}findClassDeclarationsByType(e,t){const n=[];return this._addClassTypeDeclarations(e,t,n,new Set),n.filter((e=>(0,u.isClassDeclaration)(e))).map((e=>e))}findFunctionDeclarations(e){return this._findFunctionOrTypeAliasDeclarations(e).filter((e=>(0,u.isFunctionDeclaration)(e))).map((e=>e))}isUserCode(e){return(0,m.isUserCode)(this._boundSourceGetter(e))}getNextFileName(e){const t=(0,d.stripFileExtension)(e);let n=1,a=`${t}_${n}.py`;for(;this.isUserCode(a)&&n<1e3;)n+=1,a=`${t}_${n}.py`;return a}_findSpecialBuiltInClassDeclarations(e,t=new Set){if(38===e.node.valueExpression.nodeType){const n=e.node.valueExpression.value;return this._getBoundSourceFilesFromStubFile(e.path).flatMap((e=>this._findClassDeclarationsByName(e,n,t)))}return[]}_findClassOrTypeAliasDeclarations(e,t=new Set){const n=this._getFullClassName(e.node);return this._getBoundSourceFilesFromStubFile(e.path).flatMap((e=>this._findClassDeclarationsByName(e,n,t)))}_findFunctionOrTypeAliasDeclarations(e,t=new Set){const n=e.node.name.value,a=this._getBoundSourceFilesFromStubFile(e.path);if(e.isMethod){const i=o.getEnclosingClass(e.node);if(void 0===i)return[];const r=this._getFullClassName(i);return a.flatMap((e=>this._findMethodDeclarationsByName(e,r,n,t)))}return a.flatMap((e=>this._findFunctionDeclarationsByName(e,n,t)))}_findVariableDeclarations(e,t=new Set){if(38!==e.node.nodeType)return[];const n=e.node.value,a=this._getBoundSourceFilesFromStubFile(e.path),i=o.getEnclosingClass(e.node);if(i){const e=this._getFullClassName(i);return a.flatMap((a=>this._findFieldDeclarationsByName(a,e,n,t)))}return a.flatMap((e=>this._findVariableDeclarationsByName(e,n,t)))}_findParameterDeclarations(e){const t=[];if(!e.node.name)return t;const n=o.getEnclosingFunction(e.node);if(!n)return t;const a=this._evaluator.getDeclarationsForNameNode(n.name);if(!a)return t;const i=new Set;for(const n of a)for(const a of this._findFunctionOrTypeAliasDeclarations(n,i))(0,l.appendArray)(t,this._lookUpSymbolDeclarations(a.node,e.node.name.value).filter((e=>(0,u.isParameterDeclaration)(e))).map((e=>e)));return t}_findMemberDeclarationsByName(e,t,n,a,i){const r=[],s=this._findClassDeclarationsByName(e,t,i);for(const e of s.filter((e=>(0,u.isClassDeclaration)(e))).map((e=>e))){const t=this._evaluator.getTypeOfClass(e.node);if(!t)continue;const s=(0,h.lookUpClassMember)(t.classType,n);if(s)for(const e of s.symbol.getDeclarations())a(e,i,r)}return r}_findFieldDeclarationsByName(e,t,n,a){let i=[];const r=`@${e.getFilePath()}/c/${t}/v/${n}`;return a.has(r)||(a.add(r),i=this._findMemberDeclarationsByName(e,t,n,((e,t,n)=>{if((0,u.isVariableDeclaration)(e))if(this._isStubThatShouldBeMappedToImplementation(e.path))for(const a of this._findVariableDeclarations(e,t))(0,u.isVariableDeclaration)(a)&&n.push(a);else n.push(e)}),a),a.delete(r)),i}_findMethodDeclarationsByName(e,t,n,a){let i=[];const r=`@${e.getFilePath()}/c/${t}/f/${n}`;return a.has(r)||(a.add(r),i=this._findMemberDeclarationsByName(e,t,n,((e,t,n)=>{(0,u.isFunctionDeclaration)(e)&&(this._isStubThatShouldBeMappedToImplementation(e.path)?(0,l.appendArray)(n,this._findFunctionOrTypeAliasDeclarations(e,t)):n.push(e))}),a),a.delete(r)),i}_findVariableDeclarationsByName(e,t,n){var a;const i=[],r=`@${e.getFilePath()}/v/${t}`;if(n.has(r))return i;n.add(r);const s=null===(a=e.getParseResults())||void 0===a?void 0:a.parseTree;if(!s)return i;const o=this._lookUpSymbolDeclarations(s,t);if(0===o.length)this._addDeclarationsFollowingWildcardImports(s,t,i,n);else for(const e of o)this._addVariableDeclarations(e,i,n);return n.delete(r),i}_findFunctionDeclarationsByName(e,t,n){var a;const i=[],r=`@${e.getFilePath()}/f/${t}`;if(n.has(r))return i;n.add(r);const s=null===(a=e.getParseResults())||void 0===a?void 0:a.parseTree;if(!s)return i;const o=this._lookUpSymbolDeclarations(s,t);if(0===o.length)this._addDeclarationsFollowingWildcardImports(s,t,i,n);else for(const e of o)this._addClassOrFunctionDeclarations(e,i,n);return n.delete(r),i}_findClassDeclarationsByName(e,t,n){var a;let i=[];const r=null===(a=e.getParseResults())||void 0===a?void 0:a.parseTree;if(r){let a=t.split(".");a.length>0&&(i=this._findClassDeclarations(e,a[0],r,n),a=a.slice(1));for(const t of a)i=i.flatMap((a=>this._findClassDeclarations(e,t,a.node,n)))}return i}_findClassDeclarations(e,t,n,a){const i=[],r=`@${e.getFilePath()}[${n.start}]${t}`;if(a.has(r))return i;a.add(r);const s=this._lookUpSymbolDeclarations(n,t);if(0===s.length&&36===n.nodeType)this._addDeclarationsFollowingWildcardImports(n,t,i,a);else for(const e of s)this._addClassOrFunctionDeclarations(e,i,a);return a.delete(r),i}_addVariableDeclarations(e,t,n){if((0,u.isVariableDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.path)?(0,l.appendArray)(t,this._findVariableDeclarations(e,n)):t.push(e);else if((0,u.isAliasDeclaration)(e)){const a=this._evaluator.resolveAliasDeclaration(e,!0);a&&((0,u.isVariableDeclaration)(a)?this._addVariableDeclarations(a,t,n):((0,u.isClassDeclaration)(a)||(0,u.isFunctionDeclaration)(a))&&this._addClassOrFunctionDeclarations(a,t,n))}}_addClassOrFunctionDeclarations(e,t,n){var a;if((0,u.isClassDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.path)?(0,l.appendArray)(t,this._findClassOrTypeAliasDeclarations(e,n)):t.push(e);else if((0,u.isFunctionDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.path)?(0,l.appendArray)(t,this._findFunctionOrTypeAliasDeclarations(e,n)):t.push(e);else if((0,u.isAliasDeclaration)(e)){const a=this._handleSpecialBuiltInModule(e),i=this._evaluator.resolveAliasDeclaration(a,!0);i&&!(0,u.isAliasDeclaration)(i)&&this._addClassOrFunctionDeclarations(i,t,n)}else if((0,u.isVariableDeclaration)(e)){this._addVariableDeclarations(e,t,n);const i=null!==(a=e.typeAliasName)&&void 0!==a?a:e.node,r=this._evaluator.getType(i);if(!r)return;if((0,g.isFunction)(r)&&r.details.declaration)this._addClassOrFunctionDeclarations(r.details.declaration,t,n);else if((0,g.isOverloadedFunction)(r))for(const e of r.overloads.map((e=>e.details.declaration)).filter(p.isDefined))this._addClassOrFunctionDeclarations(e,t,n);else(0,g.isInstantiableClass)(r)&&this._addClassTypeDeclarations(e.path,r,t,n)}}_handleSpecialBuiltInModule(e){if(e.path||!e.node)return e;if("io"!==e.moduleName&&"collections"!==e.moduleName)return e;const t=this._importResolver.getTypeshedStdLibPath(this._execEnv);if(!t)return e;const n=o.getFileInfoFromNode(e.node);if(!n)return e;const a=(0,d.combinePaths)(t,function(){switch(e.node.nodeType){case 21:case 22:return e.node.module;case 23:return e.node.parent.module;default:return(0,c.assertNever)(e.node)}}().nameParts.map((e=>e.value)).join(".")+".pyi"),i=this._getSourceFiles(a,n.filePath);if(0===i.length)return e;const r={...e};return r.path=i[0].getFilePath(),r}_addClassTypeDeclarations(e,t,n,a){const i=t.details.filePath,r=this._getSourceFiles(i,void 0,e),s=t.details.fullName.substring(t.details.moduleName.length+1);for(const e of r)(0,l.appendArray)(n,this._findClassDeclarationsByName(e,s,a))}_getSourceFiles(e,t,n){const a=[];if(this._isStubThatShouldBeMappedToImplementation(e))(0,l.appendArray)(a,this._getBoundSourceFilesFromStubFile(e,t,n));else{const t=this._boundSourceGetter(e);t&&a.push(t.sourceFile)}return a}_addDeclarationsFollowingWildcardImports(e,t,n,a){var i,r;const o=null===(i=s.getScope(e))||void 0===i?void 0:i.symbolTable;if(o)for(const e of o.values())for(const i of e.getDeclarations()){if(!(0,u.isAliasDeclaration)(i)||!i.path||22!==i.node.nodeType||!i.node.isWildcardImport)continue;const e=`@${i.path}/l/${t}`;if(a.has(e))continue;a.add(e);const s=this._getSourceFiles(i.path);for(const e of s){const i=null===(r=e.getParseResults())||void 0===r?void 0:r.parseTree;if(!i)continue;const s=this._lookUpSymbolDeclarations(i,t);if(0===s.length)this._addDeclarationsFollowingWildcardImports(i,t,n,a);else for(const e of s){const t=this._evaluator.resolveAliasDeclaration(e,!0);t&&((0,u.isFunctionDeclaration)(t)||(0,u.isClassDeclaration)(t)?this._addClassOrFunctionDeclarations(t,n,a):(0,u.isVariableDeclaration)(t)&&this._addVariableDeclarations(t,n,a))}}}}_lookUpSymbolDeclarations(e,t){if(void 0===e)return[];const n=s.getScope(e),a=null==n?void 0:n.lookUpSymbol(t),i=null==a?void 0:a.getDeclarations();return null!=i?i:[]}_getFullClassName(e){const t=[];let n=e;for(;void 0!==n;)t.push(n.name.value),n=o.getEnclosingClass(n);return t.reverse().join(".")}_getBoundSourceFilesFromStubFile(e,t,n){var a;return this._getSourcePathsFromStub(e,null!=n?n:null===(a=this._fromFile)||void 0===a?void 0:a.sourceFile.getFilePath()).map((n=>this._fileBinder(null!=t?t:e,n))).filter(p.isDefined)}_getSourcePathsFromStub(e,t){let n=this._importResolver.getSourceFilesFromStub(e,this._execEnv,this._mapCompiled);if(n.length>0)return n;const a=this._getStubFileImportTree(e,t);for(let e=0;e<a.length;e++)if(n=this._importResolver.getSourceFilesFromStub(a[e],this._execEnv,this._mapCompiled),n.length>0)return n;return[]}_getStubFileImportTree(e,t){return t&&this._isStubThatShouldBeMappedToImplementation(e)?(0,y.buildImportTree)(t,e,(e=>{const t=this._boundSourceGetter(e);return t?t.importedBy.map((e=>e.sourceFile.getFilePath())):[]}),this._cancelToken).filter((e=>this._isStubThatShouldBeMappedToImplementation(e))):[e]}_isStubThatShouldBeMappedToImplementation(e){if(this._preferStubs)return!1;return!!f(e)&&this._importResolver.getSourceFilesFromStub(e,this._execEnv,this._mapCompiled).every((t=>t!==e))}},t.isStubFile=f},60259:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildImportTree=void 0;const n=1e3;class a{constructor(){this.value=0}}function i(e,t,a,r,s,o){if(s.value>n||o.isCancellationRequested)return[];if(s.value+=1,t===e)return r.length?r:[t];if(r.length>1&&r.find((e=>e===t)))return[];const l=a(t);for(let n=0;n<l.length&&!o.isCancellationRequested;n++){const p=i(e,l[n],a,[...r,t],s,o);if(p.length>0)return p}return[]}t.buildImportTree=function(e,t,n,r){const s=i(e,t,n,[],new a,r);return s.length>0?s:[t]}},93890:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateStaticBoolLikeExpression=t.evaluateStaticBoolExpression=void 0;const a=n(59750);function i(e,t,n,p,c){if(4===e.nodeType)return i(e.rightExpression,t,n,p,c);if(55===e.nodeType){if(38===e.operator){const a=r(e.expression,t,n,p,c);if(void 0!==a)return!a}}else if(7===e.nodeType){if(37===e.operator||36===e.operator){const a=i(e.leftExpression,t,n,p,c),r=i(e.rightExpression,t,n,p,c);if(void 0===a||void 0===r)return;return 37===e.operator?a||r:a&&r}if(l(e.leftExpression,c)&&52===e.rightExpression.nodeType){const n=function(e){let t;if(e.expressions.length>=2){if(40===e.expressions[0].nodeType&&!e.expressions[0].isImaginary&&40===e.expressions[1].nodeType&&!e.expressions[1].isImaginary){const n=e.expressions[0],a=e.expressions[1];"number"==typeof n.value&&"number"==typeof a.value&&(t=256*n.value+a.value)}}else if(1===e.expressions.length){const n=e.expressions[0];"number"==typeof n.value&&(t=256*n.value)}return t}(e.rightExpression);return s(e.operator,t.pythonVersion,n)}if(24===e.leftExpression.nodeType&&l(e.leftExpression.baseExpression,c)&&1===e.leftExpression.items.length&&!e.leftExpression.trailingComma&&!e.leftExpression.items[0].name&&0===e.leftExpression.items[0].argumentCategory&&40===e.leftExpression.items[0].valueExpression.nodeType&&!e.leftExpression.items[0].valueExpression.isImaginary&&0===e.leftExpression.items[0].valueExpression.value&&40===e.rightExpression.nodeType)return s(e.operator,Math.floor(t.pythonVersion/256),e.rightExpression.value);if(function(e,t=["sys"]){if(35===e.nodeType&&38===e.leftExpression.nodeType&&"platform"===e.memberName.value&&t.some((t=>t===e.leftExpression.value)))return!0;return!1}(e.leftExpression,c)&&48===e.rightExpression.nodeType){const n=e.rightExpression.strings.map((e=>e.value)).join(""),i=function(e){if(e.pythonPlatform===a.PythonPlatform.Darwin)return"darwin";if(e.pythonPlatform===a.PythonPlatform.Windows)return"win32";if(e.pythonPlatform===a.PythonPlatform.Linux)return"linux";return}(t);return o(e.operator,i,n)}if(function(e){if(35===e.nodeType&&38===e.leftExpression.nodeType&&"os"===e.leftExpression.value&&"name"===e.memberName.value)return!0;return!1}(e.leftExpression)&&48===e.rightExpression.nodeType){const n=e.rightExpression.strings.map((e=>e.value)).join(""),i=function(e){if(e.pythonPlatform===a.PythonPlatform.Darwin)return"posix";if(e.pythonPlatform===a.PythonPlatform.Windows)return"nt";if(e.pythonPlatform===a.PythonPlatform.Linux)return"posix";return}(t);if(void 0!==i)return o(e.operator,i,n)}else if(48===e.rightExpression.nodeType){let t;if(38===e.leftExpression.nodeType?t=n.get(e.leftExpression.value):35===e.leftExpression.nodeType&&(t=n.get(e.leftExpression.memberName.value)),void 0!==t&&"string"==typeof t){const n=e.rightExpression.strings.map((e=>e.value)).join("");return o(e.operator,t,n)}}}else if(11===e.nodeType){if(33===e.constType)return!0;if(15===e.constType)return!1}else if(38===e.nodeType){if("TYPE_CHECKING"===e.value)return!0;const t=n.get(e.value);if(void 0!==t)return!!t}else if(35===e.nodeType){if(p&&"TYPE_CHECKING"===e.memberName.value&&38===e.leftExpression.nodeType&&p.some((t=>t===e.leftExpression.value)))return!0;const t=n.get(e.memberName.value);if(void 0!==t)return!!t}}function r(e,t,n,a,r){return(11!==e.nodeType||26!==e.constType)&&i(e,t,n,a,r)}function s(e,t,n){if(void 0!==t&&void 0!==n){if(t=BigInt(t),n=BigInt(n),20===e)return t<n;if(21===e)return t<=n;if(15===e)return t>n;if(16===e)return t>=n;if(12===e)return t===n;if(28===e)return t!==n}}function o(e,t,n){if(void 0!==t&&void 0!==n){if(12===e)return t===n;if(28===e)return t!==n}}function l(e,t=["sys"]){return!(35!==e.nodeType||38!==e.leftExpression.nodeType||"version_info"!==e.memberName.value||!t.some((t=>t===e.leftExpression.value)))}t.evaluateStaticBoolExpression=i,t.evaluateStaticBoolLikeExpression=r},16682:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Symbol=t.indeterminateSymbolId=void 0;const a=n(2848);let i=1;t.indeterminateSymbolId=0;class r{constructor(e){this.id=i++,this._flags=e}static createWithType(e,t){const n=new r(e);return n._synthesizedType=t,n}isInitiallyUnbound(){return!!(1&this._flags)}setIsExternallyHidden(){this._flags|=2}isExternallyHidden(){return!!(2&this._flags)}setIsIgnoredForProtocolMatch(){this._flags|=64}isIgnoredForProtocolMatch(){return!!(64&this._flags)}setIsClassMember(){this._flags|=4}isClassMember(){return!!(4&this._flags)}setIsInstanceMember(){this._flags|=8}isInstanceMember(){return!!(8&this._flags)}setIsClassVar(){this._flags|=128}isClassVar(){return!!(128&this._flags)}setIsInitVar(){this._flags|=1024}isInitVar(){return!!(1024&this._flags)}setIsInDunderAll(){this._flags|=256}isInDunderAll(){return!!(256&this._flags)}setIsPrivateMember(){this._flags|=32}isPrivateMember(){return!!(32&this._flags)}setPrivatePyTypedImport(){this._flags|=512}isPrivatePyTypedImport(){return!!(512&this._flags)}isNamedTupleMemberMember(){return!!(2048&this._flags)}isIgnoredForOverrideChecks(){return!!(4096&this._flags)}addDeclaration(e){if(this._declarations){const t=this._declarations.findIndex((t=>(0,a.areDeclarationsSame)(t,e)));if(t<0)this._declarations.push(e),this._declarations.forEach((e=>{1===e.type&&e.typeAliasName&&delete e.typeAliasName}));else{const n=this._declarations[t];(0,a.hasTypeForDeclaration)(e)?(this._declarations[t]=e,1===n.type&&1===e.type&&!e.inferredTypeSource&&n.inferredTypeSource&&(e.inferredTypeSource=n.inferredTypeSource)):1===e.type&&1===n.type&&(e.isFinal&&(n.isFinal=!0),n.typeAliasName=e.typeAliasName,!n.inferredTypeSource&&e.inferredTypeSource&&(n.inferredTypeSource=e.inferredTypeSource))}}else this._declarations=[e]}hasDeclarations(){return!!this._declarations&&this._declarations.length>0}getDeclarations(){return this._declarations?this._declarations:[]}hasTypedDeclarations(){return!!this._synthesizedType||this.getDeclarations().some((e=>(0,a.hasTypeForDeclaration)(e)))}getTypedDeclarations(){return this.getDeclarations().filter((e=>(0,a.hasTypeForDeclaration)(e)))}getSynthesizedType(){return this._synthesizedType}}t.Symbol=r},48466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPublicConstantOrTypeAlias=t.isTypeAliasName=t.isConstantName=t.isSingleDunderName=t.isDunderName=t.isPrivateOrProtectedName=t.isProtectedName=t.isPrivateName=void 0;const n=/^[A-Z0-9_]+$/,a=/^[_]+$/,i=/^_{0,2}[A-Z][A-Za-z0-9_]+$/;function r(e){return e.length>2&&e.startsWith("__")&&!e.endsWith("__")}function s(e){return e.length>1&&e.startsWith("_")&&!e.startsWith("__")}function o(e){return r(e)||s(e)}function l(e){return!!e.match(n)&&!e.match(a)}function p(e){return!!e.match(i)}t.isPrivateName=r,t.isProtectedName=s,t.isPrivateOrProtectedName=o,t.isDunderName=function(e){return e.length>4&&e.startsWith("__")&&e.endsWith("__")},t.isSingleDunderName=function(e){return e.length>2&&e.startsWith("_")&&e.endsWith("_")},t.isConstantName=l,t.isTypeAliasName=p,t.isPublicConstantOrTypeAlias=function(e){return!o(e)&&(l(e)||p(e))}},60721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isVisibleExternally=t.isTypedDictMemberAccessedThroughIndex=t.getLastTypedDeclaredForSymbol=void 0,t.getLastTypedDeclaredForSymbol=function(e){const t=e.getTypedDeclarations();if(t.length>0)return t[t.length-1]},t.isTypedDictMemberAccessedThroughIndex=function(e){const t=e.getTypedDeclarations();if(t.length>0){if(1===t[t.length-1].type)return!0}return!1},t.isVisibleExternally=function(e){return!e.isExternallyHidden()&&!e.isPrivatePyTypedImport()}},52007:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NameTypeWalker=t.TestWalker=void 0;const a=n(59438),i=n(30795),r=n(6698),s=n(66455);class o extends a.ParseTreeWalker{constructor(){super()}visitNode(e){const t=super.visitNode(e);return this._verifyParentChildLinks(e,t),this._verifyChildRanges(e,t),t}_verifyParentChildLinks(e,t){t.forEach((t=>{t&&t.parent!==e&&(0,i.fail)(`Child node ${t.nodeType} does not contain a reference to its parent ${e.nodeType}`)}))}_verifyChildRanges(e,t){let n;const a=(0,s.isCompliantWithNodeRangeRules)(e);t.forEach((t=>{if(t){let s=!1;if(!a)switch(e.nodeType){case 3:t===e.typeAnnotationComment&&(s=!0),3===t.nodeType&&(s=!0);break;case 48:t===e.typeAnnotation&&(s=!0);break;default:(0,i.fail)(`node ${e.nodeType} is not marked as not following range rules.`)}s||((t.start<e.start||r.TextRange.getEnd(t)>r.TextRange.getEnd(e))&&(0,i.fail)(`Child node ${t.nodeType} is not contained within its parent ${e.nodeType}`),n&&t.start<r.TextRange.getEnd(n)&&62!==n.nodeType&&(0,i.fail)("Child node is not after previous child node"),n=t)}}))}}t.TestWalker=o;class l extends a.ParseTreeWalker{constructor(e){super(),this._evaluator=e}visitName(e){var t,n;return 23!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&21!==(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&this._evaluator.isNodeReachable(e,void 0)&&this._evaluator.getType(e),!0}}t.NameTypeWalker=l},51021:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createTracePrinter=void 0;const s=n(79251),o=n(30795),l=n(81844),p=n(96541),c=n(29597),d=r(n(21)),u=r(n(66455)),m=n(16682),y=n(51458);t.createTracePrinter=function(e){function t(e,t="'"){return e?`${t}${e}${t}`:""}e=e.map((e=>(0,l.ensureTrailingDirectorySeparator)(e))).sort(((e,t)=>e.localeCompare(t))).reverse();const n=/[\\/]/g;function a(t){if(t){if("string"==typeof t){for(const a of e)if(t.startsWith(a)){const e=t.substring(a.length);return(0,l.stripFileExtension)(e).replace(n,".")}return t}if(t.nameParts)return t.nameParts.join(".")}return""}function i(e){var n,a,r,s,l,p;if(e)switch(e.category){case 2:return`Any ${t(null===(n=e.typeAliasInfo)||void 0===n?void 0:n.fullName)}`;case 7:return y.TypeBase.isInstantiable(e)?`Class '${e.details.name}' (${e.details.moduleName})`:`Object '${e.details.name}' (${e.details.moduleName})`;case 5:return`Function '${e.details.name}' (${e.details.moduleName})`;case 8:return`Module '${e.moduleName}' (${e.moduleName})`;case 4:return`Never ${t(null===(a=e.typeAliasInfo)||void 0===a?void 0:a.fullName)}`;case 3:return`None ${t(null===(r=e.typeAliasInfo)||void 0===r?void 0:r.fullName)}`;case 6:return`OverloadedFunction [${e.overloads.map((e=>t(i(e),'"'))).join(",")}]`;case 10:return`TypeVar '${e.details.name}' ${t(null===(s=e.typeAliasInfo)||void 0===s?void 0:s.fullName)}`;case 0:return`Unbound ${t(null===(l=e.typeAliasInfo)||void 0===l?void 0:l.fullName)}`;case 9:return`Union [${e.subtypes.map((e=>t(i(e),'"'))).join(",")}]`;case 1:return`Unknown ${t(null===(p=e.typeAliasInfo)||void 0===p?void 0:p.fullName)}`;default:(0,o.assertNever)(e)}return""}function r(e){if(e)switch(e.type){case 8:return`Alias, ${h(e.node)} (${a(e.path)})`;case 6:return`Class, ${h(e.node)} (${a(e.path)})`;case 5:return`Function, ${h(e.node)} (${a(e.path)})`;case 0:return`Intrinsic, ${h(e.node)} ${e.intrinsicType} (${a(e.path)})`;case 2:return`Parameter, ${h(e.node)} (${a(e.path)})`;case 3:return`TypeParameter, ${h(e.node)} (${a(e.path)})`;case 7:return`SpecialBuiltInClass, ${h(e.node)} (${a(e.path)})`;case 1:return`Variable, ${h(e.node)} (${a(e.path)})`;case 4:return`TypeAlias, ${h(e.node)} (${a(e.path)})`;default:(0,o.assertNever)(e)}return""}function g(e){for(;36!==e.nodeType&&e.parent;)e=e.parent;return 36===e.nodeType?d.getFileInfo(e):void 0}function h(e,n=!1){var i;if(!e)return"";let r=n?`(${a(null===(i=g(e))||void 0===i?void 0:i.filePath)})`:"";const s=g(e);if(null==s?void 0:s.lines){const t=(0,p.convertOffsetToPosition)(e.start,s.lines);r+=` [${t.line+1}:${t.character+1}]`}if((0,c.isExpressionNode)(e))return t(function(e,t=30){return e.length<t?e:e.substring(0,t)+" <shortened> "}(u.printExpression(e)),'"')+` ${r}`;switch(e.nodeType){case 21:return`importAs '${h(e.module)}' ${t(e.alias?h(e.alias):"")} ${r}`;case 22:return`importFrom [${e.imports.map((e=>t(h(e),'"'))).join(",")}]`;case 23:return`ImportFromAs '${h(e.name)}' ${t(e.alias?h(e.alias):"")} ${r}`;case 36:return`module ${r}`;case 10:return`class '${h(e.name)}' ${r}`;case 28:return`function '${h(e.name)}' ${r}`;case 37:return`moduleName '${e.nameParts.map((e=>h(e))).join(".")}' ${r}`;case 1:return`argument '${e.name?h(e.name):"N/A"}' ${r}`;case 41:return`parameter '${e.name?h(e.name):"N/A"}' ${r}`;default:return`${u.printParseNodeType(e.nodeType)} ${r}`}}return{print:function(e){return e?function(e){const t=e;return t&&(0,s.isNumber)(t.nodeType)}(e)?h(e,!0):function(e){const t=e;return t&&(0,s.isNumber)(t.type)&&(0,s.isString)(t.path)&&(0,s.isString)(t.moduleName)}(e)?r(e):e instanceof m.Symbol?(t=e)?t.hasDeclarations()?`symbol ${r(t.getDeclarations()[0])}`:"<symbol>":"":function(e){const t=e;return t&&(0,s.isNumber)(t.category)&&(0,s.isNumber)(t.flags)}(e)?i(e):"":"";var t},printFileOrModuleName:a}}},34478:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SpeculativeTypeTracker=void 0;const s=n(30795),o=r(n(66455)),l=n(51458);t.SpeculativeTypeTracker=class{constructor(){this._speculativeContextStack=[],this._speculativeTypeCache=new Map,this._activeDependentTypes=[]}enterSpeculativeContext(e,t){this._speculativeContextStack.push({speculativeRootNode:e,entriesToUndo:[],dependentType:null==t?void 0:t.dependentType,allowDiagnostics:null==t?void 0:t.allowDiagnostics}),(null==t?void 0:t.dependentType)&&this._activeDependentTypes.push({speculativeRootNode:e,dependentType:t.dependentType})}leaveSpeculativeContext(){(0,s.assert)(this._speculativeContextStack.length>0);const e=this._speculativeContextStack.pop();(null==e?void 0:e.dependentType)&&((0,s.assert)(this._activeDependentTypes.length>0),this._activeDependentTypes.pop()),e.entriesToUndo.forEach((e=>{e.cache.delete(e.id)}))}isSpeculative(e,t=!1){if(0===this._speculativeContextStack.length)return!1;if(!e)return!0;for(let n=this._speculativeContextStack.length-1;n>=0;n--){const a=this._speculativeContextStack[n];if(o.isNodeContainedWithin(e,a.speculativeRootNode)&&(!t||!a.allowDiagnostics))return!0}return!1}trackEntry(e,t){const n=this._speculativeContextStack.length;n>0&&this._speculativeContextStack[n-1].entriesToUndo.push({cache:e,id:t})}disableSpeculativeMode(){const e=this._speculativeContextStack;return this._speculativeContextStack=[],e}enableSpeculativeMode(e){(0,s.assert)(0===this._speculativeContextStack.length),this._speculativeContextStack=e}addSpeculativeType(e,t,n,a){(0,s.assert)(this._speculativeContextStack.length>0);let i=this._speculativeTypeCache.get(e.id);i?(i=i.filter((e=>(!e.typeResult.isIncomplete||e.incompleteGenerationCount===n)&&(a?!e.expectedType||!(0,l.isTypeSame)(e.expectedType,a):!!e.expectedType))),i.length>=8&&i.slice(1)):i=[];const r={typeResult:t,expectedType:a,incompleteGenerationCount:n};this._activeDependentTypes.length>0&&(r.dependentTypes=Array.from(this._activeDependentTypes)),i.push(r),this._speculativeTypeCache.set(e.id,i)}getSpeculativeType(e,t){if(this._speculativeContextStack.some((t=>o.isNodeContainedWithin(e,t.speculativeRootNode)))){const n=this._speculativeTypeCache.get(e.id);if(n)for(const e of n)if(t){if(e.expectedType&&(0,l.isTypeSame)(t,e.expectedType)&&this._dependentTypesMatch(e))return e}else if(!e.expectedType&&this._dependentTypesMatch(e))return e}}_dependentTypesMatch(e){var t;const n=null!==(t=e.dependentTypes)&&void 0!==t?t:[];return n.length===this._activeDependentTypes.length&&n.every(((e,t)=>{const n=this._activeDependentTypes[t];return e.speculativeRootNode===n.speculativeRootNode&&(0,l.isTypeSame)(e.dependentType,n.dependentType)}))}}},69719:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getVariableDocString=t.getFunctionOrClassDeclDocString=t.getClassDocString=t.getModuleDocString=t.getModuleDocStringFromPaths=t.getModuleDocStringFromModuleNodes=t.getVariableInStubFileDocStrings=t.getPropertyDocStringInherited=t.getOverloadedFunctionDocStringsInherited=t.getFunctionDocStringInherited=void 0;const s=n(44660),o=r(n(66455)),l=n(9584),p=n(51458),c=n(5284),d=n(33029);function u(e,t){if(6===e.category){if(0===e.overloads.length)return!1;e=e.overloads[0]}return"builtins"===e.details.moduleName&&!!t&&!!e.boundToType&&!p.ClassType.isSameGenericClass(t,e.boundToType)}function m(e,t){const n=[];if(!(0,l.isStubFile)(e.path))return n;for(const a of t.findDeclarations(e))if((0,s.isVariableDeclaration)(a)&&a.docString)n.push(a.docString);else if((0,s.isClassDeclaration)(a)||(0,s.isFunctionDeclaration)(a)){const e=h(a);e&&n.push(e)}return n}function y(e){for(const t of e)if(t.statements){const e=o.getDocString(t.statements);if(e)return e}}function g(e,t){const n=[];for(const a of e)(0,l.isStubFile)(a)&&(0,c.addIfNotNull)(n,t.getModuleNode(a)),(0,c.appendArray)(n,t.findModules(a));return y(n)}function h(e){var t,n,a;return o.getDocString(null!==(a=null===(n=null===(t=e.node)||void 0===t?void 0:t.suite)||void 0===n?void 0:n.statements)&&void 0!==a?a:[])}function f(e,t,n){if(!(0,p.isOverloadedFunction)(e))return;const a=[];if(e.overloads.some((e=>e.details.docString)))e.overloads.forEach((e=>{e.details.docString&&a.push(e.details.docString)}));else if(t&&(0,l.isStubFile)(t.path)&&(0,s.isFunctionDeclaration)(t)){const e=v(n.findFunctionDeclarations(t));e&&a.push(e)}return a}function T(e,t){let n=v([e]);if(!n&&(0,l.isStubFile)(e.path)){n=v(t.findFunctionDeclarations(e))}return n}function v(e){for(const t of e){const e=h(t);if(e)return e}}t.getFunctionDocStringInherited=function(e,t,n,a){let i;if(!u(e,a)&&t&&(0,s.isFunctionDeclaration)(t)&&(i=function(e,t,n){if(!(0,p.isFunction)(e))return;let a=e.details.docString;!a&&t&&(a=T(t,n));!a&&e.details.declaration&&(a=T(e.details.declaration,n));return a}(e,t,n)),!i&&a){const t=e.details.name,r=(0,d.getClassMemberIterator)(a,t,29);for(const e of r){if(e.symbol.getDeclarations().length>0){const t=e.symbol.getDeclarations().slice(-1)[0];if((0,s.isFunctionDeclaration)(t)&&(i=T(t,n),i))break}}}return i||e.details.docString},t.getOverloadedFunctionDocStringsInherited=function(e,t,n,a,i){var r;let s;if(!u(e,i))for(const a of t)if(s=f(e,a,n),s&&s.length>0)return s;if(i&&e.overloads.length>0){const t=e.overloads[0].details.name,o=(0,d.getClassMemberIterator)(i,t,29);for(const e of o){const t=e.symbol.getDeclarations().slice(-1)[0],i=null===(r=a.getTypeForDeclaration(t))||void 0===r?void 0:r.type;if(i&&(s=f(i,t,n),s&&s.length>0))break}}return null!=s?s:[]},t.getPropertyDocStringInherited=function(e,t,n){const a=o.getEnclosingClass(e.node.name,!1),i=a?n.getTypeOfClass(a):void 0;if(i)return function(e,t,n,a){var i,r;if(!e||!(0,s.isFunctionDeclaration)(e))return;const o=null===(i=n.getTypeForDeclaration(e))||void 0===i?void 0:i.type;if(!o||!(0,d.isMaybeDescriptorInstance)(o))return;const l=28===e.node.nodeType?e.node.name.value:void 0;if(!l)return;const c=(0,d.getClassIterator)(a,0);for(const[e]of c){if(!(0,p.isInstantiableClass)(e))continue;const a=e.details.fields.get(l),i=null==a?void 0:a.getDeclarations();if(i)for(const e of i)if((0,s.isFunctionDeclaration)(e)){const a=null===(r=n.getTypeForDeclaration(e))||void 0===r?void 0:r.type;if(a&&(0,d.isMaybeDescriptorInstance)(a)){const n=T(e,t);if(n)return n}}}return}(e,t,n,i.classType)},t.getVariableInStubFileDocStrings=m,t.getModuleDocStringFromModuleNodes=y,t.getModuleDocStringFromPaths=g,t.getModuleDocString=function(e,t,n){var a;let i=e.docString;if(!i){i=g([null!==(a=null==t?void 0:t.path)&&void 0!==a?a:e.filePath],n)}return i},t.getClassDocString=function(e,t,n){let a=e.details.docString;if(!a&&t&&(0,s.isClassDeclaration)(t)&&(a=v([t]),!a&&t&&(0,l.isStubFile)(t.path)&&6===t.type))for(const e of n.findDeclarations(t)){if((0,s.isVariableDeclaration)(e)&&e.docString){a=e.docString;break}if((0,s.isClassDeclaration)(e)||(0,s.isFunctionDeclaration)(e)){a=h(e);break}}if(!a&&t){const i=n.findClassDeclarationsByType(t.path,e);if(i){a=v(i.filter((e=>(0,s.isClassDeclaration)(e))).map((e=>e)))}}return a},t.getFunctionOrClassDeclDocString=h,t.getVariableDocString=function(e,t){if(e)return void 0!==e.docString?e.docString:m(e,t).find((e=>e))}},11528:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createTypeEvaluator=t.maxCodeComplexity=void 0;const s=n(88711),o=n(5284),l=n(30795),p=n(83501),c=n(28513),d=n(96541),u=n(86513),m=n(6698),y=n(99661),g=n(29597),h=n(92365),f=n(21403),T=r(n(21)),v=n(54318),b=n(80563),_=n(54750),I=n(45341),C=n(5838),k=n(2848),S=n(64891),w=n(92814),A=n(19948),x=n(46288),P=n(63250),D=n(32966),N=r(n(66455)),F=n(78140),E=n(79282),z=n(56370),M=r(n(60177)),O=n(93890),V=n(16682),R=n(48466),L=n(60721),U=n(34478),j=n(7461),B=r(n(73800)),W=n(33029),q=n(43024),G=n(2026),K=n(51458),$=new Map([["asyncio.futures.Future",u.PythonVersion.V3_9],["asyncio.tasks.Task",u.PythonVersion.V3_9],["builtins.dict",u.PythonVersion.V3_9],["builtins.frozenset",u.PythonVersion.V3_9],["builtins.list",u.PythonVersion.V3_9],["builtins._PathLike",u.PythonVersion.V3_9],["builtins.set",u.PythonVersion.V3_9],["builtins.tuple",u.PythonVersion.V3_9],["collections.ChainMap",u.PythonVersion.V3_9],["collections.Counter",u.PythonVersion.V3_9],["collections.defaultdict",u.PythonVersion.V3_9],["collections.DefaultDict",u.PythonVersion.V3_9],["collections.deque",u.PythonVersion.V3_9],["collections.OrderedDict",u.PythonVersion.V3_9],["queue.Queue",u.PythonVersion.V3_9]]),H=new Map([["builtins.float",["builtins.int"]],["builtins.complex",["builtins.float","builtins.int"]],["builtins.bytes",["builtins.bytearray","builtins.memoryview"]]]),Z=64;t.maxCodeComplexity=768,t.createTypeEvaluator=function(e,n){const a=[],i=new Set,r=new U.SpeculativeTypeTracker,Y=[];let J,Q,X,ee,te,ne,ae,ie,re,se,oe,le,pe,ce=new Set,de=new Map,ue=new Map,me=new Map,ye=new Map,ge=[],he=!1,fe=0;const Te=[];let ve;function be(){J&&(0,s.throwIfCancellationRequested)(J)}function _e(e){return ve&&we(e)?ve.get(e.id):ue.get(e.id)}function Ie(e){const t=_e(e);return!!t&&(!t.typeResult.isIncomplete||t.incompleteGenerationCount===fe)}function Ce(e,t){var a,i;const r=_e(e);if(r&&!r.typeResult.isIncomplete){if(n.verifyTypeCacheEvaluatorFlags&&void 0!==t){const s=r.flags;if(void 0!==s&&t!==s){const r=T.getFileInfo(e),o=(0,d.convertOffsetToPosition)(e.start,r.lines),p=`Type cache flag mismatch for node type ${e.nodeType} (parent ${null!==(i=null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&void 0!==i?i:"none"}): cached flags = ${s}, access flags = ${t}, file = {${r.filePath} [${o.line+1}:${o.character+1}]}`;n.verifyTypeCacheEvaluatorFlags?(0,l.fail)(p):console.log(p)}}return r.typeResult.type}}function ke(e,t,n,a,i=!1){const s=ve&&we(e)?ve:ue;if(t.isIncomplete){const n=s.get(e.id);void 0===n||(0,K.isTypeSame)(t.type,n.typeResult.type)||fe++}else fe++;s.set(e.id,{typeResult:t,flags:n,incompleteGenerationCount:fe}),Ia(e)&&(r.trackEntry(s,e.id),i&&r.addSpeculativeType(e,t,fe,null==a?void 0:a.expectedType))}function Se(e,t=K.UnknownType.create(),n=0){ke(e,{type:t},n)}function we(e){const t=Te.length;if(0===t)return!1;const n=Te[t-1];let a=e;for(;a;){if(a===n.functionNode)return!0;a=a.parent}return!1}function Ae(e,t){return a.findIndex((n=>n.symbolId===e.id&&n.declaration===t))}function xe(e,t){const n=Ae(e,t);if(n>=0){for(let e=n+1;e<a.length;e++)a[e].isResultValid=!1;return!1}return a.push({symbolId:e.id,declaration:t,isResultValid:!0}),!0}function Pe(e){const t=a.pop();return(0,l.assert)(t.symbolId===e.id),t.isResultValid}function De(e,t,n){const i=Ae(e,t);i>=0&&(a[i].partialType=n)}function Ne(e,t){const n=Ae(e,t);if(n>=0)return a[n].partialType}function Fe(e){var t,n;let a=null===(t=ca(e,(()=>{oa(e)})))||void 0===t?void 0:t.type;if(a&&(0,K.isTypeVar)(a)&&0===a.details.declaredVariance){const t=a,i=N.getParentNodeOfType(e,76);if(10===(null===(n=null==i?void 0:i.parent)||void 0===n?void 0:n.nodeType)){const e=Ln(i.parent);if(e){jn(e.classType);const n=e.classType.details.typeParameters.find((e=>(0,K.isTypeSame)(e,t,{ignoreTypeFlags:!0})));n&&(a=K.TypeBase.isInstance(a)?K.TypeVarType.cloneAsInstance(n):n)}}}return a}function Ee(e){let t=e,n=e;for(;n;)(0,g.isExpressionNode)(n)&&(t=n),n=n.parent;for(oa(t),n=e;n;){const e=ye.get(n.id);if(e)return{type:e,node:n};if(n===t)break;n=n.parent}}function ze(e){he||(he=!0,X=Ta(e,"object"),ee=fa(e,"type"),te=Ta(e,"function"),Ye(e,"Collection"),Q=Je(e,"NoneType")||K.AnyType.create(),ne=fa(e,"tuple"),ae=fa(e,"bool"),ie=fa(e,"int"),re=fa(e,"str"),se=fa(e,"dict"),oe=Ye(e,"TypedDict"),le=Ye(e,"_TypedDict"),pe=Je(e,"SupportsKeysAndGetItem"),pe||(pe=Ye(e,"Mapping")))}function Me(e,t=0,n){const a=_e(e);if(a&&(!a.typeResult.isIncomplete||a.incompleteGenerationCount===fe))return a.typeResult;{const t=r.getSpeculativeType(e,null==n?void 0:n.expectedType);if(t&&(!t.typeResult.isIncomplete||t.incompleteGenerationCount===fe))return t.typeResult}let i;be(),n&&(n.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(n.expectedType)),ze(e);let s=0!=(128&t);switch(e.nodeType){case 38:i=function(e,t){var n;const a=T.getFileInfo(e),i=e.value;let r,s,o=!1;const p=0!=(4&t)||a.isStubFile,d=T.getTypeParameterSymbol(e);if(d){r=d,(0,l.assert)(1===r.getDeclarations().length);const t=(0,L.getLastTypedDeclaredForSymbol)(r);(0,l.assert)(3===(null==t?void 0:t.type)),s=wa(t.node),ft(a,r,e)}else{let n=va(e,i,!p,p&&0!=(256&t));if(!n){const a=ka(e);a&&(n=va(a,a.value,!p,p&&0!=(256&t)))}if(n){let d=!p;if(4===n.scope.type&&(d=!1),r=n.symbol,ft(a,r,e),!a.diagnosticRuleSet.analyzeUnannotatedFunctions){const t=N.getEnclosingFunction(e);if(t&&N.isUnannotatedFunction(t))return{type:K.AnyType.create(),isIncomplete:!1}}const u=Na(r,d?e:void 0);let m=(0,W.transformPossibleRecursiveTypeAlias)(u.type);u.isIncomplete&&((0,K.isUnbound)(m)&&(m=K.UnknownType.create(!0)),o=!0),u.isRecursiveDefinition&&et(e)&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.recursiveDefinition().format({name:i}),e);const g=!!m&&(0,K.isInstantiableClass)(m)&&K.ClassType.isSpecialBuiltIn(m);if(s=m,d&&!g){let a=m;if(!n.isBeyondExecutionScope&&r.isInitiallyUnbound()&&(a=K.UnboundType.create(),3===n.scope.type)){(0,l.assert)(n.scope.parent);const e=n.scope.parent.lookUpSymbol(i);if(e){a=Na(e).type}}const p=ua(e,r.id,a,void 0,{skipConditionalNarrowing:0!=(256&t)});if(p.type&&(s=p.type),p.isIncomplete&&(o=!0),!p.type&&n.isBeyondExecutionScope){const t=function(e,t,n){const a=t.symbol.getDeclarations();if(!a.every((e=>1===e.type||2===e.type||8===e.type)))return;if(!a.every((e=>2===e.type||M.getScopeForNode(e.node)===t.scope)))return;const i=M.getScopeHierarchy(e,t.scope);if(i&&i.length>=2&&i.every((e=>1===e.type||3===e.type))){const a=M.findTopNodeInScope(e,i[i.length-2]);if(a&&(28===a.nodeType||30===a.nodeType)){const i=T.getFlowNode(a);if(i&&t.symbol.getDeclarations().every((e=>{if(2===e.type)return!0;const t=T.getFlowNode(e.node);return!!t&&!ui.isFlowNodeReachable(t,i,!0)}))){let i=n;return t.symbol.isInitiallyUnbound()&&(i=K.UnboundType.create()),ua(e,t.symbol.id,i,a)}}}return}(e,n,m);(null==t?void 0:t.type)&&(s=t.type),(null==t?void 0:t.isIncomplete)&&(o=!0)}}if(s=bt(e,s,t),0!=(256&t)&&u.includesVariableDecl&&!s.typeAliasInfo){let n=(0,K.isTypeVar)(s)||(0,W.isTypeAliasPlaceholder)(s);!(0,K.isClass)(s)||s.includeSubclasses||r.hasTypedDeclarations()||(n=!0),n||a.isTypingStubFile||!u.includesIllegalTypeAliasDecl&&K.TypeBase.isInstantiable(s)&&0==(2&t)||(ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAnnotationVariable(),e),s=K.UnknownType.create())}}else"reveal_type"===i||"reveal_locals"===i?s=K.AnyType.create():(ot(a.diagnosticRuleSet.reportUndefinedVariable,c.DiagnosticRule.reportUndefinedVariable,y.Localizer.Diagnostic.symbolIsUndefined().format({name:i}),e),s=K.UnknownType.create())}(0,K.isParamSpec)(s)&&32&t&&(it(y.Localizer.Diagnostic.paramSpecContext(),e),s=K.UnknownType.create());if((0,K.isTypeVar)(s)&&!s.details.isParamSpec&&!s.isVariadicInUnion&&0==(128&t)&&s.details.name===i){if(!(7===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&6===e.parent.operator)){const t=s.details.isVariadic?Ye(e,"TypeVarTuple"):Ye(e,"TypeVar");s=t&&(0,K.isInstantiableClass)(t)?K.ClassType.cloneAsInstance(t):K.UnknownType.create()}}0!=(128&t)&&0==(1024&t)&&(0,K.isInstantiableClass)(s)&&K.ClassType.isBuiltIn(s,"Generic")&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.genericNotAllowed(),e);(0,K.isTypeVar)(s)&&!s.details.isSynthesized&&(s=vt(e,s,t));return{type:s,isIncomplete:o}}(e,t);break;case 35:i=function(e,t){const n=2|571652&t,a=Me(e.leftExpression,n);if((0,W.isTypeAliasPlaceholder)(a.type))return{type:K.UnknownType.create(!0),isIncomplete:!0};const i=_t(e,a,{method:"get"},2|t);if((0,b.isCodeFlowSupportedForReference)(e)){ke(e,{...i,isIncomplete:!0},t),ke(e.memberName,{...i,isIncomplete:!0},t);let n=i.type,r=!!i.isIncomplete;if((0,K.isUnbound)(n)){const t=mt(a.type);let i;(0,K.isInstantiableClass)(t)?i=(0,W.lookUpClassMember)(t,e.memberName.value,1):(0,K.isClassInstance)(t)&&(i=(0,W.lookUpObjectMember)(t,e.memberName.value,1)),i&&(n=Va(i),r=!1)}const s=ua(e,V.indeterminateSymbolId,n,void 0,{isTypeAtStartIncomplete:r,skipConditionalNarrowing:0!=(256&t)});s.type&&(i.type=s.type),s.isIncomplete&&(i.isIncomplete=!0),i.type=bt(e,i.type,t)}a.isIncomplete&&(i.isIncomplete=!0);return ke(e.memberName,i,t),i}(e,t);break;case 24:i=function(e,t=0){const n=Me(e.baseExpression,2|t);if(128&t&&48===e.baseExpression.nodeType){const t=T.getFileInfo(e);!t.isStubFile&&t.executionEnvironment.pythonVersion<u.PythonVersion.V3_10&&it(y.Localizer.Diagnostic.stringNotSubscriptable(),e.baseExpression)}if(0==(4&t)){let a=0!=(32768&t);if(a){const t=N.getExecutionScopeNode(e);36===(null==t?void 0:t.nodeType)&&(a=!1)}if(!a){const t=T.getFileInfo(e);if((0,K.isInstantiableClass)(n.type)&&K.ClassType.isBuiltIn(n.type)&&!n.type.aliasName){const a=$.get(n.type.details.fullName);void 0!==a&&t.executionEnvironment.pythonVersion<a&&!t.isStubFile&&it(y.Localizer.Diagnostic.classNotRuntimeSubscriptable().format({name:n.type.aliasName||n.type.details.name}),e.baseExpression)}}}const a=wt(e,n,{method:"get"},t);if((0,b.isCodeFlowSupportedForReference)(e)){let i=!(0,K.isAny)(n.type);if(yt(n.type,void 0,(e=>{(0,K.isClassInstance)(e)&&(K.ClassType.isBuiltIn(e)||K.ClassType.isTypedDictClass(e))||(i=!1)})),i){ke(e,a,t);const i=ua(e,V.indeterminateSymbolId,a.type,void 0,{isTypeAtStartIncomplete:!!n.isIncomplete||!!a.isIncomplete,skipConditionalNarrowing:0!=(256&t)});i.type&&(a.type=i.type),i.isIncomplete&&(a.isIncomplete=!0)}}n.isIncomplete&&(a.isIncomplete=!0);return a}(e,t);break;case 9:i=function(e,t,n){var a;let i;if(0!=(256&t)&&38===e.leftExpression.nodeType&&"type"===e.leftExpression.value){const t=new p.DiagnosticAddendum;t.addMessage(y.Localizer.DiagnosticAddendum.useTypeInstead()),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeCallNotAllowed()+t.getString(),e)}i=30===e.leftExpression.nodeType?function(e,t){(0,l.assert)(30===e.leftExpression.nodeType);const n=K.FunctionType.createSynthesizedInstance("");n.details.declaredReturnType=t?t.expectedType:K.UnknownType.create();let a=!1;e.arguments.forEach(((e,t)=>{const i=Me(e.valueExpression);i.isIncomplete&&(a=!0),K.FunctionType.addParameter(n,{category:0,name:`p${t.toString()}`,type:i.type,hasDeclaredType:!0})}));const i=e.leftExpression.parameters;if(i.length>0){const e=i[i.length-1];0!==e.category||e.name||K.FunctionType.addParameter(n,{category:0,name:"",type:K.UnknownType.create()})}function r(){return Me(e.leftExpression,2,(0,W.makeInferenceContext)(n))}let s=a||Ia(e)||(null==t?void 0:t.isTypeIncomplete)?_a(e.leftExpression,r):r();s.typeErrors&&(s=Me(e.leftExpression,2));return s}(e,n):Me(e.leftExpression,2|4&t);const r=e.arguments.map((e=>({valueExpression:e.valueExpression,argumentCategory:e.argumentCategory,node:e,name:e.name})));let s={type:K.UnknownType.create()};(null==n?void 0:n.signatureTracker)&&(i.type=(0,W.ensureFunctionSignaturesAreUnique)(i.type,n.signatureTracker,e.leftExpression.start));if((0,W.isTypeAliasPlaceholder)(i.type))s.isIncomplete=!0;else{if(38===e.leftExpression.nodeType&&"super"===e.leftExpression.value)s=function(e){var t;e.arguments.length>2&&it(y.Localizer.Diagnostic.superCallArgCount(),e.arguments[2]);const n=N.getEnclosingClass(e),a=n?null===(t=Ln(n))||void 0===t?void 0:t.classType:void 0;let i,r;if(e.arguments.length>0){i=Me(e.arguments[0].valueExpression).type;const t=mt(i);(0,K.isAnyOrUnknown)(t)||(0,K.isInstantiableClass)(t)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.superCallFirstArg().format({type:ci(i)}),e.arguments[0].valueExpression)}else a?i=null!=a?a:K.UnknownType.create():(it(y.Localizer.Diagnostic.superCallZeroArgForm(),e.leftExpression),i=K.UnknownType.create());if(e.arguments.length>1){const t=mt(Me(e.arguments[1].valueExpression).type);let n=!1;if((0,K.isAnyOrUnknown)(t)||((0,K.isClassInstance)(t)?((0,K.isInstantiableClass)(i)&&((0,W.derivesFromClassRecursive)(K.ClassType.cloneAsInstantiable(t),i,!0)||(n=!0)),r=t):(0,K.isInstantiableClass)(t)?((0,K.isInstantiableClass)(i)&&((0,W.derivesFromClassRecursive)(t,i,!0)||(n=!0)),r=t):n=!0),n){ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.superCallSecondArg().format({type:ci(i)}),e.arguments[1].valueExpression)}}else if(a){r=K.ClassType.cloneAsInstance(a);const t=N.getEnclosingFunction(e);let n;if(t){const e=Kn(t);if(e){const t=e.functionType;(K.FunctionType.isClassMethod(t)||K.FunctionType.isConstructorMethod(t)||K.FunctionType.isInstanceMethod(t))&&t.details.parameters.length>0&&t.details.parameters[0].hasDeclaredType&&(n=mt(t.details.parameters[0].type))}}r&&n&&(r=(0,W.addConditionToType)(r,(0,W.getTypeCondition)(n)))}let s=!0;if(e.arguments.length<=1){const t=N.getEnclosingFunction(e);if(t){const e=Kn(t);e&&(K.FunctionType.isStaticMethod(e.functionType)||K.FunctionType.isConstructorMethod(e.functionType)||K.FunctionType.isClassMethod(e.functionType))&&(s=!1)}}const o=e.parent;if(35===o.nodeType){const e=o.memberName.value,t=(0,K.isClass)(i)?i:void 0,n=r?(0,W.lookUpClassMember)(r,e,0,t):void 0;if(n&&(0,K.isInstantiableClass)(n.classType))return{type:s?K.ClassType.cloneAsInstance(n.classType):n.classType,bindToType:r?K.TypeBase.cloneForCondition((0,W.synthesizeTypeVarForSelfCls)(r,!s),r.condition):void 0}}if((0,K.isInstantiableClass)(i)){if(i.details.mro.some((e=>(0,K.isAnyOrUnknown)(e))))return{type:K.UnknownType.create()};const e=i.details.baseClasses;if(e.length>0){const t=e[0];if((0,K.isInstantiableClass)(t))return{type:s?K.ClassType.cloneAsInstance(t):t}}}return{type:K.UnknownType.create()}}(e);else if((0,K.isAnyOrUnknown)(i.type)&&38===e.leftExpression.nodeType&&"reveal_type"===e.leftExpression.value)s=zt(e,n);else if((0,K.isFunction)(i.type)&&"reveal_type"===i.type.details.builtInName)s=zt(e,n);else if((0,K.isFunction)(i.type)&&"assert_type"===i.type.details.builtInName)s=function(e,t){if(2!==e.arguments.length||0!==e.arguments[0].argumentCategory||void 0!==e.arguments[0].name||0!==e.arguments[0].argumentCategory||void 0!==e.arguments[1].name)return it(y.Localizer.Diagnostic.assertTypeArgs(),e),{type:K.UnknownType.create()};const n=Me(e.arguments[0].valueExpression,void 0,t);if(n.isIncomplete)return{type:K.UnknownType.create(!0),isIncomplete:!0};const a=(0,W.convertToInstance)(ga(e.arguments[1]).type);(0,K.isTypeSame)(a,n.type,{treatAnySameAsUnknown:!0,ignorePseudoGeneric:!0})||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.assertTypeTypeMismatch().format({expected:ci(a),received:ci(n.type)}),e.arguments[0].valueExpression);return{type:n.type}}(e,n);else if((0,K.isAnyOrUnknown)(i.type)&&38===e.leftExpression.nodeType&&"reveal_locals"===e.leftExpression.value)0===e.arguments.length?s.type=function(e){let t,n=e;for(;n&&(t=M.getScopeForNode(n),!t||0===t.type);)n=n.parent;const a=[];t&&t.symbolTable.forEach(((e,t)=>{if(!e.isIgnoredForProtocolMatch()){const n=Da(e);a.push(y.Localizer.DiagnosticAddendum.typeOfSymbol().format({name:t,type:ci(n,{expandTypeAlias:!0})}))}}));a.length>0?at(a.join("\n"),e):at(y.Localizer.Diagnostic.revealLocalsNone(),e);return K.NoneType.createInstance()}(e):it(y.Localizer.Diagnostic.revealLocalsArgs(),e);else{const t=jt(e,r,i,void 0,!1,n);s.type=null!==(a=t.returnType)&&void 0!==a?a:K.UnknownType.create(),t.argumentErrors?s.typeErrors=!0:s.overloadsUsedForCall=t.overloadsUsedForCall,t.isTypeIncomplete&&(s.isIncomplete=!0)}i.isIncomplete&&(s.isIncomplete=!0)}if(!Ia(e)&&!i.isIncomplete){(0,K.isInstantiableClass)(i.type)&&K.ClassType.isBuiltIn(i.type,"TypeVar")&&T.getFileInfo(e).isTypingStubFile||r.forEach((e=>{e.valueExpression&&48!==e.valueExpression.nodeType&&!Ie(e.valueExpression)&&Me(e.valueExpression)}))}0!=(256&t)&&(ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAnnotationCall(),e),s={type:K.UnknownType.create()});return s}(e,t,n);break;case 52:i=function(e,t,n){var a;if(0!=(256&t)&&1!==(null===(a=e.parent)||void 0===a?void 0:a.nodeType)){const t=new p.DiagnosticAddendum;t.addMessage(y.Localizer.DiagnosticAddendum.useTupleInstead()),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.tupleInAnnotation()+t.getString(),e)}if(0!=(128&t)&&0===e.expressions.length&&!n)return{type:xt([]),isEmptyTupleShorthand:!0};let i,r=null==n?void 0:n.expectedType,s=n&&(0,K.isAny)(n.expectedType);if(n&&(0,K.isUnion)(n.expectedType)){let t;(0,W.doForEachSubtype)(n.expectedType,(n=>{if((0,K.isAny)(n)&&(s=!0),!t){const a=_a(e,(()=>Ft(e,(0,W.makeInferenceContext)(n))));a&&Wa(n,a.type)&&(t=n)}})),r=t}if(r){const t=Ft(e,(0,W.makeInferenceContext)(r,!1,null==n?void 0:n.signatureTracker));if(t&&!t.typeErrors)return t;i=null==t?void 0:t.expectedTypeDiagAddendum}const o=function(e){const t=e.expressions.map((e=>Me(e))),n=t.some((e=>e.isIncomplete));if(!ne||!(0,K.isInstantiableClass)(ne))return{type:K.UnknownType.create()};const a=(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,Et(t)));if(n&&(0,W.getContainerDepth)(a)>8)return{type:K.UnknownType.create()};return{type:a,isIncomplete:n}}(e);s&&(o.type=K.AnyType.create());return{...o,expectedTypeDiagAddendum:i}}(e,t,n);break;case 11:i=function(e,t){let n;26===e.constType?n=0!=(128&t)?K.NoneType.createType():K.NoneType.createInstance():33!==e.constType&&15!==e.constType&&9!==e.constType||(n=Ta(e,"bool"),n&&(0,K.isClassInstance)(n)&&(33===e.constType?n=K.ClassType.cloneWithLiteral(n,!0):15===e.constType&&(n=K.ClassType.cloneWithLiteral(n,!1))));if(!n)return;return{type:n}}(e,t);break;case 48:{const n=0!=(8&t)&&!function(e){if(e.parent&&24===e.parent.nodeType){const t=Me(e.parent.baseExpression).type;if(t&&(0,K.isInstantiableClass)(t)&&K.ClassType.isSpecialBuiltIn(t,"Literal"))return!0}return!1}(e);n&&(s=!1),i=function(e,t,n){let a;if(n){let n=132|t;if(0==(4194304&t)&&(n|=524288),e.typeAnnotation)a=Me(e.typeAnnotation,n);else if(!e.typeAnnotation&&1===e.strings.length){const t=function(e){const t=T.getFileInfo(e),n=new h.Parser,a=e.strings[0].value;let i=e.strings[0].start;49===e.strings[0].nodeType&&(i+=e.strings[0].token.prefixLength+e.strings[0].token.quoteMarkLength);const r=new h.ParseOptions;r.isStubFile=t.isStubFile,r.pythonVersion=t.executionEnvironment.pythonVersion,r.reportErrorsForParsedStringContents=!0;const s=n.parseTextExpression(t.fileContents,i,a.length,r,void 0,void 0,t.typingSymbolAliases);if(s.parseTree&&62!==s.parseTree.nodeType)return s.diagnostics.forEach((t=>{it(t.message,e)})),s.parseTree.parent=e,s.parseTree;return}(e);t&&(a=Me(t,n))}if(!a){ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.expectedTypeNotString(),e),a={type:K.UnknownType.create()}}}else{let t=!0,n=!1;e.strings.forEach((e=>{const a=Oe(e);a.isIncomplete&&(n=!0);let i=!1;(0,K.isClassInstance)(a.type)&&(K.ClassType.isBuiltIn(a.type,"str")&&void 0!==a.type.literalValue||K.ClassType.isBuiltIn(null==a?void 0:a.type,"LiteralString"))&&(i=!0),i||(t=!1)}));const i=0!=(32&e.strings[0].token.flags);if(e.strings.some((e=>27===e.nodeType))){if(t){const t=Ye(e,"LiteralString");t&&(0,K.isInstantiableClass)(t)&&(a={type:K.ClassType.cloneAsInstance(t)})}a||(a={type:Ta(e,i?"bytes":"str"),isIncomplete:n})}else a={type:vn(e,i?"bytes":"str",e.strings.map((e=>e.value)).join("")),isIncomplete:n}}return a}(e,t,n);break}case 40:i=function(e,t){t=e.isImaginary?{type:Ta(e,"complex")}:e.isInteger?{type:vn(e,"int",e.value)}:{type:Ta(e,"float")};return t}(e,i);break;case 18:i=function(e,t,n){if(0!=(1&e))t={type:K.AnyType.create(!0)};else{t={type:Ta(n,"ellipsis")||K.AnyType.create()}}return t}(t,i,e);break;case 55:i=(0,P.getTypeOfUnaryOperation)(di,e,n);break;case 7:{let a=t;s&&6!==e.operator&&(a&=-129),i=(0,P.getTypeOfBinaryOperation)(di,e,a,n);break}case 5:i=(0,P.getTypeOfAugmentedAssignment)(di,e,n);break;case 31:case 45:i=function(e,t,n){var a;if(0!=(256&t)&&31===e.nodeType&&1!==(null===(a=e.parent)||void 0===a?void 0:a.nodeType)){const t=new p.DiagnosticAddendum;t.addMessage(y.Localizer.DiagnosticAddendum.useListInstead()),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.listInAnnotation()+t.getString(),e)}let i,r=null==n?void 0:n.expectedType;if(n&&(0,K.isUnion)(n.expectedType)){let t,a;(0,W.doForEachSubtype)(n.expectedType,(n=>{if(a&&!a.typeErrors)return;const i=_a(e,(()=>cn(e,(0,W.makeInferenceContext)(n))));i&&Wa(n,i.type)&&(!a||a.typeErrors&&!i.typeErrors)&&(t=n,a=i)})),r=t}if(r){const t=cn(e,(0,W.makeInferenceContext)(r));if(t&&!t.typeErrors)return t;i=null==t?void 0:t.expectedTypeDiagAddendum}const s=function(e,t){const n=31===e.nodeType?"list":"set",a=45===e.nodeType;let i=!1,r=!1,s=!1,o=[];e.entries.forEach(((e,t)=>{let n;n=32===e.nodeType?gn(e):Me(e),n.isIncomplete&&(r=!0),n.typeErrors&&(s=!0),t<Z&&o.push(n.type),!a||n.isIncomplete||n.typeErrors||dn(e,n.type,!1)})),o=o.map((e=>Ve(e)));let l=t?K.AnyType.create():K.UnknownType.create();if(o.length>0){const a=T.getFileInfo(e);l="list"===n&&a.diagnosticRuleSet.strictListInference||"set"===n&&a.diagnosticRuleSet.strictSetInference||t?(0,K.combineTypes)(o,j.maxSubtypesForInferredType):(0,W.areTypesSame)(o,{ignorePseudoGeneric:!0})?o[0]:l}else i=!0;const p=fa(e,n),c=(0,K.isInstantiableClass)(p)?K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(p,[l],!0,void 0,void 0,i)):K.UnknownType.create();if(r&&(0,W.getContainerDepth)(c)>8)return{type:K.UnknownType.create()};return{type:c,isIncomplete:r,typeErrors:s}}(e,void 0!==n);return{...s,expectedTypeDiagAddendum:i}}(e,t,n);break;case 46:i=function(e){Ia(e)||(e.startValue&&Me(e.startValue),e.endValue&&Me(e.endValue),e.stepValue&&Me(e.stepValue));return{type:Ta(e,"slice")}}(e);break;case 6:i=function(e,t,n){const a=n?Yn(e,n.expectedType,!1):void 0,i=Me(e.expression,t,(0,W.makeInferenceContext)(a)),r={type:$e(i.type,e.expression)};i.isIncomplete&&(r.isIncomplete=!0);return r}(e,t,n);break;case 51:i=(0,P.getTypeOfTernaryOperation)(di,e,t,n);break;case 32:i=function(e,t){var n;let a,i=!1,r=!1,s=e.forIfNodes.some((e=>33===e.nodeType&&e.isAsync||34===e.nodeType&&N.containsAwaitNode(e.testExpression))),o=K.UnknownType.create();N.containsAwaitNode(e.expression)&&(s=!0);t&&(a=null===(n=He({type:t.expectedType},s,void 0))||void 0===n?void 0:n.type);const l=gn(e,a);l.isIncomplete&&(i=!0);l.typeErrors&&(r=!0);const p=l.type;!s&&t&&(0,K.isClassInstance)(t.expectedType)&&K.ClassType.isBuiltIn(t.expectedType,"AsyncGenerator")&&(s=!0);const c=Ye(e,s?"AsyncGenerator":"Generator");c&&(0,K.isInstantiableClass)(c)&&(o=K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(c,s?[p,K.NoneType.createInstance()]:[p,K.NoneType.createInstance(),K.NoneType.createInstance()],!0)));return{type:o,isIncomplete:i,typeErrors:r}}(e,n);break;case 15:i=function(e,t,n){var a;if(0!=(256&t)&&1!==(null===(a=e.parent)||void 0===a?void 0:a.nodeType)){const t=new p.DiagnosticAddendum;t.addMessage(y.Localizer.DiagnosticAddendum.useDictInstead()),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.dictInAnnotation()+t.getString(),e)}let i=null==n?void 0:n.expectedType;if(n&&(0,K.isUnion)(n.expectedType)){let t,a;(0,W.doForEachSubtype)(n.expectedType,(n=>{if(a&&!a.typeErrors)return;const i=_a(e,(()=>ln(e,(0,W.makeInferenceContext)(n))));i&&Wa(n,i.type)&&(!a||a.typeErrors&&!i.typeErrors)&&(t=n,a=i)})),i=t}let r;if(i){r=new p.DiagnosticAddendum;const t=ln(e,(0,W.makeInferenceContext)(i),r);if(t)return t}const s=function(e,t){const n=t?K.AnyType.create():K.UnknownType.create();let a=n,i=n;const r=[],s=[];let o=!1,l=!1;pn(e,r,s,t,!1)&&(l=!0);const p=r.map((e=>Ve(e.type))),c=s.map((e=>Ve(e.type)));a=p.length>0?(0,K.combineTypes)(p):n,c.length>0?i=T.getFileInfo(e).diagnosticRuleSet.strictDictionaryInference||t?(0,K.combineTypes)(c):(0,W.areTypesSame)(c,{ignorePseudoGeneric:!0})?c[0]:n:(i=n,o=!0);const d=fa(e,"dict"),u=(0,K.isInstantiableClass)(d)?K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(d,[a,i],!0,void 0,void 0,o)):K.UnknownType.create();if(l&&(0,W.getContainerDepth)(u)>8)return{type:K.UnknownType.create()};return{type:u,isIncomplete:l}}(e,!!n);return{...s,expectedTypeDiagAddendum:r}}(e,t,n);break;case 30:i=function(e,t){let n=!!(null==t?void 0:t.isTypeIncomplete);const a=K.FunctionType.createInstance("","","",131072);a.details.typeVarScopeId=N.getScopeIdForNode(e),ke(e,{type:a,isIncomplete:!0},0);let i=[];if(t){(0,W.mapSubtypes)(t.expectedType,(e=>{if((0,K.isFunction)(e)&&i.push(e),(0,K.isClassInstance)(e)){const t=qe(e,"__call__");t&&(0,K.isFunction)(t)&&i.push(t)}}));const n=e.parameters.filter((e=>0===e.category&&!!e.name&&void 0===e.defaultValue)).length,a=e.parameters.filter((e=>0===e.category&&!!e.name)).length;i=i.filter((e=>{const t=e.details.parameters.filter((e=>!!e.name&&!e.hasDefault)).length,i=e.details.parameters.some((e=>!!e.name&&0!==e.category)),r=!!e.details.paramSpec;return i||r||t>=n&&t<=a}))}const r=i.length>0?i[0]:void 0;let s=!0;const o=r?(0,D.getParameterListDetails)(r):void 0;e.parameters.forEach(((n,i)=>{let r;if(o&&(i<o.params.length?r=o.params[i].type:n.defaultValue&&(r=Me(n.defaultValue,void 0,t).type)),n.name&&ke(n.name,{type:Zn(e,n.category,null!=r?r:K.UnknownType.create())},0),n.defaultValue&&Me(n.defaultValue,1),i>=0){let e=!1;0===n.category&&n.name?(0,R.isPrivateName)(n.name.value)&&(e=!0):s=!1,s&&!e&&a.details.parameters.length>0&&K.FunctionType.addParameter(a,{category:0,type:K.UnknownType.create()}),e||(s=!1)}const l={category:n.category,name:n.name?n.name.value:void 0,hasDefault:!!n.defaultValue,defaultValueExpression:n.defaultValue,hasDeclaredType:!0,type:null!=r?r:K.UnknownType.create()};K.FunctionType.addParameter(a,l)})),s&&a.details.parameters.length>0&&K.FunctionType.addParameter(a,{category:0,type:K.UnknownType.create()});const l=r?za(r):void 0;return _a(Ia(e)||(null==t?void 0:t.isTypeIncomplete)?e.expression:void 0,(()=>{const t=Me(e.expression,void 0,(0,W.makeInferenceContext)(l));a.inferredReturnType=t.type,t.isIncomplete&&(n=!0)}),{dependentType:null==t?void 0:t.expectedType}),a.details.flags&=-131073,{type:a,isIncomplete:n}}(e,n);break;case 3:i=Me(e.rightExpression),gt(e.leftExpression,i.type,!!i.isIncomplete,e.rightExpression,!0,!0);break;case 4:i=Me(e.rightExpression),gt(e.name,i.type,!!i.isIncomplete,e.rightExpression,!0);break;case 60:i=function(e){let t,n,a=!1;const i=N.getEnclosingFunction(e);if(i){const e=Kn(i);if(e){const a=K.FunctionType.getSpecializedReturnType(e.functionType);if(a){t=(0,W.getGeneratorYieldType)(a,!!i.isAsync);const e=(0,W.getGeneratorTypeArgs)(a);e&&e.length>=2&&(n=e[1])}}}if(e.expression){Me(e.expression,void 0,(0,W.makeInferenceContext)(t)).isIncomplete&&(a=!0)}return{type:n||K.UnknownType.create(),isIncomplete:a}}(e);break;case 61:i=function(e){const t=Me(e.expression),n=t.type,a=(0,W.mapSubtypes)(n,(n=>{var a,i;let r=(0,W.getGeneratorTypeArgs)(n);if(r)return r.length>=2?r[2]:K.UnknownType.create();if((0,K.isClassInstance)(n)&&K.ClassType.isBuiltIn(n,"Coroutine"))return K.UnknownType.create();const s=null!==(i=null===(a=Ze(t,!1,e))||void 0===a?void 0:a.type)&&void 0!==i?i:K.UnknownType.create();return r=(0,W.getGeneratorTypeArgs)(s),r&&r.length>=2?r[2]:K.UnknownType.create()}));return{type:a}}(e);break;case 56:i=function(e,t,n){var a;let i,r;if(n){const t=fa(e,"Iterable");t&&(0,K.isInstantiableClass)(t)&&(r=K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(t,[n.expectedType],!0)))}const s=Me(e.expression,t,(0,W.makeInferenceContext)(r)),o=s.type;if(0==(64&t)&&(0,K.isVariadicTypeVar)(o)&&!o.isVariadicUnpacked)i={type:K.TypeVarType.cloneForUnpacked(o)};else if(0!=(2097152&t)&&(0,K.isInstantiableClass)(o)&&K.ClassType.isBuiltIn(o,"tuple"))i={type:K.ClassType.cloneForUnpacked(o)};else{const t=null!==(a=He(s,!1,e))&&void 0!==a?a:{type:K.UnknownType.create(!!s.isIncomplete),isIncomplete:s.isIncomplete};i={type:t.type,typeErrors:s.typeErrors,unpackedType:o,isIncomplete:t.isIncomplete}}return i}(e,t,n);break;case 54:i=Me(e.typeAnnotation,33256);break;case 49:case 27:i=Oe(e);break;case 0:ba(e,(()=>{e.child&&Me(e.child)})),i={type:K.UnknownType.create()};break;default:(0,l.assertNever)(e,`Illegal node type: ${e.nodeType}`)}if(i||(0,l.fail)(`Unhandled expression type '${N.printExpression(e)}'`),s&&function(e,t,n){var a;if(e.isIncomplete)return;64&t&&(0,K.isVariadicTypeVar)(e.type)&&!e.type.isVariadicInUnion&&(it(y.Localizer.Diagnostic.typeVarTupleContext(),n),e.type=K.UnknownType.create());if(!(0,W.isEffectivelyInstantiable)(e.type)){(0,K.isClassInstance)(e.type)&&K.ClassType.isTupleClass(e.type)&&0===(null===(a=e.type.tupleTypeArguments)||void 0===a?void 0:a.length)||(pt(e.type,n),e.type=K.UnknownType.create(),e.typeErrors=!0)}}(i,t,e),ke(e,i,t,n,!0),n&&!(0,K.isAnyOrUnknown)(n.expectedType)&&!(0,K.isNever)(n.expectedType)&&(ye.set(e.id,n.expectedType),n.signatureTracker&&(0,K.isFunction)(i.type)&&(i.type=(0,W.ensureFunctionSignaturesAreUnique)(i.type,n.signatureTracker,e.start)),!i.isIncomplete&&!i.expectedTypeDiagAddendum)){const t=new p.DiagnosticAddendum;Wa(n.expectedType,i.type,t,void 0,void 0,512)||(i.typeErrors=!0,i.expectedTypeDiagAddendum=t,t.addTextRange(e))}return i}function Oe(e){const t=0!=(32&e.token.flags);let n;if(27===e.nodeType){let a=!0;if(e.fieldExpressions.forEach((e=>{const t=Me(e).type;(0,W.doForEachSubtype)(t,(e=>{(0,K.isClassInstance)(e)&&(K.ClassType.isBuiltIn(e,"LiteralString")||K.ClassType.isBuiltIn(e,"str")&&void 0!==e.literalValue)||(a=!1)}))})),!t&&a){const t=Ye(e,"LiteralString");t&&(0,K.isInstantiableClass)(t)&&(n={type:K.ClassType.cloneAsInstance(t)})}n||(n={type:Ta(e,t?"bytes":"str")})}else n={type:vn(e,t?"bytes":"str",e.value)};return n}function Ve(e){var t,n,a;return(0,K.isUnion)(e)&&e.subtypes.length>0&&((null===(t=e.literalStrMap)||void 0===t?void 0:t.size)===e.subtypes.length||(null===(n=e.literalIntMap)||void 0===n?void 0:n.size)===e.subtypes.length||(null===(a=e.literalEnumMap)||void 0===a?void 0:a.size)===e.subtypes.length)?Ve(e.subtypes[0]):(0,W.mapSubtypes)(e,(e=>{if((0,K.isClass)(e)){if(void 0!==e.literalValue)return K.ClassType.cloneWithLiteral(e,void 0);if(K.ClassType.isBuiltIn(e,"LiteralString")&&re&&(0,K.isInstantiableClass)(re)){let t=K.ClassType.cloneAsInstance(re);return e.condition&&(t=K.TypeBase.cloneForCondition(t,(0,W.getTypeCondition)(e))),t}}return e}))}function Re(e,t){return Le(e,{associateTypeVarsWithScope:!0,allowTypeVarTuple:1===t,allowUnpackedTypedDict:2===t,allowUnpackedTuple:1===t})}function Le(e,t){var n,a,i;const r=T.getFileInfo(e);if(r.isTypingStubFile||r.isTypingExtensionsStubFile){const t=function(e){if(!e.parent||54!==e.parent.nodeType)return;if(38!==e.parent.valueExpression.nodeType)return;const t=e.parent.valueExpression,n=t.value;let a=new Map([["Tuple",{alias:"tuple",module:"builtins"}],["Generic",{alias:"",module:"builtins"}],["Protocol",{alias:"",module:"builtins"}],["Callable",{alias:"",module:"builtins"}],["Type",{alias:"type",module:"builtins"}],["ClassVar",{alias:"",module:"builtins"}],["Final",{alias:"",module:"builtins"}],["Literal",{alias:"",module:"builtins"}],["TypedDict",{alias:"_TypedDict",module:"self"}],["Union",{alias:"",module:"builtins"}],["Optional",{alias:"",module:"builtins"}],["Annotated",{alias:"",module:"builtins"}],["TypeAlias",{alias:"",module:"builtins"}],["Concatenate",{alias:"",module:"builtins"}],["TypeGuard",{alias:"",module:"builtins"}],["Unpack",{alias:"",module:"builtins"}],["Required",{alias:"",module:"builtins"}],["NotRequired",{alias:"",module:"builtins"}],["Self",{alias:"",module:"builtins"}],["NoReturn",{alias:"",module:"builtins"}],["Never",{alias:"",module:"builtins"}],["LiteralString",{alias:"",module:"builtins"}],["ReadOnly",{alias:"",module:"builtins"}]]).get(n);"ReadOnly"!==n||T.getFileInfo(e).diagnosticRuleSet.enableExperimentalFeatures||(a=void 0);if(a){const t=Ce(e,0);if(t)return(0,l.assert)((0,K.isInstantiableClass)(t)),t;const i=Fn(e,n,a);return"LiteralString"===n&&(i.details.baseClasses.push(null!=re?re:K.AnyType.create()),(0,W.computeMroLinearization)(i)),ke(e,{type:i},0),i}return}(e);if(t)return t}let s=393;(null==t?void 0:t.isVariableAnnotation)&&(s|=32768),(null==t?void 0:t.allowFinal)||(s|=16),(null==t?void 0:t.allowClassVar)||(s|=131072),(null==t?void 0:t.allowTypeVarTuple)?s|=2097152:s|=64,(null==t?void 0:t.allowParamSpec)||(s|=32),(null==t?void 0:t.associateTypeVarsWithScope)?s|=8192:s|=4096,(null==t?void 0:t.allowUnpackedTypedDict)&&(s|=8388608),(null==t?void 0:t.allowUnpackedTuple)&&(s|=2097152),(null==t?void 0:t.notParsedByInterpreter)&&(s|=524288),(null==t?void 0:t.allowRequired)&&(s|=1048576),(0,f.isAnnotationEvaluationPostponed)(r)&&(s|=4),3===(null===(n=null==e?void 0:e.parent)||void 0===n?void 0:n.nodeType)&&e.parent.typeAnnotationComment===e?s|=524292:62===(null===(a=null==e?void 0:e.parent)||void 0===a?void 0:a.nodeType)?(e.parent.returnTypeAnnotation===e||e.parent.paramTypeAnnotations.some((t=>t===e)))&&(s|=524292):41===(null===(i=null==e?void 0:e.parent)||void 0===i?void 0:i.nodeType)&&e.parent.typeAnnotationComment===e&&(s|=524292);const o=Me(e,s).type;return(0,K.isModule)(o)&&ot(r.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.moduleAsType(),e),(0,W.convertToInstance)(o)}function Ue(e,t=0){if(e=mt(e),t>K.maxTypeRecursionCount)return!0;switch(t++,e.category){case 0:case 1:case 2:case 4:case 3:return!0;case 9:return void 0!==(0,K.findSubtype)(e,(e=>Ue(e,t)));case 5:case 6:case 8:case 10:return!1;case 7:{if(K.TypeBase.isInstantiable(e))return!1;if((0,W.isTupleClass)(e)&&e.tupleTypeArguments)return(0,W.isUnboundedTupleClass)(e)||0===e.tupleTypeArguments.length;const t=e.details.mro.find((e=>!(0,K.isClass)(e)||(0,W.isTupleClass)(e)));if(t&&(0,K.isClass)(t)&&t.tupleTypeArguments)return(0,W.isUnboundedTupleClass)(t)||0===t.tupleTypeArguments.length;if(K.ClassType.isBuiltIn(e,"bool")&&void 0!==e.literalValue)return!1===e.literalValue;if(K.ClassType.isProtocolClass(e))return!0;if((0,W.lookUpObjectMember)(e,"__len__"))return!0;const n=(0,W.lookUpObjectMember)(e,"__bool__");if(n){const e=Va(n);if((0,K.isFunction)(e)&&e.details.declaredReturnType){const t=e.details.declaredReturnType;if((0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"bool")&&!0===t.literalValue)return!1}return!0}return!1}}}function je(e,t=0){if(e=mt(e),t>K.maxTypeRecursionCount)return!0;switch(t++,e.category){case 1:case 5:case 6:case 8:case 10:case 4:case 2:return!0;case 9:return void 0!==(0,K.findSubtype)(e,(e=>je(e,t)));case 0:case 3:return!1;case 7:{if(K.TypeBase.isInstantiable(e))return!0;if((0,W.isTupleClass)(e)&&e.tupleTypeArguments&&0===e.tupleTypeArguments.length)return!1;if(!1===e.literalValue||0===e.literalValue||e.literalValue===BigInt(0)||""===e.literalValue)return!1;if(K.ClassType.isProtocolClass(e))return!0;const t=(0,W.lookUpObjectMember)(e,"__bool__");if(t){const e=Va(t);if((0,K.isFunction)(e)&&e.details.declaredReturnType){const t=e.details.declaredReturnType;if((0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"bool")&&!1===t.literalValue)return!1}}return!0}}}function Be(e,t,n,a={method:"get"},i=void 0,r=0,s){const o=It(e,K.ClassType.cloneAsInstantiable(t),!0,n,a,i,8|r,s);if(o)return{type:o.type,classType:o.classType,isIncomplete:!!o.isTypeIncomplete,isAsymmetricAccessor:o.isAsymmetricAccessor}}function We(e,t,n,a={method:"get"},i=void 0,r=0,s){let o;const l=i?new p.DiagnosticAddendum:void 0,d=i?new p.DiagnosticAddendum:void 0;if(K.ClassType.isPartiallyEvaluated(t))return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.classDefinitionCycle().format({name:t.details.name}),e),{type:K.UnknownType.create()};0==(32&r)&&(o=It(e,t,!1,n,a,l,1|r,s));const u=void 0!==(null==o?void 0:o.classType);if(!o){const i=t.details.effectiveMetaclass;i&&(0,K.isInstantiableClass)(i)&&!K.ClassType.isSameGenericClass(i,t)&&(o=It(e,i,!0,n,a,d,r,t))}if(o)return{type:o.type,isIncomplete:!!o.isTypeIncomplete,isAsymmetricAccessor:o.isAsymmetricAccessor};const m=u?l:d;i&&m&&i.addAddendum(m)}function qe(e,t,n=0,a=!1){const i=(0,W.lookUpClassMember)(e,t,8);if(i){const t=Va(i);if((0,K.isFunction)(t)||(0,K.isOverloadedFunction)(t)){const i=ti(K.ClassType.cloneAsInstance(e),t,void 0,void 0,n,a);if(i)return i}else if((0,K.isAnyOrUnknown)(t)){const e=K.FunctionType.createSynthesizedInstance("",32768);return K.FunctionType.addDefaultParameters(e),e}}}function Ge(e){if(54===e.nodeType&&38===e.valueExpression.nodeType){const t=va(e,e.valueExpression.value,!1);if(t){return void 0!==t.symbol.getDeclarations().find((e=>ri(e)))}}return!1}function Ke(e,t){var n,a;let i,r,s,o=!0,l=!1;switch(e.nodeType){case 38:{const t=va(e,e.value,!0);if(t&&(i=t.symbol,!(null===(n=Fa(i,e))||void 0===n?void 0:n.type)&&2===t.scope.type)){const t=N.getEnclosingClassOrFunction(e);if(t&&10===t.nodeType){const n=Ln(t);if(n){const t=(0,W.lookUpClassMember)(n.classType,e.value,24);t&&(i=t.symbol)}}}break}case 54:return Ke(e.valueExpression,t);case 35:{const t=mt(Me(e.leftExpression,2).type);let n;(0,K.isClassInstance)(t)?(n=(0,W.lookUpObjectMember)(t,e.memberName.value,16),r=t,s=null==n?void 0:n.classType,(null==n?void 0:n.isInstanceMember)&&(o=!1),l=!0):(0,K.isInstantiableClass)(t)&&(n=(0,W.lookUpClassMember)(t,e.memberName.value,24),r=t,s=null==n?void 0:n.classType),n&&(i=n.symbol);break}case 24:{const n=mt(Me(e.baseExpression,2).type);if(n&&(0,K.isClassInstance)(n)){const a=(0,W.lookUpClassMember)(n,"__setitem__");if(a){const t=Va(a);if((0,K.isFunction)(t)){const i=ti(n,t,(0,K.isInstantiableClass)(a.classType)?a.classType:void 0,e,void 0,!1);if(i&&(0,K.isFunction)(i)&&i.details.parameters.length>=2){const e=K.FunctionType.getEffectiveParameterType(i,1);if(!(0,K.isAnyOrUnknown)(e))return e}}}else if(K.ClassType.isTypedDictClass(n)){const a=(0,G.getTypeOfIndexedTypedDict)(di,e,n,t||{method:"get"});if(a)return a.type}}break}}if(i){let t=null===(a=Fa(i))||void 0===a?void 0:a.type;if(t){if(l&&(0,K.isClassInstance)(t)){const e=(0,W.lookUpClassMember)(t,"__set__"),n=e?Va(e):void 0;if(e&&n&&(0,K.isFunction)(n)&&n.details.parameters.length>=3){if(t=n.details.parameters[2].type,(0,K.isClass)(e.classType)){const n=(0,W.buildTypeVarContextFromSpecializedClass)(e.classType);t=(0,W.applySolvedTypeVars)(t,n)}if((0,K.isAnyOrUnknown)(t))return}}return r&&(s&&(0,K.isInstantiableClass)(s)&&(t=(0,W.partiallySpecializeType)(t,s)),((0,K.isFunction)(t)||(0,K.isOverloadedFunction)(t))&&o&&(t=ti(r,t,void 0,e))),t}}}function $e(e,t){return(0,W.mapSubtypes)(e,(e=>{if(e=mt(e),(0,K.isAnyOrUnknown)(e))return e;if((0,K.isClassInstance)(e)){const n=Tt(e,"__await__",[],t);if(n){if((0,K.isAnyOrUnknown)(n))return n;if((0,K.isClassInstance)(n)){if(Tt(n,"__iter__",[],t)){const e=function(e){if((0,K.isAnyOrUnknown)(e))return e;if((0,K.isClassInstance)(e)&&K.ClassType.isBuiltIn(e,"Generator")){const t=e.typeArguments;if(t&&t.length>=3)return t[2]}return}(n);if(e)return e}}}}if(t){ot(T.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotAwaitable().format({type:ci(e)}),t)}return K.UnknownType.create()}))}function He(e,t,n){const a=t?"__aiter__":"__iter__",i=t?"__anext__":"__next__";let r=!0,s=(0,W.transformPossibleRecursiveTypeAlias)(e.type);s=mt(s),(0,W.isOptionalType)(s)&&(n&&!e.isIncomplete&&ot(T.getFileInfo(n).diagnosticRuleSet.reportOptionalIterable,c.DiagnosticRule.reportOptionalIterable,y.Localizer.Diagnostic.noneNotIterable(),n),s=(0,K.removeNoneFromUnion)(s));const o=(0,W.mapSubtypes)(s,(s=>{if(s=mt(s),(0,K.isAnyOrUnknown)(s))return s;const o=new p.DiagnosticAddendum;if((0,K.isClass)(s)){let e;if(K.TypeBase.isInstance(s)){if((0,W.isTupleClass)(s)&&s.tupleTypeArguments&&0===s.tupleTypeArguments.length)return K.NeverType.createNever();e=Tt(s,a,[],n)}else K.TypeBase.isInstantiable(s)&&s.details.effectiveMetaclass&&(0,K.isInstantiableClass)(s.details.effectiveMetaclass)&&(e=Tt(K.ClassType.cloneAsInstance(s.details.effectiveMetaclass),a,[],n,s));if(e){const r=new p.DiagnosticAddendum,s=yt(e,void 0,(e=>{if((0,K.isAnyOrUnknown)(e))return e;if((0,K.isClassInstance)(e)){let a=Tt(e,i,[],n);if(a)return a=(0,W.mapSubtypes)(a,(e=>(0,K.isTypeVar)(e)&&(0,K.isUnpackedVariadicTypeVar)(e)?null!=X?X:K.UnknownType.create():e)),t?$e(a,n):a;r.addMessage(y.Localizer.Diagnostic.methodNotDefinedOnType().format({name:i,type:ci(e)}))}else r.addMessage(y.Localizer.Diagnostic.methodReturnsNonObject().format({name:a}))}));if(r.isEmpty())return s;o.addAddendum(r)}else{if(!t&&(0,K.isClassInstance)(s)){const e=Tt(s,"__getitem__",[{argumentCategory:0,typeResult:{type:ie&&(0,K.isInstantiableClass)(ie)?K.ClassType.cloneAsInstance(ie):K.UnknownType.create()}}],n);if(e)return e}o.addMessage(y.Localizer.Diagnostic.methodNotDefined().format({name:a}))}}n&&!e.isIncomplete&&ot(T.getFileInfo(n).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotIterable().format({type:ci(s)})+o.getString(),n),r=!1}));return r?{type:o,isIncomplete:e.isIncomplete}:void 0}function Ze(e,t,n){const a=t?"__aiter__":"__iter__";let i=!0,r=mt(e.type);(0,W.isOptionalType)(r)&&(n&&!e.isIncomplete&&ot(T.getFileInfo(n).diagnosticRuleSet.reportOptionalIterable,c.DiagnosticRule.reportOptionalIterable,y.Localizer.Diagnostic.noneNotIterable(),n),r=(0,K.removeNoneFromUnion)(r));const s=(0,W.mapSubtypes)(r,(e=>{if((0,K.isAnyOrUnknown)(e))return e;if((0,K.isClass)(e)){let t;if(K.TypeBase.isInstance(e)?t=Tt(e,a,[],n):K.TypeBase.isInstantiable(e)&&e.details.effectiveMetaclass&&(0,K.isInstantiableClass)(e.details.effectiveMetaclass)&&(t=Tt(K.ClassType.cloneAsInstance(e.details.effectiveMetaclass),a,[],n,e)),t)return mt(t)}n&&ot(T.getFileInfo(n).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotIterable().format({type:ci(e)}),n),i=!1}));return i?{type:s,isIncomplete:e.isIncomplete}:void 0}function Ye(e,t){var n;return null!==(n=Qe(e,t,["typing"]))&&void 0!==n?n:Qe(e,t,["typing_extensions"])}function Je(e,t){return Qe(e,t,["_typeshed"])}function Qe(t,n,a){const i=T.getFileInfo(t),r=e({nameParts:a,importingFilePath:i.filePath});if(!r)return;const s=r.symbolTable.get(n);return s?Da(s):void 0}function Xe(e){const n=28===e.nodeType?e:N.getExecutionScopeNode(e);if(T.getCodeFlowComplexity(n)>t.maxCodeComplexity){let t=n;28===n.nodeType?t=n.name:36===n.nodeType&&(t={start:0,length:0});const a=T.getFileInfo(e);return lt(a,a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.codeTooComplexToAnalyze(),t),!0}return!1}function et(e,t){if(Xe(e))return!0;const n=T.getFlowNode(e);if(!n)return!!e.parent&&et(e.parent,t);const a=t?T.getFlowNode(t):void 0;return ui.isFlowNodeReachable(n,a)}function tt(e){const t=T.getAfterFlowNode(e);return!!t&&(!!Xe(e)||!!ui.isFlowNodeReachable(t)&&!!function(e,t){const n=da(e.id);if(Xe(e))return!0;const a=n.getTypeFromCodeFlow(t,void 0,void 0,K.UnboundType.create(),{skipNoReturnCallAnalysis:!0});return void 0!==a.type&&!(0,K.isNever)(a.type)}(e,t))}function nt(e,t,n=!0){if(Xe(e))return!0;const a=T.getFlowNode(e),i=T.getFlowNode(t);return!(!a||!i)&&(a===i?n:ui.isFlowNodeReachable(i,a,!0))}function at(e,t,n){return rt("information",e,t,n)}function it(e,t,n){return rt("error",e,t,n)}function rt(e,t,n,a){if(!st(n)&&et(n)){return T.getFileInfo(n).diagnosticSink.addDiagnosticWithTextRange(e,t,a||n)}}function st(e){return Y.some((t=>N.isNodeContainedWithin(e,t)))||r.isSpeculative(e,!0)}function ot(e,t,n,a,i){if("none"===e)return;if(!T.getFileInfo(a).diagnosticRuleSet.analyzeUnannotatedFunctions){const e=N.getEnclosingFunction(a);if(e&&N.isUnannotatedFunction(e)&&N.isNodeContainedWithin(a,e.suite))return}const r=rt(e,n,a,i);return r&&r.setRule(t),r}function lt(e,t,n,a,i){if("none"===t)return;const r=e.diagnosticSink.addDiagnosticWithTextRange(t,a,i);return n&&r.setRule(n),r}function pt(e,t){const n=T.getFileInfo(t),a=new p.DiagnosticAddendum;(0,K.isUnion)(e)&&(0,W.doForEachSubtype)(e,(e=>{(0,W.isEffectivelyInstantiable)(e)||a.addMessage(y.Localizer.DiagnosticAddendum.typeNotClass().format({type:ci(e)}))})),ot(n.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeExpectedClass().format({type:ci(e)})+a.getString(),t)}function ct(e,t,n,a,i,r=!1,s){var o,l,d;const u=e.value,m=va(e,u,!1);if(!m)return;const g=m.symbol.getDeclarations();let h=null===(o=Fa(m.symbol))||void 0===o?void 0:o.type;const f=T.getFileInfo(e);if(void 0===h&&2===m.scope.type){const t=N.getEnclosingClass(e);if(t){const n=Ln(t);if(n){const t=(0,W.lookUpClassMember)(n.classType,e.value,1);(null==t?void 0:t.isTypeDeclared)&&(h=Va(t))}}}let v=t;const b=!!h&&(0,K.isClassInstance)(h)&&K.ClassType.isBuiltIn(h,"TypeAlias");if(h&&!b){let n=new p.DiagnosticAddendum;Wa(h,t,n)?v=Ja(e,h,t):(s&&(n=s),ot(f.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAssignmentMismatch().format(pi(t,h))+n.getString(),null!=i?i:e,null!==(d=null!==(l=n.getEffectiveTextRange())&&void 0!==l?l:i)&&void 0!==d?d:e),v=h)}else{const t=M.getScopeForNode(e);2===(null==t?void 0:t.type)&&(!K.TypeBase.isInstance(v)||(0,R.isConstantName)(u)||ai(m.symbol)||(v=Ve(v)))}const _=g.find((e=>1===e.type));_&&1===_.type&&(_.isConstant?e!==(0,k.getNameNodeForDeclaration)(g[0])&&ot(f.diagnosticRuleSet.reportConstantRedefinition,c.DiagnosticRule.reportConstantRedefinition,y.Localizer.Diagnostic.constantRedefinition().format({name:u}),e):ii(_)&&!r&&ot(f.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.finalReassigned().format({name:u}),e)),n||mn(f.diagnosticRuleSet.reportUnknownVariableType,c.DiagnosticRule.reportUnknownVariableType,e,v,e,a),ke(e,{type:v,isIncomplete:n},0)}function dt(e,t,n,a,r){const s=Me(e.leftExpression,2),o=mt(s.type);if(38===e.leftExpression.nodeType){const i=N.getEnclosingClass(e);if(i){const r=Ln(i);if(r&&(0,K.isInstantiableClass)(r.classType)&&((0,K.isClassInstance)(o)?K.ClassType.isSameGenericClass(o,r.classType)&&ut(e,t,n,!0,a):(0,K.isInstantiableClass)(o)&&K.ClassType.isSameGenericClass(o,r.classType)&&ut(e,t,n,!1,a),K.ClassType.isProtocolClass(r.classType))){const t=r.classType.details.fields.get(e.memberName.value);if(t){0===t.getDeclarations().filter((e=>!N.getEnclosingFunction(e.node))).length&&it(y.Localizer.Diagnostic.assignmentInProtocol(),e.memberName)}}}}var l;_t(e,s,{method:"set",setType:{type:t,isIncomplete:n},setErrorNode:a,setExpectedTypeDiag:r},0).isAsymmetricAccessor&&(l=e,Ia(void 0)||i.add(l.id)),ke(e.memberName,{type:t,isIncomplete:n},0),ke(e,{type:t,isIncomplete:n},0)}function ut(e,t,n,a,i){var r;const s=e.memberName.value,o=T.getFileInfo(e),p=N.getEnclosingClass(e);if(!p)return;const d=Ln(p);if(d&&(0,K.isInstantiableClass)(d.classType)){let p=(0,W.lookUpClassMember)(d.classType,s,a?0:8);const u=d.classType.details.fields;if(p){const n=(0,K.isInstantiableClass)(p.classType)?p.classType:void 0,m=n&&K.ClassType.isSameGenericClass(d.classType,n);if(m&&a&&(null==n?void 0:n.details.inheritedSlotsNames)&&n.details.localSlotsNames&&n.details.localSlotsNames.length>0&&!n.details.inheritedSlotsNames.some((e=>e===s))){const t=(0,W.lookUpClassMember)(n,s,8);let a=!1;if(t){const e=Da(t.symbol);((0,K.isAnyOrUnknown)(e)||(0,K.isUnbound)(e)||(0,W.isMaybeDescriptorInstance)(e))&&(a=!0)}a||ot(o.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.slotsAttributeError().format({name:s}),e.memberName)}if(m&&p.isInstanceMember===a){const t=u.get(s);(0,l.assert)(void 0!==t);const n=t.getDeclarations();n.length>0&&1===n[0].type&&i&&e.memberName!==n[0].node&&n[0].isConstant&&ot(o.diagnosticRuleSet.reportConstantRedefinition,c.DiagnosticRule.reportConstantRedefinition,y.Localizer.Diagnostic.constantRedefinition().format({name:e.memberName.value}),e.memberName)}else{const n=null===(r=Fa(p.symbol))||void 0===r?void 0:r.type;if(n&&!(0,W.isProperty)(n)&&!p.isInstanceMember&&a){ft(o,p.symbol,e.memberName);const n=Va(p);t=(0,K.combineTypes)([t,n])}}}p=(0,W.lookUpClassMember)(d.classType,s,16),p||!i||n||mn(o.diagnosticRuleSet.reportUnknownMemberType,c.DiagnosticRule.reportUnknownMemberType,e.memberName,t,e,!0)}}function mt(e,t=!1,n){return(0,W.mapSubtypes)(e,(e=>{if((0,K.isParamSpec)(e)){if("args"===e.paramSpecAccess)return ne&&(0,K.isInstantiableClass)(ne)&&X&&(0,K.isClassInstance)(X)?K.ClassType.cloneAsInstance((0,W.specializeTupleClass)(ne,[{type:X,isUnbounded:!0}])):K.UnknownType.create();if("kwargs"===e.paramSpecAccess)return se&&(0,K.isInstantiableClass)(se)&&re&&(0,K.isInstantiableClass)(re)&&X&&(0,K.isClassInstance)(X)?K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(se,[(0,W.convertToInstance)(re),X],!0)):K.UnknownType.create()}if(t&&(0,K.isFunction)(e)&&0===e.details.parameters.length&&e.details.paramSpec){const t=K.FunctionType.createInstance("","","",32832);return K.FunctionType.addDefaultParameters(t),K.FunctionType.cloneForParamSpec(e,t)}if((0,K.isVariadicTypeVar)(e)){if(e.isVariadicInUnion)return e;if(ne&&(0,K.isInstantiableClass)(ne))return(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,[{type:e,isUnbounded:!1}],!0,!0))}if((0,K.isTypeVar)(e)&&!e.details.recursiveTypeAliasName){if(e.details.boundType){const t=K.TypeBase.isInstantiable(e)?(0,W.convertToInstantiable)(e.details.boundType):e.details.boundType;return e.details.isSynthesized?t:(0,W.addConditionToType)(t,[{typeVarName:K.TypeVarType.getNameWithScope(e),constraintIndex:0,isConstrainedTypeVar:!1}])}if(e.details.recursiveTypeAliasName)return e;if(e.details.constraints.length>0){const t=[];return e.details.constraints.forEach(((a,i)=>{if(n){const t=K.TypeVarType.getNameWithScope(e),a=n.find((e=>e.typeVarName===t));if(a&&a.constraintIndex!==i)return}K.TypeBase.isInstantiable(e)&&(a=(0,W.convertToInstantiable)(a)),t.push((0,W.addConditionToType)(a,[{typeVarName:K.TypeVarType.getNameWithScope(e),constraintIndex:i,isConstrainedTypeVar:!0}]))})),(0,K.combineTypes)(t)}if(e.details.isExemptFromBoundCheck)return K.AnyType.create();if(K.TypeBase.isInstantiable(e)){if(ee&&(0,K.isInstantiableClass)(ee))return e.details.isSynthesized?ee:(0,W.addConditionToType)(K.ClassType.cloneAsInstance(ee),[{typeVarName:K.TypeVarType.getNameWithScope(e),constraintIndex:0,isConstrainedTypeVar:!1}])}else if(X)return e.details.isSynthesized?X:(0,W.addConditionToType)(X,[{typeVarName:K.TypeVarType.getNameWithScope(e),constraintIndex:0,isConstrainedTypeVar:!1}]);return K.AnyType.create()}return e}))}function yt(e,t,n,a=0){const i=[];let r=!1;function s(e,s){let o=(0,K.isUnion)(e)?e:mt(e);o=(0,W.transformPossibleRecursiveTypeAlias)(o),(0,W.doForEachSubtype)(o,((o,l,p)=>{var c;if(t){const e=function(e,t,n){if(n>K.maxTypeRecursionCount)return e;if(n++,!K.TypeCondition.isCompatible((0,W.getTypeCondition)(e),t))return;if((0,K.isClass)(e)&&e.typeArguments&&!e.tupleTypeArguments){jn(e);let a=!1;const i=e.typeArguments.map(((i,r)=>{if(3!==K.TypeVarType.getVariance(e.details.typeParameters[r]))return i;const s=yt(i,t,(e=>e),n);return s!==i&&(a=!0),s}));if(a)return K.ClassType.cloneForSpecialization(e,i,!0)}return e}(o,t,a);if(!e)return;o=e}let d=n(o,e,s&&l===p.length-1);if(d!==e&&(r=!0),d){const e=null===(c=(0,W.getTypeCondition)(o))||void 0===c?void 0:c.filter((e=>e.isConstrainedTypeVar));e&&e.length>0&&(d=(0,W.addConditionToType)(d,e)),i.push(d)}}))}if((0,K.isUnion)(e)?e.subtypes.forEach(((t,n)=>{s(t,n===e.subtypes.length-1)})):s(e,!0),!r)return e;const o=(0,K.combineTypes)(i);return 9===o.category&&K.UnionType.addTypeAliasSource(o,e),o}function gt(e,t,n,a,i=!1,r=!1,s){if((0,K.isTypeVar)(t)&&a&&9===a.nodeType){const n=Me(a.leftExpression,2).type;(0,K.isInstantiableClass)(n)&&(K.ClassType.isBuiltIn(n,"TypeVar")||K.ClassType.isBuiltIn(n,"TypeVarTuple")||K.ClassType.isBuiltIn(n,"ParamSpec"))&&(38===e.nodeType&&e.value===t.details.name||it(t.details.isParamSpec?y.Localizer.Diagnostic.paramSpecAssignedName().format({name:K.TypeVarType.getReadableName(t)}):y.Localizer.Diagnostic.typeVarAssignedName().format({name:K.TypeVarType.getReadableName(t)}),e))}switch(t=(0,K.removeUnbound)(t),e.nodeType){case 38:ct(e,t,n,i,a,r,s);break;case 35:dt(e,t,n,a,s);break;case 24:{const i=Me(e.baseExpression,2);wt(e,i,{method:"set",setType:{type:t,isIncomplete:n},setErrorNode:a,setExpectedTypeDiag:s},0),ke(e,{type:t,isIncomplete:n},0);break}case 31:case 52:!function(e,t,n,a){const i=31===e.nodeType?e.entries:e.expressions,r=new Array(i.length);for(let e=0;e<i.length;e++)r[e]=[];const s=i.findIndex((e=>56===e.nodeType)),o=i.findIndex((e=>56===e.nodeType));t=mt(t);const l=new p.DiagnosticAddendum;(0,W.doForEachSubtype)(t,(t=>{var p,c;const d=(0,W.getSpecializedTupleType)(t);if(d&&d.tupleTypeArguments){const n=d.tupleTypeArguments.map((e=>(0,W.addConditionToType)(e.type,(0,W.getTypeCondition)(t)))),a=d.tupleTypeArguments.findIndex((e=>e.isUnbounded));if(a>=0&&n.length<r.length){const e=n.length>0?n[a]:K.AnyType.create();for(;n.length<r.length;)n.splice(a,0,e)}if(s>=0)if(n.length>r.length){const t=n.splice(s,n.length-r.length+1);let a=(0,K.combineTypes)(t);31===e.nodeType&&(a=Ve(a)),n.splice(s,0,a)}else n.length===r.length-1&&n.splice(s,0,K.NeverType.createNever());if(n.forEach(((e,t)=>{t<r.length&&r[t].push(e)})),n.length!==i.length){const a=o>=0?i.length-1:i.length,r=l.createAddendum();r.addMessage((31===e.nodeType?y.Localizer.DiagnosticAddendum.listAssignmentMismatch():y.Localizer.DiagnosticAddendum.tupleAssignmentMismatch()).format({type:ci(t)})),r.createAddendum().addMessage(y.Localizer.DiagnosticAddendum.tupleSizeMismatch().format({expected:a,received:n.length}))}}else{const e=null!==(c=null===(p=He({type:t,isIncomplete:n},!1,a))||void 0===p?void 0:p.type)&&void 0!==c?c:K.UnknownType.create();for(let n=0;n<i.length;n++)r[n].push((0,W.addConditionToType)(e,(0,W.getTypeCondition)(t)))}})),l.isEmpty()||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,(31===e.nodeType?y.Localizer.Diagnostic.listAssignmentMismatch():y.Localizer.Diagnostic.tupleAssignmentMismatch()).format({type:ci(t)})+l.getString(),e);i.forEach(((e,t)=>{const i=r[t];gt(e,0===i.length?K.UnknownType.create():(0,K.combineTypes)(i),n,a,!0)})),ke(e,{type:t,isIncomplete:n},0)}(e,t,n,a);break;case 54:{const n=Le(e.typeAnnotation,{isVariableAnnotation:!0,allowFinal:N.isFinalAllowedForAssignmentTarget(e.valueExpression),allowClassVar:N.isClassVarAllowedForAssignmentTarget(e.valueExpression)});if(!((0,K.isClassInstance)(n)&&(K.ClassType.isBuiltIn(n,"Final")||K.ClassType.isBuiltIn(n,"ClassVar")))){(0,K.isClassInstance)(n)&&K.ClassType.isBuiltIn(n,"TypeAlias")||Wa(n,t)&&((0,K.isClassInstance)(t)&&K.ClassType.isEnumClass(t)||(t=Ja(e,n,t)))}gt(e.valueExpression,t,!1,a,i,r,s);break}case 56:38===e.expression.nodeType&&ct(e.expression,Ta(e.expression,"list",[t]),!1,i,a);break;case 0:e.child&&ba(e.child,(()=>{Me(e.child)}));break;default:it(y.Localizer.Diagnostic.assignmentTargetExpr(),e)}}function ht(e){switch(e.nodeType){case 38:Me(e);break;case 35:{const t=Me(e.leftExpression,2),n=_t(e,t,{method:"del"},0);ke(e.memberName,{type:n.type},0),ke(e,{type:n.type},0);break}case 24:{const t=Me(e.baseExpression,2);wt(e,t,{method:"del"},0),ke(e,{type:K.UnboundType.create()},0);break}case 52:e.expressions.forEach((e=>{ht(e)}));break;case 0:e.child&&ba(e.child,(()=>{Me(e.child)}));break;default:ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.delTargetExpr(),e);break}}function ft(e,t,n){Ia(n)||e.accessedSymbolSet.add(t.id)}function Tt(e,t,n,a,i){const r=(0,W.lookUpObjectMember)(e,t,8);if(!r)return;const s=Ra(r,e);if(!s)return;const o=s.type;if((0,K.isAnyOrUnknown)(o))return o;if((0,K.isFunction)(o)||(0,K.isOverloadedFunction)(o)){const t=ti(i||e,o,r&&(0,K.isInstantiableClass)(r.classType)?r.classType:void 0,a,void 0,!1,i);if(t){if(!(0,K.isOverloadedFunction)(t))return za(t);if(a){const e=Vt(a,{type:t,isIncomplete:s.isIncomplete},n);if(e)return za(e)}}}}function vt(e,t,n){var a;if(K.TypeBase.isInstantiable(t)&&!t.scopeId&&!(0,W.isTypeAliasPlaceholder)(t)){const i=function(e,t){var n;let a=e,i=0;(0,l.assert)(K.TypeBase.isInstantiable(t));for(;a&&(a=N.getTypeVarScopeNode(a),a);){let e,r=!1;if(10===a.nodeType){const t=Ln(a);t&&!K.ClassType.isPartiallyEvaluated(t.classType)&&(e=t.classType.details.typeParameters),r=!!a.typeParameters,i++}else if(28===a.nodeType){const i=Kn(a);if(i){const a=i.functionType.details;if(e=a.typeParameters,null===(n=a.rescopedTypeParameters)||void 0===n?void 0:n.some((e=>e.details.name===t.details.name)))return{type:t,isRescoped:!0,foundInterveningClass:!1}}r=!!a.typeParameters}else 77===a.nodeType&&(r=!!a.typeParameters);if(e){const n=e.find((e=>e.details.name===t.details.name));if(null==n?void 0:n.scopeId)return{type:t=K.TypeVarType.cloneForScopeId(t,n.scopeId,n.scopeName,n.scopeType),isRescoped:!1,foundInterveningClass:i>1&&!r}}a=a.parent}a=e;for(;a;){let n,i;if(77===a.nodeType?(n=Ce(a.name,0),i=a):3===a.nodeType&&(n=Ce(a.leftExpression,0)),n&&n&&(0,K.isTypeVar)(n)&&n.details.recursiveTypeAliasScopeId&&n.details.recursiveTypeAliasName){if(i&&!t.details.isTypeParamSyntax)ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeParameterNotDeclared().format({name:t.details.name,container:i.name.value}),e);else{const e=n.details.recursiveTypeParameters;if(e&&!e.some((e=>e.details.name===t.details.name)))return{type:t,isRescoped:!1,foundInterveningClass:!1}}return{type:K.TypeVarType.cloneForScopeId(t,n.details.recursiveTypeAliasScopeId,n.details.recursiveTypeAliasName,2),isRescoped:!1,foundInterveningClass:!1}}a=a.parent}return{type:t,isRescoped:!1,foundInterveningClass:!1}}(e,t);if(t=i.type,0!=(2048&n)&&void 0!==t.scopeId){if(!t.details.isSynthesized&&!t.details.isParamSpec){if(t.details.isTypeParamSyntax)return t;const n=N.getTypeVarScopeNode(e);if(n&&n.typeParameters&&!n.typeParameters.parameters.some((t=>t.name===e)))return t;ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarUsedByOuterScope().format({name:t.details.name}),e)}}else if(0!=(8192&n)){if(void 0===t.scopeId)if(i.foundInterveningClass)ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarUsedByOuterScope().format({name:t.details.name}),e);else{let n=N.getEnclosingClassOrFunction(e);if(n&&35===(null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&e.parent.leftExpression===e){const a=e.parent.memberName.value;if("args"===a||"kwargs"===a){const a=N.getEnclosingClassOrFunction(n);28===(null==a?void 0:a.nodeType)?i.isRescoped?ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecScopedToReturnType().format({name:t.details.name}),e):n=a:i.type.scopeId||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecNotUsedByOuterScope().format({name:t.details.name}),e)}}n?(n.typeParameters&&!n.typeParameters.parameters.some((e=>e.name.value===t.details.name))&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeParameterNotDeclared().format({name:t.details.name,container:n.name.value}),e),t=K.TypeVarType.cloneForScopeId(t,N.getScopeIdForNode(n),n.name.value,28===n.nodeType?1:0)):(0,l.fail)("AssociateTypeVarsWithCurrentScope flag was set but enclosing scope not found")}}else if(0!=(4096&n)&&(void 0===t.scopeId||i.foundInterveningClass)&&!t.details.isSynthesized){let n;n=i.isRescoped?(0,K.isParamSpec)(t)?y.Localizer.Diagnostic.paramSpecScopedToReturnType():y.Localizer.Diagnostic.typeVarScopedToReturnType():(0,K.isParamSpec)(t)?y.Localizer.Diagnostic.paramSpecNotUsedByOuterScope():y.Localizer.Diagnostic.typeVarNotUsedByOuterScope(),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,n.format({name:t.details.name}),e)}}return(0,K.isUnpackedVariadicTypeVar)(t)&&(t=K.TypeVarType.cloneForPacked(t)),t}function bt(e,t,n){var a;if(0!=(2&n))return t;if((0,K.isInstantiableClass)(t)&&(0!=(128&n)&&0==(512&n)&&!t.typeAliasInfo&&(0,W.requiresTypeArguments)(t)&&(t.typeArguments&&t.isTypeArgumentExplicit||ot(T.getFileInfo(e).diagnosticRuleSet.reportMissingTypeArgument,c.DiagnosticRule.reportMissingTypeArgument,y.Localizer.Diagnostic.typeArgsMissingForClass().format({name:t.aliasName||t.details.name}),e)),t.typeArguments||(t=null===(a=ma(t,void 0,n,e))||void 0===a?void 0:a.type)),0!=(128&n)&&t.typeAliasInfo&&t.typeAliasInfo.typeParameters&&t.typeAliasInfo.typeParameters.length>0&&!t.typeAliasInfo.typeArguments){let n=!1;const a=[],i=new q.TypeVarContext(t.typeAliasInfo.typeVarScopeId);t.typeAliasInfo.typeParameters.forEach((e=>{let t;e.details.defaultType||(n=!0),t=e.details.defaultType||e.details.isParamSpec?(0,W.applySolvedTypeVars)(e,i,{unknownIfNotFound:!0}):K.UnknownType.create(),a.push(t),i.setTypeVarType(e,t)})),n&&ot(T.getFileInfo(e).diagnosticRuleSet.reportMissingTypeArgument,c.DiagnosticRule.reportMissingTypeArgument,y.Localizer.Diagnostic.typeArgsMissingForAlias().format({name:t.typeAliasInfo.name}),e),t=K.TypeBase.cloneForTypeAlias((0,W.applySolvedTypeVars)(t,i,{unknownIfNotFound:!0}),t.typeAliasInfo.name,t.typeAliasInfo.fullName,t.typeAliasInfo.typeVarScopeId,t.typeAliasInfo.typeParameters,a)}return t}function _t(e,t,a,i){var r,s,o;let l=t.type;const d=e.memberName.value;let m=new p.DiagnosticAddendum;const g=T.getFileInfo(e);let h,f,v=!!t.isIncomplete;if(t.isIncomplete&&(0,K.isUnbound)(t.type))return{type:K.UnknownType.create(!0),isIncomplete:!0};function b(t){if(Q&&(0,K.isInstantiableClass)(Q))return K.TypeBase.isInstance(t)?Be(e.memberName,K.ClassType.cloneAsInstance(Q),d,a,m):We(e.memberName,Q,d,a,m)}switch((0,K.isUnion)(l)&&K.TypeBase.isSpecialForm(l)&&X&&(l=X),(0,K.isParamSpec)(l)&&l.paramSpecAccess&&(l=mt(l)),l.category){case 2:case 1:case 4:h=l;break;case 10:if(l.details.isParamSpec){if("args"===d){const t=N.getEnclosingParameter(e);return t&&1===t.category?{type:K.TypeVarType.cloneForParamSpecAccess(l,"args"),isIncomplete:v}:(it(y.Localizer.Diagnostic.paramSpecArgsUsage(),e),{type:K.UnknownType.create(v),isIncomplete:v})}if("kwargs"===d){const t=N.getEnclosingParameter(e);return t&&2===t.category?{type:K.TypeVarType.cloneForParamSpecAccess(l,"kwargs"),isIncomplete:v}:(it(y.Localizer.Diagnostic.paramSpecKwargsUsage(),e),{type:K.UnknownType.create(v),isIncomplete:v})}return v||ot(g.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecUnknownMember().format({name:d}),e),{type:K.UnknownType.create(v),isIncomplete:v}}if(256&i)return v||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarNoMember().format({type:ci(l),name:d}),e.leftExpression),{type:K.UnknownType.create(v),isIncomplete:v};if(l.details.recursiveTypeAliasName)return{type:K.UnknownType.create(!0),isIncomplete:!0};if(!l.details.isVariadic)return _t(e,{type:mt(l),bindToType:l,isIncomplete:v},a,0);break;case 7:if(K.TypeBase.isInstantiable(l)){const n=We(e.memberName,l,d,a,m,0,t.bindToType);h=null==n?void 0:n.type,(null==n?void 0:n.isIncomplete)&&(v=!0),(null==n?void 0:n.isAsymmetricAccessor)&&(f=!0)}else{const n=(0,w.getTypeOfEnumMember)(di,e,l,d,v);if(n)return n;const i=Be(e.memberName,l,d,a,m,void 0,t.bindToType);i&&(h=(0,W.addConditionToType)(i.type,(0,W.getTypeCondition)(l))),(null==i?void 0:i.isIncomplete)&&(v=!0),(null==i?void 0:i.isAsymmetricAccessor)&&(f=!0)}break;case 8:{const t=K.ModuleType.getField(l,d);if(t&&!t.isExternallyHidden())"get"===a.method&&ft(T.getFileInfo(e),t,e.memberName),h=Na(t,void 0,!0).type,(0,K.isTypeVar)(h)&&(h=vt(e,h,i)),(0,K.isUnbound)(h)&&(h=K.UnknownType.create(!0)),t.isPrivateMember()&&ot(T.getFileInfo(e).diagnosticRuleSet.reportPrivateUsage,c.DiagnosticRule.reportPrivateUsage,y.Localizer.Diagnostic.privateUsedOutsideOfModule().format({name:d}),e.memberName),t.isPrivatePyTypedImport()&&ot(T.getFileInfo(e).diagnosticRuleSet.reportPrivateImportUsage,c.DiagnosticRule.reportPrivateImportUsage,y.Localizer.Diagnostic.privateImportFromPyTypedModule().format({name:d,module:l.moduleName}),e.memberName);else{if("get"===a.method){const e=K.ModuleType.getField(l,"__getattr__");if(e){if(g.executionEnvironment.pythonVersion>=u.PythonVersion.V3_7||e.getDeclarations().some((e=>e.path.toLowerCase().endsWith(".pyi")))){const t=Na(e);(0,K.isFunction)(t.type)&&(h=za(t.type),t.isIncomplete&&(v=!0))}}}!h&&l.notPresentFieldType&&(h=l.notPresentFieldType),h||(v||ot(g.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.moduleUnknownMember().format({memberName:d,moduleName:l.moduleName}),e.memberName),h=n.evaluateUnknownImportsAsAny?K.AnyType.create():K.UnknownType.create())}break}case 9:h=(0,W.mapSubtypes)(l,(n=>{if((0,K.isNoneInstance)(n)){const t=b(n);return t?(h=(0,W.addConditionToType)(t.type,(0,W.getTypeCondition)(l)),t.isIncomplete&&(v=!0),h):void(v||ot(T.getFileInfo(e).diagnosticRuleSet.reportOptionalMemberAccess,c.DiagnosticRule.reportOptionalMemberAccess,y.Localizer.Diagnostic.noneUnknownMember().format({name:d}),e.memberName))}if(!(0,K.isUnbound)(n)){const i=_t(e,{type:n,isIncomplete:t.isIncomplete},a,0);return i.isIncomplete&&(v=!0),i.type}}));break;case 5:case 6:if("__defaults__"===d)h=K.AnyType.create();else if("__self__"===d){const e=(0,K.isFunction)(l)?l:l.overloads[0];void 0!==e.preBoundFlags&&0==(4&e.preBoundFlags)&&(h=e.boundToType)}else h=te?_t(e,{type:te},a,i).type:K.AnyType.create();break;case 3:{const e=b(l);e&&(h=(0,W.addConditionToType)(e.type,(0,W.getTypeCondition)(l)),e.isIncomplete&&(v=!0));break}default:m.addMessage(y.Localizer.DiagnosticAddendum.typeUnsupported().format({type:ci(l)}))}if(!h){const n=(0,K.isFunction)(l)||(0,K.isOverloadedFunction)(l)||(0,K.isClassInstance)(l)&&K.ClassType.isBuiltIn(l,"function");if(!t.isIncomplete){let t=y.Localizer.Diagnostic.memberAccess();"set"===a.method?t=y.Localizer.Diagnostic.memberSet():"del"===a.method&&(t=y.Localizer.Diagnostic.memberDelete()),a.setExpectedTypeDiag&&(m=a.setExpectedTypeDiag);const[i,s]=n?[g.diagnosticRuleSet.reportFunctionMemberAccess,c.DiagnosticRule.reportFunctionMemberAccess]:[g.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues];ot(i,s,t.format({name:d,type:ci(l)})+m.getString(),e.memberName,null!==(r=m.getEffectiveTextRange())&&void 0!==r?r:e.memberName)}h=n?K.AnyType.create():K.UnknownType.create()}if(0==(2&i)&&(0,K.isInstantiableClass)(h)&&!h.typeArguments&&(h=null===(s=ma(h,void 0,i,e))||void 0===s?void 0:s.type),"get"===a.method){let t=v;if((0,K.isInstantiableClass)(h)){const n=N.getParentNodeOfType(e,1);n&&9===(null===(o=null==n?void 0:n.parent)||void 0===o?void 0:o.nodeType)&&(t=!0)}t||mn(g.diagnosticRuleSet.reportUnknownMemberType,c.DiagnosticRule.reportUnknownMemberType,e.memberName,h,e,!1)}return{type:h,isIncomplete:v,isAsymmetricAccessor:f,isRequired:!1,isNotRequired:!1}}function It(e,t,n,a,i,r,s,o){var p,c;let d=0;1&s&&(d|=8),2&s&&(d|=2),4&s&&(d|=4),256&s&&(d|=32),128&s&&(d|=1);let u=(0,W.lookUpClassMember)(t,a,16|d);if(u||(u=(0,W.lookUpClassMember)(t,a,d)),u){let l,d=!1;if(u.symbol.isInitVar())return void(null==r||r.addMessage(y.Localizer.DiagnosticAddendum.memberIsInitVar().format({name:a})));if("get"!==i.method){const r=N.getEnclosingClass(e);if(r){const e=null===(p=Ln(r))||void 0===p?void 0:p.classType;if(e&&(0,K.isInstantiableClass)(e)&&K.ClassType.isSameGenericClass(e,t)){if(l=null===(c=Fa(u.symbol))||void 0===c?void 0:c.type,l&&(0,K.isInstantiableClass)(u.classType)&&(l=(0,W.partiallySpecializeType)(l,u.classType)),"set"===i.method&&u.symbol.isClassVar()&&n){const e=Ra(u,o||"__new__"===a?void 0:t);e&&(0,W.isDescriptorInstance)(e.type,!0)&&(l=e.type,s&=8)}l||(l=K.UnknownType.create())}}}if(!l){const e=Ra(u,o||"__new__"===a?void 0:t);e?(l=e.type,e.isIncomplete&&(d=!0)):l=K.UnknownType.create()}if((0,K.isClass)(u.classType)&&K.ClassType.isTypedDictClass(u.classType)){const e=u.symbol.getTypedDeclarations();if(e.length>0&&1===e[0].type)return void(null==r||r.addMessage(y.Localizer.DiagnosticAddendum.memberUnknown().format({name:a})))}"get"===i.method&&((0,K.isInstantiableClass)(u.classType)&&K.ClassType.isSameGenericClass(u.classType,t)&&ft(T.getFileInfo(e),u.symbol,e),"__init_subclass__"!==a&&"__class_getitem__"!==a||(0,K.isFunction)(l)&&!K.FunctionType.isClassMethod(l)&&(l=K.FunctionType.cloneWithNewFlags(l,2|l.details.flags)));const m=function(e,t,n,a,i,r,s,o,l,p){const c=0!=(16&r);let d=!0,u=!1;if(e=(0,W.mapSubtypes)(e,(e=>{var m,g,h;const f=mt(e),T=!t||t.isClassMember;if((0,K.isClass)(f)&&T){let e=f,c=!1;if(K.TypeBase.isInstantiable(f)&&(f.details.effectiveMetaclass&&(0,K.isInstantiableClass)(f.details.effectiveMetaclass)&&(i||"get"===l.method)?(e=K.ClassType.cloneAsInstance(f.details.effectiveMetaclass),c=!0):e=void 0),e){let T;T="get"===l.method?"__get__":"set"===l.method?"__set__":"__delete__";const v=(0,W.lookUpClassMember)(e,T,8);if(K.ClassType.isPropertyClass(e))if("set"===l.method){if(!v)return null==p||p.addMessage(y.Localizer.DiagnosticAddendum.propertyMissingSetter().format({name:o})),void(d=!1)}else if("del"===l.method&&!v)return null==p||p.addMessage(y.Localizer.DiagnosticAddendum.propertyMissingDeleter().format({name:o})),void(d=!1);if(v){let o=Va(v);const b=[{argumentCategory:0,typeResult:{type:K.ClassType.isClassProperty(e)?n:i?null!=a?a:K.ClassType.cloneAsInstance(n):K.NoneType.createInstance()}}];if("get"===l.method?b.push({argumentCategory:0,typeResult:{type:n}}):"set"===l.method&&b.push({argumentCategory:0,typeResult:{type:null!==(g=null===(m=l.setType)||void 0===m?void 0:m.type)&&void 0!==g?g:K.UnknownType.create(),isIncomplete:!!(null===(h=l.setType)||void 0===h?void 0:h.isIncomplete)}}),K.ClassType.isPropertyClass(e)&&t&&(0,K.isInstantiableClass)(t.classType)&&(Ea(o),o=(0,W.partiallySpecializeType)(o,t.classType),0!=(1&r)&&K.ClassType.isProtocolClass(n)&&(null==p||p.addMessage(y.Localizer.DiagnosticAddendum.propertyAccessFromProtocolClass()),d=!1)),o&&((0,K.isFunction)(o)||(0,K.isOverloadedFunction)(o))){const a=o,i=ba(s,(()=>{var i;let r;K.ClassType.isPropertyClass(f)&&!c?t&&(0,K.isInstantiableClass)(t.classType)&&(r=t.classType):(0,K.isInstantiableClass)(v.classType)&&(r=v.classType);let o=ti(e,a,r,s,void 0,void 0,c?f:void 0);if(o&&((0,K.isFunction)(o)||(0,K.isOverloadedFunction)(o))){const e=new q.TypeVarContext((0,W.getTypeVarScopeId)(o));if(r){const e=(0,W.partiallySpecializeType)(o,r,n);e&&((0,K.isFunction)(e)||(0,K.isOverloadedFunction)(e))&&(o=e)}const t=jt(s,b,{type:o},e,!0);if(t.argumentErrors){if("set"===l.method)if(l.setType&&(0,K.isFunction)(o)&&o.details.parameters.length>=2&&!l.setType.isIncomplete){const e=K.FunctionType.getEffectiveParameterType(o,1);null==p||p.addMessage(y.Localizer.DiagnosticAddendum.typeIncompatible().format({destType:ci(e),sourceType:ci(l.setType.type)}))}else(0,K.isOverloadedFunction)(o)&&(null==p||p.addMessage(y.Localizer.Diagnostic.noOverload().format({name:T})));return d=!1,K.AnyType.create()}return"get"===l.method?null!==(i=t.returnType)&&void 0!==i?i:K.UnknownType.create():K.AnyType.create()}}));if("set"===l.method&&(0,K.isClass)(v.classType)&&function(e){var t;if(void 0!==e.isAsymmetricDescriptor)return e.isAsymmetricDescriptor;let n=!1;const a=(0,W.lookUpClassMember)(e,"__get__",2),i=(0,W.lookUpClassMember)(e,"__set__",2);if(a&&i){const e=Da(a.symbol),r=Da(i.symbol);if((0,K.isFunction)(e)&&(0,K.isFunction)(r)&&r.details.parameters.length>=3&&e.details.declaredReturnType){const a=K.FunctionType.getEffectiveParameterType(r,2),i=null!==(t=K.FunctionType.getSpecializedReturnType(e))&&void 0!==t?t:K.UnknownType.create();(0,K.isTypeSame)(a,i)||(n=!0)}}else n=!1;return e.isAsymmetricDescriptor=n,n}(v.classType)&&(u=!0),i)return i}}}}else if((0,K.isFunction)(f)||(0,K.isOverloadedFunction)(f)){if("set"===l.method){let e=!1;if((0,K.isFunction)(f))e=K.FunctionType.isFinal(f);else{const t=K.OverloadedFunctionType.getImplementation(f);t&&(e=K.FunctionType.isFinal(t))}if(e&&t&&(0,K.isClass)(t.classType))return null==p||p.addMessage(y.Localizer.Diagnostic.finalMethodOverride().format({name:o,className:t.classType.details.name})),void(d=!1)}if(!i||t&&!t.isInstanceMember){let e=a;if(a&&!(0,W.isInstantiableMetaclass)(n)){const t=(0,K.isFunction)(f)?f:f.overloads[0];K.FunctionType.isInstanceMethod(t)&&!K.TypeBase.isInstance(a)&&(e=(0,W.convertToInstance)(a))}return ti(i?K.ClassType.cloneAsInstance(n):n,f,t&&(0,K.isInstantiableClass)(t.classType)?t.classType:void 0,s,void 0,c,e)}}if("set"===l.method){if((null==t?void 0:t.symbol.isClassVar())&&8&r)return null==p||p.addMessage(y.Localizer.DiagnosticAddendum.memberSetClassVar().format({name:o})),void(d=!1);const n=null==t?void 0:t.symbol.getDeclarations().find((e=>ii(e)));if(n&&!N.isNodeContainedWithin(s,n.node)){const e=N.getEnclosingFunction(s);if(!e||"__init__"!==e.name.value)return null==p||p.addMessage(y.Localizer.Diagnostic.finalReassigned().format({name:o})),void(d=!1)}if((null==t?void 0:t.isInstanceMember)&&(0,K.isClass)(t.classType)&&K.ClassType.isReadOnlyInstanceVariables(t.classType))return null==p||p.addMessage(y.Localizer.DiagnosticAddendum.readOnlyAttribute().format({name:o})),void(d=!1);let a=!1;if((t&&t.symbol.hasTypedDeclarations()||t&&!t.symbol.getDeclarations().some((e=>e.node===s)))&&(a=!0),a){let n=e;return i&&!t.isInstanceMember&&(0,K.isFunction)(f)&&(K.FunctionType.isClassMethod(f)||K.FunctionType.isInstanceMethod(f))&&(n=K.FunctionType.clone(f,!0)),n}}return e})),!d)return;return{type:e,isAsymmetricAccessor:u}}(l,u,t,o,n,s,e,a,i,r);if(!m)return;if(l=m.type,"set"===i.method&&i.setType){if(!Wa(l,i.setType.type,null==r?void 0:r.createAddendum()))return void(i.setType.isIncomplete||null==r||r.addMessage(y.Localizer.DiagnosticAddendum.memberAssignment().format({type:ci(i.setType.type),name:a,classType:li(t)})));if((0,K.isInstantiableClass)(u.classType)&&K.ClassType.isFrozenDataClass(u.classType)&&n)return void(null==r||r.addMessage(y.Localizer.DiagnosticAddendum.dataClassFrozen().format({name:ci(K.ClassType.cloneAsInstance(u.classType))})))}return{symbol:u.symbol,type:l,isTypeIncomplete:d,isClassMember:!u.isInstanceMember,isClassVar:u.isClassVar,classType:u.classType,isAsymmetricAccessor:m.isAsymmetricAccessor}}if(0==(65&s)){const n=function(e,t,n,a){var i,r,s,o,p;const c=n=>{var a;return null===(a=We(t,e,n,{method:"get"},void 0,68))||void 0===a?void 0:a.type};let d;"get"===n.method?d=null!==(i=c("__getattribute__"))&&void 0!==i?i:c("__getattr__"):"set"===n.method?d=c("__setattr__"):((0,l.assert)("del"===n.method),d=c("__delattr__"));if(d){let i=K.AnyType.create();re&&(0,K.isInstantiableClass)(re)&&(i=K.ClassType.cloneWithLiteral(K.ClassType.cloneAsInstance(re),a));const l=[{argumentCategory:0,typeResult:{type:K.ClassType.cloneAsInstance(e)}},{argumentCategory:0,typeResult:{type:i}}];if("set"===n.method&&l.push({argumentCategory:0,typeResult:{type:null!==(s=null===(r=n.setType)||void 0===r?void 0:r.type)&&void 0!==s?s:K.UnknownType.create(),isIncomplete:!!(null===(o=n.setType)||void 0===o?void 0:o.isIncomplete)}}),(0,K.isFunction)(d)||(0,K.isOverloadedFunction)(d)){const a=ti(e,d,e,t);if(a&&((0,K.isFunction)(a)||(0,K.isOverloadedFunction)(a))){const i=new q.TypeVarContext((0,W.getTypeVarScopeId)(a)),r=jt(t,l,{type:a},i,!0);let s=!1;return"set"===n.method&&(s=function(e){var t;if(void 0!==e.isAsymmetricAttributeAccessor)return e.isAsymmetricAttributeAccessor;let n=!1;const a=(0,W.lookUpClassMember)(e,"__getattr__",2),i=(0,W.lookUpClassMember)(e,"__setattr__",2);if(a&&i){const e=Da(a.symbol),r=Da(i.symbol);if((0,K.isFunction)(e)&&(0,K.isFunction)(r)&&r.details.parameters.length>=3&&e.details.declaredReturnType){const a=K.FunctionType.getEffectiveParameterType(r,2),i=null!==(t=K.FunctionType.getSpecializedReturnType(e))&&void 0!==t?t:K.UnknownType.create();(0,K.isTypeSame)(a,i)||(n=!0)}}else n=!1;return e.isAsymmetricAttributeAccessor=n,n}(e)),{type:null!==(p=r.returnType)&&void 0!==p?p:K.UnknownType.create(),isAsymmetricAccessor:s}}}}return}(t,e,i,a);if(n)return{symbol:void 0,type:n.type,isTypeIncomplete:!1,isClassMember:!1,isClassVar:!1,isAsymmetricAccessor:n.isAsymmetricAccessor}}null==r||r.addMessage(y.Localizer.DiagnosticAddendum.memberUnknown().format({name:a}))}function Ct(e,t,n){const a=t.findIndex((e=>(0,K.isVariadicTypeVar)(e)));if(a>=0){const i=t[a];if(ne&&(0,K.isInstantiableClass)(ne))if(a<e.length){const n=e.slice(a,a+1+e.length-t.length);if(1===n.length&&(0,K.isVariadicTypeVar)(n[0].type))kt(n[0].type,n[0].node);else{n.forEach(((e,t)=>{hn(e,{allowEmptyTuple:0===t,allowVariadicTypeVar:!0,allowUnpackedTuples:!0})}));const i=[];1===n.length&&n[0].isEmptyTupleShorthand||n.forEach((e=>{(0,K.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?(0,o.appendArray)(i,e.type.tupleTypeArguments):i.push({type:(0,W.convertToInstance)(e.type),isUnbounded:!1})}));const r=(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,i,!0,!0));e=[...e.slice(0,a),{node:e[a].node,type:r},...e.slice(a+1+e.length-t.length,e.length)]}}else i.details.defaultType||e.push({node:n,type:(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,[],!0,!0))})}return e}function kt(e,t){return!!e.isVariadicUnpacked||(it(y.Localizer.Diagnostic.unpackedTypeVarTupleExpected().format({name1:e.details.name,name2:e.details.name}),t),!1)}function St(e,t,n){var a,i,r;if(!(null===(a=t.typeAliasInfo)||void 0===a?void 0:a.typeParameters)||0===t.typeAliasInfo.typeParameters.length&&t.typeAliasInfo.typeArguments)return;if(!K.TypeBase.isInstantiable(t))return;if(t.typeAliasInfo.typeArguments)return;const s=t.typeAliasInfo.typeParameters;let o=Ct(Nt(e,n),s,e);if(1===s.length&&s[0].details.isParamSpec&&o&&o.every((e=>!(0,W.isEllipsisType)(e.type)&&!e.typeList&&!(0,K.isParamSpec)(e.type)))&&(o=[{type:K.UnknownType.create(),node:o[0].node,typeList:o}]),!s.some((e=>e.details.isVariadic&&!e.isVariadicInUnion))){let n=s.length;const a=s.findIndex((e=>!!e.details.defaultType));a>=0&&(n=a),o.length>s.length?it(y.Localizer.Diagnostic.typeArgsTooMany().format({name:ci(t),expected:s.length,received:o.length}),o[s.length].node):o.length<n&&it(y.Localizer.Diagnostic.typeArgsTooFew().format({name:ci(t),expected:s.length,received:o.length}),e.items[e.items.length-1])}if((0,K.isInstantiableClass)(t)&&"mypy_extensions.FlexibleAlias"===t.details.fullName&&o.length>=1)return{node:e,type:o[0].type};const l=new q.TypeVarContext(t.typeAliasInfo.typeVarScopeId),c=new p.DiagnosticAddendum;s.forEach(((e,a)=>{if(e.details.isParamSpec&&a<o.length){const t=o[a].type;if(o[a].typeList){const t=K.FunctionType.createSynthesizedInstance("",65536);K.TypeBase.setSpecialForm(t),o[a].typeList.forEach(((e,n)=>{K.FunctionType.addParameter(t,{category:0,name:`__p${n}`,isNameSynthesized:!0,type:(0,W.convertToInstance)(e.type),hasDeclaredType:!0})})),(0,_.assignTypeToTypeVar)(di,e,t,c,l,128)}else if((0,K.isParamSpec)(t))(0,_.assignTypeToTypeVar)(di,e,(0,W.convertToInstance)(t),c,l,128);else if((0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"Concatenate")){const n=t.typeArguments,a=K.FunctionType.createInstance("","","",0);n&&n.length>0&&n.forEach(((e,t)=>{t===n.length-1?(K.FunctionType.addParameter(a,{category:0,isNameSynthesized:!1,type:K.UnknownType.create()}),(0,K.isParamSpec)(e)&&(a.details.paramSpec=e)):K.FunctionType.addParameter(a,{category:0,name:`__p${t}`,isNameSynthesized:!0,hasDeclaredType:!0,type:e})})),(0,_.assignTypeToTypeVar)(di,e,a,c,l,128)}else if((0,W.isEllipsisType)(t)){const t=K.FunctionType.createSynthesizedInstance("",98304);K.TypeBase.setSpecialForm(t),K.FunctionType.addDefaultParameters(t),(0,_.assignTypeToTypeVar)(di,e,t,c,l)}else it(y.Localizer.Diagnostic.typeArgListExpected(),o[a].node)}else{let i;if(a<o.length&&o[a].typeList&&it(y.Localizer.Diagnostic.typeArgListNotAllowed(),o[a].node),i=a<o.length?(0,W.convertToInstance)(o[a].type):e.details.defaultType?(0,W.applySolvedTypeVars)(e,l,{unknownIfNotFound:!0}):K.UnknownType.create(),0!=(16384&n)){const e=function(e){if(!e.typeAliasInfo||!e.typeAliasInfo.typeParameters)return;if(e.typeAliasInfo.usageVariance)return e.typeAliasInfo.usageVariance;const t=e.typeAliasInfo.typeParameters,n=t.map((()=>1));return e.typeAliasInfo.usageVariance=n,At(e,t,n),n}(t);if(e&&a<e.length){const t=e[a];if(!(0,W.isVarianceOfTypeArgumentCompatible)(i,t)){const e=c.createAddendum();e.addMessage(y.Localizer.DiagnosticAddendum.varianceMismatchForTypeAlias().format({typeVarName:ci(i),typeAliasParam:ci(s[a])})),e.addTextRange(o[a].node)}}}(0,_.assignTypeToTypeVar)(di,e,i,c,l,128)}})),c.isEmpty()||it(y.Localizer.Diagnostic.typeNotSpecializable().format({type:ci(t)})+c.getString(),e,null!==(i=c.getEffectiveTextRange())&&void 0!==i?i:e);const d=l.getPrimarySignature(),u=[];null===(r=t.typeAliasInfo.typeParameters)||void 0===r||r.forEach((e=>{let t;if((0,K.isParamSpec)(e)){const n=d.getParamSpecType(e);t=n?(0,W.convertParamSpecValueToType)(n):K.UnknownType.create()}else t=d.getTypeVarType(e);u.push(t||K.UnknownType.create())}));return{type:K.TypeBase.cloneForTypeAlias((0,W.applySolvedTypeVars)(t,l),t.typeAliasInfo.name,t.typeAliasInfo.fullName,t.typeAliasInfo.typeVarScopeId,t.typeAliasInfo.typeParameters,u),node:e}}function wt(e,t,n,a){const i=St(e,t.type,a);if(i)return i;if((0,K.isTypeVar)(t.type)&&(0,W.isTypeAliasPlaceholder)(t.type)){const n=Nt(e,a).map((e=>(0,W.convertToInstance)(e.type)));return{type:K.TypeBase.cloneForTypeAlias(t.type,t.type.details.recursiveTypeAliasName,"",t.type.details.recursiveTypeAliasScopeId,t.type.details.recursiveTypeParameters,n)}}let r=t.isIncomplete,s=!1,o=!1,l=!1;const p=yt(t.type,void 0,((t,i)=>{var p;if((0,K.isAnyOrUnknown)(t))return t;if(128&a&&(0,K.isTypeVar)(i))return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarNotSubscriptable().format({type:ci(i)}),e.baseExpression),Nt(e,a),K.UnknownType.create();if((0,K.isInstantiableClass)(t)){if(t.details.effectiveMetaclass&&(0,K.isInstantiableClass)(t.details.effectiveMetaclass)&&!K.ClassType.isBuiltIn(t.details.effectiveMetaclass,["type","_InitVarMeta"])&&0==(128&a)){const i=We(e,t,Pt(n),void 0,void 0,96);if(256&a&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsExpectingNone().format({name:ci(K.ClassType.cloneAsInstance(t))}),e),i)return Dt(e,t,n).type}if("set"===n.method?ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.genericClassAssigned(),e.baseExpression):"del"===n.method&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.genericClassDeleted(),e.baseExpression),K.ClassType.isSpecialBuiltIn(t,"Literal"))return function(e,t){if(0===e.items.length)return it(y.Localizer.Diagnostic.literalEmptyArgs(),e.baseExpression),K.UnknownType.create();const n=[];for(const t of e.items){let a;const i=t.valueExpression;if(0!==t.argumentCategory)it(y.Localizer.Diagnostic.unpackedArgInTypeArgument(),i),a=K.UnknownType.create();else if(t.name)it(y.Localizer.Diagnostic.keywordArgInTypeArgument(),i),a=K.UnknownType.create();else if(48===i.nodeType){const t=0!=(32&i.strings[0].token.flags),n=i.strings.map((e=>e.value)).join("");a=bn(e,t?"bytes":"str",n)}else 40===i.nodeType?!i.isImaginary&&i.isInteger&&(a=bn(e,"int",i.value)):11===i.nodeType?33===i.constType?a=bn(e,"bool",!0):15===i.constType?a=bn(e,"bool",!1):26===i.constType&&(a=K.NoneType.createType()):55===i.nodeType&&33===i.operator&&40===i.expression.nodeType&&!i.expression.isImaginary&&i.expression.isInteger&&(a=bn(e,"int",-i.expression.value));if(!a){const e=Me(i);if((0,K.isClassInstance)(e.type)&&K.ClassType.isEnumClass(e.type)&&void 0!==e.type.literalValue)a=K.ClassType.cloneAsInstantiable(e.type);else{let t=!0;(0,W.doForEachSubtype)(e.type,(e=>{(0,K.isInstantiableClass)(e)&&void 0!==e.literalValue||(0,K.isNoneTypeClass)(e)||(t=!1)})),t&&(a=e.type)}}a||(it(y.Localizer.Diagnostic.literalUnsupportedType(),t),a=K.UnknownType.create()),n.push(a)}return(0,K.combineTypes)(n)}(e);if(K.ClassType.isBuiltIn(t,"InitVar")){const t=Nt(e,a);return 1===t.length?t[0].type:(it(y.Localizer.Diagnostic.typeArgsMismatchOne().format({received:t.length}),e.baseExpression),K.UnknownType.create())}if(K.ClassType.isEnumClass(t))return K.ClassType.cloneAsInstance(t);const i=(0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"Annotated"),r=(0,K.isInstantiableClass)(t)&&K.ClassType.hasCustomClassGetItem(t),d=(null===(p=t.details.typeParameters)||void 0===p?void 0:p.length)>0||K.ClassType.isSpecialBuiltIn(t)||K.ClassType.isBuiltIn(t,"type")||K.ClassType.isPartiallyEvaluated(t),u=(0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"Final"),m=(0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"ClassVar"),g=T.getFileInfo(e).diagnosticRuleSet.enableExperimentalFeatures&&(0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"dict")&&!t.aliasName;let h=Nt(e,a,{isAnnotatedClass:i,hasCustomClassGetItem:r||!d,isFinalAnnotation:u,isClassVarAnnotation:m,supportsTypedDictTypeArg:g});if(i||(h=Ct(h,t.details.typeParameters,e)),r)return t;if(t.typeArguments)return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.classAlreadySpecialized().format({type:ci((0,W.convertToInstance)(t),{expandTypeAlias:!0})}),e.baseExpression),t;const f=ma(t,h,a,e);return f.isRequired?s=!0:f.isNotRequired&&(o=!0),f.isReadOnly&&(l=!0),f.type}if((0,K.isClassInstance)(t)){const a=Dt(e,t,n);return a.isIncomplete&&(r=!0),a.type}if((0,K.isNever)(t)||(0,K.isUnbound)(t))return K.NeverType.createNever();if((0,K.isNoneInstance)(t)&&!r)return ot(T.getFileInfo(e).diagnosticRuleSet.reportOptionalSubscript,c.DiagnosticRule.reportOptionalSubscript,y.Localizer.Diagnostic.noneNotSubscriptable(),e.baseExpression),K.UnknownType.create();if(!r){ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotSubscriptable().format({type:ci(t)}),e.baseExpression)}return K.UnknownType.create()}));return t.isIncomplete||e.items.forEach((e=>{Ie(e.valueExpression)||Me(e.valueExpression,4&a)})),{type:p,isIncomplete:r,isReadOnly:l,isRequired:s,isNotRequired:o}}function At(e,t,n,a=0){function i(e,i){(0,W.doForEachSubtype)(e,(e=>{const r=t.findIndex((t=>(0,K.isTypeSame)(t,e)));r>=0?n[r]=(0,W.combineVariances)(n[r],i):At(e,t,n,a)}))}a>K.maxTypeRecursionCount||(a++,(0,W.doForEachSubtype)(e,(e=>{if(5===e.category){if(e.specializedTypes){e.specializedTypes.parameterTypes.forEach((e=>{i(e,4)}));const t=e.specializedTypes.returnType;t&&i(t,3)}}else 7===e.category&&e.typeArguments&&(jn(e),e.typeArguments.forEach(((t,n)=>{var a;if((0,W.isTupleClass)(e))i(t,3);else if(n<e.details.typeParameters.length){const r=e.details.typeParameters[n];(0,K.isUnpackedClass)(t)&&t.tupleTypeArguments?t.tupleTypeArguments.forEach((e=>{i(e.type,2)})):i(t,null!==(a=r.computedVariance)&&void 0!==a?a:r.details.declaredVariance)}})))})))}function xt(e,t=!1){return ne&&(0,K.isInstantiableClass)(ne)?(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,e.map((e=>({type:e,isUnbounded:t}))))):K.UnknownType.create()}function Pt(e){return"get"===e.method?"__getitem__":"set"===e.method?"__setitem__":((0,l.assert)("del"===e.method),"__delitem__")}function Dt(e,t,n){var a,i,r,s,o,l;if((0,K.isClassInstance)(t)&&K.ClassType.isTypedDictClass(t)){const a=(0,G.getTypeOfIndexedTypedDict)(di,e,t,n);if(a)return a}const p=Pt(n),d=(0,K.isClassInstance)(t)?null===(a=Be(e,t,p,void 0,void 0,64))||void 0===a?void 0:a.type:null===(i=We(e,t,p,void 0,void 0,96))||void 0===i?void 0:i.type;if(!d){return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.methodNotDefinedOnType().format({name:p,type:ci(t)}),e.baseExpression),{type:K.UnknownType.create()}}if(1===e.items.length&&!e.trailingComma&&!e.items[0].name&&0===e.items[0].argumentCategory&&(0,K.isClassInstance)(t)){const n=e.items[0].valueExpression,a=Me(n).type;if((0,K.isClassInstance)(a)&&K.ClassType.isBuiltIn(a,"int")&&(0,W.isLiteralType)(a)&&"number"==typeof a.literalValue){const e=a.literalValue,n=(0,W.getSpecializedTupleType)(t);if(n&&n.tupleTypeArguments&&!(0,W.isUnboundedTupleClass)(n)){if(e>=0&&e<n.tupleTypeArguments.length)return{type:n.tupleTypeArguments[e].type};if(e<0&&n.tupleTypeArguments.length+e>=0)return{type:n.tupleTypeArguments[n.tupleTypeArguments.length+e].type}}}else if((0,K.isClassInstance)(a)&&K.ClassType.isBuiltIn(a,"slice")){const e=(0,W.getSpecializedTupleType)(t);if(e&&e.tupleTypeArguments&&!(0,W.isUnboundedTupleClass)(e)&&46===n.nodeType&&!n.stepValue){const t=(t,n)=>{let a=n;if(t){const n=Me(t).type;(0,K.isClassInstance)(n)&&K.ClassType.isBuiltIn(n,"int")&&(0,W.isLiteralType)(n)&&"number"==typeof n.literalValue?(a=n.literalValue,a<0&&(a=e.tupleTypeArguments.length+a)):a=-1}return a},a=t(n.startValue,0),i=t(n.endValue,e.tupleTypeArguments.length);if(a>=0&&i>0&&i<=e.tupleTypeArguments.length&&ne&&(0,K.isInstantiableClass)(ne))return{type:K.ClassType.cloneAsInstance((0,W.specializeTupleClass)(ne,e.tupleTypeArguments.slice(a,i)))}}}}const u=e.items.filter((e=>0===e.argumentCategory&&!e.name)),m=e.items.filter((e=>1===e.argumentCategory)),g=e.items.filter((e=>0===e.argumentCategory&&!!e.name)),h=e.items.filter((e=>2===e.argumentCategory));let f,v=!1;if(1!==u.length||0!==m.length||e.trailingComma)if(0===u.length&&0===m.length)f=ne&&(0,K.isInstantiableClass)(ne)?(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,[])):K.UnknownType.create();else{const e=[];u.forEach((t=>{const n=Me(t.valueExpression);e.push(n.type),n.isIncomplete&&(v=!0)})),m.forEach((t=>{var n,a;const i=Me(t.valueExpression);i.isIncomplete&&(v=!0);const r=null!==(a=null===(n=He(i,!1,t.valueExpression))||void 0===n?void 0:n.type)&&void 0!==a?a:K.UnknownType.create();e.push(r)})),f=xt(e,m.length>0)}else{const e=Me(u[0].valueExpression);f=e.type,e.isIncomplete&&(v=!0)}let b,_=[{argumentCategory:0,typeResult:{type:f,isIncomplete:v}}];if("set"===n.method){let e=null!==(s=null===(r=n.setType)||void 0===r?void 0:r.type)&&void 0!==s?s:K.AnyType.create();if((0,K.isTypeVar)(e)&&e.details.constraints.length>0){e=mt(e,void 0,(0,K.isClassInstance)(t)?t.condition:void 0)}_.push({argumentCategory:0,typeResult:{type:e,isIncomplete:!!(null===(o=n.setType)||void 0===o?void 0:o.isIncomplete)}})}return g.forEach((e=>{_.push({argumentCategory:0,valueExpression:e.valueExpression,node:e,name:e.name})})),h.forEach((e=>{_.push({argumentCategory:2,valueExpression:e.valueExpression,node:e})})),0===g.length&&0===h.length&&1===u.length&&_a(e,(()=>{if(b=jt(e,_,{type:d}),b.argumentErrors&&(0,K.isClassInstance)(f)){const t=[..._];t[0]={...t[0]};if(Be(e,f,"__index__")){const n=Ta(e,"int");(0,K.isClassInstance)(n)&&(t[0].typeResult={type:n})}b=jt(e,t,{type:d}),b.argumentErrors||(_=t)}})),b=jt(e,_,{type:d}),{type:null!==(l=b.returnType)&&void 0!==l?l:K.UnknownType.create(),isIncomplete:!!b.isTypeIncomplete}}function Nt(e,t,n){const a=[];let i=t;(null==n?void 0:n.isFinalAnnotation)||(null==n?void 0:n.isClassVarAnnotation)?i|=131088:(i&=-1065059,(null==n?void 0:n.isAnnotatedClass)||(i|=131088),i|=2097152);const r=(t,a)=>{let r;return(null==n?void 0:n.hasCustomClassGetItem)?(i=131170,r={...Me(t,i),node:t}):(null==n?void 0:n.isAnnotatedClass)&&a>0?(i=131170,(0,f.isAnnotationEvaluationPostponed)(T.getFileInfo(e))&&(i|=4),r={...Me(t,i),node:t}):r=function(e,t,n){let a,i=137|t;const r=T.getFileInfo(e);r.isStubFile&&(i|=4);if(31===e.nodeType)a={type:K.UnknownType.create(),typeList:e.entries.map((e=>({...Me(e,i),node:e}))),node:e},Se(e,K.UnknownType.create());else if(15===e.nodeType&&n){const t=oe&&(0,K.isInstantiableClass)(oe)?(0,G.createTypedDictTypeInlined)(di,e,oe):void 0;a={type:re&&(0,K.isInstantiableClass)(re)?re:K.UnknownType.create(),inlinedTypeDict:t,node:e}}else a={...Me(e,i),node:e},15===e.nodeType&&it(y.Localizer.Diagnostic.dictInAnnotation(),e),(0,K.isClass)(a.type)&&K.ClassType.isBuiltIn(a.type,"Protocol")&&it(y.Localizer.Diagnostic.protocolNotAllowedInTypeArgument(),e),0!=(131072&t)&&(0,K.isClass)(a.type)&&K.ClassType.isBuiltIn(a.type,"ClassVar")&&it(y.Localizer.Diagnostic.classVarNotAllowed(),e);return a}(t,i,!!(null==n?void 0:n.supportsTypedDictTypeArg)&&0===a),r};return 1===e.items.length&&!e.trailingComma&&!e.items[0].name&&52===e.items[0].valueExpression.nodeType&&e.items[0].valueExpression.expressions.length>0?(e.items[0].valueExpression.expressions.forEach(((e,t)=>{a.push(r(e,t))})),Se(e.items[0].valueExpression,K.UnknownType.create())):e.items.forEach(((e,t)=>{const n=r(e.valueExpression,t);0!==e.argumentCategory&&1===e.argumentCategory&&((0,K.isVariadicTypeVar)(n.type)&&!n.type.isVariadicUnpacked?n.type=K.TypeVarType.cloneForUnpacked(n.type):(0,K.isInstantiableClass)(n.type)&&!n.type.includeSubclasses&&(0,W.isTupleClass)(n.type)&&(n.type=K.ClassType.cloneForUnpacked(n.type))),e.name&&it(y.Localizer.Diagnostic.keywordArgInTypeArgument(),e.valueExpression),a.push(n)})),a}function Ft(e,t){if(t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType),!(0,K.isClassInstance)(t.expectedType))return;if(!ne||!(0,K.isInstantiableClass)(ne))return;let n=[];if((0,W.isTupleClass)(t.expectedType)&&t.expectedType.tupleTypeArguments){n=t.expectedType.tupleTypeArguments.map((e=>(0,W.transformPossibleRecursiveTypeAlias)(e.type)));const a=t.expectedType.tupleTypeArguments.findIndex((e=>e.isUnbounded));if(a>=0)if(n.length>e.expressions.length)n.splice(a,1);else for(;n.length<e.expressions.length;)n.splice(a,0,n[a])}else{const a=new q.TypeVarContext((0,W.getTypeVarScopeId)(ne));if(!(0,_.populateTypeVarContextBasedOnExpectedType)(di,K.ClassType.cloneAsInstance(ne),t.expectedType,a,N.getTypeVarScopesForNode(e),e.start))return;const i=(0,W.applySolvedTypeVars)(ne,a);if(!i.typeArguments||1!==i.typeArguments.length)return;const r=(0,W.transformPossibleRecursiveTypeAlias)(i.typeArguments[0]);for(let t=0;t<e.expressions.length;t++)n.push(r)}const a=e.expressions.map(((e,a)=>Me(e,void 0,(0,W.makeInferenceContext)(a<n.length?n[a]:void 0,t.isTypeIncomplete,t.signatureTracker)))),i=a.some((e=>e.isIncomplete)),r=(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,Et(a),!0));let s;return a.some((e=>e.expectedTypeDiagAddendum))&&(s=new p.DiagnosticAddendum,a.forEach((e=>{e.expectedTypeDiagAddendum&&s.addAddendum(e.expectedTypeDiagAddendum)}))),{type:r,expectedTypeDiagAddendum:s,isIncomplete:i}}function Et(e){const t=[];for(const n of e){let e;if(n.unpackedType?e=n.unpackedType:(0,K.isUnpacked)(n.type)&&(e=n.type),e&&(0,K.isClassInstance)(e)&&e.tupleTypeArguments){const n=e.tupleTypeArguments;n?(0,o.appendArray)(t,n):t.push({type:K.UnknownType.create(),isUnbounded:!0})}else(0,K.isNever)(n.type)&&n.isIncomplete&&!n.unpackedType?t.push({type:K.UnknownType.create(!0),isUnbounded:!1}):t.push({type:n.type,isUnbounded:!!n.unpackedType})}if(t.filter((e=>e.isUnbounded)).length>1){const e=t.findIndex((e=>e.isUnbounded)),n=t.splice(e);t.push({type:(0,K.combineTypes)(n.map((e=>e.type))),isUnbounded:!0})}return t}function zt(e,t){let n,a,i,r,s;if(e.arguments.forEach(((e,t)=>{if(0===t)0!==e.argumentCategory||e.name||(n=e.valueExpression);else if(0===e.argumentCategory&&e.name)if("expected_text"===e.name.value){r=e.valueExpression;const t=Me(e.valueExpression).type;(0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"str")&&"string"==typeof t.literalValue?s=t.literalValue:it(y.Localizer.Diagnostic.revealTypeExpectedTextArg(),e.valueExpression)}else"expected_type"===e.name.value&&(a=e.valueExpression,i=(0,W.convertToInstance)(ga(e).type));else n=void 0})),!n)return it(y.Localizer.Diagnostic.revealTypeArgs(),e),{type:K.UnknownType.create()};const o=Me(n,void 0,t),l=o.type,p=N.printExpression(n),c=ci(l,{expandTypeAlias:!0});if(void 0!==s&&s!==c&&it(y.Localizer.Diagnostic.revealTypeExpectedTextMismatch().format({expected:s,received:c}),null!=r?r:n),i&&!(0,K.isTypeSame)(i,l,{ignorePseudoGeneric:!0})){const e=ci(i);it(y.Localizer.Diagnostic.revealTypeExpectedTypeMismatch().format({expected:e,received:c}),null!=a?a:n)}return at(y.Localizer.DiagnosticAddendum.typeOfSymbol().format({name:p,type:c}),e.arguments[0]),{type:l,isIncomplete:o.isIncomplete}}function Mt(e,t,n,a,i,r){var s,o;const l=[],p=[];let c=!1,d=[],u=!1;for(let i=0;i<t.length;i++){let m;const y=t[i],g=y.some((e=>void 0!==e));let h=[],f=!1;u=!1;for(let t=0;t<n.length;t++){const i=n[t].overload;let T=n[t];g&&(T={...n[t]},T.argParams=T.argParams.map(((e,t)=>{if(!y[t])return e;const n={...e};return n.argType=y[t],n})));const v=p.length>0?p[p.length-1].typeVarContext.clone():a,b=null!==(s=null==v?void 0:v.clone())&&void 0!==s?s:new q.TypeVarContext((0,W.getTypeVarScopeId)(i));b.addSolveForScope((0,W.getTypeVarScopeIds)(i)),b.unlock();const _=_a(e,(()=>Gt(e,T,b,!0,r)));if(_.isTypeIncomplete&&(c=!0),!_.argumentErrors&&_.returnType){d.push(i),m=i;const e={overload:m,matchResults:T,typeVarContext:b,returnType:_.returnType,argResults:null!==(o=_.argResults)&&void 0!==o?o:[]};if(p.push(e),!_.anyOrUnknownArgument){l.push(_.returnType),u=!0;break}h.push(e),(0,W.isIncompleteUnknown)(_.anyOrUnknownArgument)&&(f=!0)}}if(!u&&h.length>0)if(h=Ot(h),1===h.length)d=[h[0].overload],l.push(h[0].returnType);else{let e=[],t=!1;h.forEach((n=>{let a=!1;for(let i=0;i<e.length;i++){if(Wa(e[i],n.returnType)){const n=(0,W.containsAnyOrUnknown)(e[i],!1);n?(0,K.isAny)(n)&&(t=!0):a=!0;break}if(Wa(n.returnType,e[i])){const a=(0,W.containsAnyOrUnknown)(n.returnType,!1);a?(0,K.isAny)(a)&&(t=!0):e[i]=K.NeverType.createNever();break}}a||e.push(n.returnType)})),e=e.filter((e=>!(0,K.isNever)(e)));const n=(0,K.combineTypes)(e);let a=n;e.length>1&&(a=t?K.AnyType.create():K.UnknownType.createPossibleType(n,f)),l.push(a)}if(!m)return{argumentErrors:!0,isTypeIncomplete:c,overloadsUsedForCall:d}}a&&u&&a.copyFromClone(p[p.length-1].typeVarContext);const m=null!=a?a:p[0].typeVarContext;m.unlock(),m.addSolveForScope((0,W.getTypeVarScopeId)(p[0].overload));const y=Gt(e,p[0].matchResults,m,i,r);return y.isTypeIncomplete&&(c=!0),{argumentErrors:y.argumentErrors,anyOrUnknownArgument:y.anyOrUnknownArgument,returnType:(0,K.combineTypes)(l),isTypeIncomplete:c,specializedInitSelfType:y.specializedInitSelfType,overloadsUsedForCall:d}}function Ot(e){if(e.length<2)return e;if(e[0].matchResults.relevance!==e[e.length-1].matchResults.relevance&&(e=e.filter((t=>t.matchResults.relevance===e[0].matchResults.relevance))).length<2)return e;if((0,W.areTypesSame)(e.map((e=>e.returnType)),{treatAnySameAsUnknown:!0}))return[e[0]];const t=e[0].argResults;if(!t)return e;let n=!1;for(let a=0;a<t.length;a++)if((0,K.isAnyOrUnknown)(t[a].argType)){const t=e.map((e=>a<e.matchResults.argParams.length?e.matchResults.argParams[a].paramType:K.UnknownType.create()));(0,W.areTypesSame)(t,{treatAnySameAsUnknown:!0})||(n=!0)}return n||e.some((e=>e.argResults.length!==t.length))?e:[e[0]]}function Vt(e,t,n){let a=0,i=[];const r=new W.UniqueSignatureTracker;let s;return K.OverloadedFunctionType.getOverloads(t.type).forEach((r=>{_a(e,(()=>{const s=qt(e,n,{type:r,isIncomplete:t.isIncomplete},a);s.argumentErrors||i.push(s),a++}))})),i=Rt(i),i.forEach(((t,n)=>{void 0===s&&_a(e,(()=>{const a=Kt(e,t,new q.TypeVarContext((0,W.getTypeVarScopeId)(t.overload)),r,!0);a&&!a.argumentErrors&&(s=n)}))})),void 0===s?void 0:i[s].overload}function Rt(e){return e.sort(((e,t)=>e.relevance!==t.relevance?t.relevance-e.relevance:e.overloadIndex-t.overloadIndex))}function Lt(e,t,n,a,i,r){let s,o=[];if(_a(e,(()=>{let a=0;K.OverloadedFunctionType.getOverloads(n.type).forEach((i=>{const r=qt(e,t,{type:i,isIncomplete:n.isIncomplete},a);r.argumentErrors||o.push(r),a++}))})),o=Rt(o),0===o.length){if(!st(e)){const a=n.type.overloads[0].details.name||"<anonymous function>",i=new p.DiagnosticAddendum,r=t.map((e=>ci(ya(e).type)));i.addMessage(y.Localizer.DiagnosticAddendum.argumentTypes().format({types:r.join(", ")})),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.noOverload().format({name:a})+i.getString(),e)}return{argumentErrors:!0,isTypeIncomplete:!1,overloadsUsedForCall:[]}}function l(t){const n=o.reduce(((e,t)=>t.argumentMatchScore===e.argumentMatchScore?t.overloadIndex>e.overloadIndex?t:e:t.argumentMatchScore<e.argumentMatchScore?t:e)),i=null!=a?a:new q.TypeVarContext;return i.addSolveForScope((0,W.getTypeVarScopeIds)(n.overload)),i.unlock(),Gt(e,n,i,t,r)}if(1===o.length)return l(!1);let d=[t.map((e=>{}))],u=!!n.isIncomplete;for(;;){const n=Mt(e,d,o,a,i,r);if(n.isTypeIncomplete&&(u=!0),!n.argumentErrors)return n;if(s||_a(e,(()=>{s=t.map((e=>{if(e.typeResult)return e.typeResult.type;if(e.valueExpression){const t=e.valueExpression;return _a(t,(()=>Me(t).type))}return K.AnyType.create()}))})),d=Ut(s,d),!d||d.length>64)break}if(!st(e)&&!u){const e=l(!0);return e.returnType=K.UnknownType.create(),{...e,argumentErrors:!0}}return{argumentErrors:!0,isTypeIncomplete:!1,overloadsUsedForCall:[]}}function Ut(e,t){let n,a=e.length-1;for(;a>=0&&!t[0][a];)a--;if(a++,a>=e.length)return;for(;a<e.length;){const t=e[a];if((0,K.isUnion)(t)){n=mt(t);break}if((0,K.isTypeVar)(t)&&t.details.constraints.length>1){n=mt(t);break}a++}if(!n)return;const i=[];return t.forEach((e=>{(0,W.doForEachSubtype)(n,(t=>{const n=[...e];n[a]=t,i.push(n)}))})),i}function jt(e,t,n,a,i=!1,r,s=0){let l,p=!1,d=!1;const u=[];if(s>K.maxTypeRecursionCount)return{returnType:K.UnknownType.create(),argumentErrors:!0,overloadsUsedForCall:u};if(s++,K.TypeBase.isSpecialForm(n.type)){const t=9===e.nodeType?e.leftExpression:e;return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotCallable().format({expression:N.printExpression(t),type:ci(n.type,{expandTypeAlias:!0})}),t),{returnType:K.UnknownType.create(),argumentErrors:!0,overloadsUsedForCall:u}}let m=yt(n.type,void 0,((m,g,h)=>_a(h?void 0:e,(()=>{const h=function(e,t,n,a,i,r,s,o,l){switch(n.category){case 4:case 1:case 2:return i||t.forEach((e=>{e.valueExpression&&!Ia(e.valueExpression)&&ya(e)})),{returnType:n};case 5:return function(e,t,n,a,i,r,s){var o;if(K.TypeBase.isInstantiable(n))return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.callableNotInstantiable().format({type:ci(n)}),e),{returnType:void 0,argumentErrors:!0};n.boundToType&&(0,K.isInstantiableClass)(n.boundToType)&&!n.boundToType.includeSubclasses&&K.FunctionType.isAbstractMethod(n)&&(K.FunctionType.isStaticMethod(n)||K.FunctionType.isClassMethod(n))&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.abstractMethodInvocation().format({method:n.details.name}),9===e.nodeType?e.leftExpression:e);if("namedtuple"===n.details.builtInName)return ot(T.getFileInfo(e).diagnosticRuleSet.reportUntypedNamedTuple,c.DiagnosticRule.reportUntypedNamedTuple,y.Localizer.Diagnostic.namedTupleNoTypes(),e),{returnType:(0,x.createNamedTupleType)(di,e,t,!1)};if("NewType"===n.details.builtInName)return{returnType:rn(e,t)};let l=i;l||(l=new q.TypeVarContext((0,W.getTypeVarScopeIds)(n)));const p=Zt(e,t,{type:n,isIncomplete:a},l,r,s);let d=!!p.isTypeIncomplete,u=p.returnType,m=!!p.argumentErrors;if(!m){const a=(0,A.applyFunctionTransform)(di,e,t,n,{argumentErrors:!!p.argumentErrors,returnType:null!==(o=p.returnType)&&void 0!==o?o:K.UnknownType.create(d),isTypeIncomplete:d});u=a.returnType,a.isTypeIncomplete&&(d=!0),a.argumentErrors&&(m=!0)}"__import__"===n.details.builtInName&&(u=K.AnyType.create());return{returnType:u,isTypeIncomplete:d,argumentErrors:m,overloadsUsedForCall:p.overloadsUsedForCall,specializedInitSelfType:p.specializedInitSelfType}}(e,t,n,i,r,s,o);case 6:return function(e,t,n,a,i,r,s){var o,l;if("cast"===n.overloads[0].details.builtInName&&2===t.length)return{returnType:Wt(t,e)};const p=Lt(e,t,{type:n,isIncomplete:a},i,r,s);let c=null!==(o=p.returnType)&&void 0!==o?o:K.UnknownType.create(),d=!!p.isTypeIncomplete,u=!!p.argumentErrors;if(!u){const a=(0,A.applyFunctionTransform)(di,e,t,n,{argumentErrors:!!p.argumentErrors,returnType:null!==(l=p.returnType)&&void 0!==l?l:K.UnknownType.create(d),isTypeIncomplete:d});c=a.returnType,a.isTypeIncomplete&&(d=!0),a.argumentErrors&&(u=!0)}return{returnType:c,isTypeIncomplete:d,argumentErrors:u,overloadsUsedForCall:p.overloadsUsedForCall,specializedInitSelfType:p.specializedInitSelfType}}(e,t,n,i,r,s,o);case 7:return K.TypeBase.isInstantiable(n)?Bt(e,t,n,a,s,o):function(e,t,n,a,i,r,s,o){var l,p;const d=null===(l=Be(e,n,"__call__",void 0,void 0,64))||void 0===l?void 0:l.type;if(!d)return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.objectNotCallable().format({type:ci(n)}),e),{returnType:K.UnknownType.create(),argumentErrors:!0};const u=jt(e,t,{type:d},i,r,s,o);let m=null!==(p=u.returnType)&&void 0!==p?p:K.UnknownType.create();(0,K.isTypeVar)(a)&&K.TypeBase.isInstantiable(a)&&(0,K.isClass)(n)&&K.ClassType.isBuiltIn(n,"type")&&(m=(0,W.convertToInstance)(a));return{returnType:m,argumentErrors:u.argumentErrors,overloadsUsedForCall:u.overloadsUsedForCall}}(e,t,n,a,r,s,o,l);case 3:if(K.TypeBase.isInstantiable(n)){if(Q&&(0,K.isInstantiableClass)(Q)){return{...Bt(e,t,Q,Q,s,o),returnType:K.NoneType.createInstance()}}return{returnType:K.NoneType.createInstance()}}return ot(T.getFileInfo(e).diagnosticRuleSet.reportOptionalCall,c.DiagnosticRule.reportOptionalCall,y.Localizer.Diagnostic.noneNotCallable(),e),{argumentErrors:!0};case 10:return jt(e,t,{type:(0,W.transformPossibleRecursiveTypeAlias)(n),isIncomplete:i},r,s,o,l);case 8:return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.moduleNotCallable(),e),{argumentErrors:!0}}return{argumentErrors:!0}}(e,t,m,g,!!n.isIncomplete,a,i,r,s);return h.argumentErrors&&(p=!0),h.isTypeIncomplete&&(d=!0),h.overloadsUsedForCall&&(0,o.appendArray)(u,h.overloadsUsedForCall),l=h.specializedInitSelfType,h.returnType}),{allowDiagnostics:!0})));return p&&(0,K.isNever)(m)&&!m.isNoReturn&&(m=K.UnknownType.create()),{argumentErrors:p,returnType:m,isTypeIncomplete:d,specializedInitSelfType:l,overloadsUsedForCall:u}}function Bt(e,t,n,a,i,r){var s;if(void 0!==n.literalValue)return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.literalNotCallable(),e),{returnType:K.UnknownType.create(),argumentErrors:!0};if(K.ClassType.isBuiltIn(n)){const o=n.aliasName||n.details.name;if("type"===o){if((0,I.validateConstructorArguments)(di,e,t,n,i,r),1===t.length){const e=ya(t[0]).type;return{returnType:(0,W.mapSubtypes)(e,(e=>(0,K.isClassInstance)(e)||(0,K.isTypeVar)(e)&&K.TypeBase.isInstance(e)||(0,K.isNoneInstance)(e)?(0,W.convertToInstantiable)(Ve(e)):(0,K.isFunction)(e)&&K.TypeBase.isInstance(e)?K.FunctionType.cloneAsInstantiable(e):K.AnyType.create()))}}return t.length>=2?{returnType:sn(e,t)||K.AnyType.create()}:{returnType:K.AnyType.create()}}if("TypeVar"===o)return{returnType:Qt(e,n,t)};if("TypeVarTuple"===o)return{returnType:Xt(e,n,t)};if("ParamSpec"===o)return{returnType:tn(e,n,t)};if("TypeAliasType"===o){const n=function(e,t){if(9!==e.nodeType||!e.parent||t.length<2)return;if(3!==e.parent.nodeType||e.parent.rightExpression!==e||38!==e.parent.leftExpression.nodeType)return void it(y.Localizer.Diagnostic.typeAliasTypeMustBeAssigned(),e);const n=e.parent.leftExpression,a=t[0];if(!a.valueExpression||48!==a.valueExpression.nodeType)return void it(y.Localizer.Diagnostic.typeAliasTypeNameArg(),a.valueExpression||e);a.valueExpression.strings.map((e=>e.value)).join("")!==n.value&&it(y.Localizer.Diagnostic.typeAliasTypeNameMismatch(),a.valueExpression);let i,r,s;for(let e=1;e<t.length;e++){const n=t[e].name,a=n?n.value:void 0;if(a)if("type_params"!==a||r){if("value"!==a||i)return;i=t[e].valueExpression}else r=t[e].valueExpression;else{if(1!==e)return;i=t[e].valueExpression}}if(!i)return;if(r){if(52!==r.nodeType)return void it(y.Localizer.Diagnostic.typeAliasTypeParamInvalid(),r);s=[];let e=!0;if(r.expressions.map((t=>{let a=Me(t,128).type;(0,K.isTypeVar)(a)?(a.scopeId?e=!1:a=K.TypeVarType.cloneForScopeId(a,N.getScopeIdForNode(n),n.value,2),s.push(a)):e=!1})),!e)return void it(y.Localizer.Diagnostic.typeAliasTypeParamInvalid(),r)}return On(n,n,i,void 0,(()=>null!=s?s:[]))}(e,t);if(n)return{returnType:n}}if("NamedTuple"===o)return{returnType:(0,x.createNamedTupleType)(di,e,t,!0)};if("NewType"===o)return{returnType:rn(e,t)};if("Protocol"===o||"Generic"===o||"Callable"===o||"Concatenate"===o||"Type"===o){return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotIntantiable().format({type:o}),e),{returnType:K.AnyType.create()}}if((0,K.isClass)(a)&&(0,w.isKnownEnumType)(o))return{returnType:null!==(s=(0,w.createEnumType)(di,e,n,t))&&void 0!==s?s:K.UnknownType.create()};if("TypedDict"===o)return{returnType:(0,G.createTypedDictType)(di,e,n,t)};if("auto"===o&&0===t.length)return{returnType:(0,w.getEnumAutoValueType)(di,e)}}if(K.ClassType.supportsAbstractMethods(n)){const t=ei(n);if(t.length>0&&!n.includeSubclasses&&!(0,K.isTypeVar)(a)){const a=new p.DiagnosticAddendum,i=2;t.forEach(((e,n)=>{if(n===i)a.addMessage(y.Localizer.DiagnosticAddendum.memberIsAbstractMore().format({count:t.length-i}));else if(n<i&&(0,K.isInstantiableClass)(e.classType)){const t=e.classType.details.name;a.addMessage(y.Localizer.DiagnosticAddendum.memberIsAbstract().format({type:t,name:e.symbolName}))}})),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.instantiateAbstract().format({type:n.details.name})+a.getString(),e)}}K.ClassType.isProtocolClass(n)&&!n.includeSubclasses&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.instantiateProtocol().format({type:n.details.name}),e);const o=(0,I.validateConstructorArguments)(di,e,t,n,i,r),l=o.overloadsUsedForCall,d=o.argumentErrors,u=o.isTypeIncomplete;let m=o.returnType;if((0,K.isTypeVar)(a)&&(m=(0,W.convertToInstance)(a)),m&&(0,K.isClassInstance)(m)&&m.details.mro.some((e=>(0,K.isInstantiableClass)(e)&&K.ClassType.isBuiltIn(e,"type")))){let a="__class_"+m.details.name;if(3===t.length){const e=ya(t[0]).type;(0,K.isClassInstance)(e)&&K.ClassType.isBuiltIn(e,"str")&&"string"==typeof e.literalValue&&(a=e.literalValue)}const i=K.ClassType.createInstantiable(a,"","",T.getFileInfo(e).filePath,0,N.getTypeSourceId(e),K.ClassType.cloneAsInstantiable(m),K.ClassType.cloneAsInstantiable(m));i.details.baseClasses.push(fa(e,"object")),i.details.effectiveMetaclass=n,(0,W.computeMroLinearization)(i),m=i}return{returnType:m,overloadsUsedForCall:l,argumentErrors:d,isTypeIncomplete:u}}function Wt(e,t){const n=ga(e[0],{enforceTypeAnnotationRules:!0}).type,a=ya(e[1]).type;return K.TypeBase.isInstantiable(n)&&!(0,K.isUnknown)(n)&&(0,K.isTypeSame)((0,W.convertToInstance)(n),a,{ignorePseudoGeneric:!0})&&ot(T.getFileInfo(t).diagnosticRuleSet.reportUnnecessaryCast,c.DiagnosticRule.reportUnnecessaryCast,y.Localizer.Diagnostic.unnecessaryCast().format({type:ci(a)}),t),(0,W.convertToInstance)(n)}function qt(e,t,n,a){var i,r,s,o,d,u,m,g,h;const f=(0,D.getParameterListDetails)(n.type);let v=0,b=!1,_=!1,I=!!n.isIncomplete,C=!1;t=function(e){var t;const n=[];for(const a of e){if(1===a.argumentCategory){const e=ya(a).type,i=(0,W.combineSameSizedTuples)(mt(e),ne);if((0,K.isClassInstance)(i)&&(0,W.isTupleClass)(i)){const e=null!==(t=i.tupleTypeArguments)&&void 0!==t?t:[];if(1!==e.length||!e[0].isUnbounded){for(const t of e)t.isUnbounded?n.push({...a,argumentCategory:1,valueExpression:void 0,typeResult:{type:(0,W.specializeTupleClass)(i,[t])}}):n.push({...a,argumentCategory:0,valueExpression:void 0,typeResult:{type:t.type}});continue}}}n.push(a)}return n}(t);const k=new Map;f.params.forEach((e=>{(0,l.assert)(void 0!==e,"paramInfo is undefined for param name map");const t=e.param;t.name&&0===t.category&&k.set(t.name,{argsNeeded:0!==t.category||t.hasDefault?0:1,argsReceived:0,isPositionalOnly:e.source===D.ParameterSource.PositionOnly})}));let S=f.positionOnlyParamCount,w=null!==(i=f.firstKeywordOnlyIndex)&&void 0!==i?i:f.params.length;const A=f.argsIndex,x=f.kwargsIndex;let P,N,F=!1;if(void 0!==A&&void 0!==x){(0,l.assert)(f.params[A],"varArgListParamIndex params entry is undefined");const e=f.params[A].param;(0,l.assert)(f.params[x],"varArgDictParamIndex params entry is undefined");const t=f.params[x].param;if((0,K.isParamSpec)(e.type)&&"args"===e.type.paramSpecAccess&&(0,K.isParamSpec)(t.type)&&"kwargs"===t.type.paramSpecAccess&&e.type.details.name===t.type.details.name){F=!0;const t=e.type.scopeId;t===n.type.details.typeVarScopeId||t===n.type.details.constructorTypeVarScopeId?(P=[],N=K.TypeVarType.cloneForParamSpecAccess(e.type,void 0)):S=A}}else if(n.type.details.paramSpec){const e=n.type.details.paramSpec.scopeId;e!==n.type.details.typeVarScopeId&&e!==n.type.details.constructorTypeVarScopeId||(F=!0,P=[],N=K.TypeVarType.cloneForParamSpecAccess(n.type.details.paramSpec,void 0))}t.some((e=>1===e.argumentCategory))&&t.forEach((e=>{if(e.name){const t=f.params.findIndex((t=>((0,l.assert)(t,"paramInfo entry is undefined fork kwargs check"),t.param.name===e.name.value&&0===t.param.category)));t>=0&&t>=S&&(w<0||t<w)&&(w=t)}})),w<0&&(w=f.params.length);let E=t.findIndex((e=>2===e.argumentCategory||void 0!==e.name));E<0&&(E=t.length);let z,M=[];function O(e,t){e.active&&(z=t)}const V=void 0!==t.find((e=>1===e.argumentCategory));let R=0;for(;v<E;){if(v<S&&t[v].name){ot(T.getFileInfo(t[v].name).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.argPositional(),t[v].name),_=!0}const a=E-v,i=w-R-1;if(R>=w){if(!n.type.details.paramSpec){let n=!1;if(V&&1===t[v].argumentCategory){const e=ya(t[v]).type;(0,K.isClassInstance)(e)&&(0,W.isTupleClass)(e)&&!(0,W.isUnboundedTupleClass)(e)&&void 0!==e.tupleTypeArguments&&e.tupleTypeArguments.length>0&&(n=!0)}else n=!0;n&&(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===w?y.Localizer.Diagnostic.argPositionalExpectedOne():y.Localizer.Diagnostic.argPositionalExpectedCount().format({expected:w}),null!==(r=t[v].valueExpression)&&void 0!==r?r:e),_=!0)}break}if(R>=f.params.length)break;(0,l.assert)(f.params[R],"paramIndex params entry is undefined");const p=f.params[R].type,m=f.params[R].param.name,g=1===f.params[R].param.category&&(0,K.isVariadicTypeVar)(p);if(1===t[v].argumentCategory){let r=!1;const l=ya(t[v]);let h,S=!1;n.type.details.paramSpec&&R<w&&(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===w?y.Localizer.Diagnostic.argPositionalExpectedOne():y.Localizer.Diagnostic.argPositionalExpectedCount().format({expected:w}),null!==(s=t[v].valueExpression)&&void 0!==s?s:e),_=!0);const A=l.type;g&&(0,K.isUnpackedVariadicTypeVar)(A)?(h=A,r=!0,S=!0,C=!0):(0,K.isClassInstance)(A)&&(0,W.isTupleClass)(A)&&A.tupleTypeArguments&&1===A.tupleTypeArguments.length&&(0,K.isUnpackedVariadicTypeVar)(A.tupleTypeArguments[0].type)?(h=A.tupleTypeArguments[0].type,r=!0,S=!0,C=!0):g&&(0,K.isClassInstance)(A)&&(0,W.isTupleClass)(A)?(r=!0,S=!0,a<i&&(C=!0),h=K.ClassType.cloneForUnpacked(A)):(0,K.isParamSpec)(A)&&"args"===A.paramSpecAccess?h=void 0:(h=null!==(d=null===(o=He({type:A,isIncomplete:l.isIncomplete},!1,t[v].valueExpression))||void 0===o?void 0:o.type)&&void 0!==d?d:K.UnknownType.create(),1!==f.params[R].param.category&&(b=!0));const x=h?{argumentCategory:0,typeResult:{type:h,isIncomplete:l.isIncomplete}}:void 0;x&&l.isIncomplete&&(I=!0),g&&!r?(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackedArgWithVariadicParam(),t[v].valueExpression||e),_=!0):(P&&P.push(t[v]),x&&M.push({paramCategory:f.params[R].param.category,paramType:p,requiresTypeVarMatching:(0,W.requiresSpecialization)(p),argument:x,errorNode:null!==(u=t[v].valueExpression)&&void 0!==u?u:e,paramName:m,isParamNameSynthesized:f.params[R].param.isNameSynthesized,mapsToVarArgList:g&&a>i})),O(t[v],f.params[R].param),m&&0===f.params[R].param.category&&k.has(m)&&k.get(m).argsReceived++,(S||1===f.params[R].param.category)&&v++,(C||1!==f.params[R].param.category)&&R++}else if(1===f.params[R].param.category)if(O(t[v],f.params[R].param),P)P.push(t[v]),v++;else{let n=f.params[R].param.category,r=p;const s=f.params[R].param.name;(0,K.isUnpackedClass)(p)&&p.tupleTypeArguments&&p.tupleTypeArguments.length>0&&(r=p.tupleTypeArguments[0].type),n=(0,K.isVariadicTypeVar)(r)?1:0,a<=i?(a<i&&(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===a?y.Localizer.Diagnostic.argMorePositionalExpectedOne():y.Localizer.Diagnostic.argMorePositionalExpectedCount().format({expected:a}),t[v].valueExpression||e),_=!0),R++):(M.push({paramCategory:n,paramType:r,requiresTypeVarMatching:(0,W.requiresSpecialization)(p),argument:t[v],errorNode:t[v].valueExpression||e,paramName:s,isParamNameSynthesized:f.params[R].param.isNameSynthesized,mapsToVarArgList:!0}),v++)}else{const n=f.params[R].param.name;M.push({paramCategory:f.params[R].param.category,paramType:p,requiresTypeVarMatching:(0,W.requiresSpecialization)(p),argument:t[v],errorNode:t[v].valueExpression||e,paramName:n,isParamNameSynthesized:f.params[R].param.isNameSynthesized}),O(t[v],f.params[R].param),n&&k.has(n)&&k.get(n).argsReceived++,v++,R++}}let L=!1;if(S>=0&&R<S&&R<f.params.length&&1===f.params[R].param.category&&!(0,K.isParamSpec)(f.params[R].param.type)&&(R++,L=!0),S>=0&&R<S&&(!V||F)){const n=f.params.findIndex((e=>e.param.hasDefault));let a=(n>=0&&n<S?n:S)-E;L&&a--;const i=f.params.findIndex((e=>1===e.param.category&&!(0,K.isParamSpec)(e.param.type)));i>=R&&i<S&&a--,a>0&&(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===a?y.Localizer.Diagnostic.argMorePositionalExpectedOne():y.Localizer.Diagnostic.argMorePositionalExpectedCount().format({expected:a}),t.length>E&&t[E].valueExpression||e),_=!0)}if(!_){let a;for(;v<t.length;){if(2===t[v].argumentCategory){const i=ya(t[v],(0,W.makeInferenceContext)(f.unpackedKwargsTypedDictType)).type;if((0,K.isAnyOrUnknown)(i))a=i;else if((0,K.isClassInstance)(i)&&K.ClassType.isTypedDictClass(i)){const n=(0,G.getTypedDictMembersForClass)(di,i),a=new p.DiagnosticAddendum;n.forEach(((n,i)=>{const r=k.get(i);if(r&&!r.isPositionalOnly)if(r.argsReceived>0)a.addMessage(y.Localizer.Diagnostic.paramAlreadyAssigned().format({name:i}));else{r.argsReceived++;const a=f.params.findIndex((e=>e.param.name===i));(0,l.assert)(a>=0);const s=f.params[a].type;M.push({paramCategory:0,paramType:s,requiresTypeVarMatching:(0,W.requiresSpecialization)(s),argument:{argumentCategory:0,typeResult:{type:n.valueType}},errorNode:t[v].valueExpression||e,paramName:i})}else if(void 0!==f.kwargsIndex){const a=f.params[f.kwargsIndex].type;M.push({paramCategory:2,paramType:a,requiresTypeVarMatching:(0,W.requiresSpecialization)(a),argument:{argumentCategory:0,typeResult:{type:n.valueType}},errorNode:t[v].valueExpression||e,paramName:i}),k.set(i,{argsNeeded:1,argsReceived:1,isPositionalOnly:!1})}else f.hasUnpackedTypedDict||a.addMessage(y.Localizer.Diagnostic.paramNameMissing().format({name:i}))})),a.isEmpty()||(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackedTypedDictArgument()+a.getString(),t[v].valueExpression||e),_=!0)}else if((0,K.isParamSpec)(i)&&"kwargs"===i.paramSpecAccess)a=K.AnyType.create(),n.type.details.paramSpec&&M.push({paramCategory:2,paramType:n.type.details.paramSpec,requiresTypeVarMatching:!1,argument:t[v],errorNode:t[v].valueExpression||e});else{const n=Ta(e,"str");if(pe&&(0,K.isInstantiableClass)(pe)&&n&&(0,K.isClassInstance)(n)){const r=new q.TypeVarContext((0,W.getTypeVarScopeId)(pe));let s=!1;if((0,K.isTypeVar)(i))s=!0;else if(Wa(K.ClassType.cloneAsInstance(pe),i,void 0,r)){const e=(0,W.applySolvedTypeVars)(pe,r).typeArguments;e&&e.length>=2?(Wa(n,e[0])&&(s=!0),a=e[1]):(s=!0,a=K.UnknownType.create())}if(void 0!==f.kwargsIndex&&a){const n=f.params[f.kwargsIndex].type;M.push({paramCategory:0,paramType:n,requiresTypeVarMatching:(0,W.requiresSpecialization)(n),argType:a,argument:t[v],errorNode:t[v].valueExpression||e,paramName:f.params[f.kwargsIndex].param.name})}s||(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackedDictArgumentNotMapping(),t[v].valueExpression||e),_=!0)}}P&&P.push(t[v])}else{const a=t[v].name;if(a){const n=a.value,i=k.get(n);if(i&&!i.isPositionalOnly)if(i.argsReceived>0)ot(T.getFileInfo(a).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramAlreadyAssigned().format({name:n}),a),_=!0;else{i.argsReceived++;const a=f.params.findIndex((e=>e.param.name===n));(0,l.assert)(a>=0);const r=f.params[a].type;M.push({paramCategory:0,paramType:r,requiresTypeVarMatching:(0,W.requiresSpecialization)(r),argument:t[v],errorNode:null!==(m=t[v].valueExpression)&&void 0!==m?m:e,paramName:n}),O(t[v],f.params[a].param)}else if(P)P.push(t[v]);else if(void 0!==f.kwargsIndex){const a=f.params[f.kwargsIndex].type;M.push({paramCategory:2,paramType:a,requiresTypeVarMatching:(0,W.requiresSpecialization)(a),argument:t[v],errorNode:null!==(g=t[v].valueExpression)&&void 0!==g?g:e,paramName:n}),k.set(n,{argsNeeded:1,argsReceived:1,isPositionalOnly:!1}),(0,l.assert)(f.params[f.kwargsIndex],"paramDetails.kwargsIndex params entry is undefined"),O(t[v],f.params[f.kwargsIndex].param)}else ot(T.getFileInfo(a).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramNameMissing().format({name:a.value}),a),_=!0}else if(0===t[v].argumentCategory)if(P)P.push(t[v]);else{if(!st(e)){ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===w?y.Localizer.Diagnostic.argPositionalExpectedOne():y.Localizer.Diagnostic.argPositionalExpectedCount().format({expected:w}),t[v].valueExpression||e)}_=!0}else if(1===t[v].argumentCategory&&n.type.details.paramSpec){const a=ya(t[v]),i=a.type;a.isIncomplete&&(I=!0),(0,K.isParamSpec)(i)&&"args"===i.paramSpecAccess&&M.push({paramCategory:1,paramType:n.type.details.paramSpec,requiresTypeVarMatching:!1,argument:t[v],errorNode:null!==(h=t[v].valueExpression)&&void 0!==h?h:e})}}v++}if(!a||V&&void 0===f.argsIndex||f.params.forEach(((n,i)=>{var r,s;const o=n.param;if(i>=f.firstPositionOrKeywordIndex&&0===o.category&&o.name&&k.has(o.name)&&0===k.get(o.name).argsReceived){const n=f.params[i].type;M.push({paramCategory:0,paramType:n,requiresTypeVarMatching:(0,W.requiresSpecialization)(n),argument:{argumentCategory:0,typeResult:{type:a}},errorNode:null!==(s=null===(r=t.find((e=>2===e.argumentCategory)))||void 0===r?void 0:r.valueExpression)&&void 0!==s?s:e,paramName:o.name,isParamNameSynthesized:o.isNameSynthesized}),k.get(o.name).argsReceived=1}})),!a&&!K.FunctionType.isDefaultParameterCheckDisabled(n.type)){const t=Array.from(k.keys()).filter((e=>{const t=k.get(e);return!t||t.argsReceived<t.argsNeeded}));if(t.length>0){if(!st(e)){const n=t.map((e=>`"${e}"`)).join(", ");ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===t.length?y.Localizer.Diagnostic.argMissingForParam().format({name:n}):y.Localizer.Diagnostic.argMissingForParams().format({names:n}),e)}_=!0}f.params.forEach((t=>{var n;const a=t.param;if(0===a.category&&a.name){const i=k.get(a.name);if(0===i.argsNeeded&&0===i.argsReceived){const i=null!==(n=t.defaultArgType)&&void 0!==n?n:a.defaultType;i&&!(0,W.isEllipsisType)(i)&&(0,W.requiresSpecialization)(a.type)&&M.push({paramCategory:a.category,paramType:t.type,requiresTypeVarMatching:!0,argument:{argumentCategory:0,typeResult:{type:i}},errorNode:e,paramName:a.name,isParamNameSynthesized:a.isNameSynthesized})}}}))}}if((!_||!Ia(void 0))&&((0,l.assert)(void 0===f.argsIndex||f.argsIndex<f.params.length,"paramDetails.argsIndex params entry is invalid"),void 0!==f.argsIndex&&f.argsIndex>=0&&f.params[f.argsIndex].param.hasDeclaredType&&!C)){const t=f.params[f.argsIndex].type,n=M.filter((e=>e.mapsToVarArgList));if((0,K.isVariadicTypeVar)(t)&&!t.isVariadicInUnion&&ne&&(0,K.isInstantiableClass)(ne)){const a=n.map((t=>{var n;const a=ya(t.argument).type;return((0,K.isUnpackedVariadicTypeVar)(a)||(0,K.isClassInstance)(a)&&(0,W.isTupleClass)(a)&&a.tupleTypeArguments&&1===a.tupleTypeArguments.length&&(0,K.isUnpackedVariadicTypeVar)(a.tupleTypeArguments[0].type))&&1!==t.argument.argumentCategory&&!t.mapsToVarArgList&&(st(e)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarTupleMustBeUnpacked(),null!==(n=t.argument.valueExpression)&&void 0!==n?n:e),_=!0),{type:Ve(a),isUnbounded:1===t.argument.argumentCategory}}));let i;i=1!==a.length||a[0].isUnbounded||!(0,K.isUnpackedClass)(a[0].type)&&!(0,K.isVariadicTypeVar)(a[0].type)?K.ClassType.cloneAsInstance((0,W.specializeTupleClass)(ne,a,!0,!0)):a[0].type;const r={paramCategory:1,paramType:t,requiresTypeVarMatching:!0,argument:{argumentCategory:0,typeResult:{type:i}},errorNode:e,paramName:f.params[f.argsIndex].param.name,isParamNameSynthesized:f.params[f.argsIndex].param.isNameSynthesized,mapsToVarArgList:!0};M=[...M.filter((e=>!e.mapsToVarArgList)),r]}}let U=0;return b&&U--,["isinstance","issubclass"].some((e=>e===n.type.details.builtInName))&&2===M.length&&(M[1].isinstanceParam=!0),{overload:n.type,overloadIndex:a,argumentErrors:_,isTypeIncomplete:I,argParams:M,paramSpecTarget:N,paramSpecArgList:P,activeParam:z,relevance:U,argumentMatchScore:0}}function Gt(e,t,n,a=!1,i){var r,s;const o=t.overload,l=null!==(r=null==i?void 0:i.signatureTracker)&&void 0!==r?r:new W.UniqueSignatureTracker;if(t.overload=(0,W.ensureFunctionSignaturesAreUnique)(t.overload,l,e.start),!i||(0,K.isAnyOrUnknown)(i.expectedType)||(0,K.isNever)(i.expectedType)||!o.details.declaredReturnType||!(0,W.requiresSpecialization)(null!==(s=K.FunctionType.getSpecializedReturnType(o))&&void 0!==s?s:K.UnknownType.create()))return Kt(e,t,n,l,a);const p=za(o);let c=i.expectedType,d=0;if((0,W.containsLiteralType)(c,!0)&&(d|=128),(0,K.isUnion)(i.expectedType)&&_a(e,(()=>{const i=n.clone();Wa(p,c,void 0,i,void 0,1024|d);const r=Kt(e,t,i,l,a);(null==r?void 0:r.argumentErrors)&&(c=void 0)})),c){const t=N.getTypeVarScopesForNode(e);if((0,K.isClassInstance)(p)){if((0,K.isUnion)(c)){const e=(0,W.mapSubtypes)(c,(e=>{if((0,K.isClassInstance)(e)&&0!==e.details.typeParameters.length)return K.ClassType.isProtocolClass(e)||e.details.mro.some((e=>(0,K.isClassInstance)(e)&&e.details.typeParameters.length>0&&K.ClassType.isSameGenericClass(p,e)))?e:void 0}));(0,K.isClassInstance)(e)&&(c=e)}if((0,K.isClassInstance)(c)&&!(0,K.isTypeSame)(p,c)){const n=new q.TypeVarContext((0,W.getTypeVarScopeId)(p));(0,_.populateTypeVarContextBasedOnExpectedType)(di,p,c,n,t,e.start);const a=K.ClassType.cloneForSpecialization(p,void 0,!1);c=(0,W.applySolvedTypeVars)(a,n,{unknownIfNotFound:!0})}}else(0,K.isFunction)(p)&&(0,K.isUnion)(c)&&(c=(0,W.mapSubtypes)(c,(e=>(0,W.isCallableType)(e)?e:void 0)));c=(0,W.transformExpectedType)(c,t,e.start),Wa(p,c,void 0,n,void 0,1024|d)}return Kt(e,t,n,l,a)}function Kt(e,t,n,a,i=!1){const r=t.overload;let s,l,p=t.isTypeIncomplete,d=!1,u=0;const m=(0,W.getTypeCondition)(r);if(r.boundTypeVarScopeId&&(void 0!==r.preBoundFlags&&r.boundToType&&(0,W.requiresSpecialization)(r.boundToType)&&6&r.preBoundFlags&&n.addSolveForScope(r.boundTypeVarScopeId),"__init__"===r.details.name&&K.FunctionType.isOverloaded(r)&&r.strippedFirstParamType&&r.boundToType&&(0,K.isClassInstance)(r.strippedFirstParamType)&&(0,K.isClassInstance)(r.boundToType)&&K.ClassType.isSameGenericClass(r.strippedFirstParamType,r.boundToType)&&r.strippedFirstParamType.typeArguments)){const e=r.strippedFirstParamType.details.typeParameters;s=r.strippedFirstParamType,r.strippedFirstParamType.typeArguments.forEach(((t,a)=>{if(a<e.length){const i=e[a];(0,K.isTypeSame)(i,t,{ignorePseudoGeneric:!0})||n.setTypeVarType(e[a],t)}}))}["cast","isinstance","issubclass"].some((e=>e===r.details.builtInName))&&(i=!0);const g=t.argParams.filter((e=>e.requiresTypeVarMatching)).length;if(g>0){let s=Math.min(g,2);for(let o=0;o<s;o++)_a(e,(()=>{t.argParams.forEach((e=>{if(!e.requiresTypeVarMatching)return;const l=Jt(e,n,a,{type:r,isIncomplete:t.isTypeIncomplete},{skipUnknownArgCheck:i,skipOverloadArg:0===o,skipBareTypeVarExpectedType:0===o,useNarrowBoundOnly:s>1&&0===o,conditionFilter:m});l.isTypeIncomplete&&(p=!0),0===o&&(l.skippedOverloadArg||l.skippedBareTypeVarExpectedType)&&s++}))}));n.lock()}let h=!1,f=!1,v=[];const b=[];t.argParams.forEach(((e,s)=>{var o;const c=Jt(e,n,a,{type:r,isIncomplete:t.isTypeIncomplete},{skipUnknownArgCheck:i,conditionFilter:m});b.push(c),c.isCompatible||(d=!0,u+=t.argParams.length-s+1),c.isTypeIncomplete&&(p=!0),c.condition&&(v=null!==(o=K.TypeCondition.combine(v,c.condition))&&void 0!==o?o:[]),(0,K.isAnyOrUnknown)(c.argType)&&(l=l?(0,W.preserveUnknown)(c.argType,l):c.argType),r.details.paramSpec&&(1===e.argument.argumentCategory&&(0,K.isParamSpec)(c.argType)&&"args"===c.argType.paramSpecAccess&&(h=!0),2===e.argument.argumentCategory&&(0,K.isParamSpec)(c.argType)&&"kwargs"===c.argType.paramSpecAccess&&(f=!0))}));let _=[];if(t.paramSpecArgList&&t.paramSpecTarget){const a=function(e,t,n,a,i){const r=a.getSignatureContexts();if(1===r.length)return Yt(e,t,n,r[0],i);const s=[],l=[];r.forEach((a=>{_a(e,(()=>{const r=Yt(e,t,n,a,i);r.argumentErrors||s.push(a),(0,o.appendArray)(l,r.typeVarContexts)}))})),s.length>0&&a.copySignatureContexts(s);const p=Yt(e,t,n,s.length>0?s[0]:r[0],i);return{argumentErrors:p.argumentErrors,typeVarContexts:l}}(e,t.paramSpecArgList,t.paramSpecTarget,n,m);a.argumentErrors&&(d=!0,u+=1),_=a.typeVarContexts}else r.details.paramSpec&&(h&&f||(p||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecArgsMissing().format({type:ci(r.details.paramSpec)}),e),d=!0,u+=1));let I=za(r,t.argParams);v.length>0&&(I=K.TypeBase.cloneForCondition(I,v));let C=!0,k=e;for(;k;){const e=N.getTypeVarScopeNode(k);if(!e)break;const t=N.getScopeIdForNode(e);n.hasSolveForScope(t)&&(C=!1),k=e.parent}((0,K.isFunction)(I)||(0,K.isOverloadedFunction)(I)||r.details.typeVarScopeId===K.WildcardTypeVarScopeId)&&(C=!1);const S=!N.getTypeVarScopesForNode(e).some((e=>n.hasSolveForScope(e)))&&!r.details.rescopedTypeParameters;let w=(0,W.applySolvedTypeVars)(I,n,{unknownIfNotFound:S,unknownExemptTypeVars:$t(r,I),useUnknownOverDefault:i,eliminateUnsolvedInUnions:C,applyInScopePlaceholders:!0});if(w=(0,W.addConditionToType)(w,m),_.length>0&&_.forEach((e=>{e&&(w=(0,W.applySolvedTypeVars)(w,e))})),(0,K.isUnpackedClass)(w)&&(w=K.ClassType.cloneForUnpacked(w,!1)),(0,K.isClassInstance)(w)&&K.ClassType.isBuiltIn(w,"TypeGuard")&&w.typeArguments&&w.typeArguments.length>0&&(0,K.isClassInstance)(I)&&I.typeArguments&&I.typeArguments.length>0&&ae&&(0,K.isInstantiableClass)(ae)){let t=w.typeArguments[0];if(b.length>0){const e=b[0].argType;(0,K.isTypeVar)(e)&&!e.details.isParamSpec&&0===e.details.constraints.length&&(t=(0,W.addConditionToType)(t,[{typeVarName:K.TypeVarType.getNameWithScope(e),constraintIndex:0,isConstrainedTypeVar:!1}]))}let n=!1;if(T.getFileInfo(e).diagnosticRuleSet.enableExperimentalFeatures){const e=r.boundToType?1:0;if(e<r.details.parameters.length){Wa(K.FunctionType.getEffectiveParameterType(r,e),I.typeArguments[0])&&(n=!0)}}w=K.ClassType.cloneAsInstance(K.ClassType.cloneForTypeGuard(ae,t,n))}return w=Ht(w,a.getTrackedSignatures()),s&&(s=(0,W.applySolvedTypeVars)(s,n)),t.argumentMatchScore=u,{argumentErrors:d,argResults:b,anyOrUnknownArgument:l,returnType:w,isTypeIncomplete:p,activeParam:t.activeParam,specializedInitSelfType:s,overloadsUsedForCall:d?[]:[r]}}function $t(e,t){if((0,K.isFunction)(t)&&!t.details.name){if(t.details.typeVarScopeId&&e.details.typeVarScopeId){let n=(0,W.getTypeVarArgumentsRecursive)(t);return e.details.parameters.forEach(((e,t)=>{if(e.hasDeclaredType){const t=(0,W.getTypeVarArgumentsRecursive)(e.type);n=n.filter((e=>!t.some((t=>(0,K.isTypeSame)(e,t)))))}})),n}}return[]}function Ht(e,t){if((0,K.isFunction)(e)&&!e.details.name){const n=(0,W.getTypeVarArgumentsRecursive)(e);if(n.length>0)return K.FunctionType.cloneWithNewTypeVarScopeId(e,K.WildcardTypeVarScopeId,n,t)}return e}function Zt(e,t,n,a,i=!1,r){var s;const o=null!==(s=null==r?void 0:r.signatureTracker)&&void 0!==s?s:new W.UniqueSignatureTracker;n.type=(0,W.ensureFunctionSignaturesAreUnique)(n.type,o,e.start);const l=qt(e,t,n,0);return l.argumentErrors?(t.forEach((e=>{e.valueExpression&&!Ia(e.valueExpression)&&Me(e.valueExpression)})),{argumentErrors:!0,activeParam:l.activeParam,overloadsUsedForCall:[]}):Gt(e,l,a,i,(0,W.makeInferenceContext)(null==r?void 0:r.expectedType,null==r?void 0:r.isTypeIncomplete,o))}function Yt(e,t,n,a,i){var r;const s=a.getParamSpecType(n);if(!s)return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecNotBound().format({type:ci(n)}),(null===(r=t[0])||void 0===r?void 0:r.valueExpression)||e),{argumentErrors:!0,typeVarContexts:[void 0]};const o=N.getTypeVarScopesForNode(e),p=new q.TypeVarContext((0,W.getTypeVarScopeIds)(s));let d=!1,u=!1,m=!1,g=new Map;for(let n=0;n<2;n++)_a(n<1?e:void 0,(()=>{g=new Map;const n=s.details.parameters;n.forEach((e=>{e.name&&g.set(e.name,e)}));let a=0,r=n.findIndex((e=>0!==e.category));r<0&&(r=n.length);const h=n.find((e=>1===e.category)),f=n.find((e=>2===e.category)),v=new W.UniqueSignatureTracker;t.forEach((t=>{var s;if(0===t.argumentCategory){let l;if(t.name){const n=g.get(t.name.value);n?(l=n.type,g.delete(t.name.value)):f?l=f.type:(ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramNameMissing().format({name:t.name.value}),t.name||e),d=!0)}else{if(a<r){const e=n[a];l=e.type,e.name&&g.delete(e.name)}else h?l=h.type:(ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===n.length?y.Localizer.Diagnostic.argPositionalExpectedOne():y.Localizer.Diagnostic.argPositionalExpectedCount().format({expected:n.length}),null!==(s=t.valueExpression)&&void 0!==s?s:e),d=!0);a++}if(l){Jt({paramCategory:0,paramType:(0,W.transformExpectedType)(l,o,void 0),requiresTypeVarMatching:!1,argument:t,errorNode:t.valueExpression||e},p,v,void 0,{conditionFilter:i}).isCompatible||(d=!0)}}else if(1===t.argumentCategory){u=!0;const e=n.find((e=>1===e.category&&e.name));e&&g.has(e.name)&&g.delete(e.name)}else{m=!0,(0,l.assert)(2===t.argumentCategory);const e=n.find((e=>2===e.category));e&&g.has(e.name)&&g.delete(e.name)}}))}));if(!d){let t=Array.from(g.keys());if(t=t.filter((e=>{const t=g.get(e);return 0===t.category&&!t.hasDefault})),t.length>0&&!s.details.paramSpec&&!u&&!m){const n=t.map((e=>`"${e}"`)).join(", ");ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===t.length?y.Localizer.Diagnostic.argMissingForParam().format({name:n}):y.Localizer.Diagnostic.argMissingForParams().format({names:n}),e),d=!0}}return d||(0,W.applySourceContextTypeVarsToSignature)(a,p),{argumentErrors:d,typeVarContexts:[d?p:void 0]}}function Jt(e,t,n,a,i){var r;let s,o,l=!!(null==a?void 0:a.isIncomplete),d=!0;const u=null==a?void 0:a.type.details.name;let m=!1;if(e.argument.valueExpression){let f;const v=(0,K.isTypeVar)(e.paramType)&&e.paramType.scopeId===(null==a?void 0:a.type.details.typeVarScopeId);if(i.skipBareTypeVarExpectedType&&v)m=!0;else{f=e.paramType;(0,K.isFunction)(e.paramType)&&!!e.paramType.details.paramSpec&&t.getSignatureContexts().length>1||(f=(0,W.applySolvedTypeVars)(f,t,{useNarrowBoundOnly:!!i.useNarrowBoundOnly}))}if(f&&(0,K.isUnknown)(f)&&(f=void 0),e.argType)s=e.argType;else{const b=e.isinstanceParam?616:2,_=Me(e.argument.valueExpression,b,(0,W.makeInferenceContext)(f,!!(null==a?void 0:a.isIncomplete),n));if(s=_.type,s=(0,W.ensureFunctionSignaturesAreUnique)(s,n,e.argument.valueExpression.start),_.isIncomplete&&(l=!0),_.typeErrors)d=!1;else if(f&&(0,W.requiresSpecialization)(f)){const C=t.clone();Wa(f,s,void 0,C)?t.copyFromClone(C):d=!1}o=_.expectedTypeDiagAddendum}e.argument&&e.argument.name&&!Ia(e.errorNode)&&ke(e.argument.name,{type:null!=f?f:s,isIncomplete:l},0)}else if(e.argType)s=e.argType;else{const k=ya(e.argument);s=k.type,k.isIncomplete&&(l=!0)}2===e.paramCategory&&(0,K.isTypeVar)(e.paramType)&&(s=Ve(s)),i.conditionFilter&&(s=yt(s,i.conditionFilter,(e=>e)));const g=s.condition;let h=new p.DiagnosticAddendum;if((0,K.isParamSpec)(e.paramType)&&void 0!==e.paramType.paramSpecAccess)return{isCompatible:d,argType:s,isTypeIncomplete:l,condition:g};if((0,K.isParamSpec)(s)&&void 0!==s.paramSpecAccess)return{isCompatible:d,argType:s,isTypeIncomplete:l,condition:g};if(i.skipOverloadArg){if((0,K.isOverloadedFunction)(s))return{isCompatible:d,argType:s,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:g};const S=mt(e.paramType);if((0,K.isFunction)(S)||(0,K.isOverloadedFunction)(S)){if((0,K.isInstantiableClass)(s)){const w=(0,I.createFunctionFromConstructor)(di,s);if(w&&(0,K.isOverloadedFunction)(w))return{isCompatible:d,argType:s,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:g}}if((0,K.isClassInstance)(s)){const A=(0,W.lookUpObjectMember)(s,"__call__");if(A){const x=Va(A);if((0,K.isOverloadedFunction)(x))return{isCompatible:d,argType:s,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:g}}}}}if(!Wa(e.paramType,s,h.createAddendum(),t)){if("none"!==T.getFileInfo(e.errorNode).diagnosticRuleSet.reportGeneralTypeIssues&&!st(e.errorNode)&&!l){const P=T.getFileInfo(e.errorNode),D=ci(s),N=ci(e.paramType);let F;F=e.paramName&&!e.isParamNameSynthesized?u?y.Localizer.Diagnostic.argAssignmentParamFunction().format({argType:D,paramType:N,functionName:u,paramName:e.paramName}):y.Localizer.Diagnostic.argAssignmentParam().format({argType:D,paramType:N,paramName:e.paramName}):u?y.Localizer.Diagnostic.argAssignmentFunction().format({argType:D,paramType:N,functionName:u}):y.Localizer.Diagnostic.argAssignment().format({argType:D,paramType:N}),o&&(h=o),ot(P.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,F+h.getString(),e.errorNode,null!==(r=h.getEffectiveTextRange())&&void 0!==r?r:e.errorNode)}return{isCompatible:!1,argType:s,isTypeIncomplete:l,skippedBareTypeVarExpectedType:m,condition:g}}if(!i.skipUnknownArgCheck){const E=(0,K.removeUnbound)(s),z=T.getFileInfo(e.errorNode);function M(){const t=new p.DiagnosticAddendum;return e.paramName&&t.addMessage((u?y.Localizer.DiagnosticAddendum.argParamFunction().format({paramName:e.paramName,functionName:u}):y.Localizer.DiagnosticAddendum.argParam().format({paramName:e.paramName}))+t.getString()),t}if("none"!==z.diagnosticRuleSet.reportUnknownArgumentType&&!(0,K.isAny)(e.paramType)&&!l)if((0,K.isUnknown)(E)){const O=M();ot(z.diagnosticRuleSet.reportUnknownArgumentType,c.DiagnosticRule.reportUnknownArgumentType,y.Localizer.Diagnostic.argTypeUnknown()+O.getString(),e.errorNode)}else if((0,W.isPartlyUnknown)(E,!0)){let V=!1;if((0,K.isInstantiableClass)(E)&&(V=!0),(0,W.isPartlyUnknown)(e.paramType)&&(V=!0),(0,K.isClassInstance)(E)&&E.isEmptyContainer&&(V=!0),!V){const R=M();R.addMessage(y.Localizer.DiagnosticAddendum.argumentType().format({type:ci(E,{expandTypeAlias:!0})})),ot(z.diagnosticRuleSet.reportUnknownArgumentType,c.DiagnosticRule.reportUnknownArgumentType,y.Localizer.Diagnostic.argTypePartiallyUnknown()+R.getString(),e.errorNode)}}}return{isCompatible:d,argType:s,isTypeIncomplete:l,skippedBareTypeVarExpectedType:m,condition:g}}function Qt(e,t,n){var a,i,r,s,o,l,p;let d,m,g="";if(0===n.length)return void it(y.Localizer.Diagnostic.typeVarFirstArg(),e);const h=n[0];h.valueExpression&&48===h.valueExpression.nodeType?g=h.valueExpression.strings.map((e=>e.value)).join(""):it(y.Localizer.Diagnostic.typeVarFirstArg(),h.valueExpression||e);const f=K.TypeVarType.createInstantiable(g,!1),v=new Map;for(let c=1;c<n.length;c++){const g=n[c].name,h=g?g.value:void 0;if(h){if(v.get(h)&&it(y.Localizer.Diagnostic.duplicateParam().format({name:h}),n[c].valueExpression||e),"bound"===h)if(f.details.constraints.length>0)it(y.Localizer.Diagnostic.typeVarBoundAndConstrained(),n[c].valueExpression||e);else{const t=null!==(i=null===(a=n[c].typeResult)||void 0===a?void 0:a.type)&&void 0!==i?i:ha(n[c].valueExpression).type;(0,W.requiresSpecialization)(t,!0)&&it(y.Localizer.Diagnostic.typeVarBoundGeneric(),n[c].valueExpression||e),f.details.boundType=(0,W.convertToInstance)(t)}else if("covariant"===h)n[c].valueExpression&&an(n[c].valueExpression)&&(4===f.details.declaredVariance||0===f.details.declaredVariance?it(y.Localizer.Diagnostic.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=3);else if("contravariant"===h)n[c].valueExpression&&an(n[c].valueExpression)&&(3===f.details.declaredVariance||0===f.details.declaredVariance?it(y.Localizer.Diagnostic.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=4);else if("infer_variance"===h)n[c].valueExpression&&an(n[c].valueExpression)&&(3===f.details.declaredVariance||4===f.details.declaredVariance?it(y.Localizer.Diagnostic.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=0);else if("default"===h){m=n[c].valueExpression;const a=null!==(s=null===(r=n[c].typeResult)||void 0===r?void 0:r.type)&&void 0!==s?s:ha(m,{allowTypeVarsWithoutScopeId:!0}).type;f.details.defaultType=(0,W.convertToInstance)(a);const i=T.getFileInfo(e);!i.isStubFile&&i.executionEnvironment.pythonVersion<u.PythonVersion.V3_13&&"typing_extensions"!==t.details.moduleName&&it(y.Localizer.Diagnostic.typeVarDefaultIllegal(),m)}else it(y.Localizer.Diagnostic.typeVarUnknownParam().format({name:h}),(null===(o=n[c].node)||void 0===o?void 0:o.name)||n[c].valueExpression||e);v.set(h,h)}else if(f.details.boundType)it(y.Localizer.Diagnostic.typeVarBoundAndConstrained(),n[c].valueExpression||e);else{const t=null!==(p=null===(l=n[c].typeResult)||void 0===l?void 0:l.type)&&void 0!==p?p:ha(n[c].valueExpression).type;(0,W.requiresSpecialization)(t,!0)&&it(y.Localizer.Diagnostic.typeVarConstraintGeneric(),n[c].valueExpression||e),K.TypeVarType.addConstraint(f,(0,W.convertToInstance)(t)),void 0===d&&(d=n[c])}}if(1===f.details.constraints.length&&d&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarSingleConstraint(),d.valueExpression||e),f.details.defaultType&&m){const t=new q.TypeVarContext(K.WildcardTypeVarScopeId),n=mt((0,W.applySolvedTypeVars)(f.details.defaultType,t,{unknownIfNotFound:!0}));f.details.boundType?Wa(f.details.boundType,n)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarDefaultBoundMismatch(),m):f.details.constraints.length>0&&(f.details.constraints.some((e=>(0,K.isTypeSame)(e,n)))||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarDefaultConstraintMismatch(),m))}return f}function Xt(e,t,n){var a,i;let r="";if(0===n.length)return void it(y.Localizer.Diagnostic.typeVarFirstArg(),e);const s=n[0];s.valueExpression&&48===s.valueExpression.nodeType?r=s.valueExpression.strings.map((e=>e.value)).join(""):it(y.Localizer.Diagnostic.typeVarFirstArg(),s.valueExpression||e);const o=K.TypeVarType.createInstantiable(r,!1);o.details.isVariadic=!0;for(let r=1;r<n.length;r++){const s=n[r].name,l=s?s.value:void 0;if(l)if("default"===l){const a=n[r].valueExpression;a&&(o.details.defaultType=en(a));const i=T.getFileInfo(e);!i.isStubFile&&i.executionEnvironment.pythonVersion<u.PythonVersion.V3_13&&"typing_extensions"!==t.details.moduleName&&it(y.Localizer.Diagnostic.typeVarDefaultIllegal(),a)}else it(y.Localizer.Diagnostic.typeVarTupleUnknownParam().format({name:(null===(a=n[r].name)||void 0===a?void 0:a.value)||"?"}),(null===(i=n[r].node)||void 0===i?void 0:i.name)||n[r].valueExpression||e)}return o}function en(e){const t=ha(e,{allowUnpackedTuple:!0,allowTypeVarsWithoutScopeId:!0}).type,n=(0,K.isClass)(t)&&(0,W.isTupleClass)(t)&&t.isUnpacked,a=(0,K.isUnpackedVariadicTypeVar)(t);if(n||a)return(0,W.convertToInstance)(t);ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarTupleDefaultNotUnpacked(),e)}function tn(e,t,n){if(0===n.length)return void it(y.Localizer.Diagnostic.paramSpecFirstArg(),e);const a=n[0];let i="";a.valueExpression&&48===a.valueExpression.nodeType?i=a.valueExpression.strings.map((e=>e.value)).join(""):it(y.Localizer.Diagnostic.paramSpecFirstArg(),a.valueExpression||e);const r=K.TypeVarType.createInstantiable(i,!0);for(let a=1;a<n.length;a++){const i=n[a].name,s=i?i.value:void 0;if(!s){it(y.Localizer.Diagnostic.paramSpecUnknownArg(),n[a].valueExpression||e);break}if("default"===s){const i=n[a].valueExpression;i&&(r.details.defaultType=nn(i));const s=T.getFileInfo(e);!s.isStubFile&&s.executionEnvironment.pythonVersion<u.PythonVersion.V3_13&&"typing_extensions"!==t.details.moduleName&&it(y.Localizer.Diagnostic.typeVarDefaultIllegal(),i)}else it(y.Localizer.Diagnostic.paramSpecUnknownParam().format({name:s}),i||n[a].valueExpression||e)}return r}function nn(e){const t=K.FunctionType.createSynthesizedInstance("",98304);if(K.TypeBase.setSpecialForm(t),18===e.nodeType)return K.FunctionType.addDefaultParameters(t),t;if(31===e.nodeType)return e.entries.forEach(((e,n)=>{const a=ha(e,{allowTypeVarsWithoutScopeId:!0});K.FunctionType.addParameter(t,{category:0,name:`__p${n}`,isNameSynthesized:!0,hasDeclaredType:!0,type:(0,W.convertToInstance)(a.type)})})),ke(e,{type:K.AnyType.create()},void 0),t;{const n=ha(e,{allowParamSpec:!0,allowTypeVarsWithoutScopeId:!0});if(n.typeErrors)return;if((0,K.isParamSpec)(n.type))return t.details.paramSpec=n.type,t}ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramSpecDefaultNotTuple(),e)}function an(e){if(11===e.nodeType){if(15===e.constType)return!1;if(33===e.constType)return!0}return it(y.Localizer.Diagnostic.expectedBoolLiteral(),e),!1}function rn(e,t){var n;const a=T.getFileInfo(e);let i="";if(2!==t.length)return void ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.newTypeParamCount(),e);const r=t[0];if(0===r.argumentCategory&&r.valueExpression&&48===r.valueExpression.nodeType&&(i=r.valueExpression.strings.map((e=>e.value)).join("")),!i)return void ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.newTypeBadName(),null!==(n=t[0].node)&&void 0!==n?n:e);let s=ga(t[1]).type,o=!1;if((0,K.isAnyOrUnknown)(s)&&(X&&(0,K.isClassInstance)(X)&&(s=K.ClassType.cloneAsInstantiable(X)),o=!0),!(0,K.isInstantiableClass)(s))return void it(y.Localizer.Diagnostic.newTypeNotAClass(),t[1].node||e);K.ClassType.isProtocolClass(s)?it(y.Localizer.Diagnostic.newTypeProtocolClass(),t[1].node||e):void 0!==s.literalValue&&it(y.Localizer.Diagnostic.newTypeLiteral(),t[1].node||e);let l=-4&s.details.flags;l|=4096;const p=K.ClassType.createInstantiable(i,N.getClassFullName(e,a.moduleName,i),a.moduleName,a.filePath,l,N.getTypeSourceId(e),void 0,s.details.effectiveMetaclass);if(p.details.baseClasses.push(o?K.AnyType.create():s),(0,W.computeMroLinearization)(p),!o){const e=K.FunctionType.createSynthesizedInstance("__init__");K.FunctionType.addParameter(e,{category:0,name:"self",type:K.ClassType.cloneAsInstance(p),hasDeclaredType:!0}),K.FunctionType.addParameter(e,{category:0,name:"_x",type:K.ClassType.cloneAsInstance(s),hasDeclaredType:!0}),e.details.declaredReturnType=K.NoneType.createInstance(),p.details.fields.set("__init__",V.Symbol.createWithType(4,e));const t=K.FunctionType.createSynthesizedInstance("__new__",1);K.FunctionType.addParameter(t,{category:0,name:"cls",type:p,hasDeclaredType:!0}),K.FunctionType.addDefaultParameters(t),t.details.declaredReturnType=K.ClassType.cloneAsInstance(p),p.details.fields.set("__new__",V.Symbol.createWithType(4,t))}return p}function sn(e,t){const n=T.getFileInfo(e),a=ya(t[0]).type;if(!(0,K.isClassInstance)(a)||!K.ClassType.isBuiltIn(a,"str"))return;const i=a.literalValue||"_",r=ya(t[1]).type;if(!(0,K.isClassInstance)(r)||!(0,W.isTupleClass)(r)||void 0===r.tupleTypeArguments)return;const s=K.ClassType.createInstantiable(i,N.getClassFullName(e,n.moduleName,i),n.moduleName,n.filePath,0,N.getTypeSourceId(e),void 0,r.details.effectiveMetaclass);return r.tupleTypeArguments.forEach((n=>{const a=mt(n.type);(0,W.isEffectivelyInstantiable)(a)?s.details.baseClasses.push(a):pt(n.type,t[1].valueExpression||e)})),(0,W.computeMroLinearization)(s)||it(y.Localizer.Diagnostic.methodOrdering(),e),s}function on(e,t,n,a,i){let r=!0;const s=e=>{var s,o;let l;const p=mt(e);if((0,K.isClassInstance)(p)?l=null===(s=Be(a,p,n,void 0,void 0,65,e))||void 0===s?void 0:s.type:(0,K.isInstantiableClass)(p)&&(l=null===(o=We(a,p,n,void 0,void 0,96))||void 0===o?void 0:o.type),l){const e=t.map((e=>({argumentCategory:0,typeResult:e})));let n;return _a(a,(()=>{n=jt(a,e,{type:l},void 0,!0,i)})),n.argumentErrors&&i&&_a(a,(()=>{n=jt(a,e,{type:l},void 0,!0)})),n.argumentErrors&&(r=!1),n.returnType}r=!1},o=(0,W.mapSubtypes)(e,(e=>(0,K.isAnyOrUnknown)(e)?e:(0,K.isClassInstance)(e)||(0,K.isInstantiableClass)(e)||(0,K.isTypeVar)(e)?s(e):(0,K.isNoneInstance)(e)&&X&&(0,K.isClassInstance)(X)?s(X):(0,K.isNoneTypeClass)(e)&&ee&&(0,K.isInstantiableClass)(ee)?s(K.ClassType.cloneAsInstance(ee)):void(r=!1)));if(r)return o}function ln(e,t,n){t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType);const a=mt(t.expectedType);if(!(0,K.isClassInstance)(a))return;const i=[],r=[];let s=!1;if(K.ClassType.isTypedDictClass(a)){if(pn(e,i,r,!0,!0,void 0,void 0,(0,G.getTypedDictMembersForClass)(di,a),n)&&(s=!0),K.ClassType.isTypedDictClass(a)){const e=(0,G.assignToTypedDict)(di,a,i,r,(null==n?void 0:n.isEmpty())?n:void 0);if(e)return{type:e,isIncomplete:s}}return}const o=Ta(e,"dict");if(!(0,K.isClassInstance)(o))return;const l=new q.TypeVarContext((0,W.getTypeVarScopeId)(o));if(!(0,_.populateTypeVarContextBasedOnExpectedType)(di,o,t.expectedType,l,N.getTypeVarScopesForNode(e),e.start))return;const p=(0,W.applySolvedTypeVars)(K.ClassType.cloneAsInstantiable(o),l);if(!p.typeArguments||2!==p.typeArguments.length)return;const c=p.typeArguments[0],d=p.typeArguments[1];let u=!1;if((0,K.isClassInstance)(t.expectedType)&&t.expectedType.details.typeParameters.length>=2){const e=t.expectedType.details.typeParameters[1];2===K.TypeVarType.getVariance(e)&&(u=!0)}pn(e,i,r,!0,u,c,d,void 0,n)&&(s=!0);const m=un((0,W.makeInferenceContext)(c),i.map((e=>e.type)),!1),y=un((0,W.makeInferenceContext)(d),r.map((e=>e.type)),!u);if(!m||!y)return;return{type:Ta(e,"dict",[m,y]),isIncomplete:s}}function pn(e,t,n,a,i,r,s,o,l){let p=!1;return e.entries.forEach(((d,u)=>{var m;let g=!0;if(17===d.nodeType){const e=Me(d.keyExpression,void 0,(0,W.makeInferenceContext)(null!=r?r:a?K.NeverType.createNever():void 0));e.isIncomplete&&(p=!0);const c=e.type;let m,y;if(e.isIncomplete||e.typeErrors||dn(d.keyExpression,c,!0),l&&e.expectedTypeDiagAddendum&&l.addAddendum(e.expectedTypeDiagAddendum),o&&(0,K.isClassInstance)(c)&&K.ClassType.isBuiltIn(c,"str")&&(0,W.isLiteralType)(c)&&o.has(c.literalValue)){const e=o.get(c.literalValue).valueType;y=(0,W.makeInferenceContext)(e),m=Me(d.valueExpression,void 0,y)}else{const e=null!=s?s:a?K.NeverType.createNever():void 0;y=(0,W.makeInferenceContext)(e),m=Me(d.valueExpression,void 0,y)}if(y&&!m.typeErrors){const e=un(y,[m.type],!i);e&&(m={...m,type:e})}l&&m.expectedTypeDiagAddendum&&l.addAddendum(m.expectedTypeDiagAddendum);const h=m.type;m.isIncomplete&&(p=!0),(a||u<Z)&&(t.push({node:d.keyExpression,type:c}),n.push({node:d.valueExpression,type:h})),g=!1}else if(16===d.nodeType){let o;r&&s&&pe&&(0,K.isInstantiableClass)(pe)&&(o=K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(pe,[r,s],!0)));const l=(0,W.makeInferenceContext)(o);let m=Me(d.expandExpression,void 0,l);if(l&&!m.typeErrors){const e=un(l,[m.type],!i);e&&(m={...m,type:e})}m.isIncomplete&&(p=!0);const h=m.type;if((0,K.isAnyOrUnknown)(h))g=!1;else if((0,K.isClassInstance)(h)&&K.ClassType.isTypedDictClass(h)){if(re&&(0,K.isInstantiableClass)(re)){const e=K.ClassType.cloneAsInstance(re);(0,G.getTypedDictMembersForClass)(di,h,!0).forEach(((a,i)=>{(a.isRequired||a.isProvided)&&(t.push({node:d,type:K.ClassType.cloneWithLiteral(e,i)}),n.push({node:d,type:a.valueType}))})),g=!1}}else if(pe&&(0,K.isInstantiableClass)(pe)){const i=new q.TypeVarContext((0,W.getTypeVarScopeId)(pe));if(pe=K.ClassType.cloneForSpecialization(pe,pe.details.typeParameters,!0),Wa(K.ClassType.cloneAsInstance(pe),h,void 0,i,void 0,128)){const e=(0,W.applySolvedTypeVars)(pe,i).typeArguments;e&&e.length>=2&&((a||u<Z)&&(t.push({node:d,type:e[0]}),n.push({node:d,type:e[1]})),g=!1)}else{ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.dictUnpackIsNotMapping(),d)}}}else if(32===d.nodeType){const e=gn(d,s,r),i=e.type;if(e.isIncomplete&&(p=!0),(0,K.isClassInstance)(i)&&(0,W.isTupleClass)(i)){const e=null===(m=i.tupleTypeArguments)||void 0===m?void 0:m.map((e=>e.type));e&&2===e.length&&((a||u<Z)&&(t.push({node:d,type:e[0]}),n.push({node:d,type:e[1]})),g=!1)}}g&&(a||u<Z)&&(t.push({node:d,type:K.UnknownType.create()}),n.push({node:d,type:K.UnknownType.create()}))})),p}function cn(e,t){const n=31===e.nodeType?"list":"set";t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType);let a=!1,i=!1;const r=45===e.nodeType;if(!(0,K.isClassInstance)(t.expectedType))return;const s=Ta(e,n);if(!(0,K.isClassInstance)(s))return;const o=new q.TypeVarContext((0,W.getTypeVarScopeId)(s));if(!(0,_.populateTypeVarContextBasedOnExpectedType)(di,s,t.expectedType,o,N.getTypeVarScopesForNode(e),e.start))return;const l=(0,W.applySolvedTypeVars)(K.ClassType.cloneAsInstantiable(s),o);if(!l.typeArguments||1!==l.typeArguments.length)return;const c=l.typeArguments[0],d=[],u=new p.DiagnosticAddendum;e.entries.forEach((e=>{let t;t=32===e.nodeType?gn(e,c):Me(e,void 0,(0,W.makeInferenceContext)(c)),d.push(t.type),t.isIncomplete&&(a=!0),t.typeErrors&&(i=!0),t.expectedTypeDiagAddendum&&u.addAddendum(t.expectedTypeDiagAddendum),!r||t.isIncomplete||t.typeErrors||dn(e,t.type,!1)}));const m=(0,K.isClassInstance)(t.expectedType)&&K.ClassType.isBuiltIn(t.expectedType,n),y=un((0,W.makeInferenceContext)(c),d,!m);if(!y)return{type:K.UnknownType.create(),isIncomplete:a,typeErrors:!0,expectedTypeDiagAddendum:u};return{type:Ta(e,n,[y]),isIncomplete:a,typeErrors:i,expectedTypeDiagAddendum:u}}function dn(e,t,n){if(!function(e){let t=!0;return(0,W.doForEachSubtype)(mt(e),(e=>{if((0,K.isClassInstance)(e)){let n=!0;if(void 0!==e.details.isInstanceHashable)n=e.details.isInstanceHashable;else{const t=(0,W.lookUpObjectMember)(e,"__hash__",4);if(t&&t.isTypeDeclared){const e=t.symbol.getTypedDeclarations(),a=t.symbol.getSynthesizedType();a?n=!(0,K.isNoneInstance)(a):e.every((e=>1===e.type))&&(n=!1)}e.details.isInstanceHashable=n}n||(t=!1)}})),t}(t)){const a=T.getFileInfo(e),i=new p.DiagnosticAddendum;i.addMessage(y.Localizer.DiagnosticAddendum.unhashableType().format({type:ci(t)}));const r=n?y.Localizer.Diagnostic.unhashableDictKey():y.Localizer.Diagnostic.unhashableSetEntry();ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,r+i.getString(),e)}}function un(e,t,n){if((0,K.isAnyOrUnknown)(e.expectedType))return e.expectedType;const a=new q.TypeVarContext((0,W.getTypeVarScopeId)(e.expectedType)),i=e.expectedType;let r=!0;if(t.forEach((e=>{r&&!Wa(i,e,void 0,a)&&(r=!1)})),r){if(n&&t.length>0){const n=(0,K.combineTypes)(t);return(0,W.containsLiteralType)(e.expectedType)?n:Ve(n)}return(0,W.mapSubtypes)((0,W.applySolvedTypeVars)(e.expectedType,a,{applyInScopePlaceholders:!0}),(e=>{if(1!==t.length)return e;const n=t[0];return(0,K.isTypeSame)(e,n,{ignoreTypedDictNarrowEntries:!0})&&(0,K.isClass)(e)&&(0,K.isClass)(n)&&K.ClassType.isTypedDictClass(n)?K.ClassType.cloneForNarrowedTypedDictEntries(e,n.typedDictNarrowedEntries):e}))}}function mn(e,t,n,a,i,r){if("none"===e)return;const s=n.value,o=(0,K.removeUnbound)(a);if((0,K.isUnknown)(o))ot(e,t,y.Localizer.Diagnostic.typeUnknown().format({name:s}),i);else if((0,W.isPartlyUnknown)(o)&&(!r||!(0,K.isClassInstance)(a)||!a.isEmptyContainer)){const n=new p.DiagnosticAddendum;n.addMessage(y.Localizer.DiagnosticAddendum.typeOfSymbol().format({name:s,type:ci(o,{expandTypeAlias:!0})})),ot(e,t,y.Localizer.Diagnostic.typePartiallyUnknown().format({name:s})+n.getString(),i)}}function yn(e){var t;let n=!1;if(33===e.nodeType){const a=Me(e.iterableExpression);a.isIncomplete&&(n=!0);const i=null!==(t=He({type:Ve(a.type),isIncomplete:a.isIncomplete},!!e.isAsync,e.iterableExpression))&&void 0!==t?t:{type:K.UnknownType.create(),isIncomplete:a.isIncomplete};gt(e.targetExpression,i.type,!!i.isIncomplete,e.iterableExpression)}else(0,l.assert)(34===e.nodeType),Ia(e.testExpression)||Me(e.testExpression);return n}function gn(e,t,n){let a=!1,i=!1;for(const t of e.forIfNodes)yn(t)&&(a=!0);let r=K.UnknownType.create();if(17===e.expression.nodeType){const s=Me(e.expression.keyExpression,void 0,(0,W.makeInferenceContext)(n));s.isIncomplete&&(a=!0),s.typeErrors&&(i=!0);let o=s.type;n&&(0,W.containsLiteralType)(n)||(o=Ve(o));const l=Me(e.expression.valueExpression,void 0,(0,W.makeInferenceContext)(t));l.isIncomplete&&(a=!0),l.typeErrors&&(i=!0);let p=l.type;t&&(0,W.containsLiteralType)(t)||(p=Ve(p)),r=xt([o,p])}else if(16===e.expression.nodeType)Me(e.expression.expandExpression,void 0,(0,W.makeInferenceContext)(t));else if((0,g.isExpressionNode)(e)){const n=Me(e.expression,void 0,(0,W.makeInferenceContext)(t));n.isIncomplete&&(a=!0),n.typeErrors&&(i=!0),r=n.type}return{type:r,isIncomplete:a,typeErrors:i}}function hn(e,t){if(e.typeList){if(!(null==t?void 0:t.allowTypeArgList))return it(y.Localizer.Diagnostic.typeArgListNotAllowed(),e.node),!1;e.typeList.forEach((e=>{hn(e)}))}if((0,W.isEllipsisType)(e.type)&&!(null==t?void 0:t.allowTypeArgList))return it(y.Localizer.Diagnostic.ellipsisContext(),e.node),!1;if((0,K.isModule)(e.type))return it(y.Localizer.Diagnostic.moduleAsType(),e.node),!1;if((0,K.isParamSpec)(e.type)&&!(null==t?void 0:t.allowParamSpec))return it(y.Localizer.Diagnostic.paramSpecContext(),e.node),!1;if((0,K.isVariadicTypeVar)(e.type)&&!e.type.isVariadicInUnion){if(!(null==t?void 0:t.allowVariadicTypeVar))return it(y.Localizer.Diagnostic.typeVarTupleContext(),e.node),!1;kt(e.type,e.node)}return!(null==t?void 0:t.allowEmptyTuple)&&e.isEmptyTupleShorthand?(it(y.Localizer.Diagnostic.zeroLengthTupleNotAllowed(),e.node),!1):!((0,K.isUnpackedClass)(e.type)&&!(null==t?void 0:t.allowUnpackedTuples))||(it(y.Localizer.Diagnostic.unpackedArgInTypeArgument(),e.node),!1)}function fn(e,t){const n=K.FunctionType.createInstantiable(0);if(K.TypeBase.setSpecialForm(n),n.details.declaredReturnType=K.UnknownType.create(),n.details.typeVarScopeId=N.getScopeIdForNode(t),e&&e.length>0){if(e[0].typeList){const t=e[0].typeList;let a=!1,i=!1;const r=e=>{a&&(i||(it(y.Localizer.Diagnostic.variadicTypeArgsTooMany(),e.node),i=!0)),a=!0};t.forEach(((e,t)=>{let a=e.type,i=0;const s=`__p${t.toString()}`;(0,K.isVariadicTypeVar)(a)?(kt(a,e.node),i=1,r(e)):hn(e,{allowUnpackedTuples:!0})?(0,K.isUnpackedClass)(a)&&(i=1,r(e)):a=K.UnknownType.create(),K.FunctionType.addParameter(n,{category:i,name:s,isNameSynthesized:!0,type:(0,W.convertToInstance)(a),hasDeclaredType:!0})})),t.length>0&&K.FunctionType.addParameter(n,{category:0,isNameSynthesized:!1,type:K.UnknownType.create()})}else if((0,W.isEllipsisType)(e[0].type))K.FunctionType.addDefaultParameters(n),n.details.flags|=32768;else if((0,K.isParamSpec)(e[0].type))n.details.paramSpec=e[0].type;else if((0,K.isInstantiableClass)(e[0].type)&&K.ClassType.isBuiltIn(e[0].type,"Concatenate")){const t=e[0].type.typeArguments;t&&t.length>0&&t.forEach(((e,a)=>{a===t.length-1?(K.FunctionType.addParameter(n,{category:0,isNameSynthesized:!1,type:K.UnknownType.create()}),(0,K.isParamSpec)(e)&&(n.details.paramSpec=e)):K.FunctionType.addParameter(n,{category:0,name:`__p${a}`,isNameSynthesized:!0,hasDeclaredType:!0,type:e})}))}else it(y.Localizer.Diagnostic.callableFirstArg(),e[0].node);if(e.length>1){let t=e[1].type;hn(e[1])||(t=K.UnknownType.create()),n.details.declaredReturnType=(0,W.convertToInstance)(t)}else{ot(T.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.callableSecondArg(),t),n.details.declaredReturnType=K.UnknownType.create()}e.length>2&&it(y.Localizer.Diagnostic.callableExtraArgs(),e[2].node)}else K.FunctionType.addDefaultParameters(n,!0),n.details.flags|=32768;return n}function Tn(e,t,n,a){if(!n)return 0!=(256&a)?(it(y.Localizer.Diagnostic.optionalExtraArgs(),t),K.UnknownType.create()):e;if(n.length>1)return it(y.Localizer.Diagnostic.optionalExtraArgs(),t),K.UnknownType.create();let i=n[0].type;hn(n[0])?(0,W.isEffectivelyInstantiable)(i)||(pt(i,n[0].node),i=K.UnknownType.create()):i=K.UnknownType.create();const r=(0,K.combineTypes)([i,K.NoneType.createType()]);return(0,K.isUnion)(r)&&K.TypeBase.setSpecialForm(r),r}function vn(e,t,n){const a=Ta(e,t);return(0,K.isClassInstance)(a)?K.ClassType.cloneWithLiteral(a,n):K.UnknownType.create()}function bn(e,t,n){const a=fa(e,t);return(0,K.isInstantiableClass)(a)?K.ClassType.cloneWithLiteral(a,n):K.UnknownType.create()}function _n(e,t,n,a){var i;if(131072&a)return it(y.Localizer.Diagnostic.classVarNotAllowed(),t),K.AnyType.create();if(!n)return e;if(0===n.length)return it(y.Localizer.Diagnostic.classVarFirstArgMissing(),t),K.UnknownType.create();if(n.length>1)return it(y.Localizer.Diagnostic.classVarTooManyArgs(),n[1].node),K.UnknownType.create();const r=n[0].type;if((0,W.requiresSpecialization)(r,!0,!0)){ot(T.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.classVarWithTypeVar(),null!==(i=n[0].node)&&void 0!==i?i:t)}return r}function In(e,t,n,a){if(!n)return 0!=(256&a)&&it(y.Localizer.Diagnostic.typeGuardArgCount(),e),t;if(1!==n.length)return it(y.Localizer.Diagnostic.typeGuardArgCount(),e),K.UnknownType.create();const i=n.map((e=>(0,W.convertToInstance)(hn(e)?e.type:K.UnknownType.create())));return K.ClassType.cloneForSpecialization(t,i,!0)}function Cn(e,t,n){var a;const i=T.getFileInfo(t);n&&ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsExpectingNone().format({name:e.details.name}),null!==(a=n[0].node)&&void 0!==a?a:t);const r=N.getEnclosingClass(t),s=r?Ln(r):void 0;if(!s)return ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.selfTypeContext(),t),K.UnknownType.create();const o=N.getEnclosingFunction(t);if(o){const e=(0,S.getFunctionFlagsFromDecorators)(di,o,!0);if(!!!N.getEnclosingFunction(o)){if(4&e)return ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.selfTypeContext(),t),K.UnknownType.create();if(o.parameters.length>0){const e=N.getTypeAnnotationForParameter(o,0);if(e&&!N.isNodeContainedWithin(t,e)){const n=Le(e,{associateTypeVarsWithScope:!0});(0,K.isTypeVar)(n)&&n.details.isSynthesizedSelf||ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.selfTypeWithTypedSelfOrCls(),t)}}}}return(0,W.synthesizeTypeVarForSelfCls)(s.classType,!0)}function kn(e,t,n,a){if(!n&&0==(256&a))return{type:e};if(!n||1!==n.length)return it("ReadOnly"===e.details.name?y.Localizer.Diagnostic.readOnlyArgCount():"Required"===e.details.name?y.Localizer.Diagnostic.requiredArgCount():y.Localizer.Diagnostic.notRequiredArgCount(),t),{type:e};const i=n[0].type,r=N.getEnclosingClass(t,!0),s=r?Ln(r):void 0;let o=!1;s&&(0,K.isInstantiableClass)(s.classType)&&K.ClassType.isTypedDictClass(s.classType)&&N.isNodeContainedWithinNodeType(t,54)&&(o=!0),0!=(1048576&a)&&(o=!0);let l=n[0].isReadOnly,p=n[0].isRequired,c=n[0].isNotRequired;return"ReadOnly"===e.details.name?(n[0].isReadOnly&&(o=!1),l=!0):((n[0].isRequired||n[0].isNotRequired)&&(o=!1),p="Required"===e.details.name,c="NotRequired"===e.details.name),p="Required"===e.details.name,c="NotRequired"===e.details.name,o?{type:i,isReadOnly:l,isRequired:p,isNotRequired:c}:(it("ReadOnly"===e.details.name?y.Localizer.Diagnostic.readOnlyNotInTypedDict():"Required"===e.details.name?y.Localizer.Diagnostic.requiredNotInTypedDict():y.Localizer.Diagnostic.notRequiredNotInTypedDict(),t),{type:K.ClassType.cloneForSpecialization(e,[(0,W.convertToInstance)(i)],!!n)})}function Sn(e,t,n,a){if(!n&&0==(256&a))return e;if(!n||1!==n.length)return it(y.Localizer.Diagnostic.unpackArgCount(),t),K.UnknownType.create();let i=n[0].type;(0,K.isUnion)(i)&&1===i.subtypes.length&&(i=i.subtypes[0]);const r=T.getFileInfo(t);return 0!=(2097152&a)?(0,K.isInstantiableClass)(i)&&!i.includeSubclasses&&(0,W.isTupleClass)(i)?K.ClassType.cloneForUnpacked(i):(0,K.isVariadicTypeVar)(i)&&!i.isVariadicUnpacked?K.TypeVarType.cloneForUnpacked(i):(ot(r.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackExpectedTypeVarTuple(),t),K.UnknownType.create()):0!=(8388608&a)?(0,K.isInstantiableClass)(i)&&K.ClassType.isTypedDictClass(i)?K.ClassType.cloneForUnpacked(i):(ot(r.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackExpectedTypedDict(),t),K.UnknownType.create()):(ot(r.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.unpackNotAllowed(),t),K.UnknownType.create())}function wn(e,t,n,a){return 16&a?(it(y.Localizer.Diagnostic.finalContext(),t),K.AnyType.create()):n&&0!==n.length?(n.length>1&&it(y.Localizer.Diagnostic.finalTooManyArgs(),t),n[0].type):e}function An(e,t,n){return n&&0!==n.length?n.forEach(((e,t)=>{t===n.length-1?(0,K.isParamSpec)(e.type)||it(y.Localizer.Diagnostic.concatenateParamSpecMissing(),e.node):(0,K.isParamSpec)(e.type)?it(y.Localizer.Diagnostic.paramSpecContext(),e.node):(0,K.isUnpackedVariadicTypeVar)(e.type)?it(y.Localizer.Diagnostic.typeVarTupleContext(),e.node):(0,K.isUnpackedClass)(e.type)&&it(y.Localizer.Diagnostic.unpackedArgInTypeArgument(),e.node)})):it(y.Localizer.Diagnostic.concatenateTypeArgsMissing(),e),xn(t,n,void 0,!0)}function xn(e,t,n,a=!1,i=!1){const r=K.ClassType.isTupleClass(e);if(t)if(r&&1===t.length&&t[0].isEmptyTupleShorthand)t=[];else{let e=!1;const i=t=>{e&&(s||(it(y.Localizer.Diagnostic.variadicTypeArgsTooMany(),t.node),s=!0)),e=!0};let s=!1;t.forEach(((e,s)=>{(0,W.isEllipsisType)(e.type)?r?2!==t.length||1!==s?it(y.Localizer.Diagnostic.ellipsisSecondArg(),e.node):(0,K.isTypeVar)(t[0].type)&&(0,K.isVariadicTypeVar)(t[0].type)&&!t[0].type.isVariadicInUnion&&it(y.Localizer.Diagnostic.typeVarTupleContext(),t[0].node):it(y.Localizer.Diagnostic.ellipsisContext(),e.node):(0,K.isParamSpec)(e.type)&&a||((0,K.isVariadicTypeVar)(e.type)&&void 0===n?(i(e),kt(e.type,e.node)):void 0===n&&(0,K.isUnpacked)(e.type)?(i(e),hn(e,{allowUnpackedTuples:!0})):hn(e))}))}let s,l=t?t.map((e=>(0,W.convertToInstance)(e.type))):[];if(void 0!==n)if(t&&l.length>n)it(y.Localizer.Diagnostic.typeArgsTooMany().format({name:e.aliasName||e.details.name,expected:n,received:l.length}),t[n].node),l=l.slice(0,n);else if(l.length<n)for(;l.length<n;)l.push(K.UnknownType.create());if(r){const n=[];t?t.forEach(((e,t)=>{1===t&&(0,W.isEllipsisType)(l[t])?1!==n.length||n[0].isUnbounded?it(y.Localizer.Diagnostic.ellipsisSecondArg(),e.node):n[0]={type:n[0].type,isUnbounded:!0}:(0,K.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?(0,o.appendArray)(n,e.type.tupleTypeArguments):n.push({type:l[t],isUnbounded:!1})})):n.push({type:K.UnknownType.create(),isUnbounded:!0}),s=(0,W.specializeTupleClass)(e,n,void 0!==t)}else s=K.ClassType.cloneForSpecialization(e,l,void 0!==t);return i||K.TypeBase.setSpecialForm(s),s}function Pn(e,t,n,a){const i=[];if(!n)return 0!=(256&a)?(it(y.Localizer.Diagnostic.unionTypeArgCount(),t),K.NeverType.createNever()):e;for(const e of n){let t=e.type;hn(e,{allowVariadicTypeVar:!0,allowUnpackedTuples:!0})?(0,W.isEffectivelyInstantiable)(t)||(pt(t,e.node),t=K.UnknownType.create()):t=K.UnknownType.create(),(0,K.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?e.type.tupleTypeArguments.forEach((e=>{i.push((0,W.convertToInstantiable)(e.type))})):((0,K.isTypeVar)(t)&&(0,K.isUnpackedVariadicTypeVar)(t)&&(t=K.TypeVarType.cloneForUnpacked(t,!0)),i.push(t))}1===i.length&&((0,K.isVariadicTypeVar)(i[0])||(0,K.isUnpacked)(i[0])||(0,K.isNoneInstance)(i[0])||it(y.Localizer.Diagnostic.unionTypeArgCount(),t));const r=(0,K.combineTypes)(i);return(0,K.isUnion)(r)&&K.TypeBase.setSpecialForm(r),r}function Dn(e,t,n,a){if(!n)return 0!=(262400&a)&&it(y.Localizer.Diagnostic.genericTypeArgMissing(),t),e;const i=[];return n&&(0===n.length&&it(y.Localizer.Diagnostic.genericTypeArgMissing(),t),n.forEach((e=>{(0,K.isTypeVar)(e.type)?(i.some((t=>(0,K.isTypeSame)(t,e.type)))&&it(y.Localizer.Diagnostic.genericTypeArgUnique(),e.node),i.push(e.type)):it(y.Localizer.Diagnostic.genericTypeArgTypeVar(),e.node)}))),xn(e,n,void 0,!0)}function Nn(e,t,n,a,i){if(!K.TypeBase.isInstantiable(e))return e;if((0,W.isTypeAliasPlaceholder)(e))return e;a||(a=[],(0,W.doForEachSubtype)(e,(e=>{(0,W.addTypeVarsToListIfUnique)(a,(0,W.getTypeVarArgumentsRecursive)(e))})),a=a.filter((e=>!e.details.isSynthesized))),(a=a.map((e=>K.TypeBase.isInstance(e)?e:(0,W.convertToInstance)(e)))).forEach(((e,t)=>{var r;let s=n;i&&t<i.length&&(s=null!==(r=i[t].defaultExpression)&&void 0!==r?r:i[t].name),Un(s,e,a.slice(0,t))}));const r=a.filter((e=>(0,K.isVariadicTypeVar)(e)));r.length>1&&it(y.Localizer.Diagnostic.variadicTypeParamTooManyAlias().format({names:r.map((e=>`"${e.details.name}"`)).join(", ")}),n);const s=T.getFileInfo(t),o=N.getScopeIdForNode(t),l=a.filter((e=>e.scopeId!==o&&0===e.scopeType));return l.length>0&&it(y.Localizer.Diagnostic.genericTypeAliasBoundTypeVar().format({names:l.map((e=>`${e.details.name}`)).join(", ")}),n),K.TypeBase.cloneForTypeAlias(e,t.value,N.getClassFullName(t,s.moduleName,t.value),o,a.length>0?a:void 0)}function Fn(e,t,n){const a=T.getFileInfo(e);let i=K.ClassType.createInstantiable(t,N.getClassFullName(e,a.moduleName,t),a.moduleName,a.filePath,3,0,void 0,void 0);a.isTypingExtensionsStubFile&&(i.details.flags|=65536);const r=n.alias||"object";let s;if("builtins"===n.module)s=fa(e,r);else if("collections"===n.module)s=Qe(e,r,["collections"]);else if("self"===n.module){const t=va(e,r,!1);t&&(s=Da(t.symbol),(0,K.isInstantiableClass)(s)&&K.ClassType.isBuiltIn(s,"_TypedDict")&&(s.details.flags&=-1025))}return s&&(0,K.isInstantiableClass)(s)?n.alias?i=K.ClassType.cloneForTypingAlias(s,t):(i.details.baseClasses.push(s),i.details.effectiveMetaclass=s.details.effectiveMetaclass,(0,W.computeMroLinearization)(i)):(i.details.baseClasses.push(K.UnknownType.create()),i.details.effectiveMetaclass=K.UnknownType.create(),(0,W.computeMroLinearization)(i)),i}function En(e){var t;const n=T.getFileInfo(e);if(Ie(e))return;let a=0;n.isStubFile&&(a|=1),38!==e.rightExpression.nodeType&&35!==e.rightExpression.nodeType||(a|=2),Ge(e.leftExpression)&&(a|=131560,a&=-3);let i,r=Ce(e.rightExpression,a),s=!1;if(!r&&((n.isTypingStubFile||n.isTypingExtensionsStubFile)&&(r=function(e){if(38!==e.leftExpression.nodeType)return;const t=e.leftExpression.value;if("Any"===t)return K.AnyType.create();const n=new Map([["overload",{alias:"",module:"builtins"}],["TypeVar",{alias:"",module:"builtins"}],["_promote",{alias:"",module:"builtins"}],["no_type_check",{alias:"",module:"builtins"}],["NoReturn",{alias:"",module:"builtins"}],["Never",{alias:"",module:"builtins"}],["Counter",{alias:"Counter",module:"collections"}],["List",{alias:"list",module:"builtins"}],["Dict",{alias:"dict",module:"builtins"}],["DefaultDict",{alias:"defaultdict",module:"collections"}],["Set",{alias:"set",module:"builtins"}],["FrozenSet",{alias:"frozenset",module:"builtins"}],["Deque",{alias:"deque",module:"collections"}],["ChainMap",{alias:"ChainMap",module:"collections"}],["OrderedDict",{alias:"OrderedDict",module:"collections"}]]).get(t);return n?(Me(e.rightExpression),Fn(e,t,n)):void 0}(e),r&&ke(e.rightExpression,{type:r},0)),!r)){const o=Ke(e.leftExpression,{method:"set"});let l,p,d=!1;if(Ge(e.leftExpression))l=e.leftExpression.valueExpression,oi(e.rightExpression)||ot(n.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAliasIllegalExpressionForm(),e.rightExpression);else if(38===e.leftExpression.nodeType){const t=va(e.leftExpression,e.leftExpression.value,!1);if(t){const n=t.symbol.getDeclarations();1===n.length&&zn(n[0])&&(l=e.leftExpression,d=!0)}}if(l){p=K.TypeVarType.createInstantiable(`__type_alias_${l.value}`),p.details.isSynthesized=!0,p.details.recursiveTypeAliasName=l.value;const t=N.getScopeIdForNode(l);p.details.recursiveTypeAliasScopeId=t,p.scopeId=t,ke(e,{type:p},void 0),ke(e.leftExpression,{type:p},void 0),54===e.leftExpression.nodeType&&ke(e.leftExpression.valueExpression,{type:p},void 0)}const u=Me(e.rightExpression,a,(0,W.makeInferenceContext)(o));let m=u.type;i=u.expectedTypeDiagAddendum,u.isIncomplete&&(s=!0);const g=(0,O.evaluateStaticBoolExpression)(e.rightExpression,n.executionEnvironment,n.definedConstants);if(void 0!==g){const t=Ta(e,"bool");(0,K.isClassInstance)(t)&&(m=K.ClassType.cloneWithLiteral(t,g))}o&&Wa(o,m)&&((0,K.isAnyOrUnknown)(m)||(m=Ja(e,o,m))),r=m,38!==e.leftExpression.nodeType||e.typeAnnotationComment||(r=(0,w.transformTypeForPossibleEnumClass)(di,e.leftExpression,(()=>r))||r),l&&(!d||K.TypeBase.isInstantiable(r)&&!(0,K.isUnknown)(r))&&(r=Nn(r,l,e.rightExpression),(0,W.isTypeAliasRecursive)(p,r)&&(ot(n.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAliasIsRecursiveDirect().format({name:l.value}),e.rightExpression),r=K.UnknownType.create()),p.details.boundType=r,p.details.recursiveTypeParameters=null===(t=r.typeAliasInfo)||void 0===t?void 0:t.typeParameters)}gt(e.leftExpression,r,s,e.rightExpression,!0,!0,i),ke(e,{type:r,isIncomplete:s},0)}function zn(e){var t;if(si(e))return!0;if(1===e.type&&e.node.parent&&3===e.node.parent.nodeType&&9===(null===(t=e.node.parent.rightExpression)||void 0===t?void 0:t.nodeType)){const t=e.node.parent.rightExpression.leftExpression;if("TypedDict"===(38===t.nodeType&&t.value)||35===t.nodeType&&"TypedDict"===t.memberName.value&&38===t.leftExpression.nodeType){const e=Me(t,2).type;if((0,K.isInstantiableClass)(e)&&K.ClassType.isBuiltIn(e,"TypedDict"))return!0}}return!1}function Mn(e){var t;return On(e,e.name,e.expression,null===(t=e.typeParameters)||void 0===t?void 0:t.parameters,(()=>{let t=[];return e.typeParameters&&(t=Bn(e.typeParameters)),t}))}function On(e,t,n,a,i){const r=Ce(t,0);if(r)return r;const s=K.TypeVarType.createInstantiable(`__type_alias_${t.value}`);s.details.isSynthesized=!0,s.details.recursiveTypeAliasName=t.value;const o=N.getScopeIdForNode(t);s.details.recursiveTypeAliasScopeId=o,s.scopeId=o,ke(t,{type:s},void 0);const l=M.getScopeForNode(e),p=null==l?void 0:l.lookUpSymbolRecursive(t.value),d=T.getDeclaration(e);d&&p&&De(p.symbol,d,s);const u=i();s.details.recursiveTypeParameters=u,oi(n)||ot(T.getFileInfo(n).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAliasIllegalExpressionForm(),n);const m=ha(n,{allowForwardReference:!0});let g=!1,h=m.type;return m.isIncomplete&&(g=!0),h=Nn(h,t,n,u,a),(0,W.isTypeAliasRecursive)(s,h)&&(ot(T.getFileInfo(n).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAliasIsRecursiveDirect().format({name:t.value}),n),h=K.UnknownType.create()),s.details.boundType=h,ke(t,{type:h,isIncomplete:g},0),h}function Vn(e){if(Ie(e))return;ke(e,(0,P.getTypeOfAugmentedAssignment)(di,e,void 0),0)}function Rn(e){return`__type_of_${e}`}function Ln(e){const t=Ce(e.name,0);if(t){if(!(0,K.isInstantiableClass)(t))return;return{classType:t,decoratedType:Ce(e,0)||K.UnknownType.create()}}const n=M.getScopeForNode(e),a=T.getFileInfo(e);let i=0;(4===(null==n?void 0:n.type)||a.isTypingStubFile||a.isTypingExtensionsStubFile||a.isBuiltInStubFile)&&(i|=1,a.isTypingExtensionsStubFile&&(i|=65536),"property"===e.name.value&&(i|=2048),"tuple"===e.name.value&&(i|=524288)),a.isStubFile&&(i|=8388608);const r=K.ClassType.createInstantiable(e.name.value,N.getClassFullName(e,a.moduleName,e.name.value),a.moduleName,a.filePath,i,0,void 0,void 0,N.getDocString(e.suite.statements));r.details.typeVarScopeId=N.getScopeIdForNode(e);const s=null==n?void 0:n.lookUpSymbol(e.name.value);let d;const g=T.getDeclaration(e);g&&(d=g),d&&s&&De(s,d,r),r.details.flags|=131072,ke(e,{type:r},void 0),ke(e.name,{type:r},void 0);let h,f,v=[];e.typeParameters&&(v=Bn(e.typeParameters).map((e=>K.TypeVarType.cloneAsInstance(e))));const b=[];let _,I=289920;if(a.isStubFile&&(I|=4),e.arguments.forEach((t=>{if(2!==t.argumentCategory)if(t.name)if("metaclass"===t.name.value)_?it(y.Localizer.Diagnostic.metaclassDuplicate(),t):_=t.valueExpression;else if(!K.ClassType.isTypedDictClass(r)||"total"!==t.name.value&&"readonly"!==t.name.value)b.push({argumentCategory:0,node:t,name:t.name,valueExpression:t.valueExpression});else{const e=(0,O.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);void 0===e?it(y.Localizer.Diagnostic.typedDictBoolParam().format({name:t.name.value}),t.valueExpression):"total"!==t.name.value||e?"readonly"===t.name.value&&e&&(r.details.flags|=512):r.details.flags|=256}else{let n;if(1===t.argumentCategory?(Me(t.valueExpression),n=K.UnknownType.create()):n=mt(Me(t.valueExpression,I).type),(0,K.isUnion)(n)&&(n=(0,K.removeUnbound)(n)),(0,K.isAnyOrUnknown)(n)||(0,K.isUnbound)(n)||((0,W.isMetaclassInstance)(n)?((0,l.assert)((0,K.isClassInstance)(n)),n=n.typeArguments&&n.typeArguments.length>0?n.typeArguments[0]:K.UnknownType.create()):(0,K.isInstantiableClass)(n)?((K.ClassType.isPartiallyEvaluated(n)||n.details.mro.some((e=>(0,K.isClass)(e)&&K.ClassType.isPartiallyEvaluated(e))))&&qn(e,n),K.ClassType.isBuiltIn(n,"Protocol")&&(!a.isStubFile&&!K.ClassType.isTypingExtensionClass(n)&&a.executionEnvironment.pythonVersion<u.PythonVersion.V3_7&&it(y.Localizer.Diagnostic.protocolIllegal(),t.valueExpression),r.details.flags|=8192),K.ClassType.isBuiltIn(n,"property")&&(r.details.flags|=2048),a.executionEnvironment.pythonVersion>=u.PythonVersion.V3_6&&K.ClassType.isBuiltIn(n,"NamedTuple")&&(r.details.flags|=16777252),K.ClassType.isBuiltIn(n,"TypedDict")||K.ClassType.isTypedDictClass(n)?r.details.flags|=128:K.ClassType.isTypedDictClass(r)&&!K.ClassType.isTypedDictClass(n)&&((0,K.isInstantiableClass)(n)&&K.ClassType.isBuiltIn(n,"Generic")||it(y.Localizer.Diagnostic.typedDictBaseClass(),t)),(0,W.derivesFromClassRecursive)(n,r,!0)&&(it(y.Localizer.Diagnostic.baseClassCircular(),t),n=K.UnknownType.create())):(ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.baseClassInvalid(),t),n=K.UnknownType.create())),(0,K.isUnknown)(n)&&ot(a.diagnosticRuleSet.reportUntypedBaseClass,c.DiagnosticRule.reportUntypedBaseClass,y.Localizer.Diagnostic.baseClassUnknown(),t),r.details.baseClasses.some((e=>(0,K.isInstantiableClass)(e)&&(0,K.isInstantiableClass)(n)&&K.ClassType.isSameGenericClass(n,e)))&&ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.duplicateBaseClass(),t.name||t),r.details.baseClasses.push(n),(0,K.isInstantiableClass)(n)&&(K.ClassType.isEnumClass(n)&&(r.details.flags|=1048576),(K.ClassType.supportsAbstractMethods(n)||K.ClassType.isProtocolClass(n)&&!K.ClassType.isBuiltIn(n))&&(r.details.flags|=1024),K.ClassType.isPropertyClass(n)&&(r.details.flags|=2048),K.ClassType.isFinal(n))){const e=li(n);it(y.Localizer.Diagnostic.baseClassFinal().format({type:e}),t.valueExpression)}(0,W.addTypeVarsToListIfUnique)(v,(0,W.getTypeVarArgumentsRecursive)(n)),(0,K.isInstantiableClass)(n)&&(K.ClassType.isBuiltIn(n,"Generic")?e.typeParameters?ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.genericBaseClassNotAllowed(),t.valueExpression):h||(f&&ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.duplicateGenericAndProtocolBase(),t.valueExpression),h=[],(0,W.addTypeVarsToListIfUnique)(h,(0,W.getTypeVarArgumentsRecursive)(n))):K.ClassType.isBuiltIn(n,"Protocol")&&n.typeArguments&&n.typeArguments.length>0&&(f||(h&&ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.duplicateGenericAndProtocolBase(),t.valueExpression),f=[],(0,W.addTypeVarsToListIfUnique)(f,(0,W.getTypeVarArgumentsRecursive)(n)),e.typeParameters&&f.length>0&&(ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.protocolBaseClassWithTypeArgs(),t.valueExpression),f=[]))))}else Me(t.valueExpression)})),r.details.baseClasses.length>1){let t=!1,n=!1;r.details.baseClasses.forEach((e=>{(0,K.isInstantiableClass)(e)&&(K.ClassType.isBuiltIn(e,"NamedTuple")?t=!0:K.ClassType.isBuiltIn(e,"Generic")||(n=!0))})),t&&n&&ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.namedTupleMultipleInheritance(),e.name)}K.ClassType.isBuiltIn(r,"object")||0!==r.details.baseClasses.filter((e=>(0,K.isClass)(e))).length||r.details.baseClasses.push(fa(e,"object")),h=null!=h?h:f,h&&!e.typeParameters&&function(e,t,n){const a=t.filter((e=>!n.some((t=>t.details.name===e.details.name))));if(a.length>0){const t=new p.DiagnosticAddendum;t.addMessage(y.Localizer.DiagnosticAddendum.typeVarsMissing().format({names:a.map((e=>`"${e.details.name}"`)).join(", ")})),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarsNotInGenericOrProtocol()+t.getString(),e)}}(e.name,v,h),r.details.typeParameters=null!=h?h:v,r.details.typeParameters.some((e=>0===e.details.declaredVariance&&void 0===e.computedVariance))&&(r.details.requiresVarianceInference=!0);const k=r.details.typeParameters.filter((e=>(0,K.isVariadicTypeVar)(e)));k.length>1&&it(y.Localizer.Diagnostic.variadicTypeParamTooManyClass().format({names:k.map((e=>`"${e.details.name}"`)).join(", ")}),e.name,m.TextRange.combine(e.arguments)||e.name),r.details.typeParameters.forEach(((t,n)=>{var a;let i=e.name;if(e.typeParameters&&n<e.typeParameters.parameters.length){const t=e.typeParameters.parameters[n];i=null!==(a=t.defaultExpression)&&void 0!==a?a:t.name}Un(i,t,r.details.typeParameters.slice(0,n))})),(0,W.computeMroLinearization)(r)||it(y.Localizer.Diagnostic.methodOrdering(),e.name);const w=M.getScopeForNode(e.suite);r.details.fields=(null==w?void 0:w.symbolTable)?new Map(w.symbolTable):new Map;const A=null==w?void 0:w.getSlotsNames();if(A&&(r.details.localSlotsNames=A),!a.isStubFile&&0===r.details.typeParameters.length){const t=r.details.fields.get("__init__");if(t){const n=t.getTypedDeclarations();if(1===n.length&&5===n[0].type){const t=n[0].node,a=t.parameters;if(a.length>1&&!a.some(((e,n)=>!!N.getTypeAnnotationForParameter(t,n)))){const n=a.filter(((e,t)=>t>0&&e.name&&0===e.category&&!e.defaultValue));n.length>0&&(r.details.flags|=16384,r.details.typeParameters=n.map((n=>{const a=K.TypeVarType.createInstance(Rn(n.name.value));return a.details.isSynthesized=!0,a.scopeId=N.getScopeIdForNode(t),a.details.boundType=K.UnknownType.create(),K.TypeVarType.cloneForScopeId(a,N.getScopeIdForNode(e),e.name.value,0)})))}}}}if(0!==r.details.typeParameters.length||K.ClassType.isBuiltIn(r,"type")||(r.details.baseClasses.some((e=>(0,K.isInstantiableClass)(e)&&K.ClassType.hasCustomClassGetItem(e)))||r.details.fields.has("__class_getitem__"))&&(r.details.flags|=262144),_){const e=Me(_,I).type;((0,K.isInstantiableClass)(e)||(0,K.isUnknown)(e))&&((0,W.requiresSpecialization)(e,!0)&&ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.metaclassIsGeneric(),_),r.details.declaredMetaclass=e,(0,K.isInstantiableClass)(e)&&(K.ClassType.isBuiltIn(e,"EnumMeta")?r.details.flags|=1048576:K.ClassType.isBuiltIn(e,"ABCMeta")&&(r.details.flags|=1024)))}const x=Wn(r,e.name);r.details.flags&=-131073;let P,D=r,F=!1;for(let t=e.decorators.length-1;t>=0;t--){const n=e.decorators[t],i=(0,S.applyClassDecorator)(di,D,r,n),s=(0,W.containsAnyOrUnknown)(i,!1);s&&(0,K.isUnknown)(s)?F||(ot(a.diagnosticRuleSet.reportUntypedClassDecorator,c.DiagnosticRule.reportUntypedClassDecorator,y.Localizer.Diagnostic.classDecoratorTypeUnknown(),e.decorators[t].expression),F=!0):D=i}if((0,K.isInstantiableClass)(x)&&x.details.classDataClassTransform)P=x.details.classDataClassTransform;else{const e=r.details.mro.find((e=>(0,K.isClass)(e)&&void 0!==e.details.classDataClassTransform&&!K.ClassType.isSameGenericClass(e,r)));e&&(P=e.details.classDataClassTransform)}var E;if(P&&((0,C.applyDataClassDefaultBehaviors)(r,P),(0,C.applyDataClassClassBehaviorOverrides)(di,e.name,r,b,P)),E=r,ge.forEach((e=>{K.ClassType.isSameGenericClass(e.dependsUpon,E)&&e.classesToComplete.forEach((e=>{const t=Ce(e.name,0);t&&function(e,t){(0,W.computeMroLinearization)(e)||it(y.Localizer.Diagnostic.methodOrdering(),t),Wn(e,t)}(t,e.name)}))})),ge=ge.filter((e=>!K.ClassType.isSameGenericClass(e.dependsUpon,E))),qn(e,void 0),K.ClassType.isTypedDictClass(r)&&(0,G.synthesizeTypedDictClassMethods)(di,e,r,(0,K.isClass)(D)&&K.ClassType.isFinal(D)),K.ClassType.isDataClass(r)){const t=K.ClassType.isSkipSynthesizedDataClassInit(r);let n=t;if(!t){(0,W.lookUpClassMember)(r,"__init__",2)&&(n=!0)}let a=!1;(0,W.lookUpClassMember)(r,"__hash__",2)&&(a=!0),(0,C.synthesizeDataClassMethods)(di,e,r,t,n,a)}if(r.details.localSlotsNames){let e=!0;const t=Array.from(r.details.localSlotsNames);r.details.baseClasses.forEach((n=>{(0,K.isInstantiableClass)(n)?K.ClassType.isBuiltIn(n,"object")||K.ClassType.isBuiltIn(n,"type")||K.ClassType.isBuiltIn(n,"Generic")||(void 0===n.details.inheritedSlotsNames?e=!1:(0,o.appendArray)(t,n.details.inheritedSlotsNames)):e=!1})),e&&(r.details.inheritedSlotsNames=t)}return ke(e.name,{type:r},0),ke(e,{type:D},0),{classType:r,decoratedType:D}}function Un(e,t,n){if(!t.details.defaultType&&!t.details.isSynthesized&&!t.details.isSynthesizedSelf){const a=n.find((e=>e.details.defaultType));return void(a&&ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarWithoutDefault().format({name:t.details.name,other:a.details.name}),e))}const a=new Set;if((0,W.validateTypeVarDefault)(t,n,a),a.size>0){const n=new p.DiagnosticAddendum;a.forEach((e=>{n.addMessage(y.Localizer.DiagnosticAddendum.typeVarDefaultOutOfScope().format({name:e}))})),ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarDefaultInvalidTypeVar().format({name:t.details.name})+n.getString(),e)}}function jn(e){if(!e.details.requiresVarianceInference)return;if(!X||!(0,K.isClassInstance)(X))return;e.details.requiresVarianceInference=!1,e.details.typeParameters.forEach((e=>{0===e.details.declaredVariance&&(e.computedVariance=1)}));const t=e.details.typeParameters.map((e=>K.TypeVarType.cloneAsInvariant(e))),n=K.ClassType.cloneWithNewTypeParameters(e,t),a=K.ClassType.createInstantiable("__varianceDummy","","","",0,0,void 0,void 0);t.forEach(((i,r)=>{if(i.details.isVariadic||i.details.isParamSpec)return;if(0!==i.details.declaredVariance)return;const s=t.map(((e,t)=>e.details.isVariadic?e:t===r?X:a)),o=t.map(((e,t)=>t===r||e.details.isVariadic?e:a)),l=K.ClassType.cloneForSpecialization(n,s,!0),p=K.ClassType.cloneForSpecialization(n,o,!0);let c;if(Ua(l,p,!1))c=3;else{c=Ua(p,l,!1)?4:2}e.details.typeParameters[r].computedVariance=c}))}function Bn(e){const t=[];return e.parameters.forEach((e=>{var n;const a=T.getTypeParameterSymbol(e.name);(0,l.assert)(a);const i=null===(n=Fa(a,e.name))||void 0===n?void 0:n.type;i&&(0,K.isTypeVar)(i)&&(ke(e.name,{type:i},0),t.push(i))})),t}function Wn(e,t){let n=e.details.declaredMetaclass,a=!1;if(!n||(0,K.isInstantiableClass)(n))for(const i of e.details.baseClasses){if(!(0,K.isInstantiableClass)(i)){n=K.UnknownType.create();break}{const r=i.details.effectiveMetaclass||ee;if(!r||!(0,K.isInstantiableClass)(r)){n=r?K.UnknownType.create():void 0;break}n?(0,W.derivesFromClassRecursive)(r,n,!1)?n=r:(0,W.derivesFromClassRecursive)(n,r,!1)||a||(ot(T.getFileInfo(t).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.metaclassConflict(),t),a=!0):n=r,K.ClassType.isEnumClass(i)&&(e.details.flags|=1048576)}}if(!n){const e=fa(t,"type");n=e&&(0,K.isInstantiableClass)(e)?e:K.UnknownType.create()}return e.details.effectiveMetaclass=n,n}function qn(e,t){if(t){const n=ge.find((e=>K.ClassType.isSameGenericClass(e.dependsUpon,t)));n?n.classesToComplete.push(e):ge.push({dependsUpon:t,classesToComplete:[e]})}else ge.forEach((t=>{t.classesToComplete.push(e)}))}function Gn(e,t){const n=[];e.arguments.forEach((e=>{e.name&&"metaclass"!==e.name.value&&n.push({argumentCategory:0,node:e,name:e.name,valueExpression:e.valueExpression})}));const a=n.length>0?n[0].node.name:e.name,i=It(a,t,!1,"__init_subclass__",{method:"get"},void 0,133,t);if(i){const e=i.type;e&&jt(a,n,{type:e},void 0,!1,(0,W.makeInferenceContext)(K.NoneType.createInstance()))}else if(t.details.effectiveMetaclass&&(0,K.isClass)(t.details.effectiveMetaclass)){const i=(0,W.lookUpClassMember)(t.details.effectiveMetaclass,"__new__",32);if(i){const t=Va(i);if((0,K.isFunction)(t)){const i=(0,D.getParameterListDetails)(t);if(void 0!==i.firstKeywordOnlyIndex){const r=new Map;for(let e=i.firstKeywordOnlyIndex;e<i.params.length;e++){const t=i.params[e];0===t.param.category&&t.param.name&&r.set(t.param.name,e)}n.forEach((n=>{var s,o,l;const p=new W.UniqueSignatureTracker;if(0===n.argumentCategory&&n.name){const d=null!==(s=r.get(n.name.value))&&void 0!==s?s:i.kwargsIndex;if(void 0!==d){const e=i.params[d];Jt({paramCategory:e.param.category,paramType:K.FunctionType.getEffectiveParameterType(t,e.index),requiresTypeVarMatching:!1,argument:n,errorNode:null!==(o=n.valueExpression)&&void 0!==o?o:a},new q.TypeVarContext,p,{type:t},{skipUnknownArgCheck:!0,skipOverloadArg:!0}),r.delete(n.name.value)}else ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramNameMissing().format({name:n.name.value}),null!==(l=n.name)&&void 0!==l?l:a)}}));const s=[];if(r.forEach(((e,t)=>{i.params[e].param.hasDefault||s.push(t)})),s.length>0){const e=s.map((e=>`"${e}"`)).join(", ");ot(T.getFileInfo(a).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,1===s.length?y.Localizer.Diagnostic.argMissingForParam().format({name:e}):y.Localizer.Diagnostic.argMissingForParams().format({names:e}),a)}}}}}n.forEach((e=>{e.valueExpression&&Me(e.valueExpression)}))}function Kn(e){var t,n;const a=T.getFileInfo(e),i=Ce(e.name,0);if(i){if(!(0,K.isFunction)(i))return;return{functionType:i,decoratedType:Ce(e,0)||K.UnknownType.create()}}let r;const s=T.getDeclaration(e);s&&(r=s);const o=N.getEnclosingClass(e,!0);let l;if(o){const e=Ln(o);if(!e)return;l=e.classType}let d=(0,S.getFunctionFlagsFromDecorators)(di,e,!!o);(null==r?void 0:r.isGenerator)&&(d|=16),a.isStubFile?d|=2048:a.isInPyTypedPackage&&(d|=4096),e.isAsync&&(d|=512);const u=K.FunctionType.createInstance(e.name.value,function(e,t,n){const a=[n];let i=e;for(;i;)i=N.getEnclosingClassOrFunction(i),i&&a.push(i.name.value);return a.push(t),a.reverse().join(".")}(e,a.moduleName,e.name.value),a.moduleName,131072|d,N.getDocString(e.suite.statements));u.details.typeVarScopeId=N.getScopeIdForNode(e),"__init__"!==e.name.value&&"__new__"!==e.name.value||o&&(u.details.constructorTypeVarScopeId=N.getScopeIdForNode(o)),(a.isBuiltInStubFile||a.isTypingStubFile||a.isTypingExtensionsStubFile)&&(u.details.builtInName=e.name.value),u.details.declaration=r;const m=M.getScopeForNode(e),g=null==m?void 0:m.lookUpSymbolRecursive(e.name.value);r&&g&&De(g.symbol,r,u),ke(e,{type:u},void 0),ke(e.name,{type:u},void 0);const h=l&&K.ClassType.isPseudoGenericClass(l)&&"__init__"===e.name.value,f=[];let v=0;if(l&&0==(4&u.details.flags)&&(v=1),e.functionAnnotationComment&&!e.functionAnnotationComment.isParamListEllipsis){const t=e.parameters.length-v,n=e.functionAnnotationComment.paramTypeAnnotations.length;v>0&&n===e.parameters.length?v=0:n!==t&&it(y.Localizer.Diagnostic.annotatedParamCountMismatch().format({expected:t,received:n}),e.functionAnnotationComment)}const b=[];e.typeParameters?u.details.typeParameters=Bn(e.typeParameters):u.details.typeParameters=b;const _=e=>{if(e.name){const t=va(e.name,e.name.value,!1);t&&ft(a,t.symbol,e.name)}};let I=!0;const C=l&&(K.FunctionType.isClassMethod(u)||K.FunctionType.isInstanceMethod(u)||K.FunctionType.isConstructorMethod(u)),k=C?1:0;if(e.parameters.forEach(((t,n)=>{let i,r,s,o,d=!1;if(t.name&&(0===n&&C||K.FunctionType.isAbstractMethod(u)||l&&K.ClassType.isProtocolClass(l))&&_(t),t.typeAnnotation)s=t.typeAnnotation;else if(t.typeAnnotationComment)s=t.typeAnnotationComment;else if(e.functionAnnotationComment&&!e.functionAnnotationComment.isParamListEllipsis){const t=n-v;t>=0&&t<e.functionAnnotationComment.paramTypeAnnotations.length&&(s=e.functionAnnotationComment.paramTypeAnnotations[t])}if(s&&(r=Re(s,t.category),(0,K.isVariadicTypeVar)(r)&&!r.isVariadicUnpacked&&(it(y.Localizer.Diagnostic.unpackedTypeVarTupleExpected().format({name1:r.details.name,name2:r.details.name}),s),r=K.UnknownType.create())),!r&&h&&n>0&&0===t.category&&t.name&&!t.defaultValue){const e=Rn(t.name.value);r=l.details.typeParameters.find((t=>t.details.name===e))}if(r){const e=$n(t,r);e!==r&&(r=e,d=!0)}if(t.defaultValue&&(o=Me(t.defaultValue,1,(0,W.makeInferenceContext)(r)).type),r){if(t.defaultValue&&o){const n=new p.DiagnosticAddendum,i=new q.TypeVarContext(u.details.typeVarScopeId);if(l&&void 0!==l.details.typeVarScopeId&&("__init__"!==e.name.value&&"__new__"!==e.name.value||i.addSolveForScope(l.details.typeVarScopeId)),!Wa(r,o,n,i)){const e=ot(a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.paramAssignmentMismatch().format({sourceType:ci(o),paramType:ci(r)})+n.getString(),t.defaultValue);if(d&&s){const t={action:"pyright.addoptionalforparam",offsetOfTypeNode:s.start+1};null==e||e.addAction(t)}}}i=r}if(n>=k){let e=!1;0===t.category&&t.name?(0,R.isPrivateName)(t.name.value)&&(e=!0):I=!1,I&&!e&&u.details.parameters.length>k&&K.FunctionType.addParameter(u,{category:0,type:K.UnknownType.create()}),e||(I=!1)}let m=!1;if(!s){m=!0;const t=Hn(e,u.details.flags,n,l);t&&(i=t)}const g={category:t.category,name:t.name?t.name.value:void 0,hasDefault:!!t.defaultValue,defaultValueExpression:t.defaultValue,defaultType:o,type:null!=i?i:K.UnknownType.create(),typeAnnotation:s,hasDeclaredType:!!s,isTypeInferred:m};if(K.FunctionType.addParameter(u,g),g.hasDeclaredType&&(0,W.addTypeVarsToListIfUnique)(b,(0,W.getTypeVarArgumentsRecursive)(g.type)),t.name){const n=Zn(e,t.category,g.type);f.push(n)}else f.push(g.type)})),I&&u.details.parameters.length>k&&K.FunctionType.addParameter(u,{category:0,type:K.UnknownType.create()}),f.forEach(((t,n)=>{const a=e.parameters[n].name;a&&((0,K.isUnknown)(t)&&(u.details.flags|=16384),ke(a,{type:t},0))})),f.length>=2){const e=f[f.length-2],t=f[f.length-1];(0,K.isParamSpec)(e)&&"args"===e.paramSpecAccess&&(0,K.isParamSpec)(t)&&"kwargs"===t.paramSpecAccess&&(u.details.flags|=32768)}const w=null!==(t=e.returnTypeAnnotation)&&void 0!==t?t:null===(n=e.functionAnnotationComment)||void 0===n?void 0:n.returnTypeAnnotation;if(w){u.details.declaredReturnType=K.UnknownType.create();const e=Le(w,{associateTypeVarsWithScope:!0});u.details.declaredReturnType=e}else a.isStubFile&&("__init__"===e.name.value?u.details.declaredReturnType=K.NoneType.createInstance():u.details.declaredReturnType=K.UnknownType.create());u.details.declaredReturnType&&w&&function(e,t,n){const a=(0,W.getTypeVarArgumentsRecursive)(e),i=[];a.forEach((a=>{K.TypeBase.isInstantiable(a)&&(a=K.TypeVarType.cloneAsInstance(a)),a.scopeId===t.details.typeVarScopeId&&(n.some((e=>(0,K.isTypeSame)((0,W.convertToInstance)(e),a)))||(0,W.isTypeVarLimitedToCallable)(e,a)&&i.push(a))})),(0,W.addTypeVarsToListIfUnique)(n,a),i.length>0&&(t.details.rescopedTypeParameters=i)}(u.details.declaredReturnType,u,b),(a.isStubFile||N.isSuiteEmpty(e.suite))&&u.details.declaredReturnType&&(0,K.isClassInstance)(u.details.declaredReturnType)&&K.ClassType.isBuiltIn(u.details.declaredReturnType,["Generator","AsyncGenerator","AwaitableGenerator"])&&(u.details.flags|=16),u.details.typeParameters.forEach(((t,n)=>{var a;let i=e.name;if(e.typeParameters&&n<e.typeParameters.parameters.length){const t=e.typeParameters.parameters[n];i=null!==(a=t.defaultExpression)&&void 0!==a?a:t.name}Un(i,t,u.details.typeParameters.slice(0,n))})),u.details.flags&=-131073;const A=e.isAsync?function(e,t){const n=K.FunctionType.clone(t);t.details.declaredReturnType&&(n.details.declaredReturnType=Yn(e,t.details.declaredReturnType,K.FunctionType.isGenerator(t)));return t.details.flags|=1024,n.details.flags|=1024,n}(e,u):u;let x=A,P=!1;for(let t=e.decorators.length-1;t>=0;t--){const n=e.decorators[t],i=(0,S.applyFunctionDecorator)(di,x,u,n,e),r=(0,W.containsAnyOrUnknown)(i,!1);r&&(0,K.isUnknown)(r)?P||(ot(a.diagnosticRuleSet.reportUntypedFunctionDecorator,c.DiagnosticRule.reportUntypedFunctionDecorator,y.Localizer.Diagnostic.functionDecoratorTypeUnknown(),e.decorators[t].expression),P=!0):x=i}return(0,K.isFunction)(x)&&(K.FunctionType.isOverloaded(x)&&e.parameters.forEach((e=>{_(e)})),x=(0,S.addOverloadsToFunctionType)(di,e,x)),ke(e.name,{type:u},0),ke(e,{type:x},0),{functionType:u,decoratedType:x}}function $n(e,t){var n;return 11!==(null===(n=e.defaultValue)||void 0===n?void 0:n.nodeType)||26!==e.defaultValue.constType||(0,W.isOptionalType)(t)||T.getFileInfo(e).diagnosticRuleSet.strictParameterNoneValue?t:(0,K.combineTypes)([t,K.NoneType.createInstance()])}function Hn(e,t,n,a){var i;if(a){if(0===n&&0==(4&t)){const e=0!=(3&t);return(0,W.synthesizeTypeVarForSelfCls)(a,e)}const r=e.name.value,s=(0,W.lookUpClassMember)(a,r,1);if(s){const t=s.symbol.getDeclarations();if(1===t.length&&5===t[0].type){const a=t[0].node;if(a.parameters.length===e.parameters.length&&a.parameters.every(((t,n)=>{var a,i;const r=e.parameters[n];return(null===(a=r.name)||void 0===a?void 0:a.value)===(null===(i=t.name)||void 0===i?void 0:i.value)&&r.category===t.category}))){const t=a.parameters[n],r=null!==(i=t.typeAnnotation)&&void 0!==i?i:t.typeAnnotationComment;if(r){let t=Re(r,e.parameters[n].category);if((0,W.requiresSpecialization)(t)&&(0,K.isClass)(s.classType)){const e=(0,W.buildTypeVarContextFromSpecializedClass)(s.classType);t=(0,W.applySolvedTypeVars)(t,e)}const a=T.getFileInfo(e);return a.isInPyTypedPackage&&!a.isStubFile&&(t=K.TypeBase.cloneForAmbiguousType(t)),t}}}}}const r=e.parameters[n].defaultValue;if(r){const t=Me(r,1).type;let n;if((0,K.isNoneInstance)(t)||(0,K.isClassInstance)(t)&&(0,R.isPrivateOrProtectedName)(t.details.name))n=(0,K.combineTypes)([t,K.UnknownType.create()]);else{let e=!1;((0,K.isFunction)(t)||(0,K.isOverloadedFunction)(t)||(0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,["tuple","list","set","dict"]))&&(e=!0),e||(n=Ve(t))}if(n){const t=T.getFileInfo(e);t.isInPyTypedPackage&&!t.isStubFile&&(n=K.TypeBase.cloneForAmbiguousType(n))}return n}}function Zn(e,t,n){switch(t){case 0:return n;case 1:return(0,K.isTypeVar)(n)&&n.paramSpecAccess?n:(0,K.isUnpackedClass)(n)?K.ClassType.cloneForUnpacked(n,!1):ne&&(0,K.isInstantiableClass)(ne)?K.ClassType.cloneAsInstance((0,W.specializeTupleClass)(ne,[{type:n,isUnbounded:!(0,K.isVariadicTypeVar)(n)}],!0)):K.UnknownType.create();case 2:{if((0,K.isTypeVar)(n)&&n.paramSpecAccess)return n;if((0,K.isClassInstance)(n)&&K.ClassType.isTypedDictClass(n)&&n.isUnpacked)return n;const t=fa(e,"dict"),a=Ta(e,"str");return(0,K.isInstantiableClass)(t)&&(0,K.isClassInstance)(a)?K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(t,[a,n],!0)):K.UnknownType.create()}}}function Yn(e,t,n){let a;if((0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t))if("Generator"===t.details.name){const n=Ye(e,"AsyncGenerator");if(n&&(0,K.isInstantiableClass)(n)){const e=[],i=t.typeArguments;i&&i.length>0&&e.push(i[0]),i&&i.length>1&&e.push(i[1]),a=K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(n,e,!0))}}else["AsyncGenerator","AsyncIterator","AsyncIterable"].some((e=>e===t.details.name))&&(a=t);if(!a||!n){const n=Ye(e,"Coroutine");a=n&&(0,K.isInstantiableClass)(n)?K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(n,[K.AnyType.create(),K.AnyType.create(),t],!0)):K.UnknownType.create()}return a}function Jn(e,t){var n;if(e.returnTypeAnnotation||(null===(n=e.functionAnnotationComment)||void 0===n?void 0:n.returnTypeAnnotation))return;let a=Ce(e.suite,0),i=!1;if(a)return{type:a,isIncomplete:i};if(ce.has(e.id)||ce.size>=12)a=K.UnknownType.create(),i=!0;else{ce.add(e.id);try{let n;const r=T.getDeclaration(e);r&&(n=r);const s=!tt(e),o=tt(e.suite);if(T.getFileInfo(e).isStubFile)a=K.UnknownType.create();else{if(s)a=t||function(e){if(!e||!e.isMethod||e.returnStatements||e.yieldStatements||!e.raiseStatements)return!1;for(const t of e.raiseStatements){if(!t.typeExpression||t.valueExpression)return!1;const e=Me(t.typeExpression).type,n=(0,K.isInstantiableClass)(e)||(0,K.isClassInstance)(e)?e:void 0;if(!n||!(0,W.derivesFromStdlibClass)(n,"NotImplementedError"))return!1}return!0}(n)?K.UnknownType.create():K.NeverType.createNoReturn();else{const e=[];(null==n?void 0:n.returnStatements)&&n.returnStatements.forEach((t=>{if(et(t))if(t.returnExpression){const n=Me(t.returnExpression);n.isIncomplete&&(i=!0);let a=n.type;a=(0,W.mapSubtypes)(a,(e=>(0,K.isClassInstance)(e)&&e.isEmptyContainer?K.ClassType.cloneForSpecialization(e,e.typeArguments,!!e.isTypeArgumentExplicit,e.includeSubclasses,e.tupleTypeArguments,!1):e)),e.push(a)}else e.push(K.NoneType.createInstance())})),!s&&o&&e.push(K.NoneType.createInstance()),a=(0,K.combineTypes)(e),a=(0,K.removeUnbound)(a)}if(null==n?void 0:n.isGenerator){const t=[];let i=!1,r=!1;n.yieldStatements&&n.yieldStatements.forEach((e=>{var n,a;if(et(e))if(61===e.nodeType){r=!0;const a=Me(e.expression);if((0,K.isClassInstance)(a.type)&&K.ClassType.isBuiltIn(a.type,"Coroutine"))t.push(),i=!0;else{const i=null===(n=He(a,!1,e))||void 0===n?void 0:n.type;t.push(null!=i?i:K.UnknownType.create())}}else if(47!==(null===(a=null==e?void 0:e.parent)||void 0===a?void 0:a.nodeType)&&(r=!0),e.expression){const n=Me(e.expression).type;t.push(null!=n?n:K.UnknownType.create())}else t.push(K.NoneType.createInstance())})),0===t.length&&t.push(K.NoneType.createInstance());const s=(0,K.combineTypes)(t),o=Ye(e,i?"AwaitableGenerator":"Generator");if(o&&(0,K.isInstantiableClass)(o)){const e=[],t=r?K.UnknownType.create():K.AnyType.create();e.push(s,t,(0,K.isNever)(a)?K.NoneType.createInstance():a),i&&e.push(K.AnyType.create()),a=K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(o,e,!0))}else a=K.UnknownType.create()}}ke(e.suite,{type:a,isIncomplete:i},0)}finally{ce.delete(e.id)}}return a?{type:a,isIncomplete:i}:void 0}function Qn(e){var t,n;if(Ie(e))return;const a=Me(e.iterableExpression),i=null!==(n=null===(t=He(a,!!e.isAsync,e.iterableExpression))||void 0===t?void 0:t.type)&&void 0!==n?n:K.UnknownType.create();gt(e.targetExpression,i,!!a.isIncomplete,e.targetExpression),ke(e,{type:i,isIncomplete:!!a.isIncomplete},0)}function Xn(e){if((0,l.assert)(void 0!==e.typeExpression),Ie(e))return;const t=Me(e.typeExpression),n=t.type;function a(e,n){var a,i;if(e=mt(e),(0,K.isAnyOrUnknown)(e))return e;if((0,K.isInstantiableClass)(e))return K.ClassType.cloneAsInstance(e);if((0,K.isClassInstance)(e)){const r=null!==(i=null===(a=He({type:e,isIncomplete:t.isIncomplete},!1,n))||void 0===a?void 0:a.type)&&void 0!==i?i:K.UnknownType.create();return(0,W.mapSubtypes)(r,(e=>(0,K.isAnyOrUnknown)(e)?e:K.UnknownType.create()))}return K.UnknownType.create()}let i=(0,W.mapSubtypes)(n,(t=>{const n=(0,W.getSpecializedTupleType)(t);if(n&&n.tupleTypeArguments){const t=n.tupleTypeArguments.map((t=>a(t.type,e.typeExpression)));return(0,K.combineTypes)(t)}return a(t,e.typeExpression)}));e.isExceptGroup&&(i=Ta(e,"BaseExceptionGroup",[i])),e.name&&gt(e.name,i,!1,e.name),ke(e,{type:i},0)}function ea(e){if(Ie(e))return;const t=Me(e.expression);let n=t.type;const a=e.parent&&58===e.parent.nodeType&&!!e.parent.isAsync;if((0,W.isOptionalType)(n)){ot(T.getFileInfo(e).diagnosticRuleSet.reportOptionalContextManager,c.DiagnosticRule.reportOptionalContextManager,y.Localizer.Diagnostic.noneNotUsableWith(),e.expression),n=(0,K.removeNoneFromUnion)(n)}const i=a?"__aenter__":"__enter__",r=(0,W.mapSubtypes)(n,(t=>{if(t=mt(t),(0,K.isAnyOrUnknown)(t))return t;const n=new p.DiagnosticAddendum;if((0,K.isClass)(t)){let r=on(t,[],i,e.expression,void 0);if(r)return a&&(r=$e(r,e.expression)),r;a||on(t,[],"__aenter__",e.expression,void 0)&&n.addMessage(y.Localizer.DiagnosticAddendum.asyncHelp())}return ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotUsableWith().format({type:ci(t),method:i})+n.getString(),e.expression),K.UnknownType.create()})),s=a?"__aexit__":"__exit__";(0,W.doForEachSubtype)(n,(t=>{if(t=mt(t),(0,K.isAnyOrUnknown)(t))return;if((0,K.isClass)(t)){const n={type:K.AnyType.create()};if(on(t,[n,n,n],s,e.expression,void 0))return}ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeNotUsableWith().format({type:ci(t),method:s}),e.expression)})),e.target&&gt(e.target,r,!!t.isIncomplete,e.target),ke(e,{type:r,isIncomplete:!!t.isIncomplete},0)}function ta(e){var t;if(Ie(e))return;let n;if(n=e.alias?e.alias:e.module.nameParts[0],!n)return;let a=null!==(t=sa(e,n.value))&&void 0!==t?t:K.UnknownType.create();const i=Ce(e,0);i&&(0,K.isModule)(i)&&a&&(0,K.isTypeSame)(a,i)&&(a=i),ct(n,a,!1,!1),ke(e,{type:a},0)}function na(t){var n;if(Ie(t))return;const a=t.alias||t.name,i=T.getFileInfo(t);if((null===(n=t.alias)||void 0===n?void 0:n.value)===t.name.value){const e=va(t,t.name.value,!0);e&&ft(i,e.symbol,t)}let r=sa(t,a.value);if(!r){const n=t.parent;(0,l.assert)(n&&22===n.nodeType),(0,l.assert)(!n.isWildcardImport);const a=T.getImportInfo(n.module);if(a&&a.isImportFound&&!a.isNativeLib){const n=a.resolvedPaths[a.resolvedPaths.length-1],s=e(n);let o=!1;if(s){if(o=!0,i.executionEnvironment.pythonVersion>=u.PythonVersion.V3_7||i.isStubFile){const e=s.symbolTable.get("__getattr__");if(e){const t=Da(e);(0,K.isFunction)(t)&&(r=za(t),o=!1)}}}else n||(o=!0);o&&ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.importSymbolUnknown().format({name:t.name.value}),t.name)}r||(r=K.UnknownType.create())}ct(a,r,!1,!1),ke(t,{type:r},0)}function aa(e){if(Ie(e))return;if(!e.parent||63!==e.parent.nodeType)return void(0,l.fail)("Expected parent of case statement to be match statement");const t=T.getFileInfo(e),n=Me(e.parent.subjectExpression);let a=n.type;for(const n of e.parent.cases){if(n===e){"none"!==t.diagnosticRuleSet.reportUnnecessaryComparison&&(0,F.checkForUnusedPattern)(di,e.pattern,a);break}n.guardExpression||(a=(0,F.narrowTypeBasedOnPattern)(di,a,n.pattern,!1))}ke(e,{type:(0,F.assignTypeToPatternTargets)(di,a,!!n.isIncomplete,e.pattern),isIncomplete:!!n.isIncomplete},0)}function ia(e){if(Ie(e))return;const t=e.module.nameParts[0];let n=sa(e,t.value);if(!n)return;const a=Ce(e,0);a&&(0,K.isModule)(a)&&n&&(0,K.isTypeSame)(n,a)&&(n=a),ct(t,n,!1,!1),ke(e,{type:n},0)}function ra(e){var t;if(3===(null===(t=e.parent)||void 0===t?void 0:t.nodeType))En(e.parent);else{const t=Le(e.typeAnnotation,{isVariableAnnotation:!0,allowFinal:N.isFinalAllowedForAssignmentTarget(e.valueExpression),allowClassVar:N.isClassVarAllowedForAssignmentTarget(e.valueExpression)});ke(e.valueExpression,{type:t},0)}}function sa(e,t){const a=va(e,t,!0);if(!a)return;const i=a.symbol.getDeclarations().filter((t=>N.isNodeContainedWithin(e,t.node)&&8===t.type));let r=i.length>0?i[i.length-1]:void 0;if(r||(r=a.symbol.getDeclarations().find((e=>8===e.type))),!r)return;(0,l.assert)(8===r.type);const s=T.getFileInfo(e),o=Pa(r,!0,{allowExternallyHiddenAccess:s.isStubFile});if(o){if(!o.declaration)return n.evaluateUnknownImportsAsAny?K.AnyType.create():K.UnknownType.create();if(23===e.nodeType&&(o.isPrivate&&ot(s.diagnosticRuleSet.reportPrivateUsage,c.DiagnosticRule.reportPrivateUsage,y.Localizer.Diagnostic.privateUsedOutsideOfModule().format({name:e.name.value}),e.name),o.privatePyTypedImporter)){const t=new p.DiagnosticAddendum;o.privatePyTypedImported&&t.addMessage(y.Localizer.DiagnosticAddendum.privateImportFromPyTypedSource().format({module:o.privatePyTypedImported})),ot(s.diagnosticRuleSet.reportPrivateImportUsage,c.DiagnosticRule.reportPrivateImportUsage,y.Localizer.Diagnostic.privateImportFromPyTypedModule().format({name:e.name.value,module:o.privatePyTypedImporter})+t.getString(),e.name)}return Aa(a.symbol,r)}}function oa(e){var t,n,a,i,r,s;if(38===e.nodeType&&e.parent){if(28===e.parent.nodeType&&e.parent.name===e)return void Kn(e.parent);if(10===e.parent.nodeType&&e.parent.name===e)return void Ln(e.parent);if(23===e.parent.nodeType)return void na(e.parent);if(21===e.parent.nodeType)return void ta(e.parent);if(77===e.parent.nodeType&&e.parent.name===e)return void Mn(e.parent);if(29===e.parent.nodeType||39===e.parent.nodeType)return void Me(e,4);if(37===e.parent.nodeType)return}const o=N.getParentAnnotationNode(e);if(o){const e=o.parent;return(0,l.assert)(void 0!==e),3===e.nodeType?void(o===e.typeAnnotationComment?Le(o,{isVariableAnnotation:!0,allowFinal:N.isFinalAllowedForAssignmentTarget(e.leftExpression),allowClassVar:N.isClassVarAllowedForAssignmentTarget(e.leftExpression)}):En(e)):54===e.nodeType?void ra(e):28===e.nodeType&&o===e.returnTypeAnnotation?void Le(o,{associateTypeVarsWithScope:!0}):void Le(o,{isVariableAnnotation:54===(null===(t=o.parent)||void 0===t?void 0:t.nodeType),allowUnpackedTuple:41===e.nodeType&&1===e.category,allowUnpackedTypedDict:41===e.nodeType&&2===e.category})}const p=N.getParentNodeOfType(e,64);if(p){const t=p;if(N.isNodeContainedWithin(e,t.pattern))return void aa(t)}let c=e,d=0;for(;;){const e=N.getParentNodeOfType(c,1);if(e&&e!==c){if((0,l.assert)(void 0!==e.parent),9===e.parent.nodeType||24===e.parent.nodeType){c=e.parent;continue}if(10===e.parent.nodeType)return void Ln(e.parent)}let t=c.parent;if(!t)break;if(4!==t.nodeType||c!==t.name){if(9===t.nodeType||35===t.nodeType){if(c===t.leftExpression){if(9===c.nodeType&&38===c.leftExpression.nodeType&&"super"===c.leftExpression.value){c=t;continue}if(9===t.nodeType&&30===c.nodeType){c=t;continue}d=2;break}}else if(24===t.nodeType){if(c===t.baseExpression){d=2;break}}else if(48===t.nodeType&&c===t.typeAnnotation){c=t;continue}if(!(0,g.isExpressionNode)(t))if(17===t.nodeType||16===t.nodeType||33===t.nodeType||34===t.nodeType)(0,l.assert)(void 0!==t.parent&&(0,g.isExpressionNode)(t.parent)),t=t.parent;else{if(41!==t.nodeType)break;if((0,l.assert)(void 0!==t.parent),30!==t.parent.nodeType)break;t=t.parent}c=t}else c=t}const u=c.parent;switch((0,l.assert)(void 0!==u),u.nodeType){case 14:return void ht(c);case 75:if(c===u.name&&76===(null===(n=u.parent)||void 0===n?void 0:n.nodeType)&&77===(null===(a=u.parent.parent)||void 0===a?void 0:a.nodeType))return void Mn(u.parent.parent);break;case 77:return void Mn(u);case 13:return void(10===(null===(i=u.parent)||void 0===i?void 0:i.nodeType)?Ln(u.parent):28===(null===(r=u.parent)||void 0===r?void 0:r.nodeType)&&Kn(u.parent));case 41:if(c!==u.defaultValue)return void la(u);break;case 1:if(c===u.name)return;if(10===(null===(s=u.parent)||void 0===s?void 0:s.nodeType))return void Ln(u.parent);break;case 44:if(u.returnExpression){const t=N.getEnclosingFunction(e),n=t?Oa(t):void 0;return void Me(u.returnExpression,0,(0,W.makeInferenceContext)(n))}break;case 54:return void ra(u);case 3:return void En(u)}54!==c.nodeType?Me(c,d):ra(c)}function la(e){if(!e.name)return;const t=e.parent;if(30===t.nodeType)return void oa(t);(0,l.assert)(28===t.nodeType);const n=t,a=n.parameters.findIndex((t=>t===e)),i=N.getTypeAnnotationForParameter(n,a);if(i){const t=n.parameters[a],r=Re(i,n.parameters[a].category),s=Zn(e,e.category,$n(t,r));return void ke(e.name,{type:s},0)}const r=N.getEnclosingClass(n,!0),s=r?Ln(r):void 0;if(s&&K.ClassType.isPseudoGenericClass(null==s?void 0:s.classType)&&"__init__"===n.name.value){const t=Rn(e.name.value),n=s.classType.details.typeParameters.find((e=>e.details.name===t));if(n)return void ke(e.name,{type:n},0)}const o=Hn(n,(0,S.getFunctionFlagsFromDecorators)(di,n,!0),a,null==s?void 0:s.classType);ke(e.name,{type:Zn(e,e.category,null!=o?o:K.UnknownType.create())},0)}function pa(e){ze(e);let t=e;for(;t;){switch(t.nodeType){case 3:if(!(t.parent&&(3===t.parent.nodeType||4===t.parent.nodeType||5===t.parent.nodeType)&&t.parent.rightExpression===t))return void En(t);break;case 77:return void Mn(t);case 4:return void Me(t);case 5:return void Vn(t);case 10:return void Ln(t);case 41:return void la(t);case 30:return void oa(t);case 28:return void Kn(t);case 26:return void Qn(t);case 25:return void Xn(t);case 59:return void ea(t);case 33:{const e=t.parent;if((0,l.assert)(32===e.nodeType),t===e.expression)oa(e);else for(const n of e.forIfNodes)if(yn(n),n===t)break;return}case 21:return void ta(t);case 23:return void na(t);case 22:return void ia(t);case 64:return void aa(t)}t=t.parent}(0,l.fail)("Unexpected statement")}function ca(e,t){let n=_e(e);return n&&!n.typeResult.isIncomplete?n.typeResult:(t(),n=_e(e),n?n.typeResult:void 0)}function da(e){let t=de.get(e);return t||(t=ui.createCodeFlowAnalyzer(),de.set(e,t)),t}function ua(e,t,n,a,i){var r;const s=(0,b.createKeyForReference)(e),o=N.getExecutionScopeNode(null!==(r=null==a?void 0:a.parent)&&void 0!==r?r:e),p=T.getCodeFlowExpressions(o);if(!p||!p.has(s)&&!p.has(b.wildcardImportReferenceKey))return{type:void 0,isIncomplete:!1};if(Xe(e))return{type:void 0,isIncomplete:!0};let c;c=we(o)?function(){const e=Te.length;return(0,l.assert)(e>0),Te[e-1].codeFlowAnalyzer}():da(o.id);const d=T.getFlowNode(null!=a?a:e);return void 0===d?{type:void 0,isIncomplete:!1}:c.getTypeFromCodeFlow(d,e,t,n,i)}function ma(e,t,n,a){if(K.ClassType.isSpecialBuiltIn(e)){switch(e.aliasName||e.details.name){case"Callable":return{type:fn(t,a)};case"Never":return t&&t.length>0&&it(y.Localizer.Diagnostic.typeArgsExpectingNone().format({name:"Never"}),t[0].node),{type:K.NeverType.createNever()};case"NoReturn":return t&&t.length>0&&it(y.Localizer.Diagnostic.typeArgsExpectingNone().format({name:"NoReturn"}),t[0].node),{type:K.NeverType.createNoReturn()};case"Optional":return{type:Tn(e,a,t,n)};case"Type":{if(1===(null==t?void 0:t.length)&&(0,K.isAnyOrUnknown)(t[0].type)&&ee&&(0,K.isInstantiableClass)(ee))return{type:ee};let n=xn(e,t,1);return(0,K.isInstantiableClass)(n)&&(n=(0,W.explodeGenericClass)(n)),{type:n}}case"ClassVar":return{type:_n(e,a,t,n)};case"Protocol":return{type:xn(e,t,void 0,!0)};case"Tuple":return{type:xn(e,t,void 0)};case"Union":return{type:Pn(e,a,t,n)};case"Generic":return{type:Dn(e,a,t,n)};case"Final":return{type:wn(e,a,t,n)};case"Annotated":return function(e,t){return t&&t.length<2&&it(y.Localizer.Diagnostic.annotatedTypeArgMissing(),e),t&&0!==t.length?{type:K.TypeBase.cloneForAnnotated(t[0].type),isReadOnly:t[0].isReadOnly,isRequired:t[0].isRequired,isNotRequired:t[0].isNotRequired}:{type:K.AnyType.create()}}(a,t);case"Concatenate":return{type:An(a,e,t)};case"TypeGuard":return{type:In(a,e,t,n)};case"Unpack":return{type:Sn(e,a,t,n)};case"Required":case"NotRequired":return kn(e,a,t,n);case"ReadOnly":if(T.getFileInfo(a).diagnosticRuleSet.enableExperimentalFeatures)return kn(e,a,t,n);break;case"Self":return{type:Cn(e,a,t)};case"LiteralString":return{type:xn(e,t,0)}}}const i=T.getFileInfo(a);if(i.isStubFile||i.executionEnvironment.pythonVersion>=u.PythonVersion.V3_9||(0,f.isAnnotationEvaluationPostponed)(T.getFileInfo(a))||0!=(4&n)){if(K.ClassType.isBuiltIn(e,"type")&&t){if(t.length>=1){if((0,K.isAnyOrUnknown)(t[0].type))return{type:e};if((0,K.isFunction)(t[0].type)||(0,K.isOverloadedFunction)(t[0].type))return ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeAnnotationWithCallable(),t[0].node),{type:K.UnknownType.create()}}const n=Ye(a,"Type");if(n&&(0,K.isInstantiableClass)(n)){let e=xn(n,t,1,void 0,!0);return(0,K.isInstantiableClass)(e)&&(e=(0,W.explodeGenericClass)(e)),{type:e}}}if((0,W.isTupleClass)(e))return{type:xn(e,t,void 0,void 0,!0)}}let r=t?t.length:0;const s=K.ClassType.isPseudoGenericClass(e)?[]:K.ClassType.getTypeParameters(e);if(0===s.length&&0===r)return{type:e};const o=s.findIndex((e=>(0,K.isVariadicTypeVar)(e)));if(t){let n=s.length;const l=s.findIndex((e=>!!e.details.defaultType));if(l>=0&&(n=l),t[0].inlinedTypeDict)return t.length>1&&ot(i.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsTooMany().format({name:e.aliasName||e.details.name,expected:1,received:r}),t[1].node),{type:t[0].inlinedTypeDict};if(r>s.length){if(!K.ClassType.isPartiallyEvaluated(e)&&!K.ClassType.isTupleClass(e)){const n=T.getFileInfo(a);0===s.length?ot(n.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsExpectingNone().format({name:e.aliasName||e.details.name}),t[s.length].node):1===s.length&&(0,K.isParamSpec)(s[0])||ot(n.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsTooMany().format({name:e.aliasName||e.details.name,expected:s.length,received:r}),t[s.length].node),r=s.length}}else if(r<n){ot(T.getFileInfo(a).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeArgsTooFew().format({name:e.aliasName||e.details.name,expected:n,received:r}),t.length>0?t[0].node.parent:a)}t.forEach(((e,t)=>{if(t===o){if((0,K.isClassInstance)(e.type)&&(0,W.isTupleClass)(e.type))return;if((0,K.isVariadicTypeVar)(e.type))return void kt(e.type,e.node)}const n=t<s.length?s[t]:void 0;hn(e,{allowParamSpec:!0,allowTypeArgList:null==n?void 0:n.details.isParamSpec})}))}let l=[];const d=K.ClassType.getTypeParameters(e);if(1===d.length&&d[0].details.isParamSpec&&t)if(t.every((e=>!(0,W.isEllipsisType)(e.type)&&!e.typeList&&!(0,K.isParamSpec)(e.type))))1===t.length&&(0,K.isInstantiableClass)(t[0].type)&&K.ClassType.isBuiltIn(t[0].type,"Concatenate")||(t=[{type:K.UnknownType.create(),node:t[0].node,typeList:t}]);else if(t.length>1){const e=t.find((e=>(0,K.isParamSpec)(e.type)));e&&it(y.Localizer.Diagnostic.paramSpecContext(),e.node);const n=t.find((e=>!!e.typeList));n&&it(y.Localizer.Diagnostic.typeArgListNotAllowed(),n.node)}const m=new q.TypeVarContext(e.details.typeVarScopeId);d.forEach(((e,n)=>{if(t&&n<t.length){if(e.details.isParamSpec){const a=t[n],i=K.FunctionType.createSynthesizedInstance("",65536);if(K.TypeBase.setSpecialForm(i),(0,W.isEllipsisType)(a.type))return K.FunctionType.addDefaultParameters(i),i.details.flags|=32768,l.push(i),void m.setTypeVarType(e,(0,W.convertTypeToParamSpecValue)(i));if(a.typeList)return a.typeList.forEach(((e,t)=>{K.FunctionType.addParameter(i,{category:0,name:`__p${t}`,isNameSynthesized:!0,type:(0,W.convertToInstance)(e.type),hasDeclaredType:!0})})),l.push(i),void m.setTypeVarType(e,(0,W.convertTypeToParamSpecValue)(i));if((0,K.isInstantiableClass)(a.type)&&K.ClassType.isBuiltIn(a.type,"Concatenate")){const e=a.type.typeArguments;return e&&e.length>0&&e.forEach(((t,n)=>{n===e.length-1?(0,K.isParamSpec)(t)&&(i.details.paramSpec=t):K.FunctionType.addParameter(i,{category:0,name:`__p${n}`,isNameSynthesized:!0,hasDeclaredType:!0,type:t})})),void l.push(i)}}const a=(0,W.convertToInstance)(t[n].type);return l.push(a),void m.setTypeVarType(e,a)}const a=(0,W.applySolvedTypeVars)(e,m,{unknownIfNotFound:!0});l.push(a),(0,K.isParamSpec)(e)?m.setTypeVarType(e,(0,W.convertTypeToParamSpecValue)(a)):m.setTypeVarType(e,a)})),l=l.map(((a,i)=>{if(i<r){const r=new p.DiagnosticAddendum;let o=function(e,t,n){if((0,K.isAnyOrUnknown)(t))return t;let a=(0,W.transformPossibleRecursiveTypeAlias)(t);if((0,K.isTypeVar)(t)){if((0,K.isTypeSame)(t,e))return t;a=mt(t)}if((0,K.isClass)(a)&&K.ClassType.isPartiallyEvaluated(a))return t;if(e.details.boundType&&!(0,W.isTypeAliasPlaceholder)(a)&&!Wa(e.details.boundType,a,n.createAddendum(),void 0,void 0))return void(e.details.isSynthesized||n.addMessage(y.Localizer.DiagnosticAddendum.typeBound().format({sourceType:ci(a),destType:ci(e.details.boundType),name:K.TypeVarType.getReadableName(e)})));if(e.details.isParamSpec)return(0,K.isParamSpec)(t)||(0,K.isFunction)(t)&&K.FunctionType.isParamSpecValue(t)||(0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"Concatenate")?t:void n.addMessage(y.Localizer.DiagnosticAddendum.typeParamSpec().format({type:ci(t),name:K.TypeVarType.getReadableName(e)}));if((0,K.isTypeVar)(t)&&t.details.isParamSpec)return void n.addMessage(y.Localizer.Diagnostic.paramSpecContext());const i=e.details.constraints;if(0===i.length)return t;if((0,W.isTypeAliasPlaceholder)(t))return t;if((0,K.isTypeVar)(t)&&t.details.constraints.length>0){if(t.details.constraints.every((e=>i.some((t=>Wa(t,e))))))return t}else{let e;for(const t of i)Wa(t,a)&&(e&&!Wa(e,t)||(e=t));if(e)return e}return void n.addMessage(y.Localizer.DiagnosticAddendum.typeConstrainedTypeVar().format({type:ci(t),name:K.TypeVarType.getReadableName(e)}))}(s[i],a,r);if(o&&0!=(16384&n)){const t=s[i].details.declaredVariance;(0,W.isVarianceOfTypeArgumentCompatible)(o,t)||(r.addMessage(y.Localizer.DiagnosticAddendum.varianceMismatchForClass().format({typeVarName:ci(o),className:e.details.name})),o=void 0)}if(o)a=o;else if(!(0,K.isClassInstance)(a)||!K.ClassType.isPartiallyEvaluated(a)){ot(T.getFileInfo(t[i].node).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarAssignmentMismatch().format({type:ci(a),name:K.TypeVarType.getReadableName(s[i])})+r.getString(),t[i].node)}}return a})),t&&0===e.details.typeParameters.length&&K.ClassType.isPartiallyEvaluated(e)&&(l=t.map((e=>(0,W.convertToInstance)(e.type))));return{type:K.ClassType.cloneForSpecialization(e,l,void 0!==t)}}function ya(e,t){return e.typeResult?{type:e.typeResult.type,isIncomplete:e.typeResult.isIncomplete}:e.valueExpression?Me(e.valueExpression,void 0,t):{type:K.UnknownType.create()}}function ga(e,t){return e.typeResult?{type:e.typeResult.type,isIncomplete:e.typeResult.isIncomplete}:ha(e.valueExpression,t)}function ha(e,t){let n=131208;(null==t?void 0:t.allowTypeVarsWithoutScopeId)||(n|=4096);return T.getFileInfo(e).isStubFile||(null==t?void 0:t.allowForwardReference)?n|=4:n|=4194304,(null==t?void 0:t.allowFinal)||(n|=16),(null==t?void 0:t.allowRequired)&&(n|=1048832),(null==t?void 0:t.allowUnpackedTuple)?n|=2097152:n|=64,(null==t?void 0:t.allowParamSpec)||(n|=32),(null==t?void 0:t.enforceTypeAnnotationRules)&&(n|=256),Me(e,n)}function fa(e,t){const n=M.getScopeForNode(e);if(n){const e=M.getBuiltInScope(n).lookUpSymbol(t);if(e)return Da(e)}return K.UnknownType.create()}function Ta(e,t,n){const a=fa(e,t);if((0,K.isInstantiableClass)(a)){let e=a;return n&&(e=K.ClassType.cloneForSpecialization(e,n,void 0!==n)),K.ClassType.cloneAsInstance(e)}return a}function va(e,t,n,a=!1){var i;const r=M.getScopeForNode(e);let s=null==r?void 0:r.lookUpSymbolRecursive(t);const o=null!==(i=null==r?void 0:r.type)&&void 0!==i?i:3;if(s&&n&&(1!==o&&0!==o)){if(!s.symbol.getDeclarations().find((t=>{if(8!==t.type&&0!==t.type){const n=N.getExecutionScopeNode(e),a=6===t.type||5===t.type||4===t.type?t.node.name:t.node;if(n===N.getExecutionScopeNode(a)&&!nt(a,e)){const t=T.getFlowNode(e);return!(t&&ui.isFlowNodeReachable(t,void 0,!0))}}return!0})))if(1!==s.scope.type){let e=s.scope.parent;const n=s.isOutsideCallerModule||3===s.scope.type;let a=s.isBeyondExecutionScope||s.scope.isIndependentlyExecutable();if(2===s.scope.type){const t=s.scope.getGlobalScope();e=t.scope,t.isBeyondExecutionScope&&(a=!0)}s=e?e.lookUpSymbolRecursive(t,n,a):void 0}else s=void 0}if(s&&a){let e=s;for(;3!==e.scope.type&&4!==e.scope.type&&e.scope.parent&&(e=e.scope.parent.lookUpSymbolRecursive(t,e.isOutsideCallerModule,e.isBeyondExecutionScope||e.scope.isIndependentlyExecutable()),e););3!==(null==e?void 0:e.scope.type)&&4!==(null==e?void 0:e.scope.type)||(s=e)}return s}function ba(e,t){Y.push(e);try{const e=t();return Y.pop(),e}catch(e){throw Y.pop(),e}}function _a(e,t,n){if(!e)return t();r.enterSpeculativeContext(e,n);try{const e=t();return r.leaveSpeculativeContext(),e}catch(e){throw r.leaveSpeculativeContext(),e}}function Ia(e){return r.isSpeculative(e)}function Ca(e,t){if((0,K.isFunction)(e)&&e.details.declaration){const n=e.details.declaration;if(5===n.type){const e=n.node,a=T.getScope(e);if(a){const e=a.lookUpSymbol(t);if(e)return e.getDeclarations().find((e=>2===e.type))}}}}function ka(e){if(e.parent&&23===e.parent.nodeType&&e.parent.alias&&e===e.parent.name)return e.parent.alias}function Sa(e){var t,n,a;switch(e.type){case 0:{if("Any"===e.intrinsicType)return{type:K.AnyType.create()};if("class"===e.intrinsicType){const t=Ln(N.getEnclosingClass(e.node));return{type:null==t?void 0:t.classType}}const t=Ta(e.node,"str"),n=Ta(e.node,"int");if((0,K.isClassInstance)(n)&&(0,K.isClassInstance)(t)){if("str"===e.intrinsicType)return{type:t};if("str | None"===e.intrinsicType)return{type:(0,K.combineTypes)([t,K.NoneType.createInstance()])};if("int"===e.intrinsicType)return{type:n};if("Iterable[str]"===e.intrinsicType){const n=fa(e.node,"Iterable");if((0,K.isInstantiableClass)(n))return{type:K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(n,[t],!0))}}if("Dict[str, Any]"===e.intrinsicType){const n=fa(e.node,"dict");if((0,K.isInstantiableClass)(n))return{type:K.ClassType.cloneAsInstance(K.ClassType.cloneForSpecialization(n,[t,K.AnyType.create()],!0))}}}return{type:K.UnknownType.create()}}case 6:{const t=Ln(e.node);return{type:null==t?void 0:t.decoratedType}}case 7:return{type:Le(e.node.typeAnnotation)};case 5:{const t=Kn(e.node);return{type:null==t?void 0:t.decoratedType}}case 4:return{type:Mn(e.node)};case 2:{let n=e.node.typeAnnotation||e.node.typeAnnotationComment;if(!n&&28===(null===(t=e.node.parent)||void 0===t?void 0:t.nodeType)){const t=e.node.parent;if(t.functionAnnotationComment&&!t.functionAnnotationComment.isParamListEllipsis){const a=t.parameters.findIndex((t=>t===e.node));n=N.getTypeAnnotationForParameter(t,a)}}if(n){const t=Re(n,e.node.category);return{type:Zn(e.node,e.node.category,$n(e.node,t))}}return{type:void 0}}case 3:return{type:wa(e.node)};case 1:{const t=e.typeAnnotationNode;if(t){let i;if(e.isRuntimeTypeExpression)i=(0,W.convertToInstance)(ha(t,{allowFinal:!0,allowRequired:!0}).type);else{const a=e.isDefinedByMemberAccess&&35===(null===(n=e.node.parent)||void 0===n?void 0:n.nodeType)?e.node.parent:e.node;i=Le(t,{isVariableAnnotation:!0,allowClassVar:N.isClassVarAllowedForAssignmentTarget(a),allowFinal:N.isFinalAllowedForAssignmentTarget(a),allowRequired:N.isRequiredAllowedForAssignmentTarget(a)})}if(i)return 38===e.node.nodeType&&(i=null!==(a=(0,w.transformTypeForPossibleEnumClass)(di,e.node,(()=>i)))&&void 0!==a?a:i),(0,K.isClassInstance)(i)&&K.ClassType.isBuiltIn(i,"TypeAlias")?{type:void 0,isTypeAlias:!0}:{type:i}}return{type:void 0}}case 8:return{type:void 0}}}function wa(e){const t=Ce(e.name,0);if(t&&(0,K.isTypeVar)(t))return t;let n=K.TypeVarType.createInstantiable(e.name.value);if(n.details.isTypeParamSyntax=!0,e.typeParamCategory===g.TypeParameterCategory.TypeVarTuple?n.details.isVariadic=!0:e.typeParamCategory===g.TypeParameterCategory.ParamSpec&&(n.details.isParamSpec=!0),ke(e,{type:n},void 0),ke(e.name,{type:n},void 0),e.boundExpression)if(52===e.boundExpression.nodeType){const t=e.boundExpression.expressions.map((e=>{const t=ha(e).type;return(0,W.requiresSpecialization)(t,!0)&&it(y.Localizer.Diagnostic.typeVarBoundGeneric(),e),(0,W.convertToInstance)(t)}));t.length<2?ot(T.getFileInfo(e.boundExpression).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarSingleConstraint(),e.boundExpression):e.typeParamCategory===g.TypeParameterCategory.TypeVar&&(n.details.constraints=t)}else{const t=ha(e.boundExpression).type;(0,W.requiresSpecialization)(t,!0)&&it(y.Localizer.Diagnostic.typeVarConstraintGeneric(),e.boundExpression),e.typeParamCategory===g.TypeParameterCategory.TypeVar&&(n.details.boundType=(0,W.convertToInstance)(t))}if(e.defaultExpression&&(e.typeParamCategory===g.TypeParameterCategory.ParamSpec?n.details.defaultType=nn(e.defaultExpression):e.typeParamCategory===g.TypeParameterCategory.TypeVarTuple?n.details.defaultType=en(e.defaultExpression):n.details.defaultType=(0,W.convertToInstance)(ha(e.defaultExpression).type)),n.details.defaultType&&e.defaultExpression){const t=new q.TypeVarContext(K.WildcardTypeVarScopeId),a=(0,W.applySolvedTypeVars)(n.details.defaultType,t,{unknownIfNotFound:!0});n.details.boundType?Wa(n.details.boundType,a)||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarDefaultBoundMismatch(),e.defaultExpression):n.details.constraints.length>0&&(n.details.constraints.some((e=>(0,K.isTypeSame)(e,a)))||ot(T.getFileInfo(e).diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,y.Localizer.Diagnostic.typeVarDefaultConstraintMismatch(),e.defaultExpression))}const a=N.getTypeVarScopeNode(e);if(a){let e;10===a.nodeType?(e=0,n.details.declaredVariance=0):28===a.nodeType?e=1:((0,l.assert)(77===a.nodeType),e=2),n=K.TypeVarType.cloneForScopeId(n,N.getScopeIdForNode(77===a.nodeType?a.name:a),a.name.value,e)}return n}function Aa(t,a){var i,r,s;const o=xa(a,!0,{allowExternallyHiddenAccess:T.getFileInfo(a.node).isStubFile});if(!o)return n.evaluateUnknownImportsAsAny?K.AnyType.create():K.UnknownType.create();function l(e,t,a){if(t.path&&t.loadSymbolsFromPath){const i=a(t.path);i?(e.fields=i.symbolTable,e.docString=i.docString):e.notPresentFieldType=n.evaluateUnknownImportsAsAny?K.AnyType.create():K.UnknownType.create()}return t.implicitImports&&t.implicitImports.forEach(((t,n)=>{let i;if(t.isUnresolved)i=K.UnknownType.create();else{const r=e.moduleName?e.moduleName+"."+n:"";i=l(K.ModuleType.create(r,t.path),t,a)}const r=V.Symbol.createWithType(0,i);e.loaderFields.set(n,r)})),e}if(8===o.type){let t=o.moduleName;if(8===a.type&&(a.symbolName&&(t+="."+a.symbolName),t.startsWith("."))){const e=T.getFileInfo(a.node).moduleName.split(".");for(t=t.substr(1);t.startsWith(".")&&e.length>0;)t=t.substr(1),e.pop();t=e.join(".")+"."+t}const n=K.ModuleType.create(t,o.path);return o.symbolName&&o.submoduleFallback?l(n,o.submoduleFallback,e):l(n,o,e)}const p=Sa(o);if(p.type)return p.type;const c=T.getFileInfo(o.node);let d=!c.isInPyTypedPackage||c.isStubFile;if(!d&&1===o.type){const e=N.getEnclosingClass(o.node,!0);if(e){const t=Ln(e);t&&K.ClassType.isEnumClass(t.classType)&&(d=!0)}if((ii(o)||o.isConstant)&&(d=!0),9===(null===(i=o.inferredTypeSource)||void 0===i?void 0:i.nodeType)){const e=Me(o.inferredTypeSource.leftExpression,2).type,t=["TypeVar","ParamSpec","TypeVarTuple","TypedDict","NamedTuple","NewType"];((0,K.isInstantiableClass)(e)&&K.ClassType.isBuiltIn(e,t)||(0,K.isFunction)(e)&&t.some((t=>e.details.builtInName===t)))&&(d=!0)}}if(2===o.type)return null===(r=ca(o.node.name,(()=>{la(o.node)})))||void 0===r?void 0:r.type;if(1===o.type&&o.inferredTypeSource){const e=ri(o)||zn(o),n=e&&o.inferredTypeSource.parent?o.inferredTypeSource.parent:o.inferredTypeSource;let i=null===(s=ca(o.node,(()=>{pa(n)})))||void 0===s?void 0:s.type;if(i&&38===o.node.nodeType){const e=(0,w.transformTypeForPossibleEnumClass)(di,o.node,(()=>{var e,t;return null!==(t=null===(e=ca(o.inferredTypeSource,(()=>{pa(o.inferredTypeSource)})))||void 0===e?void 0:e.type)&&void 0!==t?t:K.UnknownType.create()}));e&&(i=e)}return i&&e&&o.typeAliasName&&(!K.TypeBase.isInstantiable(i)||(0,K.isUnknown)(i)||(0,W.isEllipsisType)(i)||(i=Nn(i,o.typeAliasName,o.node),d=!0)),i&&c.isInPyTypedPackage&&!c.isStubFile&&(d||function(e,t,n){var a;const i=e.getDeclarations().filter((e=>1!==e.type||!e.isInferenceAllowedInPyTyped));if(i.length>1)return!1;if(1!==t.type)return!1;if(0===i.length)return!0;if((0,K.isTypeVar)(n))return!0;let r;const s=t.node.parent;s&&(3===s.nodeType?r=s:35===s.nodeType&&3===(null===(a=s.parent)||void 0===a?void 0:a.nodeType)&&(r=s.parent));if(!r)return!1;const o=Me(r.rightExpression).type;if((0,K.isClassInstance)(o)&&(0,W.isLiteralType)(o))return!0;if(38===r.rightExpression.nodeType&&!K.TypeBase.isAmbiguous(o))return!0;return!1}(t,a,i)&&(d=!0),d||(i=K.TypeBase.cloneForAmbiguousType(i))),i}}function xa(t,n,a){var i,r,s;return null===(s=(0,k.resolveAliasDeclaration)(e,t,{resolveLocalNames:n,allowExternallyHiddenAccess:null!==(i=null==a?void 0:a.allowExternallyHiddenAccess)&&void 0!==i&&i,skipFileNeededCheck:null!==(r=null==a?void 0:a.skipFileNeededCheck)&&void 0!==r&&r}))||void 0===s?void 0:s.declaration}function Pa(t,n,a){var i,r;return(0,k.resolveAliasDeclaration)(e,t,{resolveLocalNames:n,allowExternallyHiddenAccess:null!==(i=null==a?void 0:a.allowExternallyHiddenAccess)&&void 0!==i&&i,skipFileNeededCheck:null!==(r=null==a?void 0:a.skipFileNeededCheck)&&void 0!==r&&r})}function Da(e){return Na(e).type}function Na(e,t,n=!1){var a,i;let r;if(e.hasTypedDeclarations()){r=Fa(e,t);const n=null==r?void 0:r.type,a=!!r.isTypeAlias;if(n||!a){let t=!1;n&&((0,K.isFunction)(n)&&K.FunctionType.isPartiallyEvaluated(n)||(0,K.isClass)(n)&&K.ClassType.isPartiallyEvaluated(n))&&(t=!0);const a=e.getTypedDeclarations();return{type:null!=n?n:K.UnknownType.create(),isIncomplete:t,includesVariableDecl:a.some((e=>1===e.type)),includesIllegalTypeAliasDecl:!a.every((e=>si(e))),isRecursiveDefinition:!n}}}let s=me.get(e.id);const o=t?t.id:void 0,l=`${void 0===o?".":o.toString()}${n?"*":""}`;if(s){const e=s.get(l);if(e&&!e.isIncomplete)return e}const p=[],c=e.getDeclarations();let d,u=!1,m=!1,y=!1,g=!1;if(c.length>64){const e={type:K.UnknownType.create(),isIncomplete:!1,includesVariableDecl:!1,includesIllegalTypeAliasDecl:!c.every((e=>si(e))),isRecursiveDefinition:!1};return _(e),e}if(n)c.forEach(((e,t)=>{e.isInExceptSuite||(d=t)}));else if(c.length>1&&c.every((e=>8===e.type))){const e=c.filter((e=>8===e.type&&!e.isInExceptSuite));1===e.length&&(d=c.findIndex((t=>t===e[0])))}let h=!1;c.forEach(((n,a)=>{var i,r,s;let o=void 0===d||a===d;if(h&&(o=!1),e.isClassVar()&&1===n.type&&n.isDefinedByMemberAccess&&(o=!1),void 0!==t&&8!==n.type){N.getExecutionScopeNode(t)===N.getExecutionScopeNode(n.node)&&(nt(n.node,t)||(o=!1))}if(o){const t=null!==(i=xa(n,!0,{allowExternallyHiddenAccess:T.getFileInfo(n.node).isStubFile}))&&void 0!==i?i:n,a=ri(t),o=a||zn(t);if(a&&(h=!0),o&&1===t.type&&3===(null===(s=null===(r=t.inferredTypeSource)||void 0===r?void 0:r.parent)||void 0===s?void 0:s.nodeType)&&En(t.inferredTypeSource.parent),xe(e,n))try{let i=Aa(e,n);if(Pe(e)||(u=!0),i){if(1===t.type){T.getFileInfo(t.node).isTypingStubFile||(y=!0);let e=!1;1===t.type&&(t.isConstant||ii(t))&&(e=!0),(0,K.isClassInstance)(i)&&K.ClassType.isEnumClass(i)&&(0,w.isDeclInEnumClass)(di,t)&&(e=!0),!K.TypeBase.isInstance(i)||a||e||(i=Ve(i))}p.push(i),Ia(n.node)&&(g=!0)}else u=!0}catch(t){throw Pe(e),t}else{if(6===t.type){const e=Ln(t.node);(null==e?void 0:e.decoratedType)&&p.push(e.decoratedType)}u=!0,m=!0}}}));const f=(null!==(i=null===(a=null==s?void 0:s.get(l))||void 0===a?void 0:a.evaluationAttempts)&&void 0!==i?i:0)+1;let v;p.length>0?(u=m&&f<16,v=(0,K.combineTypes)(p)):v=K.UnboundType.create();const b={type:v,isIncomplete:u,includesVariableDecl:y,includesIllegalTypeAliasDecl:!c.every((e=>si(e))),isRecursiveDefinition:!1,evaluationAttempts:f};return g||_(b),b;function _(t){s||(s=new Map,me.set(e.id,s)),s.set(l,t)}}function Fa(e,t){const n=e.getSynthesizedType();if(n)return{type:n};let a=e.getTypedDeclarations();if(0===a.length)return e.getDeclarations().length>64?{type:K.UnknownType.create()}:{type:void 0};if(t&&a.length>1){const e=a.filter((e=>{if(8!==e.type){if(N.getExecutionScopeNode(t)===N.getExecutionScopeNode(e.node)&&!nt(e.node,t,!1))return!1}return!0}));if(0===e.length)return{type:K.UnboundType.create()};a=e}let i=a.length-1;for(;i>=0;){const t=a[i],n=Ne(e,t);if(n)return{type:n};if(Ae(e,t)<0&&xe(e,t))try{const n=Sa(t);if(Pe(e)||6===t.type)return n}catch(t){throw Pe(e),t}i--}return{type:void 0}}function Ea(e){(0,K.isFunction)(e)?za(e):(0,K.isOverloadedFunction)(e)&&e.overloads.forEach((e=>{za(e)}))}function za(e,t,n=!0){const a=K.FunctionType.getSpecializedReturnType(e);return a?Ht(a,void 0):n?Ma(e,t):K.UnknownType.create()}function Ma(e,t){var n;let a,i=!1,s=!0;if(K.FunctionType.isStubDefinition(e))return K.UnknownType.create();if(K.FunctionType.isOverloaded(e)&&!K.FunctionType.isSynthesizedMethod(e))return K.UnknownType.create();if(e.inferredReturnType)a=e.inferredReturnType;else{if(K.FunctionType.isInstanceMethod(e)&&"__init__"===e.details.name)a=K.NoneType.createInstance();else if(e.details.declaration){const t=e.details.declaration.node;if(s=T.getFileInfo(t).diagnosticRuleSet.analyzeUnannotatedFunctions,s&&!Xe(t.suite)){const s=T.getCodeFlowComplexity(t);if(e.details.parameters.length<=1||e.details.parameters.some((e=>e.hasDeclaredType))||s<32){let s;!function(e){const t=r.disableSpeculativeMode();try{e(),r.enableSpeculativeMode(t)}catch(e){throw r.enableSpeculativeMode(t),e}}((()=>{s=Jn(t,K.FunctionType.isAbstractMethod(e))})),a=null==s?void 0:s.type,(null==s?void 0:s.isIncomplete)&&(i=!0),a&&K.FunctionType.isWrapReturnTypeInAwait(e)&&(a=Yn(t,a,!!(null===(n=e.details.declaration)||void 0===n?void 0:n.isGenerator)))}}}a||(a=K.UnknownType.create()),i||(e.inferredReturnType=a)}if(!i&&s&&(0,W.isPartlyUnknown)(a)&&K.FunctionType.hasUnannotatedParams(e)&&!K.FunctionType.isStubDefinition(e)&&!K.FunctionType.isPyTypedDefinition(e)&&!K.FunctionType.isWrapReturnTypeInAwait(e)&&t){const n=function(e,t){var n;let a;if(!e.details.declaration)return;const i=e.details.declaration.node;if(T.getCodeFlowComplexity(i)>=8)return;if(t.some((e=>!e.paramName)))return;if(Te.some((e=>e.functionNode===i)))return;const r=Kn(i);if(!r)return;if(t.length>6)return;if(Te.length>=2)return;const s=[];let o=!1;if(ba(i,(()=>{var n,l;const p=ve;Te.push({functionNode:i,codeFlowAnalyzer:ui.createCodeFlowAnalyzer()});try{ve=new Map;let p=!0;if(i.parameters.forEach(((e,n)=>{if(e.name){let a;const o=t.find((t=>e.name.value===t.paramName));o&&o.argument.valueExpression?(a=Me(o.argument.valueExpression).type,(0,K.isUnknown)(a)||(p=!1)):e.defaultValue?(a=Me(e.defaultValue).type,(0,K.isUnknown)(a)||(p=!1)):0===n&&(K.FunctionType.isInstanceMethod(r.functionType)||K.FunctionType.isClassMethod(r.functionType))&&r.functionType.details.parameters.length>0&&i.parameters[0].name&&(a=r.functionType.details.parameters[0].type),a||(a=K.UnknownType.create()),s.push(a),ke(e.name,{type:a},0)}})),!p){const t=null===(n=r.functionType.callSiteReturnTypeCache)||void 0===n?void 0:n.find((e=>e.paramTypes.length===s.length&&e.paramTypes.every(((e,t)=>(0,K.isTypeSame)(e,s[t])))));t?(a=t.returnType,o=!0):a=null===(l=Jn(i,K.FunctionType.isAbstractMethod(e)))||void 0===l?void 0:l.type}}finally{Te.pop(),ve=p}})),a)return a=(0,K.removeUnbound)(a),K.FunctionType.isWrapReturnTypeInAwait(e)&&!(0,K.isNever)(a)&&(a=Yn(i,a,!!(null===(n=e.details.declaration)||void 0===n?void 0:n.isGenerator))),o||(r.functionType.callSiteReturnTypeCache||(r.functionType.callSiteReturnTypeCache=[]),r.functionType.callSiteReturnTypeCache.length>=8&&(r.functionType.callSiteReturnTypeCache=r.functionType.callSiteReturnTypeCache.slice(1)),r.functionType.callSiteReturnTypeCache.push({paramTypes:s,returnType:a})),a;return}(e,t);n&&(a=n)}return a}function Oa(e){const t=Kn(e);return t?K.FunctionType.isAbstractMethod(t.functionType)?K.AnyType.create():K.FunctionType.isGenerator(t.functionType)?(0,W.getDeclaredGeneratorReturnType)(t.functionType):t.functionType.details.declaredReturnType:K.AnyType.create()}function Va(e){return(0,K.isInstantiableClass)(e.classType)?(0,W.partiallySpecializeType)(Da(e.symbol),e.classType,void 0,null!=ee?ee:K.UnknownType.create()):K.UnknownType.create()}function Ra(e,t){if((0,K.isInstantiableClass)(e.classType)){const n=Na(e.symbol);if(n)return Ea(n.type),{type:(0,W.partiallySpecializeType)(n.type,e.classType,t),isIncomplete:!!n.isIncomplete}}}function La(e,t,n,a,i,r,s,o){if(K.ClassType.isHierarchyPartiallyEvaluated(e)||K.ClassType.isHierarchyPartiallyEvaluated(t))return!0;if(K.ClassType.isTypedDictClass(e)&&K.ClassType.isTypedDictClass(t)&&!K.ClassType.isSameGenericClass(e,t))return!!(0,G.assignTypedDictToTypedDict)(di,e,t,n,a,r,s)&&(K.ClassType.isFinal(e)!==K.ClassType.isFinal(t)?(null==n||n.addMessage(y.Localizer.DiagnosticAddendum.typedDictFinalMismatch().format({sourceType:ci((0,W.convertToInstance)(t)),destType:ci((0,W.convertToInstance)(e))})),!1):0==(1&r)||(0,G.assignTypedDictToTypedDict)(di,t,e,void 0,void 0,r,s));const p=H.get(e.details.fullName);if(p&&p.some((e=>t.details.mro.some((t=>(0,K.isClass)(t)&&e===t.details.fullName))))&&0==(1&r))return!0;const c=[],d=K.ClassType.isDerivedFrom(t,e,c);if(K.ClassType.isProtocolClass(e)&&!d)return!!(0,z.assignClassToProtocol)(di,e,t,null==n?void 0:n.createAddendum(),a,i,r,!1,s)||(null==n||n.addMessage(y.Localizer.DiagnosticAddendum.protocolIncompatible().format({sourceType:ci((0,W.convertToInstance)(t)),destType:ci((0,W.convertToInstance)(e))})),!1);if((0==(1&r)||K.ClassType.isSameGenericClass(t,e))&&d&&((0,l.assert)(c.length>0),function(e,t,n,a,i,r,s,o){let l,p=t;if(jn(e),0!=(1&s)){if(void 0!==t.literalValue!==(void 0!==e.literalValue))return!1}else if(K.ClassType.isBuiltIn(e,"object"))return!0;for(let e=n.length-1;e>=0;e--){const t=n[e];if((0,K.isUnknown)(t))return!0;if(e<n.length-1){let e=p;K.ClassType.isBuiltIn(p,"NamedTuple")&&K.ClassType.isBuiltIn(t,"tuple")&&l&&(e=l),p=(0,W.specializeForBaseClass)(e,t)}if(0!==K.ClassType.getTypeParameters(t).length){if(!t.typeArguments)return!0;l=p}}if(0!=(1&s)){if(void 0!==t.literalValue!==(void 0!==e.literalValue))return!1}if(e.tupleTypeArguments&&p.tupleTypeArguments)return function(e,t,n,a,i,r,s){var o,l;const p=[...null!==(o=e.tupleTypeArguments)&&void 0!==o?o:[]],c=[...null!==(l=t.tupleTypeArguments)&&void 0!==l?l:[]];let d;2&r?(ja(c,p),d=p.findIndex((e=>e.isUnbounded))):(ja(p,c),d=c.findIndex((e=>e.isUnbounded)));if(c.length===p.length)for(let e=0;e<c.length;e++){const t=null==n?void 0:n.createAddendum();if(!Wa(p[e].type,c[e].type,null==t?void 0:t.createAddendum(),a,i,r,s))return t&&t.addMessage(y.Localizer.DiagnosticAddendum.tupleEntryTypeMismatch().format({entry:e+1})),!1}else if(d<0)return null==n||n.addMessage(y.Localizer.DiagnosticAddendum.tupleSizeMismatch().format({expected:p.length,received:c.length})),!1;return!0}(e,p,a,i,r,s,o);if(e.typeArguments)return Ba(e,p,a,i,r,s,o);if(i&&p.typeArguments&&!i.isLocked()){const t=p.typeArguments;for(let n=0;n<e.details.typeParameters.length;n++){const a=n<t.length?t[n]:K.UnknownType.create();i.setTypeVarType(e.details.typeParameters[n],void 0,void 0,a)}}return!0}(e,t,c,null==n?void 0:n.createAddendum(),a,i,r,s)))return!0;if(K.ClassType.isBuiltIn(e,"object")&&0==(1&r))return!0;const u=o?K.ClassType.cloneAsInstance(e):e,m=o?K.ClassType.cloneAsInstance(t):t;let g=ci(u),h=ci(m);return g===h&&e.details.fullName&&t.details.fullName&&(g=e.details.fullName,h=t.details.fullName),null==n||n.addMessage(y.Localizer.DiagnosticAddendum.typeIncompatible().format({sourceType:h,destType:g})),!1}function Ua(e,t,n=!0,a=0){(0,l.assert)(K.ClassType.isSameGenericClass(e,t)),(0,l.assert)(e.details.typeParameters.length>0);const i=new p.DiagnosticAddendum,r=new q.TypeVarContext;let s=!0;return e.details.fields.forEach(((n,o)=>{if(!s||n.isIgnoredForProtocolMatch())return;if("__new__"===o||"__init__"===o)return;const p=(0,W.lookUpClassMember)(t,o);(0,l.assert)(void 0!==p);let c=Da(n);const d=Va(p);if(c=(0,W.partiallySpecializeType)(c,e),(0,K.isClassInstance)(c)&&K.ClassType.isPropertyClass(c)&&(0,K.isClassInstance)(d)&&K.ClassType.isPropertyClass(d))(0,E.assignProperty)(di,K.ClassType.cloneAsInstantiable(c),K.ClassType.cloneAsInstantiable(d),e,t,i,r,void 0,a)||(s=!1);else{const t=n.getDeclarations()[0];let l=0;1!==(null==t?void 0:t.type)||ii(t)||K.ClassType.isFrozenDataClass(e)||(0,R.isPrivateOrProtectedName)(o)||(l|=1),Wa(c,d,i,r,void 0,l,a)||(s=!1)}})),!!s&&(e.details.baseClasses.forEach((i=>{if((0,K.isInstantiableClass)(i)&&!K.ClassType.isBuiltIn(i,"object")&&!K.ClassType.isBuiltIn(i,"Protocol")&&!K.ClassType.isBuiltIn(i,"Generic")&&i.details.typeParameters.length>0){const r=(0,W.specializeForBaseClass)(e,i),o=(0,W.specializeForBaseClass)(t,i);n||r.details.typeParameters.forEach(((e,t)=>{if(!e.details.isParamSpec&&!e.details.isVariadic&&!e.details.isSynthesized&&o.typeArguments&&t<o.typeArguments.length&&r.typeArguments&&t<r.typeArguments.length){const n=e.details.declaredVariance;(0,K.isTypeVar)(o.typeArguments[t])?2!==n&&4!==n||(s=!1):(0,K.isTypeVar)(r.typeArguments[t])&&(2!==n&&3!==n||(s=!1))}})),s&&!Ua(r,o,n,a)&&(s=!1)}})),s)}function ja(e,t){const n=e.findIndex((e=>(0,K.isVariadicTypeVar)(e.type))),a=e.findIndex((e=>e.isUnbounded)),i=t.findIndex((e=>e.isUnbounded));if(i>=0){const n=t.length>0?t[i].type:K.AnyType.create();for(;t.length<e.length;)t.splice(i,0,{type:n,isUnbounded:!0})}if(a>=0||n>=0){const i=t.length-e.length+1;if(i>=0)if(n>=0){if(ne&&(0,K.isInstantiableClass)(ne)){const e=t.splice(n,i),a=(0,W.convertToInstance)((0,W.specializeTupleClass)(ne,e.map((e=>({type:e.type,isUnbounded:e.isUnbounded}))),!0,!0));t.splice(n,0,{type:a,isUnbounded:!1})}}else{const e=t.splice(a,i).map((e=>(0,K.isTypeVar)(e.type)&&(0,K.isUnpackedVariadicTypeVar)(e.type)&&!e.type.isVariadicInUnion?K.TypeVarType.cloneForUnpacked(e.type,!0):e.type));t.splice(a,0,{type:e.length>0?(0,K.combineTypes)(e):K.AnyType.create(),isUnbounded:!1})}}}function Ba(e,t,n,a,i,r,s){var o,c,d;(0,l.assert)(K.ClassType.isSameGenericClass(e,t)),jn(e);const u=K.ClassType.getTypeParameters(e);let m,g;if(!e.typeArguments||!t.typeArguments)return!0;K.ClassType.isTupleClass(e)?(m=null!==(c=null===(o=e.tupleTypeArguments)||void 0===o?void 0:o.map((e=>e.type)))&&void 0!==c?c:[],g=null===(d=t.tupleTypeArguments)||void 0===d?void 0:d.map((e=>e.type))):(m=e.typeArguments,g=t.typeArguments);let h=!0;return null==g||g.forEach(((t,o)=>{const l=o>=m.length?m.length-1:o,c=l>=0?m[l]:K.UnknownType.create(),d=l<u.length?u[l]:void 0,g=new p.DiagnosticAddendum,f=d?K.TypeVarType.getVariance(d):3;let T,v;if(3===f?(T=128|r,v=y.Localizer.DiagnosticAddendum.typeVarIsCovariant):4===f?(T=2^r|128,v=y.Localizer.DiagnosticAddendum.typeVarIsContravariant):(T=129|r,v=y.Localizer.DiagnosticAddendum.typeVarIsInvariant),!Wa(4===f?t:c,4===f?c:t,g,4===f?i:a,4===f?a:i,T,s)&&!K.ClassType.isPseudoGenericClass(e)){if(n)if(d){n.createAddendum().addMessage(v().format({name:K.TypeVarType.getReadableName(d),...pi(t,c)}))}else n.addAddendum(g);h=!1}})),h}function Wa(e,t,n,a,i,r=0,s=0){var p,c;if(e===t&&!(0,W.requiresSpecialization)(e))return!0;if(s>K.maxTypeRecursionCount)return!0;if(s++,(0,K.isTypeVar)(e)&&e.details.recursiveTypeAliasScopeId&&(0,K.isTypeVar)(t)&&t.details.recursiveTypeAliasScopeId){if((null===(p=e.typeAliasInfo)||void 0===p?void 0:p.typeArguments)&&(null===(c=t.typeAliasInfo)||void 0===c?void 0:c.typeArguments)&&e.details.recursiveTypeAliasScopeId===t.details.recursiveTypeAliasScopeId){let o=!0;const l=t.typeAliasInfo.typeArguments;return e.typeAliasInfo.typeArguments.forEach(((e,t)=>{Wa(e,t<l.length?l[t]:K.UnknownType.create(),n,a,i,r,s)||(o=!1)})),o}if(0!=(4&r))return!0;r|=4}const d=(0,W.transformPossibleRecursiveTypeAlias)(e),u=(0,W.transformPossibleRecursiveTypeAlias)(t);if((d!==e&&(0,K.isUnion)(d)||u!==t&&(0,K.isUnion)(u))&&s>10)return!((0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"str")&&(0,K.isUnion)(d))||d.subtypes.some((e=>(0,K.isClassInstance)(e)&&K.ClassType.isBuiltIn(e,["object","str"])));if(e=d,t=u,(0,K.isUnbound)(e)||(0,K.isUnbound)(t))return!0;0!=(16&r)&&(t=mt(t));const m=r;if(r&=-65,(0,K.isTypeVar)(e)){if((0,W.isTypeVarSame)(e,t))return!e.scopeId||!(null==a?void 0:a.hasSolveForScope(e.scopeId))||(0,_.assignTypeToTypeVar)(di,e,t,n,a,r,s);if(function(e,t,n){return!(0,K.findSubtype)(t,(t=>{var a;if((0,K.isTypeSame)(e,t,{ignorePseudoGeneric:!0},n))return!1;const i=K.TypeVarType.getNameWithScope(e),r=(null!==(a=(0,W.getTypeCondition)(t))&&void 0!==a?a:[]).filter((e=>e.typeVarName===i));return 0===r.length||!r.some((a=>a.typeVarName===K.TypeVarType.getNameWithScope(e)&&(e.details.boundType?((0,l.assert)(0===a.constraintIndex,"Expected constraint for bound TypeVar to have index of 0"),Wa(e.details.boundType,t,void 0,void 0,void 0,0,n)):!(e.details.constraints.length>0)||((0,l.assert)(a.constraintIndex<e.details.constraints.length,"Constraint for constrained TypeVar is out of bounds"),Wa(e.details.constraints[a.constraintIndex],t,void 0,void 0,void 0,0,n)))))}))}(e,t,s))return!0;const o=e;if(K.TypeBase.isInstantiable(e)===K.TypeBase.isInstantiable(t)&&t.condition&&t.condition.some((e=>!e.isConstrainedTypeVar&&e.typeVarName===o.nameWithScope)))return!0;if((0,K.isUnion)(t)){const n=(0,K.removeFromUnion)(t,(e=>(0,K.isAnyOrUnknown)(e)));if((0,K.isTypeSame)(e,n))return!0}if((0,K.isTypeVar)(t)&&t.details.isSynthesizedSelf&&t.details.boundType&&e.details.isSynthesizedSelf&&e.details.boundType&&K.TypeBase.isInstance(t)===K.TypeBase.isInstance(e))return 0==(2&r)&&a&&(0,_.assignTypeToTypeVar)(di,e,t,n,a,m,s),!0;if((0,K.isVariadicTypeVar)(e)&&(0,K.isClassInstance)(t)&&(0,W.isTupleClass)(t)&&t.tupleTypeArguments&&1===t.tupleTypeArguments.length&&(0,K.isTypeSame)(e,t.tupleTypeArguments[0].type,{},s))return!0;if(0==(2&r)||!(0,K.isTypeVar)(t)){const o=0==(2&r)?a:i;return!!(0,_.assignTypeToTypeVar)(di,e,t,n,null!=o?o:new q.TypeVarContext,m,s)&&(!(0,K.isAnyOrUnknown)(t)||0==(16&r))}}if((0,K.isTypeVar)(t)){if(0!=(2&r)){if(i&&i.hasSolveForScope((0,W.getTypeVarScopeId)(t))){if((0,_.assignTypeToTypeVar)(di,t,e,n,i,m,s))return!0;let a=!1;return(0,K.isUnion)(e)&&(0,W.doForEachSubtype)(e,(e=>{(0,_.assignTypeToTypeVar)(di,t,e,n,i,m,s)&&(a=!0)})),a}return Wa(mt(e),mt(t),n,void 0,void 0,m,s)}if(0!=(1&r)){if((0,K.isAnyOrUnknown)(e))return!0;if((0,K.isParamSpec)(t)&&(0,K.isFunction)(e)&&K.FunctionType.shouldSkipArgsKwargsCompatibilityCheck(e)&&e.details.parameters.length<=2)return!0;if(!(0,K.isUnion)(e))return null==n||n.addMessage(y.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(pi(t,e))),!1}}if((0,K.isAnyOrUnknown)(e))return!0;if((0,K.isAnyOrUnknown)(t)){const n=0==(2&r)?a:i;if(n){const a=(0,W.isEllipsisType)(t)?K.AnyType.create():t;(0,W.setTypeArgumentsRecursive)(e,a,n,s)}if(0==(16&r))return!0}if((0,K.isNever)(t)){if(0!=(1&r))return(0,K.isNever)(e);const t=0==(2&r)?a:i;return t&&(0,W.setTypeArgumentsRecursive)(e,K.UnknownType.create(),t,s),!0}if((0,K.isUnion)(e)){if((0,K.isUnion)(t))return qa(e,t,void 0,a,i,m,s);const n=null==a?void 0:a.clone(),r=null==i?void 0:i.clone();if($a(e,t,void 0,n,r,m,s))return a&&n&&a.copyFromClone(n),i&&r&&i.copyFromClone(r),!0}const g=mt(t);if((0,K.isUnion)(g))return qa(e,g,n,a,i,m,s);if((0,K.isUnion)(e))return $a(e,t,n,a,i,m,s);if((0,K.isNoneInstance)(e)){if((0,K.isNoneInstance)(t))return!0;if((0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"NoneType"))return!0}if((0,K.isNoneTypeClass)(e)){if((0,K.isNoneTypeClass)(t))return!0;if((0,K.isInstantiableClass)(t)&&K.ClassType.isBuiltIn(t,"NoneType"))return!0}if((0,K.isClassInstance)(g)&&K.ClassType.isBuiltIn(g,"type")){const o=g.typeArguments;let l,p;if(o&&o.length>=1){if(l=o[0],(0,K.isAnyOrUnknown)(l))return!(!(0,K.isClassInstance)(e)||!K.ClassType.isBuiltIn(g,"type"))||K.TypeBase.isInstantiable(e);p=(0,W.convertToInstantiable)(l)}else K.TypeBase.isInstantiable(e)&&(l=null!=X?X:K.AnyType.create(),p=g);if(p&&l&&((0,K.isClassInstance)(l)||(0,K.isTypeVar)(l)))return!!Wa(e,p,null==n?void 0:n.createAddendum(),a,i,r,s)||(null==n||n.addMessage(y.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(pi(t,e))),!1)}if((0,K.isInstantiableClass)(e)&&(0,K.isInstantiableClass)(g))return K.ClassType.isProtocolClass(e)&&K.ClassType.isProtocolClass(g)&&(0,K.isInstantiableClass)(t)&&!t.includeSubclasses?(null==n||n.addMessage(y.Localizer.DiagnosticAddendum.protocolSourceIsNotConcrete().format({sourceType:ci((0,W.convertToInstance)(t)),destType:ci(e)})),!1):!!La(e,g,n,a,i,r,s,!1)||(null==n||n.addMessage(y.Localizer.DiagnosticAddendum.typeAssignmentMismatch().format(pi(t,e))),!1);if((0,K.isClassInstance)(e)){if(K.ClassType.isBuiltIn(e,"Type")){const o=e.typeArguments;if(o&&o.length>=1&&K.TypeBase.isInstance(o[0])&&K.TypeBase.isInstantiable(t))return Wa(o[0],(0,W.convertToInstance)(t),n,a,i,r,s)}else if(K.ClassType.isBuiltIn(e,"type")){if((0,K.isAnyOrUnknown)(t)&&0!=(16&r))return!1;if(K.TypeBase.isInstantiable(t)){return!((0,K.isClass)(t)&&void 0!==t.literalValue)}}else if(K.ClassType.isBuiltIn(e,"TypeGuard")&&0!=(64&m)&&(0,K.isClassInstance)(t)&&K.ClassType.isBuiltIn(t,"bool"))return!0;let o=mt(t);if((0,K.isClass)(o)&&K.TypeBase.isInstance(o)){if(void 0!==e.literalValue){if(void 0===o.literalValue||!K.ClassType.isLiteralValueSame(o,e))return null==n||n.addMessage(y.Localizer.DiagnosticAddendum.literalAssignmentMismatch().format({sourceType:ci(t),destType:ci(e)})),!1}if(K.ClassType.isBuiltIn(e,"LiteralString")){if(K.ClassType.isBuiltIn(o,"str")&&void 0!==o.literalValue)return!0;if(K.ClassType.isBuiltIn(o,"LiteralString"))return!0}else K.ClassType.isBuiltIn(o,"LiteralString")&&re&&(0,K.isInstantiableClass)(re)&&(o=K.ClassType.cloneAsInstance(re));return!!La(K.ClassType.cloneAsInstantiable(e),K.ClassType.cloneAsInstantiable(o),n,a,i,r,s,!0)}if((0,K.isFunction)(o)||(0,K.isOverloadedFunction)(o)){const t=Ha(e,s);if(t)return Wa(t,o,n,a,i,r,s);if(te&&(0,K.isClassInstance)(te))return Wa(e,te,n,a,i,r,s)}else if((0,K.isModule)(o)){if(K.ClassType.isBuiltIn(e,"ModuleType"))return!0;if(K.ClassType.isProtocolClass(e))return(0,z.assignModuleToProtocol)(di,K.ClassType.cloneAsInstantiable(e),o,n,a,r,s)}else if((0,K.isInstantiableClass)(o)){const t=Ha(e,s);if(t)return Wa(t,o,n,a,i,r,s);if(K.ClassType.isProtocolClass(e))return(0,z.assignClassToProtocol)(di,K.ClassType.cloneAsInstantiable(e),o,n,a,i,r,!0,s);const l=o.details.effectiveMetaclass;if(l)ret